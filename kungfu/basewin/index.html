<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>功夫量化文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/kungfu/logo.jpg">
    <meta name="description" content="基于官方文档制作">
    
    <link rel="preload" href="/kungfu/assets/css/0.styles.e1af5fd6.css" as="style"><link rel="preload" href="/kungfu/assets/js/app.d8936bc4.js" as="script"><link rel="preload" href="/kungfu/assets/js/2.92b4690c.js" as="script"><link rel="preload" href="/kungfu/assets/js/1.216a80cf.js" as="script"><link rel="preload" href="/kungfu/assets/js/11.9d149074.js" as="script"><link rel="prefetch" href="/kungfu/assets/js/10.e24291e3.js"><link rel="prefetch" href="/kungfu/assets/js/12.971a181c.js"><link rel="prefetch" href="/kungfu/assets/js/13.fb7ac4c6.js"><link rel="prefetch" href="/kungfu/assets/js/14.1d59b1b8.js"><link rel="prefetch" href="/kungfu/assets/js/15.55e5e943.js"><link rel="prefetch" href="/kungfu/assets/js/16.31ea2e3c.js"><link rel="prefetch" href="/kungfu/assets/js/17.80805348.js"><link rel="prefetch" href="/kungfu/assets/js/18.80f981f0.js"><link rel="prefetch" href="/kungfu/assets/js/19.bf59c4df.js"><link rel="prefetch" href="/kungfu/assets/js/20.4b4a7f9d.js"><link rel="prefetch" href="/kungfu/assets/js/21.3aeaccd0.js"><link rel="prefetch" href="/kungfu/assets/js/22.ecd36846.js"><link rel="prefetch" href="/kungfu/assets/js/23.db7dac14.js"><link rel="prefetch" href="/kungfu/assets/js/24.89d19a7b.js"><link rel="prefetch" href="/kungfu/assets/js/3.bd263672.js"><link rel="prefetch" href="/kungfu/assets/js/4.4e742319.js"><link rel="prefetch" href="/kungfu/assets/js/5.7cdffb22.js"><link rel="prefetch" href="/kungfu/assets/js/6.c07d7939.js"><link rel="prefetch" href="/kungfu/assets/js/7.0624a7ab.js"><link rel="prefetch" href="/kungfu/assets/js/vendors~docsearch.38ca1a7a.js">
    <link rel="stylesheet" href="/kungfu/assets/css/0.styles.e1af5fd6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kungfu/" class="home-link router-link-active"><!----> <span class="site-name">功夫量化文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kungfu/LinuxKF/" class="nav-link">
  Linux上手指南
</a></div><div class="nav-item"><a href="http://docs.kungfu-trader.com/latest/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  功夫官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kungfu/LinuxKF/" class="nav-link">
  Linux上手指南
</a></div><div class="nav-item"><a href="http://docs.kungfu-trader.com/latest/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  功夫官方文档
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/kungfu/basewin/#一、-安装-配置和添加策略" class="sidebar-link">一、 安装，配置和添加策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_1-1、-安装" class="sidebar-link">1.1、 安装</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_1-2、-配置" class="sidebar-link">1.2、 配置</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_1-3、添加策略" class="sidebar-link">1.3、添加策略</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_1-4、-小结" class="sidebar-link">1.4、 小结</a></li></ul></li><li><a href="/kungfu/basewin/#二、-功夫量化-python-api-入门" class="sidebar-link">二、 功夫量化  Python API 入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_2-1、-初识-context-对象-object" class="sidebar-link">2.1、 初识 context 对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#context-小结" class="sidebar-link">context 小结：</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_2-2、-基本方法-函数" class="sidebar-link">2.2、 基本方法（函数）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#基本方法-小结" class="sidebar-link">基本方法 小结</a></li></ul></li><li><a href="/kungfu/basewin/#三、-交易方法-函数" class="sidebar-link">三、 交易方法（函数）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_3-1-报单-context-insert-order" class="sidebar-link">3.1 报单 context.insert_order()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_3-2-报单回报-on-order" class="sidebar-link">3.2 报单回报 on_order():</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_3-3-成交回报-on-trade" class="sidebar-link">3.3 成交回报 on_trade():</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_3-4-撤单-context-cancel-order" class="sidebar-link">3.4 撤单 context.cancel_order()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_3-5、-小结" class="sidebar-link">3.5、 小结</a></li></ul></li><li><a href="/kungfu/basewin/#四、逐笔行情" class="sidebar-link">四、逐笔行情</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_4-1-逐笔行情-on-transaction" class="sidebar-link">4.1 逐笔行情 on_transaction():</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_4-2-逐笔委托-on-entrust" class="sidebar-link">4.2 逐笔委托 on_entrust():</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_4-3、-小结" class="sidebar-link">4.3、 小结</a></li></ul></li><li><a href="/kungfu/basewin/#五、帐户信息" class="sidebar-link">五、帐户信息</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-1、策略程序的订单薄-context-book-对象" class="sidebar-link">5.1、策略程序的订单薄  context.book 对象</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-2、-帐户的订单薄-context-get-account-book" class="sidebar-link">5.2、 帐户的订单薄  context.getaccountbook()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-3、-资产信息-asset-对象-object" class="sidebar-link">5.3、 资产信息 asset 对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-4、-手续费-commissions-对象-object" class="sidebar-link">5.4、 手续费 commissions  对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-5、-交易品种-instruments-对象-object" class="sidebar-link">5.5、 交易品种 instruments  对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-6、持有-多-单列表-long-positions-对象-object" class="sidebar-link">5.6、持有（多）单列表 long_positions 对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-7、委托单列表-order-inputs-orders-对象-object" class="sidebar-link">5.7、委托单列表 order_inputs/orders 对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-8、成交单列表-traders-对象-object" class="sidebar-link">5.8、成交单列表 traders 对象（Object）</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-9、是否持有指定品种的订单-has-position" class="sidebar-link">5.9、是否持有指定品种的订单 has_position()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-10、-是否持有指定品种的多单-has-long-position" class="sidebar-link">5.10、 是否持有指定品种的多单 haslongposition()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-11、-查询多个品种的持单-has-position-for" class="sidebar-link">5.11、 查询多个品种的持单 haspositionfor()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-12、-获取持有订单的信息-get-position" class="sidebar-link">5.12、 获取持有订单的信息  get_position()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_5-13、-小结" class="sidebar-link">5.13、 小结</a></li></ul></li><li><a href="/kungfu/basewin/#六、小工具-utils" class="sidebar-link">六、小工具 Utils</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_6-1、-获取交易品种在持有单列表中的键-key-值-hash-instrument" class="sidebar-link">6.1、 获取交易品种在持有单列表中的键（Key）值 hash_instrument()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_6-2、-检查报价是否有效-is-valid-price" class="sidebar-link">6.2、 检查报价是否有效 isvalidprice()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_6-3、-检查报单状态是否为最终状态-is-final-status" class="sidebar-link">6.3、 检查报单状态是否为最终状态  isfinalstatus()</a></li><li class="sidebar-sub-header"><a href="/kungfu/basewin/#_6-4、-获取交易品种的类型-get-instrument-type" class="sidebar-link">6.4、 获取交易品种的类型 getinstrumenttype()</a></li></ul></li><li><a href="/kungfu/basewin/#后记" class="sidebar-link">后记</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>玩了 量化交易 也差不多有 2 年多了，总算有个大概的认识了。</p> <p>天朝内的投资市场A股（包括期货），简单点的量化工具如 <u>迅投QMT、PTrade 和 掘金量化</u> 之类的，还是比较容易上手的。有点 Python 基础不是什么难事儿。打比方的话就如一辆 奥托，也不是不能开，就那么回事儿。主要是在支持 Level 2 逐笔行情方面不给力。必竟是在公开的互联网上，在用户的电脑上运行。所以硬件性能、安全性、都不能有太多要求。散户玩玩还是可以的。</p> <p>功夫量化 算是可以在 服务器 端运行的工具了，可以在券商托管的机房里，接收 Level 2 逐笔行情，真正毫秒级，（纳秒那真是吹牛逼的）。目前个人也接触了几个版本了，中泰的 SmartX 内置的功夫（有加工和修改）、华鑫证券的纯原生功夫（已升级到2.4版）、银河证券的功夫（略有加工和修改2.4版）。可以比喻成 奥迪了，做A股性能足足的了。特此整理下笔记，以备日后运用得更加顺畅。</p> <p>2022/9</p> <h2 id="一、-安装-配置和添加策略"><a href="#一、-安装-配置和添加策略" class="header-anchor">#</a> 一、 安装，配置和添加策略</h2> <p>本章指导用户从 0 开始，在 Windows 系统中安装 功夫量化 ，并配置好 模拟（SIM）帐户和行情源，最后添加一个 测试程序，在日志中打印输出 “Hellow World”。</p> <h3 id="_1-1、-安装"><a href="#_1-1、-安装" class="header-anchor">#</a> 1.1、 安装</h3> <p>纯正的 功夫量化，当然来自其官网：</p> <p>www.kungfu-trader.com</p> <p>但是，强烈建议还是找券商的客户经理要一个 安装包 比较合适。因为各券商 与 功夫量化 合作，都会把自家的柜台接口事先写好，用起来方便。同时还根据自家的情况做过一些小小的修改。如果用网上公开的版本，很可能与自己的券商接口接不上，或者有这样那样的一些小Bug，自己去一一排查吧，费时费力。（你要是就喜欢解难题，那祝开心就好。）</p> <p>最容易上手的 功夫量化 ，就直接去官网下载一个 Windows 版，在自己的电脑上就可以跑起来了。</p> <p><img src="/kungfu/assets/img/gongfu01.b7c85b4a.png" alt="官网首页下载"></p> <p>就在首页底部即可看到下载的按钮。</p> <p><img src="/kungfu/assets/img/gongfu_win.840b4e79.png" alt="下载Windows版本"></p> <p>如介绍那样，功夫量化 内置了 sim模拟柜台，开箱即用、简单方便。当然只是用来模拟和学习。要真正用到实盘上，还得花钱，或咨询你的客户经理。</p> <p>本篇的内容是从 功夫量化 Windows 版开始上手的，对初学者来说是最容易学习的方式，图形化鼠标操作应该十分熟悉。如果你就是要玩硬核的，就要挑战高难度，不然不开心！可以尝试用 Linux 版本。（厉害了!老铁）</p> <p>点击 Windows 下载后，会得到一个安装文件，如：</p> <p><code>Kungfu-2.3.9-win-app-07141510.exe</code></p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEwAAABqCAIAAACZACBXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFwmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdEV2dD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlRXZlbnQjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMi0wOS0zMFQxOTo0Njo0NCswODowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAyMi0wOS0zMFQxOTo0Njo0NCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjItMDktMzBUMTk6NDY6NDQrMDg6MDAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6YzU3YzE1Y2YtZmQ5OC0yNTRjLTk0YjEtOTg1NWRhMDNjOWQ0IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6OTc2NmE1MmMtZTdmNy1mNzQzLTllNTItYjhj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" alt="Windows版安装文件"></p> <p>安装过程十分简单，就是一路 “下一步Next”就好，没有任何难度。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>可能会出现的问题是，你的 Windows 系统中缺失 C++ 相关的组件。 请下载 <code>Visual C++ Redistributable for Visual Studio 2019</code> 安装一下就好。或者把补丁打齐、把 微软运行库 安装一下即可解决。</p></div> <p>安装成功之后，在 Windows 桌面上就会出现一个 功夫 的图标，如下图所示：</p> <p><img src="data:image/png;base64,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" alt="Windows功夫图标"></p> <p>用鼠标左键双击这个图标，即可开始运行 功夫量化。</p> <p>看，安装过程，就是如此简单，你已经全部完成了。你应该看到如下的主界面了</p> <h3 id="_1-2、-配置"><a href="#_1-2、-配置" class="header-anchor">#</a> 1.2、 配置</h3> <p><img src="/kungfu/assets/img/gongfuUI.145d8336.png" alt="功夫界面"></p> <p>如果你的电脑网络正常，请关注一下界面的左下角，有一个 “主进程状态”，</p> <p><img src="/kungfu/assets/img/Master01.ca2fd14f.png" alt="主进程状态"></p> <p>绿色表示一切正常。鼠标左键点击一下，可以看到 主控进程、数据进程和通信进程，都是在 运行中  的状态，这就很 OK 了。</p> <p>细心如你，一定发现了，在 “主进程状态” 旁边，还有一个 “帐户进程状态”，是灰色的，这肯定表示 没有正常工作 啊。</p> <p>是的，因为刚刚安装好，还没有添加 帐户 和 行情源 啊。</p> <p>帐户 ———— 就是用来 模拟交易，买卖股票的罗。（你要直接上实盘？那你厉害！666666666）<br>
行情源 ———— 当然就是用来接收报价数据的啊。</p> <p>如果都没有的话，那玩啥？所以，功夫量化 已经准备好了开箱即用的 sim（模拟）帐号和行情源。如果你是用券商提供的安装包安装的，那其中应该已经内置了模拟帐户和行情源，都来自于你的券商。比如，中泰的柜台叫 XTP、华鑫的柜台叫 tora、银河证券的柜台叫 ItpGalaxy，行情源叫 HuarGalaxy......诸如此类（名称不整洋气点，没有排面！），各家都有起名大师。作为初学者，我们就都用 sim（模拟）吧。</p> <h4 id="_1-2-1、-添加柜台帐户-简称td"><a href="#_1-2-1、-添加柜台帐户-简称td" class="header-anchor">#</a> 1.2.1、 添加柜台帐户（简称TD）</h4> <p>请点击主界面 帐户列表 区域的 “添加” 按钮</p> <p><img src="/kungfu/assets/img/addaccount01.7dfd018c.png" alt="添加柜台帐户1"></p> <p>在弹出的小窗口中，点击选择 SIM（模拟），然后点击确定。</p> <p><img src="/kungfu/assets/img/addaccount02.c64b18e3.png" alt="添加柜台帐户2"></p> <p>在接下来的窗口中，输入帐号，任意几个数字都可以。然后在下面的 match_mode（撮合模式）中，选择 fill（全部成交）</p> <p><img src="/kungfu/assets/img/addaccount03.00c9a17a.png" alt="添加柜台帐户3"></p> <p>顺便解释一下撮合模式中的其它几个选项，分别代表：</p> <table><thead><tr><th>选项</th> <th>撮合模式</th></tr></thead> <tbody><tr><td>reject</td> <td>拒绝成交</td></tr> <tr><td>pend</td> <td>挂单</td></tr> <tr><td>cancel</td> <td>撤单</td></tr> <tr><td>partialfillandcancel</td> <td>部分成交后撤单</td></tr> <tr><td>partialfill</td> <td>部分成交</td></tr> <tr><td>fill</td> <td>全部成交</td></tr></tbody></table> <p>基本上在实际交易的过程中，这些情况都会遇到。作为初学者，我们就先选择 fill（全部成交）吧，意即，这个模拟帐户中，只要下了委托单，就肯定会成交。不会出现撤单啊、拒单啊、部分成交啊之类的情况。以后，根据需要、再选择其它的撮合模式分别做测试吧。</p> <p>最后，请点击确定。你会看到主界面上的 帐户列表 区域，出现了刚刚添加的模拟帐户。恭喜，这就表示添加柜台帐户，成功！</p> <p>这时，请点击 “进程” 下面的 开关，成为绿色，此时 状态 显示为 “就绪”</p> <p><img src="/kungfu/assets/img/addaccount05.a416eb3c.png" alt="添加柜台帐户5"></p> <p>你可以通过滑动下面的滑块，看到右侧更多的信息。在帐户这一行的末尾，有 3 个按钮，分别是 “打开日志文件”、“帐户设置”和“删除帐户”，其功能就是字面意思，应该不难理解吧。</p> <p><img src="/kungfu/assets/img/addaccount04.a75012ac.png" alt="添加柜台帐户4"></p> <p>添加帐户的操作，就到这里了。</p> <h4 id="_1-2-2、-添加行情源-简称md"><a href="#_1-2-2、-添加行情源-简称md" class="header-anchor">#</a> 1.2.2、 添加行情源（简称MD）</h4> <p>点击 主界面 左上区域 中的 “行情源” 标签，即可切换到 行情源 面板。类拟 帐户列表 中一样，也有个 “添加” 按钮</p> <p><img src="/kungfu/assets/img/addMD01.07f27e7e.png" alt="添加行情源1"></p> <p>在弹出的小窗口中，点击选择 SIM（模拟），然后点击确定。</p> <p><img src="/kungfu/assets/img/addMD02.2e0308cb.png" alt="添加行情源2"></p> <p>完事了，就这么简单。</p> <p>这时可以点击 “进程” 下面的 开关，使之成为绿色，此时 状态 显示为 “就绪”，就一切 OK 了。</p> <p><img src="/kungfu/assets/img/addMD03.7a7a2665.png" alt="添加行情源2"></p> <p>现在，再看一眼主界面右下角吧，是不是 帐户进程状态 和 主进程状态 一样，都是绿色的了。这就说明 功夫量化 已经完全可用了。</p> <p><img src="/kungfu/assets/img/gongfuUI02.cdd6622e.png" alt="帐户行情全绿"></p> <h3 id="_1-3、添加策略"><a href="#_1-3、添加策略" class="header-anchor">#</a> 1.3、添加策略</h3> <p>用 功夫量化 当然是用来跑策略啊、实现自动交易啊。</p> <p>先准备一个简单的策略程序吧，就用来测试一下。具体代码如下：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source <span class="token operator">=</span> <span class="token string">&quot;sim&quot;</span>          <span class="token comment"># TD 和 MD 的源，都是 sim</span>
account_str <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Hellow World '</span><span class="token punctuation">)</span>
<span class="token comment"># TEST01.py 的内容结束</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>就保存为 TEST01.py 文件吧，呆会儿就能用上。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意 ：</p> <p>策略应和功夫安装目录在一个盘符下面，策略文件路径最好不要有空格。</p> <p>在运行策略之前一定要看下启动的账户柜台进程(td)和行情源柜台进程(md)是否与策略中填写的柜台ID一致</p></div> <p>1、用鼠标左键点击 主界面 最左侧的 “策略” 按钮，以切换到 策略面板。在 策略面板 的 策略区域 右上角有个 “添加” 按钮</p> <p><img src="/kungfu/assets/img/addst01.efa52694.png" alt="添加策略按钮"></p> <p>2、 点击了 “添加” 按钮后，会弹出 “添加策略” 窗口，在其中为策略先起个名字，然后点击 “入口文件” 后面的按钮，选择刚刚准备好的 TEST01.py ，最后点击 “确定” 。</p> <p><img src="data:image/png;base64,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" alt="添加策略"></p> <p>3、成功添加了策略之后，即可在 策略区域 看到刚刚添加的 策略。其所在的一行包括、状态，启动运行的滑动开关，以及最靠右的四个按钮，分别是 查看日志、设置策略、编辑修改 和删除策略</p> <p><img src="/kungfu/assets/img/addst03.074ff02e.png" alt="已添加的策略"></p> <p>4、运行策略，查看日志</p> <p><img src="/kungfu/assets/img/addst04.3ee9beb9.png" alt="运行策略"></p> <p>看到日志中显示了 “Hellow World ”，程序猿们，是不是就秒懂了？</p> <h3 id="_1-4、-小结"><a href="#_1-4、-小结" class="header-anchor">#</a> 1.4、 小结</h3> <p>从一开始，在 Windows 上安装 功夫量化。然后配置好 模拟的柜台帐号与行情源。最后添加一个 测试程序 TEST01.py， 看到日志窗口中输出了经典的 “Hellow World”。应该没有什么难度吧。</p> <p>重要提示：实际工作中，从安装包开始，还是直接找 券商 索取比较好，因为功夫量化是和券商一起工作的。换句话说，券商不支持，单玩 功夫量化 也玩不起来啊。（自己在家模拟玩吗？这么有兴致？）券商的安装包中，通常已经内置了柜台帐号和行情源，配置起来也十分方便，不然你自己猜啊？就算你猜中，接通了，技术上你是牛逼了，但不合法啊！懂？！所以，重点还是在如何写策略程序，用代码实现具体的交易过程，这才是正解。</p> <p>如果你启动 功夫量化 之后，卡在了 “系统提示” ，可运行一次 清理journal，再重启即可。</p> <p><img src="/kungfu/assets/img/journal.c4efc04d.jpg" alt="清理日志"></p> <h2 id="二、-功夫量化-python-api-入门"><a href="#二、-功夫量化-python-api-入门" class="header-anchor">#</a> 二、 功夫量化  Python API 入门</h2> <p>主要介绍 功夫量化 中 Python 的版本以及预先安装好的第三方库。同时初步讨论一个最重要的 对象 <code>context</code> 及其简单的方法（函数）和属性（变量）。然后展示了官网上的 Demo  例程，有编程基础的朋友，阅读了本章之后，基本就可以上手了。</p> <p>所以谓 API （ 应用程序编程接口），简称 接口。在本文档中，说人话就是：把做股票的一些基本操作， 用 Python 这种计算机语言 描述一遍，让电脑可以执行。已经有人（或公司）写好了现成的，可以拿来就用的指令、方法（函数），就是 API，把这些汇集成册，就是 API手册。</p> <p>举个例子：我要下个委托单，买100股 600002这个股票，10.55 的时候买！</p> <p>我们查一下功夫量化的 API 手册，哦，原来这样写：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>    # 买入沪市品种 600002 股票 100股，要价为 10.55 
    context.insert_order(
                         &quot;600002&quot;,           # 品种的代码
                         Exchange.SSE,       # 交易所名称
                         &quot;sim&quot;,              # 柜台的名称
                         &quot;123456&quot;,           # 帐号
                         10.55,              # 价格
                         100,                # 数量
                         PriceType.Limit,    # 价格类型
                         Side.Buy,           # 买卖方向 
                         Offset.Open         # 开平方向
                        )

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这就是学习 API 的作用。你通过学习，把基本操作 与 Python 语言的 API 联系起来，就可以根据策略要求，选择条件组合，打造自己的自动交易程序了。或者为他人代写程序、开辟你的另一条赚钱之路。</p> <p>功夫量化 中已经内置了  Python ，版本是 3.7.5 -&gt; 3.7.9 ，功夫量化 2.4 版之后，把 Python 升级到了 3.8 以上了。同时也带上了一些第三方的 库：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>url = &quot;http://mirrors.aliyun.com/pypi/simple/&quot;
verify_ssl = false
name = &quot;pypi&quot;

[packages]
conan = &quot;==1.22&quot;
pywin32 = {version = &quot;==227&quot;,sys_platform = &quot;== 'win32'&quot;}
pyinstaller = &quot;==3.6&quot;
click = &quot;==7.1.1&quot;
tabulate = &quot;==0.8.6&quot;
prompt_toolkit = &quot;==1.0.14&quot;
PyInquirer = &quot;==1.0.3&quot;
psutil = &quot;==5.7.0&quot;
chinesecalendar = &quot;==1.4.0&quot;
zhdate = &quot;==0.1&quot;
schema = &quot;==0.7.1&quot;
rx = &quot;==3.0.1&quot;
numpy = &quot;==1.16.4&quot;
pandas = &quot;==0.24.2&quot;
statsmodels = &quot;==0.10.1&quot;
sortedcontainers = &quot;==2.1.0&quot;
recordclass = &quot;==0.12.0.1&quot;
dotted_dict = &quot;==1.1.2&quot;
plotly = &quot;==4.0.0&quot;
tushare = &quot;==1.2.39&quot;

[dev-packages]
clang-format = &quot;==9.0.0&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>你可以理解为 功夫量化 也是一个第三方的 库。开始写代码的时候，引用这个 库，就可以方便的调用其中已经写好的各种 方法（函数） 和 属性（变量），来构造你自己的交易策略。省得你还得从头写起，这就是常说的不要自己重复造轮子。</p> <h3 id="_2-1、-初识-context-对象-object"><a href="#_2-1、-初识-context-对象-object" class="header-anchor">#</a> 2.1、 初识 context 对象（Object）</h3> <p><font color="red" size="4"> 最重要的 对象（Object），没有之一 ！！</font></p> <p>既然把 功夫量化 看作是一个 库 来导入，当然就为用起来方便啊，里面有现成的、已经写好的 对象、方法（函数），可以复制粘帖嘛。</p> <p>首先必须要介绍的，最最重要的一个 对象 <font color="red" size="6">  context  </font>。字面意思就是 <u>承上启下关联上下文</u> 的 对象，在整个程序中随处可见，就是传说中的全局范围可见，它就是策略程序的本体。同时，还可以根据需要随时附加上自定义的属性和方法。在其它的量化工具中，也常常可见到类似的 对象，甚至名称也类似 context 。如果把策略程序比喻成盖一座房子、那么 <font color="red" size="6">  context </font> 可以比喻为 水泥或钉子，哪哪儿都用得上它，哪哪儿都需要它。</p> <p>说这么多，证明一下。来罗——</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'这个策略程序的名称是：{} '</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
程序开始
这个策略程序的名称是：test
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>看到了吧，context 有个属性（变量）叫 name ，就是当前运行的这个策略程序的名称。所以说，它就是策略程序的本体。</p> <p>在前面的 Hellow 例子中，其实我们已经用到了</p> <p><code>context.log.info()</code></p> <p>这个 <code>log</code> 其实就是附加在 <code>context</code> 上的一个属性。众所周知，对象 的属性和方法（函数）是可以随时自定义的。你也可以随时写个变量 <code>abc</code> ，然后附加到 <code>context</code> 上，成为它的属性 <code>context.abc</code> ，然后在程序的任何地方，只要有 <code>context</code> ，当然也就有你刚刚自定义的 <code>context.abc</code> 了。（这不就是 全局变量？）甚至，你还可以自定义一个 函数 <code>f_xyz()</code>，然后把这个函数附加到 <code>context</code> 上，这样它就成为了一个方法，<code>context.f_xyz()</code>。同样的，只要有 <code>context</code> 的地方，就可以随时调用 <code>context.f_xyz()</code> 方法，（这个 函数 就成了一个全局函数）这就是 面向对象 的编程特性。</p> <p>好了，先打住。知道你们一个个都要原地起飞了，摩拳擦掌都要开始自己动手写自定义方法和属性了，一个个的癞蛤蟆找青娃 ———— 玩得花。敢不敢先看看 <code>context</code> 已经自带了哪些方法和属性？如果实在不好用，再想着怎么自己去造轮子？用现成的不香吗？</p> <p>请看下面的示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'Hellow World '</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'context是什么？  {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'context的内容：  {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>运行之后会看到如下结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>程序开始

Hellow World

context是什么？ &lt;click.core.Context object at 0x000001BBFA96FEC8&gt;

context的内容： ['__class__', '__delattr__', '__dict__', '__dir__', '__doc__', '__enter__', '__eq__', '__exit__', '__format__', '__ge__', '__getattribute__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__weakref__', '_close_callbacks', '_depth', '_meta', 'abort', 'add_account', 'add_time_interval', 'add_timer', 'allow_extra_args', 'allow_interspersed_args', 'archive_dir', 'args', 'auto_envvar_prefix', 'book', 'books', 'buy', 'call_on_close', 'cancel_order', 'category', 'close', 'color', 'command', 'command_path', 'config_location', 'console_location', 'constants', 'dataset_dir', 'default_map', 'ensure_object', 'exit', 'fail', 'find_object', 'find_root', 'forward', 'get_account_book', 'get_account_cash_limit', 'get_help', 'get_usage', 'group', 'help_option_names', 'hold_book', 'hold_positions', 'home', 'ignore_unknown_options', 'inbox_dir', 'index_location', 'info_name', 'insert_order', 'invoke', 'invoked_subcommand', 'is_book_held', 'is_positions_mirrored', 'location', 'log', 'log_level', 'logger', 'lookup_default', 'loop', 'low_latency', 'make_formatter', 'make_order', 'max_content_width', 'meta', 'mode', 'name', 'now', 'obj', 'params', 'parent', 'path', 'protected_args', 'replay', 'req_deregister', 'req_history_order', 'req_history_trade', 'resilient_parsing', 'runtime_dir', 'runtime_locator', 'scope', 'sell', 'show_default', 'strategy', 'strftime', 'strptime', 'subscribe', 'subscribe_all', 'terminal_width', 'token_normalize_func', 'trading_day', 'utils', 'wc_context']
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>前面的 Hellow World 就不说了。
<code>&lt;click.core.Context object at 0x000001BBFA96FEC8&gt;</code>
表示  context 是一个 对象，0x00开头的那一串字符是 16位进制的内存地址，程序猿们看到了都默默点头。<br>
然后是一个列表，其中每一项都是 context 的一个属性或方法。（有没有吓跑一大群人，哈哈。）</p> <p>别怕，我们先挑两个简单的瞧瞧：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'context.name 表示当前策略名称： {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'context.now() 返回当前时间戳： {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
程序开始
context.name 表示 当前策略名称： TEST01
context.now() 返回当前时间戳： 1636327025027141500
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这么简单的例子就不用多解释了吧？关于 时间戳 其实就是一个 单位为 纳秒 的整数，是从 1970-01-01 00:00:00.000 开始计算的。功夫量化 中用到了 20 位。其实 13 位左右，一般到 秒 或 毫秒 就差不多了。当然现代计算机的算力强劲，纳秒 多牛逼，多么高大上！</p> <p>以上都是幼儿园级别的，敢不敢来 2 个小学一年级以上的？</p> <p>安排</p> <h4 id="_2-1-1、-添加帐户-context-add-account"><a href="#_2-1-1、-添加帐户-context-add-account" class="header-anchor">#</a> 2.1.1、 添加帐户 context.add_account()</h4> <p>任何一个自动交易程序，最关键的第一件事儿，当然是要告诉电脑，你的帐户是什么啊。帐户、柜台都没有，或者写错了，那岂不是天大的笑话。</p> <p>这个方法（函数）就是告诉你的电脑，你要用的帐户是什么。</p> <p>语法： <code>context.add_account(source_id, account_id)</code> <br>
参数：<code>source_id, account_id</code> <br>
source_id 是一个字符串，代表 柜台的名称，如 <code>'sim'</code> ；<br>
account_id 也是一个字符串，一般是一串数字，如 <code>'123456'</code> <br>
返回值： 无<br></p> <h4 id="_2-1-2、-订阅品种-context-subscribe"><a href="#_2-1-2、-订阅品种-context-subscribe" class="header-anchor">#</a> 2.1.2、 订阅品种 context.subscribe()</h4> <p>最关键的第二件事儿，就是要告诉电脑，你准备交易什么品种。你要紧盯全网行情？只要上市的品种，你都要 买买买 ？大哥，豪气！求带我飞！</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>本文档中只讨论A股的交易品种。当然 功夫量化 也是支持期货市场的。</p></div> <p>语法： <code>context.subscribe(source_id, instruments, exchange_id)</code> <br>
参数：<code>source_id, instruments, exchange_id</code> <br>
source_id 同上，是一个字符串，代表 柜台的名称，如 <code>'sim'</code> ；<br>
instruments 是一个列表（List），一对方括号包含1个或多个字符串，每一个字符串代表一个交易品种，如 <code>['600001','600002']</code><br>
exchange_id 是一个字符串，代表 市场的名称。众所周知，A股市场目前有三家了，深市、沪市和北交所。因此，对应的品种需要填上对应的市场ID，  <code>Exchange.SSE</code>代表上海沪市、 <code>Exchange.SZE</code>代表深圳市场、后来 <code>Exchange.BSE</code>代表北京证券交易所，简称北交所。<br></p> <p>返回值： 无<br></p> <p>这就是任何一个自动交易程序，最关键的两件事儿：<br> <font color="blue" size="4">
一，添加帐号、<br>
二，订阅品种。
</font><br>
具体操作就是对应了 <code>context</code> 的两个方法（函数）。因此，在每一个程序开头的位置，必然会看到类似如下的代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅上海沪市的2个品种</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>其中第5行 <code>def pre_start(context):</code> 是程序启动时调用的第一个方法（函数），即初始化方法（函数），我们接下来马上就要讨论到。添加帐号 和 订阅品种 这两个关键动作，就写在这个方法（函数）中，这是必不可缺的。</p> <h4 id="_2-1-3、-订阅全部品种-context-subscribe-all"><a href="#_2-1-3、-订阅全部品种-context-subscribe-all" class="header-anchor">#</a> 2.1.3、 订阅全部品种 context.subscribe_all()</h4> <p>看过上一节的方法（函数）之后，是不是还觉得有点麻烦。事前还得准备好一个列表，如：<code>['600001','600002',......]</code>。这要是订阅成百上千个，不得累死？来个简单粗暴点的！安排:</p> <p>语法： <code>context.subscribe_all(source_id)</code> <br>
参数：<code>source_id</code> <br>
source_id 就是代表柜台名称的字符串，如 <code>&quot;tora&quot;</code> ；<br></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意 : <code>sim</code> 模拟柜台不支持全市场订阅</p></div> <p>没了，够简单吧。</p> <p>返回值： 无<br></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3055845&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe_all<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 订阅全部可交易的品种</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如此一来，就等于订阅了全市场的全部品种，大约 6000+ 多种 。当然，这也需要足够大的内存和 CPU 的能力来支撑。如果电脑硬件配置不足，很可能就卡死了。</p> <h4 id="_2-1-4、-输出日志消息-context-log-info"><a href="#_2-1-4、-输出日志消息-context-log-info" class="header-anchor">#</a> 2.1.4、 输出日志消息  context.log.info()</h4> <p>这个方法（函数），我们已经认识了，用过了。它就是用来输出文字，进行人机对话的。调试程序啊、查看一下某个变量的值啊、检查一下获取的值是不是符合预期啊，用它来代替 <code>print()</code> 就对了。它还可以输出几个级别的信息，如： <code>context.log.warning</code>、<code>context.log.error</code> 、<code>context.log.debug</code> 分别对应 警告消息、错误消息和调试消息。想要输出的文本，就是它的形式参数，类型当然是一个 字符串（string），带上 <code>format()</code> 方法可以让输出的文本更容易阅读。前面的 &quot;Hellow World&quot; 的例子，都是用这个方法（函数）来实现的。</p> <p>身为初学者，在开发编程、调试的过程中，我们会经常用到这个方法（函数）。</p> <h4 id="_2-1-5、-转换时间格式-context-strftime-context-strptime"><a href="#_2-1-5、-转换时间格式-context-strftime-context-strptime" class="header-anchor">#</a> 2.1.5、 转换时间格式 <br> context.strftime()/context.strptime()</h4> <p>有 python 语言基础的朋友已经秒懂了。没错，它们就是用来转换时间格式的啊，一个用来把 毫秒时间戳 转换为 文本类型（格式），方便阅读；另一个就是把 文本类型（格式） 的时间，转换为 <code>datetime.datetime</code> 的  毫秒时间戳，注意 文本字符串必须是 &quot;%Y-%m-%d %H:%M:%S.&quot; 的格式，注意最后有一个英文句点（.）不要漏掉了 。</p> <p>请看下面的示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#  pre_start() 方法（函数）， 传入参数 context </span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot; 这个策略的名称是： {} &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot; 当前时间是 {} 纳秒（自 1970-01-01 08:00:00 以来）&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot; 当前时间转换为 文本类型（格式）为： {} &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>context<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot; 2020-02-02 09:30:01. 转换为时间戳：  {} &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">&quot;2020-02-02 09:30:01.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行的结果如下：
 
这个策略的名称是： test
今天的日期是： 2020-07-19 00:00:00
当前时间是 1558231726820023165 纳秒（自 1970-01-01 08:00:00 以来）
当前时间转换为 文本类型（格式）为： 2020-07-19 9:55:26.820023165
2020-02-02 09:30:01. 转换为时间戳：  1580607001000000000 
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_2-1-6、-延时执行-定时重复执行context-add-timer-context-add-time-interval"><a href="#_2-1-6、-延时执行-定时重复执行context-add-timer-context-add-time-interval" class="header-anchor">#</a> 2.1.6、 延时执行/定时重复执行<br>context.add_timer()/context.add_time_interval()</h4> <p>这 2 个方法（函数）是十分有用的。顾名思义，</p> <p><code>context.add_timer()</code> 表达，延迟 xxx 秒（指定一段时间）之后，调用执行一个函数/指令，只执行一次；
<code>context.add_time_interval()</code> 表达，每 xxx 秒（指定时间间隔）执行一个函数/指令，重复执行，一直执行，只到程序终止；</p> <p>放在一起，就是为了避免搞混淆了。（不要问为什么，问就是：我没有。）</p> <p>参数：2 个方法（函数）的参数都相同。<br>
nano 是一个整数，表示纳秒单位的时间。一个是表达 延迟多长时间之后，执行一次；另一个是表示重复执行的间隔时间；
callback 是想要执行的函数或指令，通常用 简单的匿名函数即可；</p> <p>上示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#  pre_start() 方法（函数）， 传入参数 context </span>
    context<span class="token punctuation">.</span>add_timer<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">*</span><span class="token number">1000000000</span><span class="token punctuation">,</span><span class="token keyword">lambda</span> ctx<span class="token punctuation">,</span> event<span class="token punctuation">:</span> context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;延迟 1 秒，打印输出 1 次。 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    context<span class="token punctuation">.</span>add_time_interval<span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">1000000000</span><span class="token punctuation">,</span><span class="token keyword">lambda</span> ctx<span class="token punctuation">,</span> event<span class="token punctuation">:</span> context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;每 3 秒，打印输出一次，一直重复下去。 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行的结果如下：
 
 延迟 1 秒，打印输出 1 次。
 每 3 秒，打印输出一次，一直重复下去。
 每 3 秒，打印输出一次，一直重复下去。
 每 3 秒，打印输出一次，一直重复下去。
 每 3 秒，打印输出一次，一直重复下去。
 每 3 秒，打印输出一次，一直重复下去。
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_2-1-7、-官网-demo"><a href="#_2-1-7、-官网-demo" class="header-anchor">#</a> 2.1.7、 官网 Demo</h4> <p>关于 <font color="red" size="6">  context  </font>的重要性，可见其非同一般吧，功夫量化 的基本方法（函数），用到的对象（Object），都是绑定在这个 <code>context</code> 上面的，如前所述，它就是一个 承上启下，联接上下文的，十分重要的对象（Object）。后面的章节还会更详细的讨论它自带的、可以让我们方便使用的、直接可以复制粘帖的方法（函数）和属性（变量）。</p> <p>所以一开始，功夫量化 就给了一个 Demo 的示例，有基础的同学参考这个 Demo 中的代码示例，直接引用（就是 复制粘帖 呗），多方便。想起网上一个段子，网友评论疼讯，一天天的就知道 复制粘帖，没想到大企鹅回嘴呛声了。“大把的人还不知道复制哪儿，粘帖哪儿呢？” ———— 没毛病！</p> <p>所以，学习 Python API 的目的，就是要知道“复制什么？粘帖到那儿”。 ———— 一点毛病没有！</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 期货</span>
<span class="token comment"># SOURCE = &quot;ctp&quot;</span>
<span class="token comment"># ACCOUNT = &quot;089270&quot;</span>
<span class="token comment"># tickers = [&quot;rb2001&quot;,&quot;rb2003&quot;]</span>
<span class="token comment"># VOLUME = 2</span>
<span class="token comment"># EXCHANGE = Exchange.SHFE</span>

<span class="token comment">#股票</span>
SOURCE <span class="token operator">=</span> <span class="token string">&quot;xtp&quot;</span>
ACCOUNT <span class="token operator">=</span> <span class="token string">&quot;15040910&quot;</span>
tickers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;600000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;600001&quot;</span><span class="token punctuation">]</span>
VOLUME <span class="token operator">=</span> <span class="token number">200</span>
EXCHANGE <span class="token operator">=</span> Exchange<span class="token punctuation">.</span>SSE

<span class="token comment"># 启动前回调，添加交易账户，订阅行情，策略初始化计算等</span>
<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>SOURCE<span class="token punctuation">,</span> ACCOUNT<span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>SOURCE<span class="token punctuation">,</span> tickers<span class="token punctuation">,</span> EXCHANGE<span class="token punctuation">)</span>
    <span class="token comment"># context.subscribe(&quot;bar&quot;, tickers, EXCHANGE)</span>
	<span class="token comment"># context.subscribe_all(SOURCE)</span>
    context<span class="token punctuation">.</span>ordered <span class="token operator">=</span> <span class="token boolean">False</span>


<span class="token comment"># 启动准备工作完成后回调，策略只能在本函数回调以后才能进行获取持仓和报单</span>
<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;post_start&quot;</span><span class="token punctuation">)</span>
    log_book<span class="token punctuation">(</span>context<span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>
	<span class="token comment"># context.req_history_order(ACCOUNT)</span>
	<span class="token comment"># context.req_history_trade(ACCOUNT)</span>

<span class="token comment"># 收到快照行情时回调，行情信息通过quote对象获取</span>
<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># context.log.info(&quot;[on_quote] {}&quot;.format(quote))</span>
    <span class="token keyword">if</span> quote<span class="token punctuation">.</span>instrument_id <span class="token keyword">in</span> tickers<span class="token punctuation">:</span>
        <span class="token comment"># 如果没有报单则报单</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> context<span class="token punctuation">.</span>ordered<span class="token punctuation">:</span>
            order_id <span class="token operator">=</span> context<span class="token punctuation">.</span>insert_order<span class="token punctuation">(</span>quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span> EXCHANGE<span class="token punctuation">,</span> ACCOUNT<span class="token punctuation">,</span> quote<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span> VOLUME<span class="token punctuation">,</span> PriceType<span class="token punctuation">.</span>Limit<span class="token punctuation">,</span> Side<span class="token punctuation">.</span>Buy<span class="token punctuation">,</span> Offset<span class="token punctuation">.</span>Open<span class="token punctuation">)</span>
            <span class="token comment"># order_id = context.insert_order(quote.instrument_id, EXCHANGE, ACCOUNT, quote.last_price, VOLUME, PriceType.Any, Side.Buy, Offset.Open)#上期所不支持市价单</span>
            <span class="token keyword">if</span> order_id <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                context<span class="token punctuation">.</span>ordered <span class="token operator">=</span> <span class="token boolean">True</span>
                context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;[order] (rid){} (ticker){}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order_id<span class="token punctuation">,</span> quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 通过添加时间回调，在三秒以后撤单</span>
                context<span class="token punctuation">.</span>add_timer<span class="token punctuation">(</span>context<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">1000000000</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> ctx<span class="token punctuation">,</span> event<span class="token punctuation">:</span> cancel_order<span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> order_id<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 收到k线行情时回调，行情信息通过bar对象获取</span>
<span class="token keyword">def</span> <span class="token function">on_bar</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> bar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;[on_bar] {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 收到订单状态回报时回调</span>
<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;[on_order] {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 收到成交信息回报时回调</span>
<span class="token keyword">def</span> <span class="token function">on_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> trade<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;[on_trade] {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>trade<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 策略释放资源前回调，仍然可以获取持仓和报单</span>
<span class="token keyword">def</span> <span class="token function">pre_stop</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;[befor strategy stop]&quot;</span><span class="token punctuation">)</span>


<span class="token comment"># 策略释放资源后回调</span>
<span class="token keyword">def</span> <span class="token function">post_stop</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;[befor process stop]&quot;</span><span class="token punctuation">)</span>


<span class="token comment">## 自定义函数</span>
<span class="token comment"># 自定义持仓和资金日志输出函数</span>
<span class="token keyword">def</span> <span class="token function">log_book</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;[avail]{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail<span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;[acc_avail]{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>SOURCE<span class="token punctuation">,</span> ACCOUNT<span class="token punctuation">)</span><span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail<span class="token punctuation">)</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> context<span class="token punctuation">.</span>book
    asset <span class="token operator">=</span> book<span class="token punctuation">.</span>asset
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>
        <span class="token string">&quot;[strategy capital] (avail){} (margin){} (market_value){} (initial_equity){} (dynamic_equity){} (static_equity){} (realized_pnl){} (unrealized_pnl){}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            asset<span class="token punctuation">.</span>avail<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>margin<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>market_value<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>initial_equity<span class="token punctuation">,</span>
            asset<span class="token punctuation">.</span>dynamic_equity<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>static_equity<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">)</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>SOURCE<span class="token punctuation">,</span> ACCOUNT<span class="token punctuation">)</span>
    asset <span class="token operator">=</span> book<span class="token punctuation">.</span>asset
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>
        <span class="token string">&quot;[account capital] (avail){} (margin){} (market_value){} (initial_equity){} (dynamic_equity){} (static_equity){} (realized_pnl){} (unrealized_pnl){}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            asset<span class="token punctuation">.</span>avail<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>margin<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>market_value<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>initial_equity<span class="token punctuation">,</span>
            asset<span class="token punctuation">.</span>dynamic_equity<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>static_equity<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span> asset<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">)</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;acc_pos&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> key <span class="token keyword">in</span> book<span class="token punctuation">.</span>long_positions<span class="token punctuation">:</span>
        log_stock_pos<span class="token punctuation">(</span>context<span class="token punctuation">,</span> book<span class="token punctuation">.</span>long_positions<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># log_future_pos(context, pos)</span>
    context<span class="token punctuation">.</span>logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;str_pos&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> key <span class="token keyword">in</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>long_positions<span class="token punctuation">:</span>
        log_stock_pos<span class="token punctuation">(</span>context<span class="token punctuation">,</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>long_positions<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># log_future_pos(context, pos)</span>

<span class="token comment"># 自定义期货持仓数据日志输出函数</span>
<span class="token keyword">def</span> <span class="token function">log_future_pos</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>
        <span class="token string">&quot;(instrument_id){} (instrument_type){} (exchange_id){}(direction){} (volume){} (yesterday_volume){} (last_price){} (settlement_price){} (pre_settlement_price){} (avg_open_price){} (position_cost_price){} (margin){} (position_pnl){} (realized_pnl){} (unrealized_pnl){} &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            pos<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
            pos<span class="token punctuation">.</span>direction<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>volume<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>yesterday_volume<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>settlement_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>pre_settlement_price<span class="token punctuation">,</span>
            pos<span class="token punctuation">.</span>avg_open_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>position_cost_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>margin<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>position_pnl<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 自定义股票持仓数据日志输出函数</span>
<span class="token keyword">def</span> <span class="token function">log_stock_pos</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> pos<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>
        <span class="token string">&quot;(instrument_id){} (instrument_type){} (exchange_id){} (direction){} (volume){} (yesterday_volume){} (last_price){} (pre_close_price){} (close_price){} (avg_open_price){} (position_cost_price){} (realized_pnl){} (unrealized_pnl){} &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            pos<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>direction<span class="token punctuation">,</span>
            pos<span class="token punctuation">.</span>volume<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>yesterday_volume<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>pre_close_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>close_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>avg_open_price<span class="token punctuation">,</span>
            pos<span class="token punctuation">.</span>position_cost_price<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span> pos<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 自定义撤单回调函数</span>
<span class="token keyword">def</span> <span class="token function">cancel_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    action_id <span class="token operator">=</span> context<span class="token punctuation">.</span>cancel_order<span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>
    <span class="token keyword">if</span> action_id <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;[cancel order] (action_id){} (rid){} &quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>action_id<span class="token punctuation">,</span> order_id<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br></div></div><p>看到 Demo 这么多代码。有编程基础的朋友都笑了，这太 easy 了，简单小儿科；不太熟悉电脑的朋友都哭了，啊————这么难，逃了逃了。</p> <p>所以既然都看到了这儿了，多少也了解到：本文档就是为了让更多的不太熟悉电脑的朋友们也能够上手 功夫量化 而撰写的，并且力求比官方文档更易理解、更易参考。（必须吐槽官方文档，浓浓的知识诅咒的味道，一般二般的计算机专业的大学生也得费点劲儿才能理解透彻，何况普通大众、芸芸股民乎————）</p> <p>其实先从 Demo 例程的开头几行看起，就算没有计算机基础的朋友，也能看个八九不离十。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-    国际惯例，表示下面这些代码的国际字符集是 UTF-8</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft         <span class="token comment"># 导入 易筋经 里的 时间模块，重命名为 kft</span>
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>     <span class="token comment"># 导入 咏春 模块</span>

<span class="token comment">#股票</span>
SOURCE <span class="token operator">=</span> <span class="token string">&quot;sim&quot;</span>                   <span class="token comment"># 股票帐户的柜台，本地模拟就用 sim </span>
ACCOUNT <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span>               <span class="token comment"># 股票帐号，如前面的例子可以用 12345 </span>
tickers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;600000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;600001&quot;</span><span class="token punctuation">]</span>    <span class="token comment"># 想要关注的股票代码</span>
VOLUME <span class="token operator">=</span> <span class="token number">200</span>                     <span class="token comment"># 自定义一个参数，代表 交易量</span>
EXCHANGE <span class="token operator">=</span> Exchange<span class="token punctuation">.</span>SSE          <span class="token comment"># 自定义一个变量，代表 上海沪市的 代码 Exchange.SSE</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>瞧，就这么简单。本文档的所有内容只讨论有关股票的部分，因此 期货部分 省略。再往下就是一些 功夫量化 中已经写好的 方法（函数） 和 属性（变量）了，只要参考 API 手册，根据自己的策略，复制粘帖、修修改改、删删减减，一步一步的实现自己的交易策略，就是这样一个过程。</p> <h3 id="context-小结"><a href="#context-小结" class="header-anchor">#</a> context 小结：<br></h3> <p>好了，这一小节就到这里了，再说多了，怕把所有人都吓跑了。除了拿出来一个 Demo 吓唬吓唬了各位，其它的全是大白话，应该没有什么难以理解的地方吧。</p> <p>简单一句话就是介绍了 功夫量化 中用到的 Python 版本，以及已经安装好的 第三方 库。最最重要的一个对象就是<font color="red" size="6">  context  </font>，没有之一。它是全局可见的，也就是随时随地都可以直接调用，程序猿们都秒懂了。不太熟悉计算机的朋友只要没被劝退，看懂 Demo 例程中的前 10 行，应该没有任何压力。</p> <h4 id="exchange-交易所-对象-object"><a href="#exchange-交易所-对象-object" class="header-anchor">#</a> Exchange 交易所 对象（Object）</h4> <p>本章中出现的一个简单的对象（Object） 就是用来表达 交易所 的对象。甚至可以看成是一个简单的枚举型变量 或 一个包含交易所ID的列表，具体内容如下表所示：</p> <table><thead><tr><th>属性</th> <th>值</th> <th>说明</th></tr></thead> <tbody><tr><td>Exchange.BSE</td> <td>&quot;BSE&quot;</td> <td>北京证券交易所（北交所）</td></tr> <tr><td>Exchange.SSE</td> <td>&quot;SSE&quot;</td> <td>上海证券交易所（上交所）</td></tr> <tr><td>Exchange.SZE</td> <td>&quot;SZE&quot;</td> <td>深圳证券交易所（深交所）</td></tr> <tr><td>Exchange.SHFE</td> <td>&quot;SHFE&quot;</td> <td>上海期货交易所</td></tr> <tr><td>Exchange.DCE</td> <td>&quot;DCE&quot;</td> <td>大连商品交易所</td></tr> <tr><td>Exchange.CZCE</td> <td>&quot;CZCE&quot;</td> <td>郑州商品交易所</td></tr> <tr><td>Exchange.CFFEX</td> <td>&quot;CFFEX&quot;</td> <td>中国金融期货交易所</td></tr> <tr><td>Exchange.INE</td> <td>&quot;INE&quot;</td> <td>上海国际能源交易中心</td></tr></tbody></table> <p>交易股票主要还是 上交所 和 深交所。北交所 才开没多久嘛。</p> <p>接下来的内容，就是介绍 功夫量化 中的各种 方法（函数） 和 属性（变量），认识它们所表达的意思以及具体的执行步骤，这就是 API 指南的意义。可以把它们想象成建筑材料一样，搬来放在合适的地方，打造自己心中模型的样子。说白了就是 <u>复制粘帖 到 正确的位置</u>。开发量化交易程序就是如此 ———— 没啥神秘的。是否能进入量化交易的大门，只取决于你是否继续阅读此文档了。</p> <h3 id="_2-2、-基本方法-函数"><a href="#_2-2、-基本方法-函数" class="header-anchor">#</a> 2.2、 基本方法（函数）</h3> <p>功夫量化 官方已写好了一些基本的方法（函数），以供直接、方便的调用。说人话就是给我们复制粘帖的原材料。</p> <p>先吐槽两句：本人也勉强算是老程序猿了，一直学得就是 函数、参数、返回值啥啥的。然后时代变革，都要面向对象。非要把 函数 叫 方法、非要把 变量 叫 属性......得得得，你们说中杯就中杯、说大杯就大杯、说超大杯就超大杯，好吧。我服了。</p> <p>功夫量化 是基于 Python 语言的，当然也是 面向对象 的。（所以只能向强大的势力低头）</p> <p>下表列出了 功夫量化 中的基本方法（函数），先瞅一眼混个脸熟吧。</p> <table><thead><tr><th>编号</th> <th>方法（函数）名称</th> <th>功能简述</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>pre_start()</td> <td>策略启动前的初始化，只执行一次</td> <td>必不可缺</td></tr> <tr><td>02</td> <td>post_start()</td> <td>策略登录帐户，成功建立连接后，只执行一次</td> <td>通常在此获取帐户的信息</td></tr> <tr><td>03</td> <td>pre_stop()</td> <td>策略停止前的准备工作，只执行一次</td> <td>可以省略，但养成好习惯是个不错的主意</td></tr> <tr><td>04</td> <td>post_stop()</td> <td>策略断开帐户时的收尾工作，只执行一次</td> <td>可以省略，检查下门关好没有</td></tr> <tr><td>05</td> <td>on_quote()</td> <td>接收 3 秒一跳快照行情的方法（函数）</td> <td>绝对重点，最常用的方法（函数）</td></tr> <tr><td>06</td> <td>on_transaction()</td> <td>接收 逐笔行情的方法（函数）</td> <td>这已经是高频了，大佬。</td></tr> <tr><td>07</td> <td>on_entrust()</td> <td>接收 逐笔委托 行情的方法（函数）</td> <td>玩得这么高端吗！</td></tr> <tr><td>08</td> <td>on_bar()</td> <td>接收 K 线行情的方法（函数）</td> <td>量化传统的 K 线图表交易策略不可少</td></tr> <tr><td>09</td> <td>on_order()</td> <td>接收 委托单 消息的方法（函数）</td> <td>每下一单用这个核对，十分必要</td></tr> <tr><td>10</td> <td>on_trade()</td> <td>接收 成交单 消息的方法（函数）</td> <td>每成交一单用这个核对，是必需的</td></tr></tbody></table> <p>可以说每一个交易策略程序，都或多或少包含几个上述这些方法（函数），它们就象基础的材料木头和石块、尤其是 <code>pre_start()</code> 啊、<code>on_quote()</code> 啊，肯定是要用上的，同时还有 <code>context</code> 对象 。回忆一下，连最简单的 “Hello World” 程序都不例外呢。</p> <p>接下来，我们就逐一来认识这些 方法（函数）吧。</p> <h4 id="_2-2-1、-初始化-pre-start"><a href="#_2-2-1、-初始化-pre-start" class="header-anchor">#</a> 2.2.1、 初始化 pre_start():</h4> <p>功能： 策略程序一开始启动时，就调用执行此方法（函数），仅执行一次。通常用来做一些准备工作，如：添加帐号、订阅品种、读取文件等。</p> <p>语法： <code>def pre_start(context):</code> <br>
参数：<code>context</code> <br>
看到 context 了吧，都说了它是随处可见的，哪哪儿都有它。必须的！<br>
返回值： 无 <br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>前面的例子中，其实已经见过面了。通常在这个 初始化方法（函数）中，会做两件事，一是添加自己的股票帐号、另一件事就是 订阅自己想要交易的 股票品种。如果还有什么其它的准备工作，比如声明几个变量做为参数啊、读取文件加载数据啊，也可以在这个方法（函数）中执行。</p> <h4 id="_2-2-2、-连接检查-post-start"><a href="#_2-2-2、-连接检查-post-start" class="header-anchor">#</a> 2.2.2、 连接检查 post_start():</h4> <p>功能： 当运行策略程序的电脑 成功连接 券商交易柜台服务器的主机后，会自动调用执行此方法（函数），仅执行一次。通常用来检验一下准备工作是否有遗漏，或者查看一下帐户中的 持仓信息、可用资金等。</p> <p>语法： <code>def post_start(context):</code> <br>
参数：<code>context</code> <br>
只要是 功夫量化 的程序， context 这个 对象 作为参数是必须的！哪那儿都有它！<br>
返回值： 无 <br>
示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'连接柜台主机 sim 已成功 帐号 12345 已登录成功。'</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'检验工作完成'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在实际运用中，<code>post_start()</code> 方法（函数）中，更多的是执行一些检验帐户的操作，因为既然执行到了这个方法（函数），那一定是帐户和柜台主机已经联通了，帐户中有没有持仓单啊、有多少可用资金啊、帐户的名称啊、诸如这些信息就可以获取到了，在此可以打印输出到日志，核对一下。</p> <h4 id="_2-2-3、-快照行情-on-quote-3秒一跳"><a href="#_2-2-3、-快照行情-on-quote-3秒一跳" class="header-anchor">#</a> 2.2.3、 快照行情 on_quote(): （3秒一跳）</h4> <p>功能：这个方法（函数）可是重点！敲黑板！每收到一个订阅品种的报价、就会调用执行一次此方法（函数）。</p> <p>语法： <code>def on_quote(context, quote, location):</code> <br>
参数：<code>context, quote, location</code> <br>
返回值： 无<br></p> <p>在 形式参数 列表中：<br> <code>context</code> 就不再重复了，反正哪哪儿都有它；<br> <code>location</code> 是 功夫量化 2.4 版之后新增的一个参数，包含当前运行程序的电脑的一些信息，如：帐号、柜台名称等。<br> <code>quote</code> 就是重点中的重点了。用脚也想到了， <code>quote</code> 肯定是一个 对象（Object） 了，它其中包含了什么呢？当然是报价数据啊，请看下例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;quote 是什么类型？ {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>quote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 输出 quote 的类型 </span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;quote 中有什么？ {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token punctuation">(</span>quote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># 输出 quote 中的内容</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
quote 是什么？ &lt;class 'pykungfu.longfist.types.Quote'&gt;
quote 中有什么？ ['__class__', '__delattr__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__gt__', '__has_data__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__module__', '__ne__', '__new__', '__parse__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__sizeof__', '__str__', '__subclasshook__', '__tag__', '__uid__', 'ask_price', 'ask_volume', 'bid_price', 'bid_volume', 'close_price', 'data_time', 'exchange_id', 'high_price', 'instrument_id', 'instrument_type', 'iopv', 'last_price', 'low_price', 'lower_limit_price', 'open_interest', 'open_price', 'pre_close_price', 'pre_open_interest', 'pre_settlement_price', 'settlement_price', 'source_id', 'trading_day', 'trading_phase_code', 'turnover', 'upper_limit_price', 'volume']
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>又是这么密密麻麻一大堆、而且还在不停的滚动，恐惧症都犯了。因为 <code>on_quote()</code> 这个方法（函数）是每接收到一次报价就执行一次的，大约是 3 秒一次。因此这些信息也就会不停的滚动了。看到这么多的信息也不用怕，其实它们全是属性（变量），其中保存的就是报价数据了，看了下面这个例子，就一目了然了：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到的交易品种的报价数据如下：\n&quot;</span><span class="token punctuation">)</span>     
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 申卖价<span class="token punctuation">[</span>卖一<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>卖五<span class="token punctuation">]</span> ask_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>         \
                      \n 申卖量 ask_volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 申买价<span class="token punctuation">[</span>买一<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>买五<span class="token punctuation">]</span> bid_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>         \
                      \n 申买量 bid_volume： <span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                      \n 收盘价 close_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 报价时间<span class="token punctuation">[</span>纳秒<span class="token punctuation">]</span> data_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                      \n 交易所 exchange_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 最高价 high_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                      \n 交易品种 instrument_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                      \n 交易品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>        \
                      \n iopv： <span class="token punctuation">{</span><span class="token punctuation">}</span>                               \
                      \n 最新价 last_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                      \n 最低价 low_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 跌停价 lower_limit_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                      \n 持仓量（期货用）open_interest： <span class="token punctuation">{</span><span class="token punctuation">}</span>        \
                      \n 今开盘价 open_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 昨收盘价 pre_close_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                      \n 昨持仓量（期货用）pre_open_interest：<span class="token punctuation">{</span><span class="token punctuation">}</span>   \
                      \n 昨结价（期货用）pre_settlement_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>  \
                      \n 结算价（期货用）settlement_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>      \
                      \n 柜台 source_id：<span class="token punctuation">{</span><span class="token punctuation">}</span>                       \
                      \n 交易日 trading_day：<span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                      \n 换手 turnover：<span class="token punctuation">{</span><span class="token punctuation">}</span>                        \
                      \n 涨停价 upper_limit_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                      \n 成交量 volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                        \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                              quote<span class="token punctuation">.</span>ask_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>ask_volume<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>bid_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>bid_volume<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>close_price<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>quote<span class="token punctuation">.</span>data_time<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 把纳秒时间戳转换为文本格式。</span>
                              quote<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>high_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>iopv<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>low_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>lower_limit_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>open_interest<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>open_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>pre_close_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>pre_open_interest<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>pre_settlement_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>settlement_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>source_id<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>turnover<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>upper_limit_price<span class="token punctuation">,</span>
                              quote<span class="token punctuation">.</span>volume
                             <span class="token punctuation">)</span>    
                    <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
收到的交易品种的报价数据如下： 
申卖价[卖一...卖五] ask_price：[193.04, 193.05, 193.06, 193.3, 193.34, 193.38, 193.39, 193.42, 193.43, 194.14] 
申卖量 ask_volume：[100, 100, 400, 100, 100, 100, 900, 1000, 900, 800] 
申买价[买一...买五] bid_price：[192.96, 192.95, 192.94, 192.93, 192.92, 192.91, 192.9, 192.89, 192.88, 192.87] 
申买量 bid_volume： [1200, 2800, 800, 1900, 1900, 1000, 1500, 500, 300, 700] 
收盘价 close_price： 0.0 
报价时间[纳秒] data_time： 2020-08-11 11:09:30.614508500 
交易所 exchange_id ： SSE 
最高价 high_price： 0.0 
交易品种 instrument_id： 600001 
交易品种类型 instrument_type： InstrumentType.Stock 
iopv： 0.0 
最新价 last_price： 193.0 
最低价 low_price： 0.0 
跌停价 lower_limit_price： 0.0 
持仓量（期货用）open_interest： 0.0 
今开盘价 open_price：0.0 
昨收盘价 pre_close_price：0.0 
昨持仓量（期货用）pre_open_interest：0.0 
昨结价（期货用）pre_settlement_price：0.0 
结算价（期货用）settlement_price：0.0 
柜台 source_id： 
交易日 trading_day： 
换手 turnover：0.0 
涨停价 upper_limit_price：0.0 
成交量 volume：0 
......

&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><p>这下应该很清楚了吧。如果这都觉得麻烦，那么在 功夫量化 的自己的 app 中，也可以更简单点，如以下代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到的交易品种的报价数据如下：\n&quot;</span><span class="token punctuation">)</span>     
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>quote<span class="token punctuation">)</span>  <span class="token comment"># 直接输出 quote 这个对象</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果如下：

收到的交易品种的报价数据如下：

{&quot;ask_price&quot;:[202.9,203.54,203.55,203.71,203.77,204.43,204.52,204.56,205.13,205.16],&quot;ask_volume&quot;:[100,600,100,300,100,900,200,100,100,100],&quot;bid_price&quot;:[202.88,202.82,202.81,202.8,202.79,202.78,202.77,202.76,202.75,202.74],&quot;bid_volume&quot;:[69400,1100,900,500,1000,1400,100,100,600,1900],&quot;close_price&quot;:0.0,&quot;data_time&quot;:1666515225010159000,&quot;exchange_id&quot;:&quot;SSE&quot;,&quot;high_price&quot;:0.0,&quot;instrument_id&quot;:&quot;600001&quot;,&quot;instrument_type&quot;:1,&quot;iopv&quot;:0.0,&quot;last_price&quot;:202.89,&quot;low_price&quot;:0.0,&quot;lower_limit_price&quot;:0.0,&quot;open_interest&quot;:0.0,&quot;open_price&quot;:0.0,&quot;pre_close_price&quot;:0.0,&quot;pre_open_interest&quot;:0.0,&quot;pre_settlement_price&quot;:0.0,&quot;settlement_price&quot;:0.0,&quot;source_id&quot;:&quot;&quot;,&quot;trading_day&quot;:&quot;&quot;,&quot;trading_phase_code&quot;:&quot;&quot;,&quot;turnover&quot;:0.0,&quot;upper_limit_price&quot;:0.0,&quot;volume&quot;:0}

{&quot;ask_price&quot;:[202.9,203.54,203.55,203.71,203.77,204.43,204.52,204.56,205.13,205.16],&quot;ask_volume&quot;:[100,600,100,300,100,900,200,100,100,100],&quot;bid_price&quot;:[202.88,202.82,202.81,202.8,202.79,202.78,202.77,202.76,202.75,202.74],&quot;bid_volume&quot;:[69400,1100,900,500,1000,1400,100,100,600,1900],&quot;close_price&quot;:0.0,&quot;data_time&quot;:1666515225010159000,&quot;exchange_id&quot;:&quot;SSE&quot;,&quot;high_price&quot;:0.0,&quot;instrument_id&quot;:&quot;600001&quot;,&quot;instrument_type&quot;:1,&quot;iopv&quot;:0.0,&quot;last_price&quot;:202.89,&quot;low_price&quot;:0.0,&quot;lower_limit_price&quot;:0.0,&quot;open_interest&quot;:0.0,&quot;open_price&quot;:0.0,&quot;pre_close_price&quot;:0.0,&quot;pre_open_interest&quot;:0.0,&quot;pre_settlement_price&quot;:0.0,&quot;settlement_price&quot;:0.0,&quot;source_id&quot;:&quot;&quot;,&quot;trading_day&quot;:&quot;&quot;,&quot;trading_phase_code&quot;:&quot;&quot;,&quot;turnover&quot;:0.0,&quot;upper_limit_price&quot;:0.0,&quot;volume&quot;:0}

&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>拉拉杂杂那么多，但实际运用中，也就主要关心其中的几个，比如<u> 申买价/量 ask_price/volume、申卖价/量 bid_price/volume、报价时间 data_time、交易品种instrument_id、最新价 last_price、昨收盘价 pre_close_price、换手 turnover、涨停价 upper_limit_price、成交量 volume......</u>差不多了。（难不成你玩个股票还能用上 三角函数，还解个微积分？你装得累不累？）</p> <p>你盯盘时，是不是也就只会盯着价格？但电脑程序老厉害了，盯着这么多数据呢，而且程序可以同时盯住多个品种的报价，是不是比你的肉眼精准多了？这就是量化交易程序的优势。</p> <h3 id="基本方法-小结"><a href="#基本方法-小结" class="header-anchor">#</a> 基本方法 小结</h3> <p>这么快就小结了？才刚刚看明白一点呢。本文档是面向初学者、新手的入门指南嘛，搞太多了、太复杂了，把人都吓跑了就不妙了。</p> <p>本节内容确实简单：就介绍了 功夫量化 中，程序必然会用到的 3 个基本的方法（函数），其中：</p> <p><code>pre_start()</code> 就是你点击 运行 那个按钮后，电脑第一个执行的 方法（函数），并且只执行一次。</p> <p><code>post_start()</code> 是建立起网络联接之后，执行一次的方法（函数），通常用来校验一下自己的帐号、资金，核对一下。</p> <p><code>on_quote()</code> 是最重要的了，通俗的说就是 “盯盘”。电脑可厉害了，只要是用  <code>context.subscribe()</code> 订阅过的品种，它都能盯住，而且 3 秒 一跳，比你的肉眼厉害多了，就问你服不服？怕不怕！盯住的数据，它还都能记住，保存在  <code>quote</code> 这个 对象（Object） 中，以便后一步进行计算和比较。</p> <h4 id="quote-快照行情-对象-object"><a href="#quote-快照行情-对象-object" class="header-anchor">#</a> quote 快照行情 对象（Object）</h4> <p>quote 中包含的是 3秒一跳的快照行情数据，具体内容可参考下表。</p> <table><thead><tr><th>序号</th> <th>属性名称</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>ask_price</td> <td>申卖价[卖一...卖五]</td> <td></td></tr> <tr><td>02</td> <td>ask_volume</td> <td>申卖量</td> <td></td></tr> <tr><td>03</td> <td>bid_price</td> <td>申买价[买一...买五]</td> <td></td></tr> <tr><td>04</td> <td>bid_volume</td> <td>申买量</td> <td></td></tr> <tr><td>05</td> <td>close_price</td> <td>收盘价</td> <td></td></tr> <tr><td>06</td> <td>data_time</td> <td>报价时间[纳秒]</td> <td></td></tr> <tr><td>07</td> <td>exchange_id</td> <td>交易所</td> <td></td></tr> <tr><td>08</td> <td>high_price</td> <td>最高价</td> <td></td></tr> <tr><td>09</td> <td>instrument_id</td> <td>交易品种</td> <td></td></tr> <tr><td>10</td> <td>instrument_type</td> <td>交易品种类型</td> <td></td></tr> <tr><td>11</td> <td>iopv</td> <td></td> <td></td></tr> <tr><td>12</td> <td>last_price</td> <td>最新价</td> <td></td></tr> <tr><td>13</td> <td>low_price</td> <td>最低价</td> <td></td></tr> <tr><td>14</td> <td>lower_limit_price</td> <td>跌停价</td> <td></td></tr> <tr><td>15</td> <td>open_interest</td> <td>持仓量</td> <td>期货用</td></tr> <tr><td>16</td> <td>open_price</td> <td>今开盘价</td> <td></td></tr> <tr><td>17</td> <td>pre_close_price</td> <td>昨收盘价</td> <td></td></tr> <tr><td>18</td> <td>pre_open_interest</td> <td>昨持仓量</td> <td>期货用</td></tr> <tr><td>19</td> <td>pre_settlement_price</td> <td>昨结价</td> <td>期货用</td></tr> <tr><td>20</td> <td>settlement_price</td> <td>结算价</td> <td>期货用</td></tr> <tr><td>21</td> <td>source_id</td> <td>柜台</td> <td></td></tr> <tr><td>22</td> <td>trading_day</td> <td>交易日</td> <td></td></tr> <tr><td>23</td> <td>turnover</td> <td>换手</td> <td></td></tr> <tr><td>24</td> <td>upper_limit_price</td> <td>涨停价</td> <td></td></tr> <tr><td>25</td> <td>volume</td> <td>成交量</td> <td></td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>quote 对象 中所包含的数据，因版本不同，或 券商不同，内容也有所差异。具体信息以券商提供的手册为准。</p></div> <p>接下来，当然就是要 下单交易 了。因此下一章，我们开始讨论 功夫量化 中的用来下单交易的方法（函数），让电脑为我们自动执行交易，只要指令下得对，那效率比你用手拍精准多了！不服来战！</p> <h2 id="三、-交易方法-函数"><a href="#三、-交易方法-函数" class="header-anchor">#</a> 三、 交易方法（函数）</h2> <p>终于来到最激动人心的操作步骤了，本章要讨论的内容可是和真金白银直接相关，都是钱、都是钱啊！（所以强烈建议用模拟帐户测试。）前面我们已经知道了如何让电脑程序代替我们的肉眼盯盘，那现在，看准了就该让电脑程序代替我们手拍下单了。你平时做交易难道不是这样的吗？眼盯手拍，完事儿之后，拍自己大腿。现在有电脑帮你盯盘、帮你下单。（完事了你可以有理由砸电脑了，都是电脑的锅！）</p> <p>在没有用量化自动交易程序之前，其实你也是在用某一款券商给你的软件、用鼠标点击界面上的“买入”或“卖出”按钮，来进行操作，这个动作通常被称为 报单。程序无非是把这个 报单 按钮，用指令的形式替换一下罢了。当你 报单 时，就是下了一个 委托单，电脑程序称之为 <code>Order</code>，当价格合适时，即撮合成功时，这个 委托单 就会变成 成交单，电脑程序称之为 <code>Trade</code>，这就表示你已经成功完成了一次交易。如果这是一个 “买入”动作，那么你自己的帐户里，就会出现一笔对应的 持仓单，电脑称之为 <code>Position</code>，对应的买入品种的持有数量就会 增加；反之，如果你刚刚完成的是一个 “卖出”动作，并且顺利成交了，那么你的帐户里，这个品种对应的 持仓单，可卖数量就会减少。低买高卖，你就赚了。高卖低出，那就是 割肉！瞧，交易股票，就是这样一个过程，一点也不难。</p> <p>那么，首先要介绍的，当然是 下单 这个动作对应的 方法（函数），也就是刚刚说的，对应 “买卖”按钮的指令。</p> <h3 id="_3-1-报单-context-insert-order"><a href="#_3-1-报单-context-insert-order" class="header-anchor">#</a> 3.1 报单 context.insert_order()</h3> <p>功能：这个方法（函数）实现 买入/卖出 的 报单 操作。这可是和真金白银直接相关的指令，一定要谨慎在意。</p> <p>语法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>context.insert_order(
                     instrument_id,   # 想交易的品种代码 如 '600002'
                     exchange_id,     # 交易所名称 如 沪市 Exchange.SSE 
                     source_id,       # 券商的柜台名称 模拟用 'sim'
                     account_id,      # 帐号 如 '123456'
                     limit_price,     # 报单的价格 如 22.41
                     volume,          # 报单的手数，具体品种数量 如 200
                     priceType,       # 报价类型 对象，建议用 PriceType.Limit
                     side,            # 买卖方向，Side.Buy 或 Side.Sell
                     offset,          # 开平方向，Offset.Open 或 Offset.Close
                     hedgeFlag,       # 投机类型，可省略不写
                     is_swap          # 是否交换仓位，可省略不写，默认为  False
                    )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>参数：<br></p> <table><thead><tr><th>编号</th> <th>参数名称</th> <th>类型</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>instrument_id</td> <td>字符串 str</td> <td>交易品种的代码</td> <td>如： '600478'</td></tr> <tr><td>02</td> <td>exchange_id</td> <td>对象 Exchange</td> <td>交易所的代码</td> <td>如：沪市 Exchange.SSE</td></tr> <tr><td>03</td> <td>source_id</td> <td>字符串 str</td> <td>柜台的名称</td> <td>如：'sim'</td></tr> <tr><td>04</td> <td>account_id</td> <td>字符串 str</td> <td>帐号</td> <td>如：'123456'</td></tr> <tr><td>05</td> <td>limit_price</td> <td>浮点数 float</td> <td>想要成交的价格</td> <td>如：21.84</td></tr> <tr><td>06</td> <td>volume</td> <td>整数 int</td> <td>想要成交的数量</td> <td>如：100 表示交易一手股票</td></tr> <tr><td>07</td> <td>priceType</td> <td>对象 PriceType</td> <td>报单类型</td> <td>如：PriceType.Limit</td></tr> <tr><td>08</td> <td>side</td> <td>对象 Side</td> <td>买卖方向</td> <td>如：Side.Buy 表示买入</td></tr> <tr><td>09</td> <td>offset</td> <td>对象 Offset</td> <td>开平方向</td> <td>如：Offset.Close 表示平仓 持有单</td></tr> <tr><td>10</td> <td>hedgeFlag</td> <td>对象 HedgeFlag</td> <td>投机套保标识</td> <td>可省略不写此参数</td></tr> <tr><td>11</td> <td>is_swap</td> <td>对象 is_swap</td> <td>是否互换单</td> <td>可省略不写此参数，默认为 否 False</td></tr></tbody></table> <p>好家伙，这么多参数，头昏。</p> <p>不昏不昏，前面几个简单参数，就不啰嗦了。如果连 帐号、交易所、价格、数量都还搞不清楚，那还是劝退吧。投资交易市场不适合你。</p> <p>从 07 参数开始，咋还是个 对象（Object） 呢？哎，这就是 面向对象 编程的特色。一个 对象（Object） 可以作为参数 传递给一个 方法（函数），这样做的好处就是把这个 对象（Object） 包含的全部内容也一并 传递 到了 函数 内部，不仅属性（变量），还包含 对象 自带的方法（函数）。（感觉是不是套娃一样？扯远了扯远了，头更昏了。）说简单点，参数 priceType 就是几个可选值，交易股票时，建议就用 <code>PriceType.Limit</code> ，复制粘帖就好了。</p> <p>同理，<br>
08 参数 side ，就记住： 买 就是 <code>Side.Buy</code> ； 卖 就是 <code>Side.Sell</code> ，齐活儿。</p> <p>09 参数 offset ，就记住： 想要新买入一个品种就是 <code>Offset.Open</code> ；想平仓卖出一个持有的品种，就是 <code>Offset.Close</code>，复制粘帖 ；</p> <p>10 参数，可省略，就是可以不写。所以，我们暂时不讨论；<br>
11 参数，是 2.4 版新增的一个参数，一般也用不上。所以，我们也不讨论；<br>
（哈哈，划水成功）</p> <p>返回值：<code>order_id</code> 一个长整数，代表 委托单 的编号。<br>
终于看到一个有 返回值  的函数了，不容易啊。人和人说话，有来言有去语啊。这才是正常人的交流啊。人机对话，也要有发起、有回报啊。当年计算机老师都说了，一个没有返回消息的程序，就是一个粗鲁的程序，没有礼貌。所以在函数式编程的时候，每一个函数都是有返回值的，就算真的啥也没有，好歹返回一个 0 啊，讲礼貌很难吗？好吧，吐槽暂停、说正事儿。<br></p> <p>这个 返回值 <code>order_id</code> 就是一串数字编号，方便之后用这个编号就可以查阅到这个 委托单，事后检查是很重要的。接下来我们马上就会用上的。</p> <p>说这么多，不如上示例代码：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>    <span class="token comment"># 买入沪市品种 600000 股票 200股，要价为 12.0 </span>
    context<span class="token punctuation">.</span>insert_order<span class="token punctuation">(</span>
                         <span class="token string">&quot;600000&quot;</span><span class="token punctuation">,</span>           <span class="token comment"># 品种的代码</span>
                         Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">,</span>       <span class="token comment"># 交易所名称</span>
                         <span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span>              <span class="token comment"># 柜台的名称</span>
                         <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>           <span class="token comment"># 帐号</span>
                         <span class="token number">12.0</span><span class="token punctuation">,</span>               <span class="token comment"># 价格</span>
                         <span class="token number">200</span><span class="token punctuation">,</span>                <span class="token comment"># 数量</span>
                         PriceType<span class="token punctuation">.</span>Limit<span class="token punctuation">,</span>    <span class="token comment"># 价格类型</span>
                         Side<span class="token punctuation">.</span>Buy<span class="token punctuation">,</span>           <span class="token comment"># 买卖方向 </span>
                         Offset<span class="token punctuation">.</span>Open         <span class="token comment"># 开平方向</span>
                        <span class="token punctuation">)</span>


    <span class="token comment"># 卖出持有的沪市品种 600000 股票 200股，要价为 18.0 </span>
    context<span class="token punctuation">.</span>insert_order<span class="token punctuation">(</span>
                         <span class="token string">&quot;600000&quot;</span><span class="token punctuation">,</span>          <span class="token comment"># 品种的代码</span>
                         Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">,</span>      <span class="token comment"># 交易所名称</span>
                         <span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span>             <span class="token comment"># 柜台的名称 </span>
                         <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>          <span class="token comment"># 帐号</span>
                         <span class="token number">18.0</span><span class="token punctuation">,</span>              <span class="token comment"># 价格</span>
                         <span class="token number">200</span><span class="token punctuation">,</span>               <span class="token comment"># 数量</span>
                         PriceType<span class="token punctuation">.</span>Limit<span class="token punctuation">,</span>   <span class="token comment"># 价格类型</span>
                         Side<span class="token punctuation">.</span>Sell<span class="token punctuation">,</span>         <span class="token comment"># 买卖方向</span>
                         Offset<span class="token punctuation">.</span>Close       <span class="token comment"># 开平方向</span>
                        <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>好家伙，12 块买入，18 块卖出，交易  200 股，赚了 1200 大洋啊，发财发财！（醒醒、做梦还早，想屁吃呢？）</p> <p>以上，就是实现 买/卖 的报单 方法（函数）了，显而易见，它其实也是一个附加在 <code>context</code> 对象上的 方法（函数），因此只要有 <code>context</code> 的地方，就可以随时调用这个方法（函数），来随时进行报单的操作。</p> <p>那么问题来了，我如何知道报单是否成功了呢？</p> <p>Good Question，真是个好问题。</p> <p>当我们用 <code>context.insert_order()</code> 报单后，就会用到另一个基本方法（函数）来接收回报消息，接下来让我们详细讨论一下吧。</p> <h3 id="_3-2-报单回报-on-order"><a href="#_3-2-报单回报-on-order" class="header-anchor">#</a> 3.2 报单回报 on_order():</h3> <p>报单，就是你用鼠标左键点击 “买”/“卖” 按钮时的动作，一旦你点击完成，就会生成一个 委托单。换作电脑程序，就是执行了一次上一节刚刚讨论过的报单方法（函数）<code>context.insert_order()</code>，之后、你的电脑会向交易所的服务器发送一个 报单 请求。你可以想象是你的电脑朝着交易所的方向，喊了一嗓子。</p> <p>那么问题来了，你的电脑真的喊了这一嗓子吗？有没有偷懒，还是中间卡壳了，甚至喊错了？那岂不是坏菜了？所以，这时候就要用到一个方法（函数）和一个 对象 来检查一下：</p> <p>语法：
<code>def on_order(context, order, location):</code></p> <p>参数：<code>context, order, location</code> <br>
返回值： 无<br></p> <p>看上去这么眼熟呢，和前面的 <code>on_quote()</code>  不能说一模一样，就是简单换了个 <code>order</code>嘛。没错，说明好记性啊。</p> <p>形式参数列表中：<br> <code>context</code> 是肯定有的，就不啰嗦了；<br> <code>location</code> 是 功夫量化 2.4 版之后新增的一个参数，前面也见过面了，复制粘帖就完了。<br></p> <p>关键点就是这个 <code>order</code> 了，没错，这也是一个对象。其中包含的内容如下所示：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order <span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'order对象： {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 
运行结果：

order对象： {&quot;account_id&quot;:&quot;&quot;,&quot;client_id&quot;:&quot;&quot;,&quot;commission&quot;:0.0,&quot;error_id&quot;:0,&quot;error_msg&quot;:&quot;&quot;,&quot;exchange_id&quot;:&quot;SSE&quot;,&quot;frozen_price&quot;:15.47,&quot;hedge_flag&quot;:0,&quot;insert_time&quot;:1666776871211807000,&quot;instrument_id&quot;:&quot;600002&quot;,&quot;instrument_type&quot;:0,&quot;limit_price&quot;:15.47,&quot;offset&quot;:0,&quot;order_id&quot;:5911543042808599379,&quot;parent_id&quot;:1666776871211,&quot;price_type&quot;:0,&quot;side&quot;:0,&quot;source_id&quot;:&quot;&quot;,&quot;status&quot;:2,&quot;tax&quot;:0.0,&quot;time_condition&quot;:0,&quot;trading_day&quot;:&quot;20221026&quot;,&quot;update_time&quot;:1666776871211807000,&quot;volume&quot;:500,&quot;volume_condition&quot;:0,&quot;volume_left&quot;:500,&quot;volume_traded&quot;:0}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如上例的代码中，第 9 行的 <code>on_order()</code> 方法（函数），是在 报单 时自动触发的。那在模拟（sim）环境中如何执行呢？简单，请跟随下面的步骤操作：</p> <p>1、让示例代码运行起来；什么？你忘了？那请自行复习一下第一章的内容吧。</p> <p><img src="/kungfu/assets/img/order01.a6921529.png" alt="运行代码"></p> <p>2、点击界面右上角的 “下单” 按钮。</p> <p>3、在弹出的 下单面板中，填好想要交易的品种以及价格、数量等数据后，点击 下单。</p> <p><img src="/kungfu/assets/img/order02.977599da.png" alt="报单操作"></p> <p>在 策略日志 区域就可以看到打印输出的信息了。</p> <p>好吧，这还看不明白了？非得捋一捋？安排，请参考下例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order<span class="token punctuation">,</span> location <span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'order对象中包含的数据如下： \n'</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 委托单ID order_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 报单时间 insert_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 更新时间 update_time：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 交易日 trading_day ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 报单品种 instrument_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                      \n 交易品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>         \
                      \n 交易所 exchange_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
				      \n 报单价格 limit_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 冻结价格 frozen_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                      \n 报单数量 volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                      \
                      \n 剩余数量 volume_left：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 税费 tax：<span class="token punctuation">{</span><span class="token punctuation">}</span>                             \
                      \n 手续费 commission： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 订单状态 status： <span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 错误ID error_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 错误消息 error_msg ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 买卖方向 side： <span class="token punctuation">{</span><span class="token punctuation">}</span>                      \
                      \n 开平方向 offset： <span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 投机套保标识 hedge_flag： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                      \n 价格类型 price_type：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 成交量类型 volume_condition：<span class="token punctuation">{</span><span class="token punctuation">}</span>         \
                      \n 成交时间类型 time_condition：<span class="token punctuation">{</span><span class="token punctuation">}</span>          \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                              order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>update_time<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>frozen_price<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>volume_left<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>tax<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>commission<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>status<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>error_id<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>error_msg<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>hedge_flag<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>volume_condition<span class="token punctuation">,</span>
                              order<span class="token punctuation">.</span>time_condition<span class="token punctuation">,</span>
                             <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>成功运行之后，在策略日志会看到如下消息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>order对象中包含的数据如下：

委托单ID order_id ： 5911543042808599385 
报单时间 insert_time： 2020-10-16 13:46:41.248089300 
更新时间 update_time：2020-10-16 13:46:41.248089300 
交易日 trading_day ： 20201026 
报单品种 instrument_id： 600000 
交易品种类型 instrument_type： InstrumentType.Unknown 
交易所 exchange_id： SSE 
报单价格 limit_price： 14.87 
冻结价格 frozen_price： 14.87 
报单数量 volume：300 
剩余数量 volume_left：300 
税费 tax：0.0 
手续费 commission： 0.0 
订单状态 status： OrderStatus.Pending 
错误ID error_id ： 0 
错误消息 error_msg ： 
买卖方向 side： Side.Buy 
开平方向 offset： Offset.Open 
投机套保标识 hedge_flag： HedgeFlag.Speculation 
价格类型 price_type：PriceType.Limit 
成交量类型 volume_condition：VolumeCondition.Any 
成交时间类型 time_condition：TimeCondition.IOC

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>这够清楚了吧。其实在实际运用中，也就主要关心其中的几个，核对 <u>报单品种 instrument_id、报单价格 limit_price、报单数量 volume </u>是不是与你预期的相符。刚刚提过的 <u>委托单ID order_id，就是那一大串数字，也是很重要的一个信息。报单时间 insert_time</u>也是，注意核对。</p> <p>最重要的莫过于 订单状态 了，这可是检查 报单 是否成功的重要标志。所谓状态嘛，当然是有几种情况了。</p> <table><thead><tr><th>整数值</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>0</td> <td>Unknown</td> <td>未知</td></tr> <tr><td>1</td> <td>Submitted</td> <td>已报单</td></tr> <tr><td>2</td> <td>Pending</td> <td>已报单，等待成交中</td></tr> <tr><td>3</td> <td>Cancelled</td> <td>已撤单</td></tr> <tr><td>4</td> <td>Error</td> <td>发生错误</td></tr> <tr><td>5</td> <td>Filled</td> <td>已成交</td></tr> <tr><td>6</td> <td>PartialFilledNotActive</td> <td>部分成交，剩余已撤单（部成部撤）</td></tr> <tr><td>7</td> <td>PartialFilledActive</td> <td>部分成交，剩余未撤单</td></tr></tbody></table> <p>请参考以下示例巩固你的理解吧。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order<span class="token punctuation">,</span> location <span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;报单回报 order 对象 {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Submitted<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单已提交！\n报单编号：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Pending<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单已提交，等待成交中！\n报单编号：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Filled<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单已成交！\n报单编号：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>PartialFilledNotActive<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单部成部撤！\n报单编号：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n剩余数量为： {}\n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume_left<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>



    <span class="token keyword">if</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Error<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单发生错误！！\n错误ID ：{} \n 错误消息：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n剩余数量为： {}\n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>error_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>error_msg<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume_left<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>当运行时执行了 <code>on_order()</code> 方法（函数），你就会在策略日志中看到类似信息：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>报单已提交，等待成交中！
报单编号：5911543043329843913 
报单时间为： 2022-10-26 20:48:43.704049000 
报单品种为： 600001 
报单价格为： 54.44 
价格类型为： PriceType.Limit 
报单数量为： 100 
买卖方向为： Side.Buy 
开平方向为： Offset.Open
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这将十分方便你复盘时，检查核验报单的情况。</p> <p>既然都报单了，接下来当然是静待成交了。如果你报单的价格、数量，正好市场上有对手盘与你交易，那么这一单就会顺利撮合成交了。</p> <p>现在用脚都想到了，成交了电脑必须给我一个回报啊，这么没有礼貌的吗？</p> <p>Good idea，真是个好想法。所以该请下一个 方法（函数）登场了。</p> <h3 id="_3-3-成交回报-on-trade"><a href="#_3-3-成交回报-on-trade" class="header-anchor">#</a> 3.3 成交回报 on_trade():</h3> <p>当你完成 报单 后，上一节的 <code>order</code> 会告诉你，“我已经确实报单了啊，没错”。接下来自然就是等待 交易服务器 回应你的电脑喊的这一嗓子了。这个过程就是 成交回报。根据市场上的具体情况 以及 你要求的价格、数量，这一单是否能顺利成交？还是成交一部分？还是全都成交不了？这必须要第一时间回报啊，不然血压都蹭蹭的往上窜。</p> <p>幸运的是，这个过程是全自动的。你的报单只要有成交的情况，就会自动执行一个方法（函数），它就是 <code>on_trade()</code>，我们来仔细看看吧：</p> <p>语法：
<code>def on_trade(context, trade, location):</code></p> <p>参数：<code>context, trade, location</code> <br>
返回值： 无<br></p> <p>这简直就是三胞胎中的老三嘛 ，看上去和前面的 <code>on_quote()</code> 、<code>on_order()</code> 有啥区别？不就是又换了个 对象 <code>trade</code>嘛。</p> <p>形式参数列表中：<br> <code>context</code> 就是原样 copy；<br> <code>location</code> 是 功夫量化 2.4 版之后新增的一个参数，也是原样复制粘帖。<br></p> <p>无非这回是 <code>trade</code> ，不用说也知道，肯定也是一个对象罗。如法炮制，先看看其中包含的内容：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> trade <span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'trade对象： {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>trade<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 
运行结果：

trade对象： {&quot;account_id&quot;:&quot;123456&quot;,&quot;client_id&quot;:&quot;&quot;,&quot;close_today_volume&quot;:0,&quot;commission&quot;:0.0,&quot;exchange_id&quot;:&quot;SSE&quot;,&quot;hedge_flag&quot;:0,&quot;instrument_id&quot;:&quot;600000&quot;,&quot;instrument_type&quot;:0,&quot;offset&quot;:0,&quot;order_id&quot;:5911543042258576638,&quot;parent_order_id&quot;:0,&quot;price&quot;:50.41,&quot;side&quot;:1,&quot;source_id&quot;:&quot;sim&quot;,&quot;tax&quot;:0.0,&quot;trade_id&quot;:5911543041550000966,&quot;trade_time&quot;:1666871286176515400,&quot;trading_day&quot;:&quot;&quot;,&quot;volume&quot;:300}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>同样的，这个 <code>on_trade()</code> 方法（函数），是在 成交 后自动触发的。在模拟（sim）环境中想要执行一次，请参考上例中的操作，启动运行后，手动下单即可，并无差别。</p> <p>知道你们非得捋一捋才能看明白？安排：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> trade<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'trade对象中包含的数据如下： \n'</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 帐号 account_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 客户名称 client_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 平今仓数量 close_today_volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>      \
                      \n 手续费 commission ： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 交易所名称 exchange_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                      \n 投机套保标识 hedge_flag： <span class="token punctuation">{</span><span class="token punctuation">}</span>           \
                      \n 交易品种 instrument_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
				      \n 交易品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>      \
                      \n 开平方向 offset： <span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                      \n 委托单号 order_id：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 关联委托单号 parent_order_id：<span class="token punctuation">{</span><span class="token punctuation">}</span>      \
                      \n 成交价格 price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                      \n 买卖方向 side： <span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 柜台名称 source_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                      \n 税费 tax：<span class="token punctuation">{</span><span class="token punctuation">}</span>                         \
                      \n 成交单号 trade_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                      \n 成交时间 trade_time：<span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                      \n 交易日 trading_day：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                      \n 成交量 volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                              trade<span class="token punctuation">.</span>account_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>client_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>close_today_volume<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>commission<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>hedge_flag<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>parent_order_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>price<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>side<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>source_id<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>tax<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>trade_id<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>trade<span class="token punctuation">.</span>trade_time<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              trade<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>
                             <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果

帐号 account_id ： 123456 
客户名称 client_id： 
平今仓数量 close_today_volume：0 
手续费 commission ： 0.0 
交易所名称 exchange_id： SSE 
投机套保标识 hedge_flag： HedgeFlag.Speculation 
交易品种 instrument_id： 600001 
交易品种类型 instrument_type： InstrumentType.Stock 
开平方向 offset： Offset.CloseToday 
委托单号 order_id：5911543043034753411 
关联委托单号 parent_order_id：0 
成交价格 price： 64.54 
买卖方向 side： Side.Sell 
柜台名称 source_id ： sim 
税费 tax：0.0 
成交单号 trade_id ： 5911543040797941231 
成交时间 trade_time：2022-10-28 14:52:11.947687500 
交易日 trading_day： 
成交量 volume：200
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><p>这下就十分清楚了吧。实际运用中，主要关心的就那么几个属性，比如 <u>交易的品种 instrument_id、成交的价格 price、成交量 volume </u>、成交的时间 trade_time，以及 成交单号 trade_id 和 委托单号 order_id，这些都是用来事后检查核对的依据。</p> <p>哎，买定离手，错爱不究。我们已经讨论过 报单 ，以及 委托单 和 成交单 了。这时候，突然，哎哎，不行，我后悔了。我要撤回，不玩了不玩了，把钱还我！</p> <p>这...这这......如果已经成交了，也就是说 <code>on_trade()</code> 已经执行了，说明 交易所 已经撮合了这笔交易，数量已经全部成交了，那就没有机会 撤回 了。真的就是 爱错了也要爱下去。（割肉呗，还有啥说的？）如果还在 委托单 这一步。还记得 委托单 的状态吗？（这么快忘了，那还是快回头复习一下吧。）如果 委托单 的 状态 还不是 已成交 <code>Filled</code>，那我们就可以用下面这个方法（函数）来完成 撤单 动作了。</p> <h3 id="_3-4-撤单-context-cancel-order"><a href="#_3-4-撤单-context-cancel-order" class="header-anchor">#</a> 3.4 撤单 context.cancel_order()</h3> <p>撤单很简单，只需要提供 委托单 的单号，同时 委托单 还没有成交，即 <code>order.status != Filled</code> ，这时就还有机会 撤回 这个 委托单。具体的方法（函数）如下：</p> <p>语法：
<code>context.cancel_order(order_id)</code></p> <p>参数：<code>order_id</code> <br>
返回值： <code>action_id</code><br></p> <p>参数只需要一个，就是 报单 时自动生成的 委托单号，现在知道这个属性（变量）<code>order.order_id</code> 的用处了吧。</p> <p>这个函数也是很有礼貌的，有一个返回值，表达 撤回 动作的编号，也是用来事后检查的。</p> <p>撤单 这个动作和 报单 一样，也可以想象为你的电脑朝着交易所的方向，喊了一嗓子。只不过这次喊的内容是：把编号 xxxx 的单子给我撤回来，我改主意了！同理，为了检查一下这一嗓子喊没喊到位，<code>on_order()</code> 也会执行一次，对应这个 撤单 的动作，也会有一次记录。请看示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> <span class="token number">100000.0</span><span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span><span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'600001'</span><span class="token punctuation">,</span><span class="token string">'600002'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">)</span>  <span class="token comment"># 订阅品种</span>

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到的交易品种 {} 的报价，管它三七二十一，报单再说！&quot;</span>
                     <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    order_id <span class="token operator">=</span> context<span class="token punctuation">.</span>insert_order<span class="token punctuation">(</span>quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span> 
                                    Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">,</span> 
                                    <span class="token string">&quot;sim&quot;</span><span class="token punctuation">,</span>              <span class="token comment"># 功夫量化 2.4 版要求填写 柜台</span>
                                    <span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
                                    quote<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span> 
                                    <span class="token number">100</span><span class="token punctuation">,</span> 
                                    PriceType<span class="token punctuation">.</span>Limit<span class="token punctuation">,</span>
                                    Side<span class="token punctuation">.</span>Buy<span class="token punctuation">,</span> 
                                    Offset<span class="token punctuation">.</span>Open
                                   <span class="token punctuation">)</span>
     
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 等一秒</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;过了1秒，我改变主意了，我要撤单！&quot;</span><span class="token punctuation">)</span>

    action_id <span class="token operator">=</span> context<span class="token punctuation">.</span>cancel_order<span class="token punctuation">(</span>order_id<span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;撤单 动作生成的单号是：{}！&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>action_id <span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order<span class="token punctuation">,</span> location <span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">if</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Submitted<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单已提交！\n报单编号：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Pending<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单已提交，等待成交中！\n报单编号：{} \n报单时间为： {} \n报单品种为： {} \n报单价格为： {} \n价格类型为： {} \n报单数量为： {} \n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>limit_price<span class="token punctuation">,</span>order<span class="token punctuation">.</span>price_type<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>    

    <span class="token keyword">if</span> order<span class="token punctuation">.</span>status <span class="token operator">==</span> OrderStatus<span class="token punctuation">.</span>Cancelled<span class="token punctuation">:</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;报单已撤回！\n撤单编号：{} \n撤单时间为： {} \n撤单品种为： {} \n撤单数量为： {} \n剩余数量为：{} \n买卖方向为： {} \n开平方向为： {} &quot;</span>
        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span>order_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>insert_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>order<span class="token punctuation">.</span>volume_left<span class="token punctuation">,</span>order<span class="token punctuation">.</span>side<span class="token punctuation">,</span>order<span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>如果你要运行上例的代码，建议将模拟帐户 <code>'sim'</code> 的选项，设置为 <code>&quot;Pend&quot;</code> ，即 报单 之后，委托单的状态是 等待中，这样即可看到 撤单 动作。可参考 第一章 1.2 配置 添加柜台帐户中的操作。</p> <p><img src="/kungfu/assets/img/cancelorder01.bcd00653.png" alt="添加柜台帐户3"></p> <p>运行结果如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>收到的交易品种 600002 的报价，管它三七二十一，报单再说！
报单已提交，等待成交中！ 
报单编号：5911543041790302880 
报单时间为： 2020-10-09 10:33:19.034556900 
报单品种为： 600000 
报单价格为： 12.0 
价格类型为： PriceType.Limit 
报单数量为： 200 
买卖方向为： Side.Buy 
开平方向为： Offset.Open 

过了1秒，我改变主意了，我要撤单！
撤单 动作生成的单号是：5911543043161467152！
报单已撤回！ 
撤单编号：5911543041790302880 
撤单时间为： 2020-10-09 10:33:20.034556900 
撤单品种为： 600000 
撤单数量为： 200 
剩余数量为：200 
买卖方向为： Side.Buy 
开平方向为： Offset.Open 
......
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>通过以上例子，你应该对 报单、撤单 以及方法（函数） <code>on_order()</code> 有了更清晰的理解吧。特别是 <code>order</code> 对象的 属性（变量） <code>order.status</code> 的几种状态所表达的意义，更加清楚了吧。</p> <h3 id="_3-5、-小结"><a href="#_3-5、-小结" class="header-anchor">#</a> 3.5、 小结</h3> <p>终于到了小结了。这一章的内容够份量了吧。基本把交易过程中最关键的操作都说明白了。（就这？）不然呢？你以为量化交易多么高大上、多么牛逼、多么复杂？还真没有，基本的动作可不就这些吗？你还能玩个花出来？交易之前翻个筋斗？和你用肉眼手拍一样一样的。无非是用计算机语言中的方法（函数）、或者 称之为 指令、代替了你的手去点“买/卖”按钮而已，没别的。</p> <p>一次完整的交易过程，不过如此。报单 --&gt; 生成 委托单 --&gt; 等待成交 或者 改主意了，撤回。这些动作、你之前是用手拍、现在用电脑程序呗。执行起来又快又准，精准高效。（最关键的，错了你可以砸电脑！）只要 报单，就会自动执行一次 <code>on_order()</code>，就是为了方便检查这个操作执行的情况，撤单也是一样。交易所成交了，也会自动执行一次 <code>on_trade()</code> ，也是为了方便事后检查核对。</p> <p>本章中用到的 对象（Object）整理如下：</p> <h4 id="order-报单-对象-object"><a href="#order-报单-对象-object" class="header-anchor">#</a> order 报单 对象（Object）</h4> <p>order 中包含的是 报单 的信息，就是由你的电脑发起，向交易所喊的那一嗓子，其中包含的具体信息可参考下表。</p> <table><thead><tr><th>序号</th> <th>属性名称</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>order_id</td> <td>委托单ID</td> <td>一长串数字</td></tr> <tr><td>02</td> <td>insert_time</td> <td>报单时间</td> <td>纳秒时间戳</td></tr> <tr><td>03</td> <td>update_time</td> <td>更新时间</td> <td></td></tr> <tr><td>04</td> <td>trading_day</td> <td>交易日</td> <td>如：20201026</td></tr> <tr><td>05</td> <td>instrument_id</td> <td>报单品种</td> <td></td></tr> <tr><td>06</td> <td>instrument_type</td> <td>交易品种类型</td> <td></td></tr> <tr><td>07</td> <td>exchange_id</td> <td>交易所</td> <td>如：沪市 Exchange.SSE</td></tr> <tr><td>08</td> <td>limit_price</td> <td>报单价格</td> <td></td></tr> <tr><td>09</td> <td>frozen_price</td> <td>冻结价格</td> <td></td></tr> <tr><td>10</td> <td>volume</td> <td>报单数量</td> <td></td></tr> <tr><td>11</td> <td>volume_left</td> <td>剩余数量</td> <td></td></tr> <tr><td>12</td> <td>tax</td> <td>税费</td> <td></td></tr> <tr><td>13</td> <td>commission</td> <td>手续费</td> <td></td></tr> <tr><td>14</td> <td>status</td> <td>订单状态</td> <td></td></tr> <tr><td>15</td> <td>error_id</td> <td>错误ID</td> <td></td></tr> <tr><td>16</td> <td>error_msg</td> <td>错误消息</td> <td></td></tr> <tr><td>17</td> <td>side</td> <td>买卖方向</td> <td></td></tr> <tr><td>18</td> <td>offset</td> <td>开平方向</td> <td></td></tr> <tr><td>19</td> <td>hedge_flag</td> <td>投机套保标识</td> <td></td></tr> <tr><td>20</td> <td>price_type</td> <td>价格类型</td> <td></td></tr> <tr><td>21</td> <td>volume_condition</td> <td>成交量类型</td> <td></td></tr> <tr><td>22</td> <td>time_condition</td> <td>成交时间类型</td> <td></td></tr></tbody></table> <p>在 报单 的过程中，有几个参数本身就是来自功夫量化的 对象（Object），如：</p> <h4 id="pricetype-价格类型-对象-object"><a href="#pricetype-价格类型-对象-object" class="header-anchor">#</a> PriceType 价格类型 对象（Object）</h4> <p>在 报单 方法（函数）<code>context.insert_order()</code> 中，用作形式参数传递。在 报单回报 的对象 <code>order</code> 中，作为属性值回传回来。</p> <table><thead><tr><th>整数值</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>0</td> <td>Limit</td> <td>限价</td></tr> <tr><td>1</td> <td>Any</td> <td>市价</td></tr> <tr><td>2</td> <td>FakBest5</td> <td>上海深圳最优五档即时成交剩余撤销，不需要报价</td></tr> <tr><td>3</td> <td>ForwardBest</td> <td>仅深圳本⽅最优价格申报, 不需要报价</td></tr> <tr><td>4</td> <td>ReverseBest</td> <td>上海最优五档即时成交，剩余部分转为限价，深圳对⼿⽅最优价格申报，不需要报价</td></tr> <tr><td>5</td> <td>Fak</td> <td>股票（仅深圳）即时成交，剩余部分撤销，不需要报价；期货即时成交剩余撤销，需要报价</td></tr> <tr><td>6</td> <td>Fok</td> <td>股票（仅深圳）市价全额成交或者撤销，不需要报价；期货全部或撤销，需要报价</td></tr> <tr><td>7</td> <td>unkonwn</td> <td>上交所的标识，意味着“增加委托”.</td></tr></tbody></table> <h4 id="side-买卖方向-对象-object"><a href="#side-买卖方向-对象-object" class="header-anchor">#</a> Side 买卖方向  对象（Object）</h4> <p>买卖方向如字面意思，就是表达 买入/卖出。但 功夫量化 同时也是支持期货市场的，所以为了表达实际运用中的更多情况，这个 对象（Object） 的属性还挺多的。</p> <table><thead><tr><th>序号</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>01</td> <td>Buy</td> <td>买</td></tr> <tr><td>02</td> <td>Sell</td> <td>卖</td></tr> <tr><td>03</td> <td>Lock</td> <td>锁仓</td></tr> <tr><td>04</td> <td>Unlock</td> <td>解锁</td></tr> <tr><td>05</td> <td>Exec</td> <td>⾏权</td></tr> <tr><td>06</td> <td>Drop</td> <td>放弃⾏权</td></tr> <tr><td>07</td> <td>Purchase</td> <td>申购</td></tr> <tr><td>08</td> <td>Redemption</td> <td>赎回</td></tr> <tr><td>09</td> <td>Split</td> <td>拆分</td></tr> <tr><td>10</td> <td>Merge</td> <td>合并</td></tr> <tr><td>11</td> <td>MarginTrade</td> <td>融资买⼊</td></tr> <tr><td>12</td> <td>ShortSell</td> <td>融券卖出</td></tr> <tr><td>13</td> <td>RepayMargin</td> <td>卖券还款</td></tr> <tr><td>14</td> <td>RepayStock</td> <td>买券还券</td></tr> <tr><td>15</td> <td>CashRepayMargin</td> <td>现⾦还款</td></tr> <tr><td>16</td> <td>StockRepayStock</td> <td>现券还券</td></tr> <tr><td>17</td> <td>SurplusStockTransfer</td> <td>余券划转</td></tr> <tr><td>18</td> <td>GuaranteeStockTransferIn</td> <td>担保品转⼊</td></tr> <tr><td>19</td> <td>GuaranteeStockTransferOut</td> <td>担保品转出</td></tr></tbody></table> <p>对于股票交易来说，就用到 买、卖 ，即示例中的 <code>Side.Buy</code> 或 <code>Side.Sell</code>。</p> <h4 id="offset-开平方向-对象-object"><a href="#offset-开平方向-对象-object" class="header-anchor">#</a> Offset 开平方向 对象（Object）</h4> <p>对应 买/卖 的动作，就有 开新仓和平仓已有持单的动作。这个 对象（Object） 就是用来表达 开仓/平仓 的。</p> <table><thead><tr><th>序号</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>01</td> <td>Open</td> <td>开新单</td></tr> <tr><td>02</td> <td>Close</td> <td>平已持有单</td></tr> <tr><td>03</td> <td>CloseToday</td> <td>平今天买入的仓位</td></tr> <tr><td>04</td> <td>CloseYesterday</td> <td>平昨</td></tr></tbody></table> <p>对应 买入，就是 <code>Offset.Open</code> 罗，对应 卖出，就是 <code>Offset.Close</code> 罗。这应该没有任何难理解的吧？猩猩都会。</p> <h4 id="hedgeflag-投机套保标识-对象-object"><a href="#hedgeflag-投机套保标识-对象-object" class="header-anchor">#</a> HedgeFlag 投机套保标识  对象（Object）</h4> <p>这个对象（Object），在 C++ 语言中才用到，Python 程序中是不用的。做股票交易也用不上。它也只有一个属性值 <code>Speculation</code>，因此瞅一眼，略过。</p> <h4 id="isswap-是否为互换单-对象-object"><a href="#isswap-是否为互换单-对象-object" class="header-anchor">#</a> IsSwap  是否为互换单  对象（Object）</h4> <p>这个对象（Object），做股票交易也是用不上的。它其实就是 2 个布尔值 ，非 真（True）即（假），也瞅一眼就好。</p> <h4 id="orderstatus-委托单状态-对象-object"><a href="#orderstatus-委托单状态-对象-object" class="header-anchor">#</a> OrderStatus 委托单状态  对象（Object）</h4> <table><thead><tr><th>序号</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>01</td> <td>Unknown</td> <td>未知</td></tr> <tr><td>02</td> <td>Submitted</td> <td>已提交</td></tr> <tr><td>03</td> <td>Pending</td> <td>等待</td></tr> <tr><td>04</td> <td>Cancelled</td> <td>已撤单</td></tr> <tr><td>05</td> <td>Error</td> <td>错误</td></tr> <tr><td>06</td> <td>Filled</td> <td>已成交</td></tr> <tr><td>07</td> <td>PartialFilledNotActive</td> <td>部分成交不在队列中（部成部撤）</td></tr> <tr><td>08</td> <td>PartialFilledActive</td> <td>部分成交还在队列中</td></tr></tbody></table> <h4 id="direction-多空-对象-object"><a href="#direction-多空-对象-object" class="header-anchor">#</a> Direction 多空 对象（Object）</h4> <p>用来表达 持仓单 ⽅向的对象（Object），也只有 2 种可能，不是多（Long），就是 空（Short）。股票交易用不上。</p> <h4 id="trade-成交回报-对象-object"><a href="#trade-成交回报-对象-object" class="header-anchor">#</a> trade  成交回报 对象（Object）</h4> <table><thead><tr><th>序号</th> <th>属性名称</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>account_id</td> <td>帐号</td> <td></td></tr> <tr><td>02</td> <td>client_id</td> <td>客户名称</td> <td></td></tr> <tr><td>03</td> <td>close_today_volume</td> <td>平今仓数量</td> <td></td></tr> <tr><td>04</td> <td>commission</td> <td>手续费</td> <td></td></tr> <tr><td>05</td> <td>exchange_id</td> <td>交易所</td> <td></td></tr> <tr><td>06</td> <td>hedge_flag</td> <td>投机套保标识</td> <td></td></tr> <tr><td>07</td> <td>instrument_id</td> <td>交易品种</td> <td></td></tr> <tr><td>08</td> <td>instrument_type</td> <td>交易品种类型</td> <td></td></tr> <tr><td>09</td> <td>offset</td> <td>开平方向</td> <td></td></tr> <tr><td>10</td> <td>order_id</td> <td>委托单号</td> <td></td></tr> <tr><td>11</td> <td>parent_order_id</td> <td>关联委托单号</td> <td></td></tr> <tr><td>12</td> <td>price</td> <td>成交价格</td> <td></td></tr> <tr><td>13</td> <td>side</td> <td>买卖方向</td> <td></td></tr> <tr><td>14</td> <td>source_id</td> <td>柜台名称</td> <td></td></tr> <tr><td>15</td> <td>tax</td> <td>税费</td> <td></td></tr> <tr><td>16</td> <td>trade_id</td> <td>成交单号</td> <td></td></tr> <tr><td>17</td> <td>trade_time</td> <td>成交时间</td> <td></td></tr> <tr><td>18</td> <td>trading_day</td> <td>成交时间交易日</td> <td></td></tr> <tr><td>19</td> <td>volume</td> <td>成交量</td> <td></td></tr></tbody></table> <p>好家伙，这也不少啊，脑袋都炸了。简单的、一撇而过就好了，猩猩都懂的，也不费什么脑子。重点就是<font color="blue" size="5"><code>order</code>、<code>PriceType</code>、<code>trade</code></font>，好好看看前面的例子，加深理解。</p> <h2 id="四、逐笔行情"><a href="#四、逐笔行情" class="header-anchor">#</a> 四、逐笔行情</h2> <p>接下来我们要玩点高级点的了。</p> <p>逐笔行情，通常资深股民都有所了解。就是常说的 Level 2 级行情、其中包含有 10-15 档报价、逐笔交易、逐笔委托......内容还挺多的。加上坊间传来传去，各种造词大神还真的挺有创意，就是让你头昏眼花、听不懂、但感觉很厉害就对了。</p> <p>功夫量化中用到的逐笔行情，根据政策要求是不允许出现在券商机房之外的场景中的。意即，你能在手机上、或你自己家里电脑上（互联网）看到的所谓 逐笔行情，都是 逗你玩。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>想要用到 逐笔行情，只能通过券商申请，在券商提供的机房中使用。所以有在公开互联网上所谓的逐笔行情，或多或少都是骗局！</p></div> <h3 id="_4-1-逐笔行情-on-transaction"><a href="#_4-1-逐笔行情-on-transaction" class="header-anchor">#</a> 4.1 逐笔行情 on_transaction():</h3> <p>没错，就是这个 transcaction 。一眼看上去，这不就是前面那 3 胞胎的堂兄弟吗？没错，果然好记性！可以把这个方法，看作是 <code>on_quote()</code> 的加强版，专门用来接收 逐笔行情 的方法（函数）。对应的就是市场中的 已成交（trade）和 已撤单 （cancel）的订单数据。</p> <p>语法：
<code>def on_transaction(context, transaction, location):</code></p> <p>参数：<code>context, transaction, location</code> <br>
返回值： 无<br></p> <p>不能说是完全复制，也基本是完全复制。就是把 <code>quote</code> 换成了 <code>transaction</code> 嘛。</p> <p>形式参数列表中：<br> <code>context</code> 是必须有的；<br> <code>location</code> 是 功夫量化 2.4 版之后新增的一个参数。<br></p> <p>关键点就是这个 <code>transaction</code> 了，当然也是一个对象。其中包含的内容如下所示：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">on_transaction</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> transaction <span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;transaction对象： {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>transaction<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 
运行结果：

&quot;transaction对象：
{&quot;ask_no&quot;:4494061,&quot;bid_no&quot;:0,&quot;biz_index&quot;:0,&quot;bs_flag&quot;:2,&quot;data_time&quot;:1667181875434000000,&quot;exchange_id&quot;:&quot;SSE&quot;,&quot;exec_type&quot;:1,&quot;instrument_id&quot;:&quot;110077&quot;,&quot;instrument_type&quot;:3,
&quot;main_seq&quot;:801,&quot;price&quot;:124.288,&quot;seq&quot;:5724859,&quot;trading_day&quot;:&quot;&quot;,&quot;volume&quot;:10}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>功夫量化的 &quot;sim&quot; 是不提供 逐笔行情 的。因此，在本地模拟环境中，是无法接收到 <code>transaction</code> 的。并且，因券商不同，沪市和深市 的 逐笔行情 还略有差别，实际运用中，注意认真甄别。</p></div> <p>按照惯例还是捋捋吧：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">on_transaction</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> transaction<span class="token punctuation">,</span>location <span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 接收已订阅品种的报价数据</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到的 逐笔行情 数据如下：\n&quot;</span><span class="token punctuation">)</span>     
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 卖⽅订单号 ask_no：<span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 买⽅订单号 bid_no：<span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                      \n 业务序号 biz_index：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 内外盘标识 bs_flag： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n ⽣成时间 data_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 交易所 exchange_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                      \n 成交标识 exec_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 交易品种 instrument_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                      \n 交易品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>      \
                      \n 主序号 main_seq：<span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 价格 price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                        \
                      \n ⼦序号 seq： <span class="token punctuation">{</span><span class="token punctuation">}</span>                        \
                      \n 交易日 trading_day：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 成交量 volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                      \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                              transaction<span class="token punctuation">.</span>ask_no<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>bid_no<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>biz_index<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>bs_flag<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>transaction<span class="token punctuation">.</span>data_time<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 转换文本格式。</span>
                              transaction<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>exec_type<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>main_seq<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>price<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>seq<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              transaction<span class="token punctuation">.</span>volume
                             <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>如果你开通了 Level 2 逐笔行情 的权限，成功运行上例后，会看到如下结果：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>收到的 逐笔行情 数据如下：

卖⽅订单号 ask_no：7332611
买⽅订单号 bid_no：7202545
业务序号 biz_index：0
内外盘标识 bs_flag： BsFlag.Sell
⽣成时间 data_time： 2020-11-02 14:18:22.880000000
交易所 exchange_id ： SSE
成交标识 exec_type： ExecType.Trade
交易品种 instrument_id： 110077
交易品种类型 instrument_type： InstrumentType.Bond
主序号 main_seq：801
价格 price： 137.75
⼦序号 seq： 9658848
交易日 trading_day：20221103
成交量 volume：4
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>大部分的属性（变量）所表达的意思一目了然，不需要过多解释吧。</p> <p>接下来讨论几个值得特别关注的：</p> <p>bs_flag ———— 这个属性（变量）实际是一个 对象，只有 3 个具体的值：分别是：Unknown 未知、Buy 买 和 Sell 卖；意即这次的 逐笔行情，是一个 买单、卖单或是未知的状态；<br>
exec_type ———— 这是十分重要的一个属性，也是一个 对象，也只有 3 个具体的值：Unknown	未知、
Cancel	撤单 和 Trade	成交；用脚也想到了，只有 Trade 的报价才是真正换手成功的价格，而 撤单 和 未知，就说明价格是虚报的，或无效的。<br>
data_time ———— 这个价格产生的时间当然也是重要的考量之一，这是交易所的时间，精准到毫秒（甚至纳秒），用来核对逐笔行情的报价时，是重要的依据。</p> <h3 id="_4-2-逐笔委托-on-entrust"><a href="#_4-2-逐笔委托-on-entrust" class="header-anchor">#</a> 4.2 逐笔委托 on_entrust():</h3> <p>上一节讨论是的大堂哥，这一节该介绍二堂哥了。这个方法（函数）就是专门用来接收 逐笔委托 的。对应的就是市场中的 已委托的 订单数据，相信你还记得，在 报单 之后就会生成一个 委托单，只要没有 成交 之前，委托单是可以撤消的。记住这一点。</p> <p>语法：
<code>def on_entrust(context, entrust, location):</code></p> <p>参数：<code>context, entrust, location</code> <br>
返回值： 无<br></p> <p>是不是就是二堂哥，也就是把 <code>transaction</code> 换成了 <code>entrust</code> 嘛。</p> <p>形式参数列表中：<br> <code>context</code> 是必须有的；<br> <code>location</code> 是 功夫量化 2.4 版之后新增的一个参数。<br></p> <p>关键点就是这个 <code>entrust</code> 了，当然也是一个对象。其中包含的内容如下所示：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">on_entrust</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entrust<span class="token punctuation">,</span>location <span class="token punctuation">)</span><span class="token punctuation">:</span>  

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到的 逐笔委托 数据如下：{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>entrust<span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token triple-quoted-string string">&quot;&quot;&quot; 
运行结果：

收到的 逐笔委托 数据如下：{&quot;biz_index&quot;:0,&quot;data_time&quot;:1667355317080000000,&quot;exchange_id&quot;:&quot;SSE&quot;,&quot;instrument_id&quot;:&quot;110077&quot;,&quot;instrument_type&quot;:3,&quot;main_seq&quot;:801,&quot;price&quot;:140.06,&quot;price_type&quot;:0,&quot;seq&quot;:3967742,&quot;side&quot;:0,&quot;trading_day&quot;:&quot;20221103&quot;,&quot;volume&quot;:6}
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>按照惯例还是捋捋吧：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">on_entrust</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> entrust<span class="token punctuation">,</span>location <span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 接收已订阅品种的报价数据</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到的 逐笔委托 数据如下：&quot;</span><span class="token punctuation">)</span>     

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 业务序号 biz_index：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n ⽣成时间 data_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                      \n 交易所 exchange_id ： <span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                      \n 交易品种 instrument_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                      \n 交易品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>      \
                      \n 主序号 main_seq：<span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                      \n 价格 price： <span class="token punctuation">{</span><span class="token punctuation">}</span>                        \
                      \n ⼦序号 seq： <span class="token punctuation">{</span><span class="token punctuation">}</span>                        \
                      \n 委托⽅向（买卖） side： <span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                      \n 交易日 trading_day：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                      \n 成交量 volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                      \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                              entrust<span class="token punctuation">.</span>biz_index<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>entrust<span class="token punctuation">.</span>data_time<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment"># 转换文本格式。</span>
                              entrust<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>main_seq<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>price<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>seq<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>side<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              entrust<span class="token punctuation">.</span>volume
                             <span class="token punctuation">)</span>    
                    <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>同样的，不要只盯着 时间、价格、委托量、这些基本的考量。时间 和 委托方向，也是十分重要的。灵活运用在你自己的交易策略中吧。</p> <h3 id="_4-3、-小结"><a href="#_4-3、-小结" class="header-anchor">#</a> 4.3、 小结</h3> <p>又这么快就小结了？对啊，关于 逐笔交易 也就这两个方法（函数）了。<code>on_transaction</code> 用来接收逐笔行情的 交易单和撤单，<code>on_entrust()</code>用来接收 逐笔委托 的数据，你还要啥？这已经是高频交易的门坎了。</p> <p>再次提醒，Level 2 逐笔行情 ，程序能用上的那种，目前（2022年）必然是在券商的机房里才有，不会放在公网（互联网）上。在公网上的，多少带点 逗你玩 的意思，注意提防。</p> <p>接收到的 逐笔行情 和 逐笔委托，重点关注的属性（变量）、无非也就是 时间、品种、价格、委托/成交的买卖方向、成交/撤单。诸如这些。（券商不同、以及 沪市深市不同，这些属性会有些许差别，请留意券商文档中的说明部分。）让它们成为你的交易策略中的条件因子吧。运用熟练了，你的交易必然就会快人一步。</p> <h4 id="transaction-逐笔行情-对象-object"><a href="#transaction-逐笔行情-对象-object" class="header-anchor">#</a> transaction 逐笔行情 对象（Object）</h4> <table><thead><tr><th>序号</th> <th>属性名称</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>ask_no</td> <td>卖⽅订单号</td> <td></td></tr> <tr><td>02</td> <td>bid_no</td> <td>买⽅订单号</td> <td></td></tr> <tr><td>03</td> <td>biz_index</td> <td>业务序号</td> <td></td></tr> <tr><td>04</td> <td>bs_flag</td> <td>内外盘标识</td> <td>市场、券商不同而不同</td></tr> <tr><td>05</td> <td>data_time</td> <td>⽣成时间</td> <td>交易所时间</td></tr> <tr><td>06</td> <td>exchange_id</td> <td>交易所</td> <td></td></tr> <tr><td>07</td> <td>exec_type</td> <td>成交标识</td> <td>对象（Object）</td></tr> <tr><td>08</td> <td>instrument_id</td> <td>交易品种</td> <td></td></tr> <tr><td>09</td> <td>instrument_type</td> <td>交易品种类型</td> <td></td></tr> <tr><td>10</td> <td>main_seq</td> <td>主序号</td> <td></td></tr> <tr><td>11</td> <td>price</td> <td>成交价格</td> <td></td></tr> <tr><td>12</td> <td>seq</td> <td>⼦序号</td> <td></td></tr> <tr><td>13</td> <td>trading_day</td> <td>交易日</td> <td></td></tr> <tr><td>14</td> <td>volume</td> <td>成交量</td> <td></td></tr></tbody></table> <h4 id="bsflag-买卖标识-对象-object"><a href="#bsflag-买卖标识-对象-object" class="header-anchor">#</a> BsFlag 买卖标识 对象（Object）</h4> <p>虽然是一个 对象，但其实只有 3 个属性（变量）。</p> <table><thead><tr><th>整数值</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>0</td> <td>BsFlag.Unknown</td> <td>未知</td></tr> <tr><td>1</td> <td>BsFlag.Buy</td> <td>买</td></tr> <tr><td>2</td> <td>BsFlag.Sell</td> <td>卖</td></tr></tbody></table> <h4 id="exectype-交易执行类型-对象-object"><a href="#exectype-交易执行类型-对象-object" class="header-anchor">#</a> ExecType 交易执行类型 对象（Object）</h4> <p>也只有 3 个属性（变量）</p> <table><thead><tr><th>整数值</th> <th>属性</th> <th>说明</th></tr></thead> <tbody><tr><td>0</td> <td>ExecType.Unknown</td> <td>未知</td></tr> <tr><td>1</td> <td>ExecType.Cancel</td> <td>撤消单</td></tr> <tr><td>2</td> <td>ExecType.Trade</td> <td>成交单</td></tr></tbody></table> <p>不言而喻，<code>BsFlag</code> 和 <code>ExecType</code> 这 2 个对象是相当重要的参数吧。</p> <h4 id="entrust-逐笔委托-对象-object"><a href="#entrust-逐笔委托-对象-object" class="header-anchor">#</a> entrust 逐笔委托 对象（Object）</h4> <table><thead><tr><th>序号</th> <th>属性名称</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>biz_index</td> <td>业务序号</td> <td></td></tr> <tr><td>02</td> <td>data_time</td> <td>⽣成时间</td> <td></td></tr> <tr><td>03</td> <td>exchange_id</td> <td>交易所</td> <td></td></tr> <tr><td>04</td> <td>instrument_id</td> <td>交易品种</td> <td></td></tr> <tr><td>05</td> <td>instrument_type</td> <td>交易品种类型</td> <td></td></tr> <tr><td>06</td> <td>main_seq</td> <td>主序号</td> <td></td></tr> <tr><td>07</td> <td>price</td> <td>价格</td> <td></td></tr> <tr><td>08</td> <td>seq</td> <td>⼦序号</td> <td></td></tr> <tr><td>09</td> <td>side</td> <td>委托⽅向（买卖）</td> <td></td></tr> <tr><td>10</td> <td>trading_day</td> <td>交易日</td> <td></td></tr> <tr><td>11</td> <td>volume</td> <td>成交量</td> <td></td></tr></tbody></table> <h2 id="五、帐户信息"><a href="#五、帐户信息" class="header-anchor">#</a> 五、帐户信息</h2> <p>俗话说“会买的是徒弟，会卖的才是师傅”。低买高卖谁都懂啊，但实际操作中呢？都追到最高点，割肉在最低点......命苦啊！</p> <p>所以，时刻关注自己的帐户的状况，乃是重中之重。本章就要详细讨论有关获取帐户数据的方法（函数）和对象。</p> <p><img src="/kungfu/assets/img/book.d2f60f7c.png" alt="订单薄BOOK"></p> <p>任何一个股票交易帐户中，都有一个 查询 功能，可以在其中看到在关帐户的一些信息，比如，帐户上有多少钱啊、持有多少股票啊、下了几个委托单啊、成交了几单啊......诸如此类。这些信息就是 订单薄 BOOK，随时随地关注自己的帐户状态，才是步入高手的境界。知已知彼才能百战不怠嘛 。</p> <h3 id="_5-1、策略程序的订单薄-context-book-对象"><a href="#_5-1、策略程序的订单薄-context-book-对象" class="header-anchor">#</a> 5.1、策略程序的订单薄  context.book 对象</h3> <p>都学习到这里的朋友，应该用脚都想到了：为了描述刚刚提到的 订单薄 BOOK，必须要用一个 对象（Object）啊。很明显，已经准备好了，就是 <code>context.book</code> ，BOOK 本身就是一个 对象（Object），同时又作为一个 属性（变量），绑定在 <code>context</code> 身上。这样的好处很明显，就是随处都可以访问了，方便我们的使用。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>正因为是绑定在 <code>context</code> 上，因此它只包含了<b>当前 策略程序</b> 的订单信息。而不是帐户中全部的订单信息。请注意同时运行多个策略时的区别。</p></div> <p>首先当然我们要先看看其中包括什么了，请参考下例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source <span class="token operator">=</span> <span class="token string">&quot;sim&quot;</span>
account_str <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source<span class="token punctuation">,</span> account_str<span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>


<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 
        
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'context.book 中包括的内容如下：'</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 描述普通帐户信息的 对象 asset：<span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                          \n 描述两融帐户信息的 对象 asset_margin ：<span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 描述手续费的 对象 commissions：<span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                          \n 获取多头仓位的方法 get_long_position：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                          \n 获取仓位的方法 get_position：<span class="token punctuation">{</span><span class="token punctuation">}</span>                     \
                          \n 判断是否有持仓的方法 get_position_for：<span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 获取空头仓位的方法 get_short_position：<span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 判断是否有多头仓位的方法 has_long_position：<span class="token punctuation">{</span><span class="token punctuation">}</span>        \
                          \n 判断是否有仓位的方法 has_position：<span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 判断是否有持仓的方法 has_position_for：<span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 判断是有空头仓位的方法 has_short_position：<span class="token punctuation">{</span><span class="token punctuation">}</span>        \
                          \n 描述持仓品种的对象 instruments：<span class="token punctuation">{</span><span class="token punctuation">}</span>                   \
                          \n 对应多头仓位的对象 long_positions：<span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 委托单输入对象 order_inputs：<span class="token punctuation">{</span><span class="token punctuation">}</span>                      \
                          \n 委托单对象 orders：<span class="token punctuation">{</span><span class="token punctuation">}</span>                               \
                          \n 对应空头仓位的对象 short_positions：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 成交单对象trades：<span class="token punctuation">{</span><span class="token punctuation">}</span>                                \
                          \n 更新的方法 update：<span class="token punctuation">{</span><span class="token punctuation">}</span>                               \
                         &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset_margin<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>commissions<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>get_long_position<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>get_position<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>get_position_for<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>get_short_position<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_long_position<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position_for<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_short_position<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>instruments<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>long_positions<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>order_inputs<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>orders<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>short_positions<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>trades<span class="token punctuation">,</span>
                                  context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>update<span class="token punctuation">,</span>
                                 <span class="token punctuation">)</span>          
                        <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 运行结果如下：

context.book 中包括的内容如下：

普通帐户信息 asset：{&quot;accumulated_fee&quot;:0.0,&quot;avail&quot;:0.0,&quot;close_pnl&quot;:0.0,&quot;dynamic_equity&quot;:0.0,&quot;frozen_cash&quot;:0.0,&quot;frozen_fee&quot;:0.0,&quot;frozen_margin&quot;:0.0,&quot;holder_uid&quot;:1666259557,&quot;initial_equity&quot;:0.0,&quot;intraday_fee&quot;:0.0,&quot;ledger_category&quot;:1,&quot;margin&quot;:0.0,&quot;market_value&quot;:0.0,&quot;position_pnl&quot;:0.0,&quot;realized_pnl&quot;:0.0,&quot;static_equity&quot;:0.0,&quot;trading_day&quot;:&quot;20221114&quot;,&quot;unrealized_pnl&quot;:0.0,&quot;update_time&quot;:1668421192424703500}

两融帐户信息 asset_margin ：{&quot;avail_margin&quot;:0.0,&quot;cash_debt&quot;:0.0,&quot;cash_margin&quot;:0.0,&quot;collateral_ratio&quot;:0.0,&quot;commission_ratio&quot;:0.0,&quot;credit&quot;:0.0,&quot;holder_uid&quot;:1666259557,&quot;ledger_category&quot;:1,&quot;margin&quot;:0.0,&quot;margin_interest&quot;:0.0,&quot;margin_market_value&quot;:0.0,&quot;settlement&quot;:0.0,&quot;short_cash&quot;:0.0,&quot;short_margin&quot;:0.0,&quot;short_market_value&quot;:0.0,&quot;total_asset&quot;:0.0,&quot;trading_day&quot;:&quot;20221114&quot;,&quot;update_time&quot;:0}

描述手续费的对象 commissions：[pykungfu.wingchun.CommissionMap object at 0x0000028F0FBECC70]
获取多头仓位的方法 get_long_position：[bound method PyCapsule.get_long_position of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
获取仓位的方法 get_position：[bound method PyCapsule.get_position of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
判断是否有持仓的方法 get_position_for：[bound method PyCapsule.get_position_for of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
获取空头仓位的方法 get_short_position：[bound method PyCapsule.get_short_position of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
判断是否有多头仓位的方法 has_long_position：[bound method PyCapsule.has_long_position of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
判断是否有仓位的方法 has_position：[bound method PyCapsule.has_position of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
判断是否有持仓的方法 has_position_for：[bound method PyCapsule.has_position_for of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
判断是有空头仓位的方法 has_short_position：[bound method PyCapsule.has_short_position of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
描述持仓品种的对象 instruments：[pykungfu.wingchun.InstrumentMap object at 0x0000028F0AAD9F70]
对应多头仓位的对象 long_positions：[pykungfu.wingchun.PositionMap object at 0x0000028F0FBECFB0]
委托单对象order_inputs：[pykungfu.wingchun.OrderInputMap object at 0x0000028F0FBF1C70]
更新的方法 update：[bound method PyCapsule.update of [pykungfu.wingchun.Book object at 0x0000028F0FBECBF0]]
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>可见这个 <code>context.book</code> 不简单吧，就算如上例那样输出到日志，也把人看得晕晕乎乎。为了看得更清晰一点，还是捋成表格吧，对象在上，方法（函数）在下：</p> <table><thead><tr><th>序号</th> <th>名称</th> <th>类型</th> <th>功能</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>asset</td> <td>对象（Object）</td> <td>描述普通帐户的信息</td> <td></td></tr> <tr><td>02</td> <td>asset_margin</td> <td>对象（Object）</td> <td>描述两融帐户的信息</td> <td></td></tr> <tr><td>03</td> <td>commissions</td> <td>对象（Object）</td> <td>描述手续费</td> <td></td></tr> <tr><td>04</td> <td>instruments</td> <td>对象（Object）</td> <td>描述品种代码</td> <td></td></tr> <tr><td>05</td> <td>long_positions</td> <td>对象（Object）</td> <td>对应多头仓位</td> <td></td></tr> <tr><td>06</td> <td>short_positions</td> <td>对象（Object）</td> <td>对应空头仓位</td> <td></td></tr> <tr><td>07</td> <td>order_inputs</td> <td>对象（Object）</td> <td>描述委托单输入</td> <td></td></tr> <tr><td>08</td> <td>orders</td> <td>对象（Object）</td> <td>描述委托单</td> <td></td></tr> <tr><td>09</td> <td>trades</td> <td>对象（Object）</td> <td>描述成交单</td> <td></td></tr> <tr><td>方法（函数）</td> <td></td> <td></td> <td></td> <td></td></tr> <tr><td>10</td> <td>has_position()</td> <td>方法（函数）</td> <td>判断是否有仓位的方法</td> <td></td></tr> <tr><td>11</td> <td>has_position_for()</td> <td>方法（函数）</td> <td>判断是否有持仓的方法</td> <td></td></tr> <tr><td>12</td> <td>has_long_position()</td> <td>方法（函数）</td> <td>判断是否有多头仓位的方法</td> <td></td></tr> <tr><td>13</td> <td>has_short_position()</td> <td>方法（函数）</td> <td>判断是有空头仓位的方法</td> <td></td></tr> <tr><td>14</td> <td>get_position()</td> <td>方法（函数）</td> <td>获取仓位的方法</td> <td></td></tr> <tr><td>15</td> <td>get_position_for()</td> <td>方法（函数）</td> <td>判断是否有持仓的方法</td> <td></td></tr> <tr><td>16</td> <td>get_long_position()</td> <td>方法（函数）</td> <td>获取多头仓位的方法</td> <td></td></tr> <tr><td>17</td> <td>get_short_position()</td> <td>方法（函数）</td> <td>获取空头仓位的方法</td> <td></td></tr> <tr><td>18</td> <td>update()</td> <td>方法（函数）</td> <td>更新的方法</td> <td></td></tr></tbody></table> <p>哎哎，先别跑嘛。本文档只涉及普通帐户，并且只讨论与股票相关的内容。因此，什么两融啊、空头啊，都删了删了。这下轻松多了吧？所以本文档仅讨论  <code>context.book</code> 中的以下这些内容：</p> <ul><li>asset 对象（Object）</li> <li>long_positions 对象（Object）</li> <li>order_inputs 对象（Object）</li> <li>orders 对象（Object）</li> <li>trades 对象（Object）</li> <li>has_position() 方法（函数）</li> <li>has_position_for() 方法（函数）</li> <li>has_long_position() 方法（函数）</li> <li>get_position() 方法（函数）</li> <li>get_position_for() 方法（函数）</li> <li>get_long_position() 方法（函数）</li> <li>update() 方法（函数）</li></ul> <h3 id="_5-2、-帐户的订单薄-context-get-account-book"><a href="#_5-2、-帐户的订单薄-context-get-account-book" class="header-anchor">#</a> 5.2、 帐户的订单薄  context.get_account_book()</h3> <p>有朋友就提问了：你刚刚说的那个 BOOK ，特别强调是 <b>当前 策略程序</b> 的 订单薄。那我肯定要时刻关注我的帐户里的所有资金啊！</p> <p>认真、仔细、严谨哈，值得表扬。因为本章第一节就提到了， <code>context.book</code> 中只包含了当前策略程序的订单信息，所以有些属性（变量）的值就是 0，如果想要获取帐户中全部的订单薄信息，就要用到这个方法（函数）了。特别是你想用一个程序控制多个帐户的时候，就十分有用了。（玩得真花，先玩好一个策略、一个帐户，可以有？这还没开始，就想飞，还想多重影分身，一起飞？）</p> <p>请参考下例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source <span class="token operator">=</span> <span class="token string">&quot;sim&quot;</span>
account_A <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span>
account_B <span class="token operator">=</span> <span class="token string">&quot;654321&quot;</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source<span class="token punctuation">,</span> account_A <span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source<span class="token punctuation">,</span> account_B <span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 
        
    A_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source<span class="token punctuation">,</span> account_A<span class="token punctuation">)</span>
    B_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source<span class="token punctuation">,</span> account_B<span class="token punctuation">)</span>
    
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'A_Book 中包括的内容如下：'</span><span class="token punctuation">)</span> 
    
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 累计手续费 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 可用资金 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 平仓盈亏（期货） A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 动态权益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结资金 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结手续费<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 持有人ID A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 期初权益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 当日手续费 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 账户类别 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 市值<span class="token punctuation">(</span>股票<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 持仓盈亏<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 累计收益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 静态权益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 交易日 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 未实现盈亏 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 更新时间<span class="token punctuation">(</span>功夫时间<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl<span class="token punctuation">,</span> 
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">,</span>
                              A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time
                            <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span> 
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'============================================='</span><span class="token punctuation">)</span> 
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'B_Book 中包括的内容如下：'</span><span class="token punctuation">)</span> 
    
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 累计手续费 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 可用资金 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 平仓盈亏（期货） B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 动态权益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结资金 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结手续费<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 持有人ID B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 期初权益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 当日手续费 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 账户类别 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 市值<span class="token punctuation">(</span>股票<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 持仓盈亏<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 累计收益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 静态权益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 交易日 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 未实现盈亏 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 更新时间<span class="token punctuation">(</span>功夫时间<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl<span class="token punctuation">,</span> 
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">,</span>
                              B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time
                            <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span> 
    
    
<span class="token string">&quot;&quot;</span>&quot; 运行结果

A_Book 中包括的内容如下：

累计手续费 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee： <span class="token number">0.0</span>
可用资金 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail： <span class="token number">953247.987</span>
平仓盈亏（期货） A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl： <span class="token number">0.0</span>
动态权益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity： <span class="token number">986335.167</span>
冻结资金 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash： <span class="token number">0.0</span>
冻结手续费<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee： <span class="token number">0.0</span>
冻结保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin： <span class="token number">0.0</span>
持有人ID A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid： <span class="token number">679239496</span>
期初权益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity： <span class="token number">0.0</span>
当日手续费 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee： <span class="token number">0.0</span>
账户类别 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category： LedgerCategory<span class="token punctuation">.</span>Account
保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin： <span class="token number">0.0</span>
市值<span class="token punctuation">(</span>股票<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value： <span class="token number">33087.18</span>
持仓盈亏<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl： <span class="token number">0.0</span>
累计收益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl： <span class="token number">0.0</span>
静态权益 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity： <span class="token number">0.0</span>
交易日 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day： <span class="token number">20300424</span>
未实现盈亏 A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl： <span class="token number">1934.8300000000013</span>
更新时间<span class="token punctuation">(</span>功夫时间<span class="token punctuation">)</span> A_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time： <span class="token number">1668603493982232838</span>

<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
B_Book 中包括的内容如下：

累计手续费 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee： <span class="token number">0.0</span>
可用资金 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail： <span class="token number">953247.987</span>
平仓盈亏（期货） B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl： <span class="token number">0.0</span>
动态权益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity： <span class="token number">986335.167</span>
冻结资金 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash： <span class="token number">0.0</span>
冻结手续费<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee： <span class="token number">0.0</span>
冻结保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin： <span class="token number">0.0</span>
持有人ID B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid： <span class="token number">679239496</span>
期初权益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity： <span class="token number">0.0</span>
当日手续费 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee： <span class="token number">0.0</span>
账户类别 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category： LedgerCategory<span class="token punctuation">.</span>Account
保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin： <span class="token number">0.0</span>
市值<span class="token punctuation">(</span>股票<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value： <span class="token number">33087.18</span>
持仓盈亏<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl： <span class="token number">0.0</span>
累计收益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl： <span class="token number">0.0</span>
静态权益 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity： <span class="token number">0.0</span>
交易日 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day： <span class="token number">20300424</span>
未实现盈亏 B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl： <span class="token number">1934.8300000000013</span>
更新时间<span class="token punctuation">(</span>功夫时间<span class="token punctuation">)</span> B_Book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time： <span class="token number">1668603493982232838</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>新手初学者朋友，尽量先运用 一个策略仅管理自己本策略的订单信息为好，即用好 <code>context.book</code> 对象。之后熟练了，再考虑管理帐户的全部订单、甚至多个帐户的订单。先玩好简单的，再玩复杂的。不要一开始就想飞！</p></div> <h3 id="_5-3、-资产信息-asset-对象-object"><a href="#_5-3、-资产信息-asset-对象-object" class="header-anchor">#</a> 5.3、 资产信息 asset 对象（Object）</h3> <p>先来个简单的吧， <code>asset</code> 这个对象（Object） 中包含多个属性（变量），都是有关帐户的一些信息。请看下面这个例子吧：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source <span class="token operator">=</span> <span class="token string">&quot;sim&quot;</span>
account_str <span class="token operator">=</span> <span class="token string">&quot;123456&quot;</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 
        
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'context.book.asset 中包括的内容如下：'</span><span class="token punctuation">)</span> 
    
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 累计手续费 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 可用资金 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 平仓盈亏（期货） context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 动态权益 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结资金 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结手续费<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 冻结保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 持有人ID context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 期初权益 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 当日手续费 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 账户类别 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 保证金<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 市值<span class="token punctuation">(</span>股票<span class="token punctuation">)</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 持仓盈亏<span class="token punctuation">(</span>期货<span class="token punctuation">)</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 累计收益 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 静态权益 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 交易日 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 未实现盈亏 context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                      \n 更新时间<span class="token punctuation">(</span>功夫时间<span class="token punctuation">)</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time： <span class="token punctuation">{</span><span class="token punctuation">}</span>     \
                     &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>accumulated_fee<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>avail<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>close_pnl<span class="token punctuation">,</span> 
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>dynamic_equity<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_cash<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_fee<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>frozen_margin<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>holder_uid<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>initial_equity<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>intraday_fee<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>ledger_category<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>margin<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>market_value<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>position_pnl<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>static_equity<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">,</span>
                              context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>asset<span class="token punctuation">.</span>update_time
                             <span class="token punctuation">)</span>
                    <span class="token punctuation">)</span> 

<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果
context.book.asset 中包括的内容如下：

累计手续费 context.book.asset.accumulated_fee： 0.0
可用资金 context.book.asset.avail： 0.0
平仓盈亏（期货） context.book.asset.close_pnl： 0.0
动态权益 context.book.asset.dynamic_equity： 0.0
冻结资金 context.book.asset.frozen_cash： 0.0
冻结手续费(期货) context.book.asset.frozen_fee： 0.0
冻结保证金(期货) context.book.asset.frozen_margin： 0.0
持有人ID context.book.asset.holder_uid： 1666259557
期初权益 context.book.asset.initial_equity： 0.0
当日手续费 context.book.asset.intraday_fee： 0.0
账户类别 context.book.asset.ledger_category： LedgerCategory.Strategy
保证金(期货) context.book.asset.margin： 0.0
市值(股票) context.book.asset.market_value： 0.0
持仓盈亏(期货) context.book.asset.position_pnl： 0.0
累计收益 context.book.asset.realized_pnl： 0.0
静态权益 context.book.asset.static_equity： 0.0
交易日 context.book.asset.trading_day： 20221116
未实现盈亏 context.book.asset.unrealized_pnl： 0.0
更新时间(功夫时间) context.book.asset.update_time： 1668598940651068700
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p>如果你用本地 <code>'sim'</code> 帐户来运行上例，结果也会如示例中一样，很多属性（变量）的值都是 0，显然这与真实情况有所差距。因此强烈建议：至少用某家券商的模拟帐户来理解有关帐户信息的描述，这样更接近真实帐户的情况，也更有帮助。并且，模拟帐户全都是免费申请的，无需付出额外的成本。</p> <p>由上例可见， <code>asset</code> 这个对象（Object） 中所包含的都是帐户相关的一些信息。其中还有一些是用于期货帐户的，实际运用中请根据自己的需求取用吧。</p> <h3 id="_5-4、-手续费-commissions-对象-object"><a href="#_5-4、-手续费-commissions-对象-object" class="header-anchor">#</a> 5.4、 手续费 commissions  对象（Object）</h3> <p>手续费 是股民朋友们除了行情之外，最关心的话题之二了。这要是都没算明白，那就是一笔糊涂帐。所以必须有个 对象（Object） 是用来描述手续费啊，就是这个 <code>commissions</code> 。很明显它带有很多的 属性（变量），用来对应有关手续费的数据信息。它也是一个 可迭代 的对象，Python程序猿秒懂了。因此用 <code>for</code> 循环来遍历其中的每一项内容，就知道其中都有什么信息了。请参考下例：（前提是你的帐户里交易过单子啊。一单都没有成交的全新帐户，程序也读取不到手续费啊。）</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>
    

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    comm <span class="token operator">=</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>commissions  <span class="token comment"># 访问 手续费 对象（Object）</span>

    <span class="token keyword">for</span> key <span class="token keyword">in</span> comm<span class="token punctuation">:</span>  <span class="token comment"># 遍历 手续费 对象（Object） 中的每一项</span>
        ccc <span class="token operator">=</span> comm<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;手续费的信息数据如下：&quot;</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 平仓费率 close_ratio： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                          \n 平今费率 close_today_ratio： <span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                          \n 交易所 exchange_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>                     \
                          \n 品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 最小手续费 min_commission： <span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 手续费模式 mode： <span class="token punctuation">{</span><span class="token punctuation">}</span> （按交易额<span class="token operator">/</span>交易量计算）    \
                          \n 开仓费率 open_ratio： <span class="token punctuation">{</span><span class="token punctuation">}</span>                    \
                          \n 品种ID product_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>                     \
                          &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ccc<span class="token punctuation">.</span>close_ratio<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>close_today_ratio<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>min_commission<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>mode<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>open_ratio<span class="token punctuation">,</span>
                                   ccc<span class="token punctuation">.</span>product_id<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>其中股民朋友们最关心的就是 “最小手续费”吧，谈到什么条件了呢？ “万一免5” 了吗？（🐕）</p> <h3 id="_5-5、-交易品种-instruments-对象-object"><a href="#_5-5、-交易品种-instruments-对象-object" class="header-anchor">#</a> 5.5、 交易品种 instruments  对象（Object）</h3> <p>每天都盯盘，看得就是交易品种，这个太熟悉不过了。买入持有了，帐户中就有对应的订单，当然也有一个与之对应的 对象（Object）来描述这些信息。同上一节类似，也是一个可迭代 的对象，包括若干属性（变量），保存着相关的信息和数据。请参考以下示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    ins <span class="token operator">=</span> context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>instruments  <span class="token comment"># 访问 交易品种 对象（Object）</span>

    <span class="token keyword">for</span> key <span class="token keyword">in</span> ins<span class="token punctuation">:</span>  <span class="token comment"># 遍历 手续费 对象（Object） 中的每一项</span>
        ment <span class="token operator">=</span> ins<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;帐户中 交易品种 的信息数据如下：&quot;</span><span class="token punctuation">)</span>

        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 合约乘数 contract_multiplier： <span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                          \n conversion_rate： <span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                          \n 创建日期 create_date：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 交割月 delivery_month：<span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                          \n 交割年 delivery_year：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 交易所 exchange_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 过期时间 expire_date：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n force_update_ratio：<span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 品种代码 instrument_id：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                          \n 品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>          \
                          \n 是否可交易 is_trading：<span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                          \n 多单保证金比例 long_margin_ratio：<span class="token punctuation">{</span><span class="token punctuation">}</span>    \
                          \n 开盘日期 open_date：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                          \n 报价步长 price_tick：<span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 产品ID product_id：<span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                          \n 空单保证金比例 short_margin_ratio：<span class="token punctuation">{</span><span class="token punctuation">}</span>   \
                          &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ment<span class="token punctuation">.</span>contract_multiplier<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>conversion_rate<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>create_date<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>delivery_month<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>delivery_year<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>expire_date<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>force_update_ratio<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>is_trading<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>long_margin_ratio<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>open_date<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>price_tick<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>product_id<span class="token punctuation">,</span>
                                   ment<span class="token punctuation">.</span>short_margin_ratio
                                  <span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>由示例可看出，交易品种的信息有很多是仅适用于期货产品的。A股股票品种相对简单多了，因此了解就好。</p> <h3 id="_5-6、持有-多-单列表-long-positions-对象-object"><a href="#_5-6、持有-多-单列表-long-positions-对象-object" class="header-anchor">#</a> 5.6、持有（多）单列表 long_positions 对象（Object）</h3> <p>所谓多单，就是某一个品种，买入之后，预期后市上涨，才能获利的订单。A股上的品种都是多单品种，只能买涨。如果买入后下跌了，就亏钱了。</p> <p>反之，预期后市下跌，才能获利的，称为 空单。如期货产品。</p> <p>本文档只讨论A股品种，因此这个 多单 对象（Object），就十分重要了。它其中就包含了已买入的持有中的订单数据。如下图，股民朋友们一眼就认出来了吧。</p> <p><img src="/kungfu/assets/img/positions.e3bc8058.png" alt="持有单列表"></p> <p>那么策略程序中，如何获取到这个列表呢。简单，整个帐户的持有单列表，都放在一个对象（Object）中嘛。</p> <p><code>positions = context.get_account_book(&quot;tora&quot;, &quot;00368920&quot;).long_positions</code></p> <p>不会这么快就忘了吧？这个方法（函数）表达的意思就是：柜台 tora ，帐号 00368920 中持有的所有多单（long_positions）都取来，放到对象 positions 中。</p> <p>然后，我们就可以访问这个 positions 了。让我们来个上帝视角的鸟瞰图，好好看看这个 positions</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>positions
{
 984964031  :{
              &quot;avg_open_price&quot;:128.3660,
              &quot;close_pnl&quot;:0.0,
			  &quot;close_price&quot;:0.0,
			  &quot;direction&quot;:0,
			  &quot;exchange_id&quot;:&quot;SSE&quot;,
			  &quot;frozen_total&quot;:10,
			  &quot;frozen_yesterday&quot;:10,                                           
			  &quot;holder_uid&quot;:679239496,
              &quot;instrument_id&quot;:&quot;113588&quot;,
              &quot;instrument_type&quot;:3,
			  &quot;last_price&quot;:106.87,
			  &quot;ledger_category&quot;:0,
			  &quot;margin&quot;:0.0,
			  &quot;position_cost_price&quot;:128.3660,
			  &quot;position_pnl&quot;:0.0,
			  &quot;pre_close_price&quot;:0.0,
			  &quot;pre_settlement_price&quot;:0.0,
			  &quot;realized_pnl&quot;:0.0,
			  &quot;settlement_price&quot;:0.0,
			  &quot;trading_day&quot;:&quot;20300513&quot;,
			  &quot;unrealized_pnl&quot;:7.560000000000002,
			  &quot;update_time&quot;:1669022154223382592,
			  &quot;volume&quot;:10,
			  &quot;yesterday_volume&quot;:10
			 }
 
 805988805  :{&quot;avg_open_price&quot;:7.9310,
              &quot;close_pnl&quot;:0.0,
              &quot;close_price&quot;:0.0,
              &quot;direction&quot;:0,
              &quot;exchange_id&quot;:&quot;SSE&quot;,
              &quot;frozen_total&quot;:0,
              &quot;frozen_yesterday&quot;:0,
              &quot;holder_uid&quot;:679239496,
              &quot;instrument_id&quot;:&quot;000039&quot;,
              &quot;instrument_type&quot;:2,
              &quot;last_price&quot;:7.19,
              &quot;ledger_category&quot;:0,
              &quot;margin&quot;:0.0,
              &quot;position_cost_price&quot;:7.9310,
              &quot;position_pnl&quot;:0.0,
              &quot;pre_close_price&quot;:0.0,
              &quot;pre_settlement_price&quot;:0.0,
              &quot;realized_pnl&quot;:0.0,
              &quot;settlement_price&quot;:0.0,
              &quot;trading_day&quot;:&quot;20300513&quot;,
              &quot;unrealized_pnl&quot;:-6.760000000000019,
              &quot;update_time&quot;:1669022399305629825,
              &quot;volume&quot;:1400,
              &quot;yesterday_volume&quot;:1400
             }
 
 3712768376 :{&quot;avg_open_price&quot;:131.8495,
              &quot;close_pnl&quot;:0.0,
              &quot;close_price&quot;:0.0,
              &quot;direction&quot;:0,
              &quot;exchange_id&quot;:&quot;SZE&quot;,
              &quot;frozen_total&quot;:0,
              &quot;frozen_yesterday&quot;:0,
              &quot;holder_uid&quot;:679239496,
              &quot;instrument_id&quot;:&quot;128063&quot;,
              &quot;instrument_type&quot;:3,
              &quot;last_price&quot;:111.25,
              &quot;ledger_category&quot;:0,
              &quot;margin&quot;:0.0,
              &quot;position_cost_price&quot;:131.8495,
              &quot;position_pnl&quot;:0.0,
              &quot;pre_close_price&quot;:0.0,
              &quot;pre_settlement_price&quot;:0.0,
              &quot;realized_pnl&quot;:0.0,
              &quot;settlement_price&quot;:0.0,
              &quot;trading_day&quot;:&quot;20300513&quot;,
              &quot;unrealized_pnl&quot;:48.760000000000019,
              &quot;update_time&quot;:1669022399305629825,
              &quot;volume&quot;:20,
              &quot;yesterday_volume&quot;:20
             }
 
 ......
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><p>这是不是就一目了然了，这么明显。这不就是个 json 数据对象吗， 左边这一列，不就是 key 嘛 ，对应右边的，不就是 value 嘛。 key:value 键:值，一对一对的，这下不简单多了。有多少个 Key ，就表示持有多少个 多单 呗，每一个 多单 具体是什么品种、持有量、均价，都在 value 里面呗。</p> <p>老规矩，上......示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>
    

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    position <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str<span class="token punctuation">)</span><span class="token punctuation">.</span>long_positions  <span class="token comment"># 访问账户持有的全部多单</span>
             <span class="token comment"># context.book.long_positions # 只访问本策略程序持有的多单 </span>

    <span class="token keyword">for</span> key <span class="token keyword">in</span> position<span class="token punctuation">:</span>  <span class="token comment"># 遍历 多单 对象（Object） 中的每一项</span>
        pos <span class="token operator">=</span> position<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;帐户中 多单 的信息数据如下：&quot;</span><span class="token punctuation">)</span>

        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span>&quot;\n 开仓均价 avg_open_price： <span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 已平仓盈亏 close_pnl： <span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 平仓价格 close_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 方向 direction：<span class="token punctuation">{</span><span class="token punctuation">}</span>                     \
                          \n 交易所 exchange_id： <span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                          \n 冻结总量 frozen_total：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 昨日冻结量 frozen_yesterday：<span class="token punctuation">{</span><span class="token punctuation">}</span>         \
                          \n 持有者ID holder_uid<span class="token punctuation">,</span>：<span class="token punctuation">{</span><span class="token punctuation">}</span>                \
                          \n 品种代码 instrument_id：<span class="token punctuation">{</span><span class="token punctuation">}</span>              \
                          \n 品种类型 instrument_type： <span class="token punctuation">{</span><span class="token punctuation">}</span>           \
                          \n 最新价格 last_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>                 \
                          \n 账户类别 ledger_category：<span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 保证金 margin：<span class="token punctuation">{</span><span class="token punctuation">}</span>                       \
                          \n 持仓成本 position_cost_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>        \
                          \n 持仓盈亏 position_pnl：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 昨收盘价 pre_close_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>            \
                          \n 昨结算价 pre_settlement_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>       \
                          \n 累计收益 realized_pnl：<span class="token punctuation">{</span><span class="token punctuation">}</span>               \
                          \n 结算价 settlement_price：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                          \n 交易日 trading_day：<span class="token punctuation">{</span><span class="token punctuation">}</span>                  \
                          \n 未实现盈亏 unrealized_pnl：<span class="token punctuation">{</span><span class="token punctuation">}</span>           \
                          \n 更新时间 updatgene_time：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                          \n 持有量 volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>                       \
                          \n 昨仓量 yesterday_volume：<span class="token punctuation">{</span><span class="token punctuation">}</span>             \
                          &quot;<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>avg_open_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>close_pnl<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>close_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>direction<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>exchange_id<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>frozen_total<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>frozen_yesterday<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>holder_uid<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>instrument_type<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>ledger_category<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>margin<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>position_cost_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>position_pnl<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>pre_close_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>pre_settlement_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>realized_pnl<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>settlement_price<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>trading_day<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>unrealized_pnl<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>update_time<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>volume<span class="token punctuation">,</span>
                                   pos<span class="token punctuation">.</span>yesterday_volume
                                  <span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：

帐户中 多单 的信息数据如下：

开仓均价 avg_open_price： 106.114
已平仓盈亏 close_pnl： 0.0
平仓价格 close_price：0.0
方向 direction：Direction.Long
交易所 exchange_id： SSE
冻结总量 frozen_total：0
昨日冻结量 frozen_yesterday：0
持有者ID holder_uid,：679239496
品种代码 instrument_id：110059
品种类型 instrument_type： InstrumentType.Bond
最新价格 last_price：106.5
账户类别 ledger_category：LedgerCategory.Account
保证金 margin：0.0
持仓成本 position_cost_price：106.114
持仓盈亏 position_pnl：0.0
昨收盘价 pre_close_price：0.0
昨结算价 pre_settlement_price：0.0
累计收益 realized_pnl：0.0
结算价 settlement_price：0.0
交易日 trading_day：20300427
未实现盈亏 unrealized_pnl：3.859999999999957
更新时间 updatgene_time：1668678901921688763
持有量 volume：10
昨仓量 yesterday_volume：10
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p>通过上例应该可以看到，<code>long_positions</code> 这个 对象（Object）中包含的信息，还是非常有用的！比如 开仓均价、持有量、持仓成本、最新价、昨收盘价......这都是事关盈亏的重要数据啊，都是钱、都是钱啊————</p> <p>至于其它那些期货才用到的属性（变量），暂时先放一放吧。</p> <h3 id="_5-7、委托单列表-order-inputs-orders-对象-object"><a href="#_5-7、委托单列表-order-inputs-orders-对象-object" class="header-anchor">#</a> 5.7、委托单列表 order_inputs/orders 对象（Object）</h3> <p>如果理解了上一节的 持有单 列表对应的 对象（Object），那么对应 委托单 列表的对象（Object） 当然就是 orders 了。那为什么有 2 个？ 可以简单的理解为一个是用于 股票 的，一个是用于 期货的。大部分的属性（变量）都是一样的，可以参考前面我们讨论过的 order 报单对象（Object），只有约 1 -- 2 个属性略有不同。</p> <p>还是看得更清晰，撸成表格对比一下，就一目了然了吧：</p> <table><thead><tr><th>序号</th> <th>order_inputs属性</th> <th>orders属性</th> <th>数据类型</th> <th>表达意义</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>order_id</td> <td>order_id</td> <td>int</td> <td>委托单ID</td> <td>一长串数字</td></tr> <tr><td>02</td> <td>insert_time</td> <td>insert_time</td> <td>长整数</td> <td>报单时间</td> <td>纳秒时间戳</td></tr> <tr><td>03</td> <td></td> <td>update_time</td> <td>长整数</td> <td>更新时间</td> <td></td></tr> <tr><td>04</td> <td></td> <td>trading_day</td> <td>字符串</td> <td>交易日</td> <td>如：20201026</td></tr> <tr><td>05</td> <td>instrument_id</td> <td>instrument_id</td> <td>字符串</td> <td>报单品种</td> <td></td></tr> <tr><td>06</td> <td>instrument_type</td> <td>instrument_type</td> <td>对象 InstrumentType</td> <td>交易品种类型</td> <td></td></tr> <tr><td>07</td> <td>exchange_id</td> <td>exchange_id</td> <td>对象 Exchange</td> <td>交易所</td> <td>如：沪市 Exchange.SSE</td></tr> <tr><td>08</td> <td>limit_price</td> <td>limit_price</td> <td>浮点数</td> <td>报单价格</td> <td></td></tr> <tr><td>09</td> <td>frozen_price</td> <td>frozen_price</td> <td>浮点数</td> <td>冻结价格</td> <td></td></tr> <tr><td>10</td> <td>volume</td> <td>volume</td> <td>整数</td> <td>报单数量</td> <td></td></tr> <tr><td>11</td> <td></td> <td>volume_left</td> <td>整数</td> <td>剩余数量</td> <td></td></tr> <tr><td>12</td> <td>volume_condition</td> <td></td> <td>对象VolumeCondition</td> <td>成交量类型</td> <td></td></tr> <tr><td>13</td> <td></td> <td>tax</td> <td>浮点数</td> <td>税费</td> <td></td></tr> <tr><td>14</td> <td></td> <td>commission</td> <td>浮点数</td> <td>手续费</td> <td></td></tr> <tr><td>15</td> <td></td> <td>status</td> <td>对象 OrderStatus</td> <td>订单状态</td> <td></td></tr> <tr><td>16</td> <td></td> <td>error_id</td> <td>整数</td> <td>错误ID</td> <td></td></tr> <tr><td>17</td> <td></td> <td>error_msg</td> <td>字符串</td> <td>错误消息</td> <td></td></tr> <tr><td>18</td> <td>side</td> <td>side</td> <td>对象 Side</td> <td>买卖方向</td> <td></td></tr> <tr><td>19</td> <td>offset</td> <td>offset</td> <td>对象 Offset</td> <td>开平方向</td> <td></td></tr> <tr><td>20</td> <td>hedge_flag</td> <td>hedge_flag</td> <td>对象 HedgeFlag</td> <td>投机套保标识</td> <td></td></tr> <tr><td>21</td> <td>price_type</td> <td>price_type</td> <td>对象 PriceType</td> <td>价格类型</td> <td></td></tr> <tr><td>22</td> <td>time_condition</td> <td>time_condition</td> <td>对象 TimeCondition</td> <td>成交时间类型</td> <td></td></tr> <tr><td>23</td> <td>block_id</td> <td></td> <td>整数</td> <td>大宗交易信息id</td> <td>非大宗交易则为0</td></tr> <tr><td>24</td> <td>is_swap</td> <td></td> <td>布尔型</td> <td>是否互换单</td> <td></td></tr></tbody></table> <p>通过这个表格即可看出，<code>orders</code> 其实就是 <code>order</code> 的分身嘛，简直就是一模一样，而 <code>order_inputs</code> 就只有几个属性（变量）是特有的，主要适用于期货品种。A股品种基本用不上，就不深入讨论了。</p> <h3 id="_5-8、成交单列表-traders-对象-object"><a href="#_5-8、成交单列表-traders-对象-object" class="header-anchor">#</a> 5.8、成交单列表 traders 对象（Object）</h3> <p>那么现在用脚想都知道了， <code>traders</code> 对象就是 <code>trade</code> 的分身嘛。不罗嗦，上示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pykungfu <span class="token keyword">import</span> wingchun <span class="token keyword">as</span> wc  <span class="token comment"># 需要先导入模块</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span> <span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>subscribe_all<span class="token punctuation">(</span><span class="token string">&quot;ToraL2&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;开始吧 &quot;</span><span class="token punctuation">)</span>

    A_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span>  <span class="token string">&quot;00368920&quot;</span><span class="token punctuation">)</span>
    
    A_trades <span class="token operator">=</span> A_Book<span class="token punctuation">.</span>trades 

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;A_trades {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>A_trades<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> key <span class="token keyword">in</span> A_trades<span class="token punctuation">:</span>  <span class="token comment"># 遍历 多单 对象（Object） 中的每一项</span>
        pos <span class="token operator">=</span> A_trades<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;pos {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">)</span>
        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;帐户中 成交单 的信息数据如下：&quot;</span><span class="token punctuation">)</span>

        context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;\n 品种代码 instrument_id：{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span>instrument_id<span class="token punctuation">)</span>
                        <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_5-9、是否持有指定品种的订单-has-position"><a href="#_5-9、是否持有指定品种的订单-has-position" class="header-anchor">#</a> 5.9、是否持有指定品种的订单 has_position()</h3> <p>如果想查询一下，是否持有某个品种的单子，就可以用到这个方法（函数）了。字面意思就是：“持有这个品种的订单吗？”</p> <p>语法： <code>has_position(exchange_id, instrument_id)</code> <br>
参数：<code>exchange_id, instrument_id</code> <br>
exchange_id ———— 表达市场、沪市是 <code>&quot;SSE&quot;</code>，深市是： <code>&quot;SZE&quot;</code>；<br>
instrument_id ———— 就是要查询的具体品种了，如 <code>&quot; 600600 &quot;</code>；<br>
返回值： 布尔值 True / False ，有持仓订单即为 真，否则为 假  <br></p> <p>请注意这样一个场景：你的帐户中是持有订单 118004 的订单的，但你当前运行的程序是 “test02”，并没有任何持仓单。那么在调用这个方法（函数）时，就要注意它的 父对象（Object） 是 <code>context.book</code> ，还是 <code>context.get_account_book()</code> 返回的 对象（Object）。请参考以下示例加强自己的理解吧：</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;    
假设帐户 00368920 中是持有 118004 的订单
但当前运行的这个程序，名称为 test02 ，没有任何持仓
&quot;&quot;&quot;</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;当前策略程序 持有 118004 的 多单吗？：{}&quot;</span>
                     <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position<span class="token punctuation">(</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;118004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
    
    A_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str<span class="token punctuation">)</span>  <span class="token comment"># 访问账户持有的全部多单 对象（Object）</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;账户 {} 中持有 118004 的 多单吗？：{}&quot;</span>
                     <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>account_str<span class="token punctuation">,</span>A_Book<span class="token punctuation">.</span>has_position<span class="token punctuation">(</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;118004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 运行结果
当前策略程序 持有 118004 的 订单吗？：False
账户 00368920 中持有 118004 的 订单吗？：True
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_5-10、-是否持有指定品种的多单-has-long-position"><a href="#_5-10、-是否持有指定品种的多单-has-long-position" class="header-anchor">#</a> 5.10、 是否持有指定品种的多单 has_long_position()</h3> <p>如果已经理解了上一节中介绍的方法（函数），那么现在这个，就不用过多介绍了。就是字面意思：“持有这个品种的多单吗？”。因为本文档只针对做A股品种的，因此肯定都是多单罗。</p> <p>语法： <code>has_long_position(exchange_id, instrument_id)</code> <br>
参数：<code>exchange_id, instrument_id</code> <br>
exchange_id ———— 表达市场、沪市是 <code>&quot;SSE&quot;</code>，深市是： <code>&quot;SZE&quot;</code>；<br>
instrument_id ———— 就是要查询的具体品种了，如 <code>&quot; 600600 &quot;</code>；<br>
返回值： 布尔值 True / False ，有多单持仓即为 真，否则为 假  <br></p> <p>同样也需要注意它的 父对象（Object） 是 <code>context.book</code> ，还是 <code>context.get_account_book()</code> 返回的 对象（Object），分别对应的是当前策略程序的 多单 和 帐户中的 多单。请参考以下示例加强自己的理解吧：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;    
假设帐户 00368920 中是持有 118004 的订单
但当前运行的这个程序，名称为 test02 ，没有任何持仓
&quot;&quot;&quot;</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;当前策略程序 持有 118004 的 多单吗？：{}&quot;</span>
                     <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_long_position<span class="token punctuation">(</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;118004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
    
    A_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str<span class="token punctuation">)</span>  <span class="token comment"># 访问账户持有的全部多单 对象（Object）</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;账户 {} 中持有 118004 的 多单吗？：{}&quot;</span>
                     <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>account_str<span class="token punctuation">,</span>A_Book<span class="token punctuation">.</span>has_long_position<span class="token punctuation">(</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;118004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; 运行结果
当前策略程序 持有 118004 的 多单吗？：False
账户 00368920 中持有 118004 的 多单吗？：True
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><h3 id="_5-11、-查询多个品种的持单-has-position-for"><a href="#_5-11、-查询多个品种的持单-has-position-for" class="header-anchor">#</a> 5.11、 查询多个品种的持单 has_position_for()</h3> <p>前面介绍的方法（函数），只能用来查询一个指定的品种，看看有没有持单。这太费劲儿了。实际运用中，当然随时都要了解订阅的全部品种，是不是持单了。不仅是一篮子股票，我要全市场的！！！</p> <p>因此就要用到下面这个方法（函数）了： <code>has_position_for()</code></p> <p>语法：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
	context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position_for<span class="token punctuation">(</span>quote<span class="token punctuation">)</span>
	
<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> order<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
	context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position_for<span class="token punctuation">(</span>order<span class="token punctuation">)</span>
                       
<span class="token keyword">def</span> <span class="token function">on_trade</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> trade<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
	context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position_for<span class="token punctuation">(</span>trade<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>参数：由语法可看出，放在不同的基础方法（函数）中，传入对应的参数 对象（Object）即可；<br>
返回值： 布尔值 True / False ，有多单持仓即为 真，否则为 假  <br></p> <p>仍然也需要注意它的 父对象（Object） 是 <code>context.book</code> ，还是 <code>context.get_account_book()</code> 返回的 对象（Object），分别对应的是当前策略程序的 多单 和 帐户中的 多单。请参考以下示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>
    <span class="token comment"># 订阅了 上海沪市 的三个品种</span>
    context<span class="token punctuation">.</span>subscribe<span class="token punctuation">(</span>source_MD<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">&quot;600600&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;118004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;113021&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> quote<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到报价品种 {} 当前策略程序持有这个品种的订单吗？ {}&quot;</span>
                   <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>has_position_for<span class="token punctuation">(</span>quote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    A_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str<span class="token punctuation">)</span>  <span class="token comment"># 访问账户持有的全部多单 对象（Object）</span>
              
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;收到报价品种 {} 账户 {} 中持有这个品种的订单吗？ {}&quot;</span>
                   <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>account_str<span class="token punctuation">,</span>A_Book<span class="token punctuation">.</span>has_position_for<span class="token punctuation">(</span>quote<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;------------------------------&quot;</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
收到报价品种 118004 当前策略程序持有这个品种的订单吗？ True
收到报价品种 118004 账户 00368920 中持有这个品种的订单吗？ True
------------------------------
收到报价品种 600600 当前策略程序持有这个品种的订单吗？ False
收到报价品种 600600 账户 00368920 中持有这个品种的订单吗？ False
------------------------------
收到报价品种 113021 当前策略程序持有这个品种的订单吗？ True
收到报价品种 113021 账户 00368920 中持有这个品种的订单吗？ True

&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="_5-12、-获取持有订单的信息-get-position"><a href="#_5-12、-获取持有订单的信息-get-position" class="header-anchor">#</a> 5.12、 获取持有订单的信息  get_position()</h3> <p>有 Python 语言基础的朋友们，看到前面的 has 就想到了，肯定得有 get 啊。has 是问 “有没有？”， 如果没有就过去了，如果有，那必须得访问一下啊。说人话就是：“有没有那啥？有就给我拿来？”</p> <p>于是就用到本节介绍的这个方法（函数）了。</p> <p>语法： <code>get_position(exchange_id, instrument_id)</code> <br>
参数：与 <code>has_position</code> 对应，也同样是 <code>exchange_id, instrument_id</code> <br>
exchange_id ———— 表达市场、沪市是 <code>&quot;SSE&quot;</code>，深市是： <code>&quot;SZE&quot;</code>；<br>
instrument_id ———— 就是要查询的具体品种了，如 <code>&quot; 600600 &quot;</code>；<br></p> <p>同样要注意它的 父对象（Object） 是 <code>context.book</code> ，还是 <code>context.get_account_book()</code> 返回的 对象（Object），分别对应 当前策略程序 和 帐户 的持有订单， 一定要小心在意。</p> <p>返回值： 用脚想也知道了，当然是一个 对象（Object），前面已经见过了，就是持仓对象 Position ，其中包含的属性（变量）就是用来描述一个订单的各种数据的。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>

source_TD <span class="token operator">=</span> <span class="token string">&quot;tora&quot;</span>
source_MD <span class="token operator">=</span> <span class="token string">&quot;ToraL2&quot;</span>        
account_str <span class="token operator">=</span> <span class="token string">&quot;00368920&quot;</span>  <span class="token comment"># 用户自己的帐号</span>

<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'程序开始 '</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一件事，接入 柜台、帐号 </span>
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str <span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;    
当前运行的这个程序，名称为 test02 ，持有 118004 的订单
帐户 00368920 中当然也是持有 118004 的订单

但 帐户 00368920 中 还持有 127029 
当前运行的这个程序 test02 ，是没有 127029 这个品种的订单的
&quot;&quot;&quot;</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context <span class="token punctuation">)</span><span class="token punctuation">:</span> 

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;获取当前程序  {} 持有品种 118004 的订单信息 {}&quot;</span>
                   <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>name<span class="token punctuation">,</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>get_long_position<span class="token punctuation">(</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;118004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;获取当前程序  {} 持有品种 127029 的订单信息 {}&quot;</span>
                   <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>name<span class="token punctuation">,</span>context<span class="token punctuation">.</span>book<span class="token punctuation">.</span>get_long_position<span class="token punctuation">(</span><span class="token string">&quot;SZE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127029&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


    A_Book <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span>source_TD<span class="token punctuation">,</span> account_str<span class="token punctuation">)</span>  <span class="token comment"># 访问账户持有的全部多单 对象（Object）</span>
              
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;获取账户  {} 持有品种 118004 的订单信息 {}&quot;</span>
                   <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>account_str<span class="token punctuation">,</span>A_Book<span class="token punctuation">.</span>get_long_position<span class="token punctuation">(</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;118004&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;获取账户  {} 持有品种 127029 的订单信息 {}&quot;</span>
                   <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>account_str<span class="token punctuation">,</span>A_Book<span class="token punctuation">.</span>get_long_position<span class="token punctuation">(</span><span class="token string">&quot;SZE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;127029&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token string">&quot;&quot;</span>&quot;
运行结果

获取当前程序 test02 持有品种 <span class="token number">118004</span> 的订单信息  <span class="token punctuation">{</span><span class="token string">&quot;avg_open_price&quot;</span><span class="token punctuation">:</span><span class="token number">113.26700000000001</span><span class="token punctuation">,</span><span class="token string">&quot;close_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;exchange_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_total&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_yesterday&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;holder_uid&quot;</span><span class="token punctuation">:</span><span class="token number">679239496</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;118004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_type&quot;</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;last_price&quot;</span><span class="token punctuation">:</span><span class="token number">127.02</span><span class="token punctuation">,</span><span class="token string">&quot;ledger_category&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;margin&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;position_cost_price&quot;</span><span class="token punctuation">:</span><span class="token number">113.26700000000001</span><span class="token punctuation">,</span><span class="token string">&quot;position_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;realized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;trading_day&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;20300506&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;unrealized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">137.52999999999986</span><span class="token punctuation">,</span><span class="token string">&quot;update_time&quot;</span><span class="token punctuation">:</span><span class="token number">1668859816491027808</span><span class="token punctuation">,</span><span class="token string">&quot;volume&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">&quot;yesterday_volume&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>

获取当前程序 test02 持有品种 <span class="token number">127029</span> 的订单信息 <span class="token punctuation">{</span><span class="token string">&quot;avg_open_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;close_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;exchange_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;SZE&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_total&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_yesterday&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;holder_uid&quot;</span><span class="token punctuation">:</span><span class="token number">1666622677</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;127029&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_type&quot;</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;last_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;ledger_category&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;margin&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;position_cost_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;position_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;realized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;trading_day&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;20221119&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;unrealized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;update_time&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;volume&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;yesterday_volume&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span>

获取账户 <span class="token number">00368920</span> 持有品种 <span class="token number">118004</span> 的订单信息 <span class="token punctuation">{</span><span class="token string">&quot;avg_open_price&quot;</span><span class="token punctuation">:</span><span class="token number">113.26700000000001</span><span class="token punctuation">,</span><span class="token string">&quot;close_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;exchange_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;SSE&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_total&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_yesterday&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;holder_uid&quot;</span><span class="token punctuation">:</span><span class="token number">679239496</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;118004&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_type&quot;</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;last_price&quot;</span><span class="token punctuation">:</span><span class="token number">127.02</span><span class="token punctuation">,</span><span class="token string">&quot;ledger_category&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;margin&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;position_cost_price&quot;</span><span class="token punctuation">:</span><span class="token number">113.26700000000001</span><span class="token punctuation">,</span><span class="token string">&quot;position_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;realized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;trading_day&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;20300506&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;unrealized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">137.52999999999986</span><span class="token punctuation">,</span><span class="token string">&quot;update_time&quot;</span><span class="token punctuation">:</span><span class="token number">1668859816491027808</span><span class="token punctuation">,</span><span class="token string">&quot;volume&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">&quot;yesterday_volume&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>

获取账户 <span class="token number">00368920</span> 持有品种 <span class="token number">127029</span> 的订单信息 <span class="token punctuation">{</span><span class="token string">&quot;avg_open_price&quot;</span><span class="token punctuation">:</span><span class="token number">125.21499999999999</span><span class="token punctuation">,</span><span class="token string">&quot;close_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;direction&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;exchange_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;SZE&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_total&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;frozen_yesterday&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;holder_uid&quot;</span><span class="token punctuation">:</span><span class="token number">679239496</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;127029&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;instrument_type&quot;</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;last_price&quot;</span><span class="token punctuation">:</span><span class="token number">129.778</span><span class="token punctuation">,</span><span class="token string">&quot;ledger_category&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;margin&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;position_cost_price&quot;</span><span class="token punctuation">:</span><span class="token number">125.21499999999999</span><span class="token punctuation">,</span><span class="token string">&quot;position_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_close_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;pre_settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;realized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;settlement_price&quot;</span><span class="token punctuation">:</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token string">&quot;trading_day&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;20300506&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;unrealized_pnl&quot;</span><span class="token punctuation">:</span><span class="token number">638.8200000000004</span><span class="token punctuation">,</span><span class="token string">&quot;update_time&quot;</span><span class="token punctuation">:</span><span class="token number">1668859816491185597</span><span class="token punctuation">,</span><span class="token string">&quot;volume&quot;</span><span class="token punctuation">:</span><span class="token number">140</span><span class="token punctuation">,</span><span class="token string">&quot;yesterday_volume&quot;</span><span class="token punctuation">:</span><span class="token number">140</span><span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>由上例可看出，当用 <code>get_position()</code> 去获取某一个指定的品种的订单信息时，会返回一个 对象（Object），其属性（变量）值就对应着订单的数据。值得注意的是这个方法（函数）的父对象，与前面的 has 方法（函数）是一样一样的，  <code>context.book</code> 对应 当前策略程序， <code>context.get_account_book()</code> 对应 帐户 ，实际运用中一定要小心在意。</p> <p>关于返回的这个 Position 对象（Object），也是十分重要的，与前面的 long_positions 对象（Object）中的内容不能说一模一样，那也是一模一样，请参考下表：</p> <h3 id="_5-13、-小结"><a href="#_5-13、-小结" class="header-anchor">#</a> 5.13、 小结</h3> <p>本章的重点就是认识了 订单薄 BOOK 这个对象（Object），注意：它如果绑定在  <code>context</code> 后面，就是表达本策略的 订单薄，如果是绑定在 <code></code> <code>context.get_account_book()</code> 返回的对象上，那么它就表达 帐户 的订单薄，请注意这二者的区别。强烈建议新手朋友们，一开始一个策略程序就只管理本策略的订单薄，盯着自己下的订单就好。不要和别的程序打搅。以后熟练了，同时运行多个策略程序了，甚至管理多个帐户了，那你想咋飞咋飞，爱咋咋的————</p> <p>在 BOOK 这个对象（Object）上，拥有多个属性（变量），同时也是对象（Object）。主要是用来描述帐户里的资金啊、订单啊、委托单啊、成交单啊，总之都是和真金白银有关啊。尤其是持有的订单，那每一次的价格跳动，都是真切实际的利益啊，因此一定要理解透彻，仔细小心。</p> <h4 id="position-持仓对象-object"><a href="#position-持仓对象-object" class="header-anchor">#</a> Position 持仓对象（Object）</h4> <p>按属性名称首字母排序</p> <table><thead><tr><th>编号</th> <th>属性</th> <th>类型</th> <th>说明</th> <th>备注</th></tr></thead> <tbody><tr><td>01</td> <td>avg_open_price</td> <td>浮点型 float</td> <td>开仓均价</td> <td></td></tr> <tr><td>02</td> <td>close_pnl</td> <td>浮点型 float</td> <td>平仓盈亏</td> <td>期货用</td></tr> <tr><td>03</td> <td>close_price</td> <td>浮点型 float</td> <td>收盘价</td> <td></td></tr> <tr><td>04</td> <td>direction</td> <td>Direction 对象</td> <td>持仓方向</td> <td></td></tr> <tr><td>05</td> <td>exchange_id</td> <td>字符串 str</td> <td>交易所</td> <td></td></tr> <tr><td>06</td> <td>frozen_total</td> <td>整数型 int</td> <td>冻结总数量</td> <td></td></tr> <tr><td>07</td> <td>frozen_yesterday</td> <td>整数型 int</td> <td>冻结昨仓</td> <td></td></tr> <tr><td>08</td> <td>holder_uid</td> <td>整数型 int</td> <td>持有人id</td> <td></td></tr> <tr><td>09</td> <td>instrument_id</td> <td>字符串型 str</td> <td>交易品种</td> <td></td></tr> <tr><td>10</td> <td>instrument_type</td> <td>InstrumentType 对象</td> <td>交易品种的类型</td> <td></td></tr> <tr><td>11</td> <td>last_price</td> <td>浮点型 float</td> <td>最新价</td> <td></td></tr> <tr><td>12</td> <td>ledger_category</td> <td>LedgerCategory 对象</td> <td>账户类别</td> <td></td></tr> <tr><td>13</td> <td>margin</td> <td>浮点型 float</td> <td>保证金</td> <td>期货用</td></tr> <tr><td>14</td> <td>position_cost_price</td> <td>浮点型 float</td> <td>持仓成本</td> <td></td></tr> <tr><td>15</td> <td>position_pnl</td> <td>浮点型 float</td> <td>持仓盈亏</td> <td>期货用</td></tr> <tr><td>16</td> <td>pre_close_price</td> <td>浮点型 float</td> <td>昨收价</td> <td></td></tr> <tr><td>17</td> <td>pre_settlement_price</td> <td>浮点型 float</td> <td>昨结算价</td> <td></td></tr> <tr><td>18</td> <td>realized_pnl</td> <td>浮点型 float</td> <td>已实现盈亏</td> <td></td></tr> <tr><td>19</td> <td>settlement_price</td> <td>浮点型 float</td> <td>结算价</td> <td></td></tr> <tr><td>20</td> <td>trading_day</td> <td>字符串型 str</td> <td>交易日</td> <td></td></tr> <tr><td>21</td> <td>unrealized_pnl</td> <td>浮点型 float</td> <td>未实现盈亏</td> <td></td></tr> <tr><td>22</td> <td>update_time</td> <td>整数型 int</td> <td>更新时间(功夫时间)</td> <td></td></tr> <tr><td>23</td> <td>volume</td> <td>整数型 int</td> <td>总持仓量</td> <td></td></tr> <tr><td>24</td> <td>yesterday_volume</td> <td>整数型 int</td> <td>昨仓数量</td> <td></td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意 : 对于 T+0 的品种，比如 可转债 ，当前可交易数量为 volume 总持仓量；而普通的股票品种，是 T+1 的，当前可交易数量为昨仓数量 yesterday_volume。注意还要 减去 冻结总量 frozen_total</p></div> <h2 id="六、小工具-utils"><a href="#六、小工具-utils" class="header-anchor">#</a> 六、小工具 Utils</h2> <p>本文档到这里，基本接近尾声了。功夫量化 的内容其实也就这么多。如果拿来和 迅投QMT、掘金量化这些比较， 功夫量化 更象一个骨架，还有很大的发展空间。但整个A股的量化交易，目前为止也是一个新兴市场啊，各路豪杰正在入场的过程中，奇技妙招、各种神通都还在路上呢。</p> <p>功夫量化 也开发了一些实用的小工具来帮助做量化开发的人，实用的、需求多的，也会慢慢增加和补充。比如本章讨论的，可以理解为就是 功夫量化 的一个小工具 模块 或称之为 库。既然是 库，使用之前当然要先 导入 了。</p> <p><code>from pykungfu import wingchun as wc</code></p> <p>导入之后，就可以调用以下四个方法了：</p> <table><thead><tr><th>属性</th> <th>类型</th> <th>说明</th></tr></thead> <tbody><tr><td>hash_instrument</td> <td>long</td> <td>根据交易品种，获取持仓列表中该品种对应的 key 值</td></tr> <tr><td>is_valid_price</td> <td>bool</td> <td>判断当前价格是否为有效价格</td></tr> <tr><td>is_final_status</td> <td>bool</td> <td>判断当前状态是否为最终状态</td></tr> <tr><td>get_instrument_type</td> <td>InstrumentType对象</td> <td>获取类型</td></tr></tbody></table> <h3 id="_6-1、-获取交易品种在持有单列表中的键-key-值-hash-instrument"><a href="#_6-1、-获取交易品种在持有单列表中的键-key-值-hash-instrument" class="header-anchor">#</a> 6.1、 获取交易品种在持有单列表中的键（Key）值 <br>hash_instrument()</h3> <p>语法： <code>hash_instrument(exchange_id, instrument_id)</code> <br>
参数：
exchange_id ———— 表达市场、沪市是 <code>&quot;Exchange.SSE&quot;</code>，深市是： <code>&quot;Exchange.SZE&quot;</code>；<br>
instrument_id ———— 就是要查询的具体品种了，如 <code>&quot; 600600 &quot;</code>；<br></p> <p>前面已经见过 持有订单列表 的全局样貌了，其中就是典型的 key:value 键:值对 结构嘛。因此只要知道了 键（key），就能准确的取到对应的 值（value）。但是只知道交易品种，不知道 key 怎么办呢？正好就用这个方法（函数）就可以获取到了。</p> <p>返回值：当然是一个长整型数字了，对应的就是 持有订单列表 中的 键（key）了。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pykungfu <span class="token keyword">import</span> wingchun <span class="token keyword">as</span> wc  <span class="token comment"># 需要先导入模块</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span> 
    
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span> <span class="token punctuation">)</span> <span class="token comment"># 添加自己的帐号</span>


<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># 获取账户 00368920 中持有的多单列表</span>
    pos <span class="token operator">=</span> context<span class="token punctuation">.</span>get_account_book<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>long_positions
    
    <span class="token comment"># 获取 110059 在列表中对应的 key </span>
    key <span class="token operator">=</span> wc<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>hash_instrument<span class="token punctuation">(</span>Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">,</span><span class="token string">&quot;110059&quot;</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;品种 110059 在多单列表中的 key :  {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>

    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;多单列表中 键 key {} 对应的 交易品种是：{}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>pos<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>instrument_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
品种 110059 在多单列表中的 key : 984964031
多单列表中 键 key 984964031 对应的 交易品种是：110059
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>可见这个方法（函数），主要用于已经知道持有某个品种的情况，直接获取对应这个品种的 Key 值。下一步，就可以根据 Key 值来获取这个订单的详细数据了。但如果传入了错误的参数，比如帐户中根本就没有这个品种的订单，却用这个方法（函数）来获取 Key ，那就要出错了。实际运用中请灵活运用吧。</p> <h3 id="_6-2、-检查报价是否有效-is-valid-price"><a href="#_6-2、-检查报价是否有效-is-valid-price" class="header-anchor">#</a> 6.2、 检查报价是否有效 is_valid_price()</h3> <p>当从交易所接收到报价时，可以用这个方法（函数）来检验一下报价是否是合法有效的。</p> <p>语法： <code>is_valid_price(quote.last_price)</code> <br>
参数：
quote.last_price ———— 当然就是接收到的最新报价罗；<br></p> <p>返回值：布尔型。如果报价有效，返回值为 真；否则为 假；</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pykungfu <span class="token keyword">import</span> wingchun <span class="token keyword">as</span> wc  <span class="token comment"># 需要先导入模块</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#  pre_start() 方法（函数）， 传入参数 context </span>
    
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span> <span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>subscribe_all<span class="token punctuation">(</span><span class="token string">&quot;ToraL2&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">pass</span>    

<span class="token keyword">def</span> <span class="token function">on_quote</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>quote<span class="token punctuation">,</span>location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    is_valid_price <span class="token operator">=</span> wc<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>is_valid_price<span class="token punctuation">(</span>quote<span class="token punctuation">.</span>last_price<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;收到品种 {} 的最新报价 {} , 是有效的吗？{}&quot;</span>
                        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>quote<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>quote<span class="token punctuation">.</span>last_price<span class="token punctuation">,</span>is_valid_price<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
收到品种 603995 的最新报价 58.28 , 是有效的吗？True
收到品种 688246 的最新报价 35.31 , 是有效的吗？True
收到品种 515100 的最新报价 1.548 , 是有效的吗？True
收到品种 515170 的最新报价 0.792 , 是有效的吗？True
收到品种 501082 的最新报价 1.748 , 是有效的吗？True

&quot;&quot;&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>当然，这个方法（函数）在 逐笔行情 中，也是可用的，也可以检验一下收到的 逐笔行情 报价，是不是有效的报价。</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pykungfu <span class="token keyword">import</span> wingchun <span class="token keyword">as</span> wc  <span class="token comment"># 需要先导入模块</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#  pre_start() 方法（函数）， 传入参数 context </span>
    
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span> <span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>subscribe_all<span class="token punctuation">(</span><span class="token string">&quot;ToraL2&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">pass</span>    

<span class="token keyword">def</span> <span class="token function">on_transaction</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> transaction<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    is_valid_price <span class="token operator">=</span> wc<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>is_valid_price<span class="token punctuation">(</span>transaction<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;收到品种 {} 的最新报价 {} , 是有效的吗？{}&quot;</span>
                        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>transaction<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>transaction<span class="token punctuation">.</span>price<span class="token punctuation">,</span>is_valid_price<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
收到品种 123080 的最新报价 115.148 , 是有效的吗？True
收到品种 300951 的最新报价 87.66 , 是有效的吗？True
收到品种 000993 的最新报价 7.46 , 是有效的吗？True
收到品种 123111 的最新报价 0.0 , 是有效的吗？False
收到品种 123074 的最新报价 0.0 , 是有效的吗？False
&quot;&quot;&quot;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="_6-3、-检查报单状态是否为最终状态-is-final-status"><a href="#_6-3、-检查报单状态是否为最终状态-is-final-status" class="header-anchor">#</a> 6.3、 检查报单状态是否为最终状态 <br> is_final_status()</h3> <p>当你开始报单后，也就是你的程序向交易所喊了一嗓子，但这个报单过程可能会被拒、部分成交、或完全成交。很可能会有几个反复的过程。但最终会确定下来。那么用这个方法（函数）就可以用来检查一下，报单是否已经有了确定的结果，即为最终状态。</p> <p>语法： <code>is_final_status(order.status)</code> <br>
参数：
order.status ———— 是 <code>order</code> 对象中的一个属性，描述了报单的当时当刻的状态，可能是 已提交、已撤单、出错 或 已成交 等；<br></p> <p>返回值：布尔型。如果已经是最终状态，返回值为 真；否则为 假；</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pykungfu <span class="token keyword">import</span> wingchun <span class="token keyword">as</span> wc  <span class="token comment"># 需要先导入模块</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#  pre_start() 方法（函数）， 传入参数 context </span>
    
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span> <span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>subscribe_all<span class="token punctuation">(</span><span class="token string">&quot;ToraL2&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token keyword">pass</span>    

<span class="token keyword">def</span> <span class="token function">on_order</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>order<span class="token punctuation">,</span>location<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    is_final_status <span class="token operator">=</span> wc<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>is_final_status<span class="token punctuation">(</span>order<span class="token punctuation">.</span>status<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">&quot;更新时间 {} 报单品种 {} 的最新状态 {} , 是最终的状态吗？{}&quot;</span>
                        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>order<span class="token punctuation">.</span>update_time<span class="token punctuation">)</span><span class="token punctuation">,</span>order<span class="token punctuation">.</span>instrument_id<span class="token punctuation">,</span>order<span class="token punctuation">.</span>status<span class="token punctuation">,</span>is_final_status<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
更新时间 2020-11-21 10:36:44.652810124 报单品种 110058 的最新状态 OrderStatus.Submitted , 是最终的状态吗？False
更新时间 2020-11-21 10:36:44.658845210 报单品种 110058 的最新状态 OrderStatus.Pending , 是最终的状态吗？False
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>实际运用中，用这个方法（函数）在 <code>on_order():</code> 中检查报单的最终状态，是十分有用的作法。</p> <h3 id="_6-4、-获取交易品种的类型-get-instrument-type"><a href="#_6-4、-获取交易品种的类型-get-instrument-type" class="header-anchor">#</a> 6.4、 获取交易品种的类型 get_instrument_type()</h3> <p>在 功夫量化 的世界里，A股市场中所有品种是分了类型的，比如普通的沪市深市品种，如果 “600600”，“003775” 等，就是股票（Stock），可转债的类型是债券（Bond ）。如果你不确定某一个品种被分在了哪个类型，就可以用这个方法（函数）来查询一下了。</p> <p>语法： <code>get_instrument_type(exchange_id, instrument_id)</code> <br>
参数：
exchange_id ———— 表达市场、沪市是 <code>&quot;Exchange.SSE&quot;</code>，深市是： <code>&quot;Exchange.SZE&quot;</code>；<br>
instrument_id ———— 就是要查询的具体品种了，如 <code>&quot; 600600 &quot;</code>；<br></p> <p>返回值：InstrumentType 交易品种的类型。</p> <p>示例：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token keyword">import</span> kungfu<span class="token punctuation">.</span>yijinjing<span class="token punctuation">.</span>time <span class="token keyword">as</span> kft
<span class="token keyword">from</span> kungfu<span class="token punctuation">.</span>wingchun<span class="token punctuation">.</span>constants <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pykungfu <span class="token keyword">import</span> wingchun <span class="token keyword">as</span> wc  <span class="token comment"># 需要先导入模块</span>


<span class="token keyword">def</span> <span class="token function">pre_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#  pre_start() 方法（函数）， 传入参数 context </span>
    
    context<span class="token punctuation">.</span>add_account<span class="token punctuation">(</span><span class="token string">&quot;tora&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;00368920&quot;</span> <span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>subscribe_all<span class="token punctuation">(</span><span class="token string">&quot;ToraL2&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">post_start</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token builtin">type</span> <span class="token operator">=</span> wc<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>get_instrument_type<span class="token punctuation">(</span>Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">,</span><span class="token string">&quot;110059&quot;</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;品种 110059 的类型是 :  {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token builtin">type</span> <span class="token operator">=</span> wc<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>get_instrument_type<span class="token punctuation">(</span>Exchange<span class="token punctuation">.</span>SSE<span class="token punctuation">,</span><span class="token string">&quot;600600&quot;</span><span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">&quot;品种 600600 的类型是 :  {}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
运行结果：
品种 110059 的类型是 : InstrumentType.Bond
品种 600600 的类型是 : InstrumentType.Stock
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="后记"><a href="#后记" class="header-anchor">#</a> 后记</h2> <p>到此，功夫量化的 Python 接口基本都介绍完了。因各家券商不同、不有服务器不同，因此在获取数据的细节方面，略有差异。因此，上手之后还是要根据各券商的具体情况稍做调整，但大致模型就是如此了。顺祝各位学有所用、交易获利。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/kungfu/assets/js/app.d8936bc4.js" defer></script><script src="/kungfu/assets/js/2.92b4690c.js" defer></script><script src="/kungfu/assets/js/1.216a80cf.js" defer></script><script src="/kungfu/assets/js/11.9d149074.js" defer></script>
  </body>
</html>
