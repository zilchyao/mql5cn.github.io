<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能交易*姚 文档站</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mql5yao/favicon.ico">
    <meta name="description" content="这是智能交易的文档站点。">
    <meta name="keywords" content="MQL,EA,智能交易,自动交易,量化,编程,培训">
    
    <link rel="preload" href="/mql5yao/assets/css/0.styles.c167a2d0.css" as="style"><link rel="preload" href="/mql5yao/assets/js/app.f23448f4.js" as="script"><link rel="preload" href="/mql5yao/assets/js/3.a8269cb7.js" as="script"><link rel="preload" href="/mql5yao/assets/js/13.1e1b93d8.js" as="script"><link rel="prefetch" href="/mql5yao/assets/js/10.a59489eb.js"><link rel="prefetch" href="/mql5yao/assets/js/11.1fde020f.js"><link rel="prefetch" href="/mql5yao/assets/js/12.a5634cbb.js"><link rel="prefetch" href="/mql5yao/assets/js/14.17d955a5.js"><link rel="prefetch" href="/mql5yao/assets/js/15.429599a3.js"><link rel="prefetch" href="/mql5yao/assets/js/16.bcf982ab.js"><link rel="prefetch" href="/mql5yao/assets/js/17.76fde0dd.js"><link rel="prefetch" href="/mql5yao/assets/js/18.49626d28.js"><link rel="prefetch" href="/mql5yao/assets/js/19.0f21f003.js"><link rel="prefetch" href="/mql5yao/assets/js/2.45a03fa6.js"><link rel="prefetch" href="/mql5yao/assets/js/20.18311061.js"><link rel="prefetch" href="/mql5yao/assets/js/21.63b34e06.js"><link rel="prefetch" href="/mql5yao/assets/js/22.a49527a7.js"><link rel="prefetch" href="/mql5yao/assets/js/23.2584759c.js"><link rel="prefetch" href="/mql5yao/assets/js/24.05b32517.js"><link rel="prefetch" href="/mql5yao/assets/js/25.991ff096.js"><link rel="prefetch" href="/mql5yao/assets/js/26.07e08c10.js"><link rel="prefetch" href="/mql5yao/assets/js/27.11150f9e.js"><link rel="prefetch" href="/mql5yao/assets/js/28.b5c9f3ea.js"><link rel="prefetch" href="/mql5yao/assets/js/29.a1ad142f.js"><link rel="prefetch" href="/mql5yao/assets/js/30.6da01d3d.js"><link rel="prefetch" href="/mql5yao/assets/js/31.28fa5dac.js"><link rel="prefetch" href="/mql5yao/assets/js/32.46aab1c1.js"><link rel="prefetch" href="/mql5yao/assets/js/33.f178c7a3.js"><link rel="prefetch" href="/mql5yao/assets/js/34.cd1eae3b.js"><link rel="prefetch" href="/mql5yao/assets/js/35.ee55e50b.js"><link rel="prefetch" href="/mql5yao/assets/js/36.56370362.js"><link rel="prefetch" href="/mql5yao/assets/js/37.2cc5b283.js"><link rel="prefetch" href="/mql5yao/assets/js/38.c3bba64a.js"><link rel="prefetch" href="/mql5yao/assets/js/39.86103eac.js"><link rel="prefetch" href="/mql5yao/assets/js/4.ffd96de7.js"><link rel="prefetch" href="/mql5yao/assets/js/40.0e36f079.js"><link rel="prefetch" href="/mql5yao/assets/js/41.17bccbf6.js"><link rel="prefetch" href="/mql5yao/assets/js/42.a40ca8ac.js"><link rel="prefetch" href="/mql5yao/assets/js/43.5a883397.js"><link rel="prefetch" href="/mql5yao/assets/js/44.19bdddfe.js"><link rel="prefetch" href="/mql5yao/assets/js/45.dec8257c.js"><link rel="prefetch" href="/mql5yao/assets/js/46.ed29615c.js"><link rel="prefetch" href="/mql5yao/assets/js/47.b6d07db1.js"><link rel="prefetch" href="/mql5yao/assets/js/48.d7ca24ca.js"><link rel="prefetch" href="/mql5yao/assets/js/5.47d44717.js"><link rel="prefetch" href="/mql5yao/assets/js/6.1f5c1ae1.js"><link rel="prefetch" href="/mql5yao/assets/js/7.1a679445.js"><link rel="prefetch" href="/mql5yao/assets/js/8.e80e8a9d.js"><link rel="prefetch" href="/mql5yao/assets/js/9.261aef18.js">
    <link rel="stylesheet" href="/mql5yao/assets/css/0.styles.c167a2d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mql5yao/" class="home-link router-link-active"><img src="/mql5yao/logo.png" alt="智能交易*姚 文档站" class="logo"> <span class="site-name can-hide">智能交易*姚 文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MQL5线上手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mql5yao/Chapter/start.html" class="sidebar-link">MQL5 参考</a></li><li><a href="/mql5yao/Chapter/one.html" class="sidebar-link">01 第一章 语言基础</a></li><li><a href="/mql5yao/Chapter/two.html" class="sidebar-link">02 第二章 标准常量，列举和架构</a></li><li><a href="/mql5yao/Chapter/three.html" class="sidebar-link">03 第三章 MQL5程序</a></li><li><a href="/mql5yao/Chapter/four.html" class="sidebar-link">04 第四章 预定义变量</a></li><li><a href="/mql5yao/Chapter/five.html" class="sidebar-link">05 第五章 普通函数</a></li><li><a href="/mql5yao/Chapter/six.html" aria-current="page" class="active sidebar-link">06 第六章 数组函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-1-arraybsearch" class="sidebar-link">6.1  ArrayBsearch</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-2-arraycopy" class="sidebar-link">6.2 ArrayCopy</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-3-arraycompare" class="sidebar-link">6.3 ArrayCompare</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-4-arrayfree" class="sidebar-link">6.4 ArrayFree</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-5-arraygetasseries" class="sidebar-link">6.5 ArrayGetAsSeries</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-6-arrayinitialize" class="sidebar-link">6.6 ArrayInitialize</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-7-arrayfill" class="sidebar-link">6.7 ArrayFill</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-8-arrayisdynamic" class="sidebar-link">6.8 ArrayIsDynamic</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-9-arrayresize" class="sidebar-link">6.9 ArrayResize</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-10-arraymaximum" class="sidebar-link">6.10 ArrayMaximum</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-11-arrayminimum" class="sidebar-link">6.11 ArrayMinimum</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-12-arrayprint" class="sidebar-link">6.12 ArrayPrint</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-13-arrayrange" class="sidebar-link">6.13 ArrayRange</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-14-arrayresize" class="sidebar-link">6.14 ArrayResize</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-15-arraysetasseries" class="sidebar-link">6.15 ArraySetAsSeries</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-16-arraysize" class="sidebar-link">6.16 ArraySize</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-17-arraysort" class="sidebar-link">6.17 ArraySort</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/six.html#_6-18-arrayswap" class="sidebar-link">6.18 ArraySwap</a></li></ul></li><li><a href="/mql5yao/Chapter/add1.html" class="sidebar-link">07 第add1章 矩阵和向量方法</a></li><li><a href="/mql5yao/Chapter/seven.html" class="sidebar-link">07 第七章 函数转换</a></li><li><a href="/mql5yao/Chapter/eight.html" class="sidebar-link">08 第八章 数学函数</a></li><li><a href="/mql5yao/Chapter/nine.html" class="sidebar-link">09 第九章 字符串函数</a></li><li><a href="/mql5yao/Chapter/ten.html" class="sidebar-link">10 第十章 日期和时间</a></li><li><a href="/mql5yao/Chapter/eleven.html" class="sidebar-link">11 第十一章 账户信息</a></li><li><a href="/mql5yao/Chapter/twelve.html" class="sidebar-link">12 第十二章 检测</a></li><li><a href="/mql5yao/Chapter/thirteen.html" class="sidebar-link">13 第十三章 事件处理</a></li><li><a href="/mql5yao/Chapter/fourteen.html" class="sidebar-link">14 第十四章 市场信息</a></li><li><a href="/mql5yao/Chapter/fifteen.html" class="sidebar-link">15 第十五章 经济日历函数</a></li><li><a href="/mql5yao/Chapter/sixteen.html" class="sidebar-link">16 第十六章 时间序列和指标访问</a></li><li><a href="/mql5yao/Chapter/seventeen.html" class="sidebar-link">17 第十七章 自定义交易品种</a></li><li><a href="/mql5yao/Chapter/eighteen.html" class="sidebar-link">18 第十八章 图表操作</a></li><li><a href="/mql5yao/Chapter/ninteen.html" class="sidebar-link">19 第十九章 交易函数</a></li><li><a href="/mql5yao/Chapter/twenty.html" class="sidebar-link">20 第二十章 交易信号</a></li><li><a href="/mql5yao/Chapter/twentyone.html" class="sidebar-link">21 第二十一章 网络函数</a></li><li><a href="/mql5yao/Chapter/twentytwo.html" class="sidebar-link">22 第二十二章 程序端全局变量</a></li><li><a href="/mql5yao/Chapter/twentythree.html" class="sidebar-link">23 第二十三章 文件函数</a></li><li><a href="/mql5yao/Chapter/twentyfour.html" class="sidebar-link">24 第二十四章 自定义指标</a></li><li><a href="/mql5yao/Chapter/twentyfive.html" class="sidebar-link">25 第二十五章 物件函数</a></li><li><a href="/mql5yao/Chapter/twentysix.html" class="sidebar-link">26 第二十六章 技术指标</a></li><li><a href="/mql5yao/Chapter/twentyseven.html" class="sidebar-link">27 第二十七章 处理优化结果</a></li><li><a href="/mql5yao/Chapter/twentyeight.html" class="sidebar-link">28 第二十八章 工作事件</a></li><li><a href="/mql5yao/Chapter/twentynine.html" class="sidebar-link">29 第二十九章 使用OpenCL工作</a></li><li><a href="/mql5yao/Chapter/thirty.html" class="sidebar-link">30 第三十章 使用数据库</a></li><li><a href="/mql5yao/Chapter/thirtyone.html" class="sidebar-link">31 第三十一章 使用DirectX</a></li><li><a href="/mql5yao/Chapter/thirtytwo.html" class="sidebar-link">32 第三十二章 集成</a></li><li><a href="/mql5yao/Chapter/add2.html" class="sidebar-link">32 第add2章 ONNX模型</a></li><li><a href="/mql5yao/Chapter/thirtythree.html" class="sidebar-link">33 第三十三章 标准程序库</a></li><li><a href="/mql5yao/Chapter/AppendixI.html" class="sidebar-link">34 附录一 来自MQL4</a></li><li><a href="/mql5yao/Chapter/AppendixII.html" class="sidebar-link">35 附录二 MQL5 函数列表</a></li><li><a href="/mql5yao/Chapter/AppendixIII.html" class="sidebar-link">36 附录三 MQL5常量列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2>第六章 数组函数</h2> <p>在MQL5语言中，数组的最大维数为四维。每个维度的索引编号都是从0到dimension_size - 1。在一个特定例子中，如一个由50个元素组成的一维数组，在调用时，第一个元素的索引编号为 <code>[0]</code>，最后一个数组的元素索引为 <code>[49]</code>。
<table border="1"><tr><td>函数</td> <td>功能</td></tr> <tr><td>ArrayBsearch</td> <td>返回在一维数组中的找到的第一个元素的索引编号</td></tr> <tr><td>ArrayCopy</td> <td>复制一个数组到另一个数组中</td></tr> <tr><td>ArrayFree</td> <td>释放任何动态数组的缓冲区，并将0维度的大小设置为0</td></tr> <tr><td>ArrayCompare</td> <td>返回比较 两组简单类型的数组 或 没有复杂对象的自定义结构 的结果</td></tr> <tr><td>ArrayGetAsSeries</td> <td>检查数组索引的方向</td></tr> <tr><td>ArrayInitialize</td> <td>将数字数组的所有元素设置为单个值</td></tr> <tr><td>ArrayFill</td> <td>用指定的值填充数组</td></tr> <tr><td>ArrayIsSeries</td> <td>检查数组是否为一个时间序列</td></tr> <tr><td>ArrayIsDynamic</td> <td>检测是否数组是否动态的</td></tr> <tr><td>ArrayMaximum</td> <td>检测元素的最大值</td></tr> <tr><td>ArrayPrint</td> <td>将 简单类型 或 简单结构 的数组打印输出到日志</td></tr> <tr><td>ArrayMinimum</td> <td>检测元素的最小值</td></tr> <tr><td>ArrayRange</td> <td>返回数组中指定维度中的元素个数。</td></tr> <tr><td>ArrayResize</td> <td>为数组的第一个维度设置新的大小</td></tr> <tr><td>ArraySetAsSeries</td> <td>设置数组索引编号的方向</td></tr> <tr><td>ArraySize</td> <td>返回数组中元素的数量</td></tr> <tr><td>ArraySort</td> <td>通过第一个维度对数字数组进行排序</td></tr> <tr><td>ArraySwap</td> <td>交换相同类型两个动态数组的内容</td></tr></table></p> <h2 id="_6-1-arraybsearch"><a href="#_6-1-arraybsearch" class="header-anchor">#</a> 6.1  ArrayBsearch</h2> <p>在 升序排列 的多维数值数组中搜索指定的值。搜索是通过第一个维度的元素执行的。</p> <p>搜寻双精度数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayBsearch</span><span class="token punctuation">(</span>
   <span class="token keyword">const</span> <span class="token keyword">double</span><span class="token operator">&amp;</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 用来搜索的数组</span>
   <span class="token keyword">double</span>           value      <span class="token comment">// 搜索什么</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>搜寻浮点型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayBsearch</span><span class="token punctuation">(</span>
   <span class="token keyword">const</span> <span class="token keyword">float</span><span class="token operator">&amp;</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 用来搜索的数组</span>
   <span class="token keyword">float</span>           value      <span class="token comment">// 搜索什么</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>搜寻长整型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayBsearch</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">long</span><span class="token operator">&amp;</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 用来搜索的数组 </span>
   <span class="token keyword">long</span>           value      <span class="token comment">// 搜索什么 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>搜寻整型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayBsearch</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 用来搜索的数组 </span>
   <span class="token keyword">int</span>           value      <span class="token comment">// 搜索什么 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>搜寻短整型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayBsearch</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">short</span><span class="token operator">&amp;</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 用来搜索的数组 </span>
   <span class="token keyword">short</span>           value      <span class="token comment">// 搜索什么 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>搜寻字符型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayBsearch</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">&amp;</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">// 用来搜索的数组 </span>
   <span class="token keyword">char</span>           value      <span class="token comment">// 搜索什么 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 用来搜索的数组</p> <p>value</p> <p>[in] 搜寻值</p> <p>返回值</p> <p>函数返回已找到元素的索引编号。如果没有找到所需的值，函数将返回一个最接近搜寻值的元素的索引编号。</p> <p>注意</p> <p>二进制搜索的过程只对排序过的数组进行。排序数组可以使用ArraySort()函数。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Script based on RSI indicator data displays&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;how often the market was in&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;overbought and oversold areas in the specified time interval.&quot;</span></span>
<span class="token comment">// 基于RSI指标数据的脚本显示了在指定的时间间隔内，市场在超买和超卖区域的频率。</span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input <span class="token keyword">int</span>                InpMAPeriod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">;</span>                    <span class="token comment">// 移动平均周期</span>
input ENUM_APPLIED_PRICE InpAppliedPrice<span class="token operator">=</span>PRICE_CLOSE<span class="token punctuation">;</span>       <span class="token comment">// 价格类型</span>
input <span class="token keyword">double</span>             InpOversoldValue<span class="token operator">=</span><span class="token number">30.0</span><span class="token punctuation">;</span>             <span class="token comment">// 超卖水平线</span>
input <span class="token keyword">double</span>             InpOverboughtValue<span class="token operator">=</span><span class="token number">70.0</span><span class="token punctuation">;</span>           <span class="token comment">// 超买水平线</span>
input datetime           InpDateStart<span class="token operator">=</span>D<span class="token char">'2012.01.01 00:00'</span><span class="token punctuation">;</span>  <span class="token comment">// 分析开始日期</span>
input datetime           InpDateFinish<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 分析结束日期</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序开始函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">double</span> rsi_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 指标值的数组</span>
   <span class="token keyword">int</span>    size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>     <span class="token comment">// 数组大小</span>
<span class="token comment">//--- 接收RSI指标处理</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> rsi_handle<span class="token operator">=</span><span class="token function">iRSI</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Period</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>InpMAPeriod<span class="token punctuation">,</span>InpAppliedPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>rsi_handle<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收指标处理失败</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;指标处理接收错误。错误代码 = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 循环中，直到指标计算它的所有值</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">BarsCalculated</span><span class="token punctuation">(</span>rsi_handle<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 如果指标强制完成脚本操作则退出</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">IsStopped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 暂停允许指标计算它的所有值</span>
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制一段时间的指标值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>rsi_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>InpDateFinish<span class="token punctuation">,</span>rsi_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;未能复制指标值。错误代码 = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收数组大小</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>rsi_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 分类数组</span>
   <span class="token function">ArraySort</span><span class="token punctuation">(</span>rsi_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 找出市场在超卖区域的时间（百分比）</span>
   <span class="token keyword">double</span> ovs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">ArrayBsearch</span><span class="token punctuation">(</span>rsi_buff<span class="token punctuation">,</span>InpOversoldValue<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>size<span class="token punctuation">;</span>
<span class="token comment">//--- 找出市场在超买区域的时间（百分比）</span>
   <span class="token keyword">double</span> ovb<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">(</span>size<span class="token operator">-</span><span class="token function">ArrayBsearch</span><span class="token punctuation">(</span>rsi_buff<span class="token punctuation">,</span>InpOverboughtValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>size<span class="token punctuation">;</span>
<span class="token comment">//--- 显示数据的字符串形式</span>
   string str<span class="token operator">=</span><span class="token string">&quot;从 &quot;</span><span class="token operator">+</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>InpDateStart<span class="token punctuation">,</span>TIME_DATE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; 到 &quot;</span>
              <span class="token operator">+</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>InpDateFinish<span class="token punctuation">,</span>TIME_DATE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; 市场价格在:&quot;</span><span class="token punctuation">;</span>
   string str_ovb<span class="token operator">=</span><span class="token string">&quot;在超买区域 &quot;</span><span class="token operator">+</span><span class="token function">DoubleToString</span><span class="token punctuation">(</span>ovb<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;% 总时长&quot;</span><span class="token punctuation">;</span>
   string str_ovs<span class="token operator">=</span><span class="token string">&quot;在超卖区域 &quot;</span><span class="token operator">+</span><span class="token function">DoubleToString</span><span class="token punctuation">(</span>ovs<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;% 总时长&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在图表上显示数据</span>
   <span class="token function">CreateLabel</span><span class="token punctuation">(</span><span class="token string">&quot;顶&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span>str<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">CreateLabel</span><span class="token punctuation">(</span><span class="token string">&quot;超买&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span>str_ovb<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">CreateLabel</span><span class="token punctuation">(</span><span class="token string">&quot;超卖&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>str_ovs<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 重绘图表</span>
   <span class="token function">ChartRedraw</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 暂停</span>
   <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 在图表左下角显示文本                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">CreateLabel</span><span class="token punctuation">(</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span>
                 <span class="token keyword">const</span> string str<span class="token punctuation">,</span><span class="token keyword">const</span> color clr<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 创建一个标签</span>
   <span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJ_LABEL<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 绑定标签到左下角</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_CORNER<span class="token punctuation">,</span>CORNER_LEFT_LOWER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 改变定位点位置</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_ANCHOR<span class="token punctuation">,</span>ANCHOR_LEFT_LOWER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- X方向定位点的距离</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_XDISTANCE<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- Y方向定位点的距离</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_YDISTANCE<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 标签文本</span>
   <span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_TEXT<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 文本颜色</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_COLOR<span class="token punctuation">,</span>clr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 文本大小</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_FONTSIZE<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h2 id="_6-2-arraycopy"><a href="#_6-2-arraycopy" class="header-anchor">#</a> 6.2 ArrayCopy</h2> <p>复制一个数组到另一个数组中。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayCopy</span><span class="token punctuation">(</span> 
   <span class="token keyword">void</span><span class="token operator">&amp;</span>        dst_array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token comment">// 目标数组 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  src_array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>         <span class="token comment">// 源数组 </span>
   <span class="token keyword">int</span>          dst_start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment">// 写入目标数组的索引编号 </span>
   <span class="token keyword">int</span>          src_start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>         <span class="token comment">// 源数组的最初索引编号 </span>
   <span class="token keyword">int</span>          count<span class="token operator">=</span>WHOLE_ARRAY    <span class="token comment">// 元素数量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参量</p> <p>dst_array[]</p> <p>[out] 目标 数组</p> <p>src_array[]</p> <p>[in] 源 数组</p> <p>dst_start=0</p> <p>[in] 从目标数组的第几个元素开始写入，默认为0 。</p> <p>src_start=0</p> <p>[in] 从源数组的第几个元素开始读取，默认为0 。</p> <p>count=WHOLE_ARRAY</p> <p>[in] 复制数组的数量，默认全部数组复制(count=WHOLE_ARRAY).</p> <p>返回值</p> <p>返回复制元素的数量</p> <p>注意</p> <p>如果参数count &lt; 0 或 count &gt; src_size - src_start,则表示所有余下的数组部分都将被复制，数组从左至右复制。对于一个时间序列数组(时间序列数组是倒序的)来说，正确的开始位置为定义调整后从左至右进行复制。如果数组自身复制到自身，则结果未定义。</p> <p>(时间序列是颠倒的数组，第一个元素在最右边，最后一个元素在最左边。时间序列是用来存储历史价格数据并包含时间信息，我们可以看见时间序列最右边是最新的报价数据，而最左边是最旧的报价数据。因此时间序列以0开始索引编号，包括交易品种的最新的报价信息。如果时间序列包括每日时间列表的数据，当前尚未收盘的日期会显示在索引0的位置，而索引1的位置会显示昨天的数据。)</p> <p>如果数组是不同类型的，在复制时，它将尝试把 源数组 的每个元素转换为 目标数组 的类型。一个字符串数组只能被复制到一个字符串数组中。不复制包含需要初始化的对象的 类 和 结构 的数组。可以将一个结构数组复制到同一类型的结构数组中。</p> <p>对于在时间序列中使用索引的动态数组，目标数组的大小会自动增加到复制数据的数量(如果后者超过数组大小)。目标数组大小不会自动减少。 示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The indicator highlights the candlesticks that are local&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;highs and lows. Interval length for finding&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;extreme values should be found using an input parameters.&quot;</span> </span>
<span class="token comment">// 该指标突出显示了一段行情中 最高 和 最低的K线柱。寻找极端值的区间长度应该使用输入参数找到。</span>
<span class="token comment">//--- 指标设置 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span> </span></span>
<span class="token comment">//---- 绘制 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Extremums&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_CANDLES </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrLightSteelBlue<span class="token punctuation">,</span>clrRed<span class="token punctuation">,</span>clrBlue </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span> </span></span>
<span class="token comment">//--- 预定义常量 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INDICATOR_EMPTY_VALUE</span> <span class="token expression"><span class="token number">0.0</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span> InpNum<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 区间长度。表示取前后 4根K线来比较，当前K线是否一个 (最高/最低)价格 </span>
<span class="token comment">//--- 指标缓冲区 </span>
<span class="token keyword">double</span> ExtOpen<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> ExtHigh<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> ExtLow<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> ExtClose<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span> ExtColor<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 全局变量 </span>
<span class="token keyword">int</span>    ExtStart<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 第一个蜡烛图的指数不是一个极值 </span>
<span class="token keyword">int</span>    ExtCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 区间的非极值数量 </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填写非极值蜡烛图                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FillCandles</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                 <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 填写蜡烛图 </span>
   <span class="token function">ArrayCopy</span><span class="token punctuation">(</span>ExtOpen<span class="token punctuation">,</span>open<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtCount<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayCopy</span><span class="token punctuation">(</span>ExtHigh<span class="token punctuation">,</span>high<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtCount<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayCopy</span><span class="token punctuation">(</span>ExtLow<span class="token punctuation">,</span>low<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtCount<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayCopy</span><span class="token punctuation">(</span>ExtClose<span class="token punctuation">,</span>close<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtStart<span class="token punctuation">,</span>ExtCount<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标缓存映射 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ExtOpen<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ExtHigh<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ExtLow<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ExtClose<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>ExtColor<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 指定值，不显示 </span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 指定用于在数据窗口显示的指标缓存名称 </span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span><span class="token string">&quot;Open;High;Low;Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标的迭代函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在时间序列设置直接索引 </span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 柱形变量计算开始 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span> 
<span class="token comment">//--- 开始的InpNum*2柱不执行计算 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>start<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      start<span class="token operator">+=</span>InpNum<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span> 
      ExtStart<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      ExtCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果只形成柱，检查下一个潜在极值 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>rates_total<span class="token operator">-</span>start<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> 
      start<span class="token operator">--</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 检查极值的柱形索引 </span>
   <span class="token keyword">int</span> ext<span class="token punctuation">;</span> 
<span class="token comment">//--- 指标值计算循环 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 在i柱上无初始绘制 </span>
      ExtOpen<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      ExtHigh<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      ExtLow<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      ExtClose<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 用于检查的极值指数 </span>
      ext<span class="token operator">=</span>i<span class="token operator">-</span>InpNum<span class="token punctuation">;</span> 
      <span class="token comment">//--- 检查本地最大值 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">IsMax</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span>ext<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 强调极值蜡烛图 </span>
         ExtOpen<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtHigh<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtLow<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtClose<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtColor<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 用中间色突出其他蜡烛图直至极值 </span>
         <span class="token function">FillCandles</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 改变变量颜色 </span>
         ExtStart<span class="token operator">=</span>ext<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> 
         ExtCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 传递到下一个迭代 </span>
         <span class="token keyword">continue</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 检查本地最小值 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">IsMin</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span>ext<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 突出极值蜡烛图 </span>
         ExtOpen<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtHigh<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtLow<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtClose<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         ExtColor<span class="token punctuation">[</span>ext<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 用中间色突出其他蜡烛图直至极值 </span>
         <span class="token function">FillCandles</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 改变变量值 </span>
         ExtStart<span class="token operator">=</span>ext<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> 
         ExtCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 传递到下一个迭代 </span>
         <span class="token keyword">continue</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 增加无极值间隔数量 </span>
      ExtCount<span class="token operator">++</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 为下次调用返回 prev_calculated 值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 检查当前数组元素是否本地最高                                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">IsMax</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>price<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> ind<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 间隔开始变量 </span>
   <span class="token keyword">int</span> i<span class="token operator">=</span>ind<span class="token operator">-</span>InpNum<span class="token punctuation">;</span> 
<span class="token comment">//--- 间隔时间结束 </span>
   <span class="token keyword">int</span> finish<span class="token operator">=</span>ind<span class="token operator">+</span>InpNum<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 检查上半部间隔 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>ind<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>price<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token operator">&lt;=</span>price<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> 
         <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 检查下半部间隔 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>ind<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>finish<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>price<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token operator">&lt;=</span>price<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> 
         <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 这是一个极值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 检查当前数组元素是否是本地最低                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">IsMin</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>price<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> ind<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 间隔开始变量 </span>
   <span class="token keyword">int</span> i<span class="token operator">=</span>ind<span class="token operator">-</span>InpNum<span class="token punctuation">;</span> 
<span class="token comment">//--- 间隔时间结束 </span>
   <span class="token keyword">int</span> finish<span class="token operator">=</span>ind<span class="token operator">+</span>InpNum<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 检查上半部间隔 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>ind<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>price<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token operator">&gt;=</span>price<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> 
         <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 检查下半部间隔 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>ind<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>finish<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>price<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token operator">&gt;=</span>price<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> 
         <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 这是一个极值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br></div></div><h2 id="_6-3-arraycompare"><a href="#_6-3-arraycompare" class="header-anchor">#</a> 6.3 ArrayCompare</h2> <p>此函数返回比较两个相同类型的数组的结果。它可以用来比较 简单类型 或 没有复杂对象的自定义结构的数组。自定义结构不可以包括 字符串，动态数组，类 和 其它没有 复杂对象 的 结构。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayCompare</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment">// 第一数组 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment">// 第二数组 </span>
   uint         start1<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment">// 第一数组的初始索引编号位置的偏移值 </span>
   uint         start2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment">// 第二数组的初始索引编号位置的偏移值 </span>
   uint         count<span class="token operator">=</span>WHOLE_ARRAY    <span class="token comment">// 元素比较的数量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参数</p> <p>array1[]</p> <p>[in] 第一数组。</p> <p>array2[]</p> <p>[in] 第二数组。</p> <p>start1=0</p> <p>[in] 第一数组的元素初始索引编号，即开始比较的位置。默认开始索引编号 —— 0。</p> <p>start2=0</p> <p>[in] 第二数组的元素初始索引编号，即开始比较的位置。默认开始索引编号 —— 0。</p> <p>count=WHOLE_ARRAY</p> <p>[in] 要比较的元素数量。两种数组的所有元素默认都参与比较 (count=WHOLE_ARRAY)。</p> <p>返回值
• -1, 如果 array1[] 小于 array2[]
• 0, 如果 array1[] 等于 array2[]
• 1, 如果 array1[] 大于 array2[]
• -2, 如果出现错误。错误的原因可能是比较数组的类型不兼容，或者start1、start2或count值导致索引位置超出数组范围，而出现错误。</p> <p>注意
如果数组的大小和count=WHOLE_ARRAY不同，那么当一个数组是另一个数组的准确子集时。那么本函数将不会返回0(数组不会被认为是相等的)。在这种情况下，比较数组大小的结果:如果array1[] 小于array2[] 将返回: -1，否则为1。</p> <h2 id="_6-4-arrayfree"><a href="#_6-4-arrayfree" class="header-anchor">#</a> 6.4 ArrayFree</h2> <p>释放任何动态数组的缓冲区，并将零维的大小设置为0。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">ArrayFree</span><span class="token punctuation">(</span> 
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment">// 数组 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 动态数组。</p> <p>返回值</p> <p>没有返回值</p> <p>注意考虑到要一次性释放所有使用的内存并且数组的主要工作由访问指标缓存组成，那么使用ArrayFree() 函数的需求不会太频繁地出现。缓冲区的大小由终端的执行子系统自动管理。</p> <p>如果需要在应用程序的复杂动态环境中手动管理内存，则ArrayFree()函数允许用户明确地立即释放已经不必要的动态数组占用的内存。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Controls\Dialog.mqh&gt;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Controls\Button.mqh&gt;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Controls\Label.mqh&gt;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Controls\ComboBox.mqh&gt;</span> </span>
<span class="token comment">//--- 预定义常量 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">X_START</span> <span class="token expression"><span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Y_START</span> <span class="token expression"><span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">X_SIZE</span> <span class="token expression"><span class="token number">580</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Y_SIZE</span> <span class="token expression"><span class="token number">800</span> </span></span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 内存工作的对话类                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">class</span> <span class="token class-name">CMemoryControl</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">CAppDialog</span></span> 
  <span class="token punctuation">{</span> 
<span class="token keyword">private</span><span class="token operator">:</span> 
   <span class="token comment">//--- 数组大小 </span>
   <span class="token keyword">int</span>               m_arr_size<span class="token punctuation">;</span> 
   <span class="token comment">//--- 数组 </span>
   <span class="token keyword">char</span>              m_arr_char<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token keyword">int</span>               m_arr_int<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token keyword">float</span>             m_arr_float<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token keyword">double</span>            m_arr_double<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token keyword">long</span>              m_arr_long<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token comment">//--- 标签 </span>
   CLabel            m_lbl_memory_physical<span class="token punctuation">;</span> 
   CLabel            m_lbl_memory_total<span class="token punctuation">;</span> 
   CLabel            m_lbl_memory_available<span class="token punctuation">;</span> 
   CLabel            m_lbl_memory_used<span class="token punctuation">;</span> 
   CLabel            m_lbl_array_size<span class="token punctuation">;</span> 
   CLabel            m_lbl_array_type<span class="token punctuation">;</span> 
   CLabel            m_lbl_error<span class="token punctuation">;</span> 
   CLabel            m_lbl_change_type<span class="token punctuation">;</span> 
   CLabel            m_lbl_add_size<span class="token punctuation">;</span> 
   <span class="token comment">//--- 按钮 </span>
   CButton           m_button_add<span class="token punctuation">;</span> 
   CButton           m_button_free<span class="token punctuation">;</span> 
   <span class="token comment">//--- 组合框 </span>
   CComboBox         m_combo_box_step<span class="token punctuation">;</span> 
   CComboBox         m_combo_box_type<span class="token punctuation">;</span> 
   <span class="token comment">//--- 来自组合框的当前的数组类型值 </span>
   <span class="token keyword">int</span>               m_combo_box_type_value<span class="token punctuation">;</span> 
  
<span class="token keyword">public</span><span class="token operator">:</span> 
                     <span class="token function">CMemoryControl</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                    <span class="token operator">~</span><span class="token function">CMemoryControl</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token comment">//--- 类对象创建方法 </span>
   <span class="token keyword">virtual</span> <span class="token keyword">bool</span>      <span class="token function">Create</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">long</span> chart<span class="token punctuation">,</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> subwin<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x1<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y1<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x2<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token comment">//--- 图表事件处理程序 </span>
   <span class="token keyword">virtual</span> <span class="token keyword">bool</span>      <span class="token function">OnEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>lparam<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>dparam<span class="token punctuation">,</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>sparam<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  
<span class="token keyword">protected</span><span class="token operator">:</span> 
   <span class="token comment">//--- 创建标签 </span>
   <span class="token keyword">bool</span>              <span class="token function">CreateLabel</span><span class="token punctuation">(</span>CLabel <span class="token operator">&amp;</span>lbl<span class="token punctuation">,</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span><span class="token keyword">const</span> string str<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> font_size<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> clr<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token comment">//--- 创建控制元素 </span>
   <span class="token keyword">bool</span>              <span class="token function">CreateButton</span><span class="token punctuation">(</span>CButton <span class="token operator">&amp;</span>button<span class="token punctuation">,</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span><span class="token keyword">const</span> string str<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> font_size<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> clr<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">bool</span>              <span class="token function">CreateComboBoxStep</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">bool</span>              <span class="token function">CreateComboBoxType</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token comment">//--- 事件处理程序 </span>
   <span class="token keyword">void</span>              <span class="token function">OnClickButtonAdd</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">void</span>              <span class="token function">OnClickButtonFree</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">void</span>              <span class="token function">OnChangeComboBoxType</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token comment">//--- 当前数组工作的方法 </span>
   <span class="token keyword">void</span>              <span class="token function">CurrentArrayFree</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">bool</span>              <span class="token function">CurrentArrayAdd</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 释放当前数组内存                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CurrentArrayFree</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 重置数组大小 </span>
   m_arr_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 释放数组 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>m_arr_char<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>m_arr_int<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span> 
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>m_arr_float<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span> 
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>m_arr_double<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span> 
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>m_arr_long<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>   
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 尝试为当前数组增加内存                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CurrentArrayAdd</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 如果所用内存大小超过物理内存大小，则退出 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_PHYSICAL<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_USED<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 根据当前类型尝试分配内存 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ArrayResize</span><span class="token punctuation">(</span>m_arr_char<span class="token punctuation">,</span>m_arr_size<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ArrayResize</span><span class="token punctuation">(</span>m_arr_int<span class="token punctuation">,</span>m_arr_size<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ArrayResize</span><span class="token punctuation">(</span>m_arr_float<span class="token punctuation">,</span>m_arr_size<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ArrayResize</span><span class="token punctuation">(</span>m_arr_double<span class="token punctuation">,</span>m_arr_size<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">4</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ArrayResize</span><span class="token punctuation">(</span>m_arr_long<span class="token punctuation">,</span>m_arr_size<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 分配内存 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>   
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 事件处理                                                          | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token function">EVENT_MAP_BEGIN</span><span class="token punctuation">(</span>CMemoryControl<span class="token punctuation">)</span> 
<span class="token function">ON_EVENT</span><span class="token punctuation">(</span>ON_CLICK<span class="token punctuation">,</span>m_button_add<span class="token punctuation">,</span>OnClickButtonAdd<span class="token punctuation">)</span> 
<span class="token function">ON_EVENT</span><span class="token punctuation">(</span>ON_CLICK<span class="token punctuation">,</span>m_button_free<span class="token punctuation">,</span>OnClickButtonFree<span class="token punctuation">)</span> 
<span class="token function">ON_EVENT</span><span class="token punctuation">(</span>ON_CHANGE<span class="token punctuation">,</span>m_combo_box_type<span class="token punctuation">,</span>OnChangeComboBoxType<span class="token punctuation">)</span> 
<span class="token function">EVENT_MAP_END</span><span class="token punctuation">(</span>CAppDialog<span class="token punctuation">)</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 构造函数                                                          | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CMemoryControl</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 析构函数                                                          | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">CMemoryControl</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 类对象创建方法                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">long</span> chart<span class="token punctuation">,</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> subwin<span class="token punctuation">,</span> 
                            <span class="token keyword">const</span> <span class="token keyword">int</span> x1<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y1<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x2<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> y2<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 创建基本类对象 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CAppDialog</span><span class="token double-colon punctuation">::</span><span class="token function">Create</span><span class="token punctuation">(</span>chart<span class="token punctuation">,</span>name<span class="token punctuation">,</span>subwin<span class="token punctuation">,</span>x1<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y2<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 准备标签字符串 </span>
   string str_physical<span class="token operator">=</span><span class="token string">&quot;物理内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_PHYSICAL<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">;</span> 
   string str_total<span class="token operator">=</span><span class="token string">&quot;内存总量 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_TOTAL<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">;</span> 
   string str_available<span class="token operator">=</span><span class="token string">&quot;可用内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_AVAILABLE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">;</span> 
   string str_used<span class="token operator">=</span><span class="token string">&quot;已用内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_USED<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 创建标签 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_memory_physical<span class="token punctuation">,</span><span class="token string">&quot;physical_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">5</span><span class="token punctuation">,</span>str_physical<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_memory_total<span class="token punctuation">,</span><span class="token string">&quot;total_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">30</span><span class="token punctuation">,</span>str_total<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_memory_available<span class="token punctuation">,</span><span class="token string">&quot;available_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">55</span><span class="token punctuation">,</span>str_available<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_memory_used<span class="token punctuation">,</span><span class="token string">&quot;used_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">80</span><span class="token punctuation">,</span>str_used<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_array_type<span class="token punctuation">,</span><span class="token string">&quot;type_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token string">&quot;数组类型 = double&quot;</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_array_size<span class="token punctuation">,</span><span class="token string">&quot;size_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">130</span><span class="token punctuation">,</span><span class="token string">&quot;数组大小 = 0&quot;</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_error<span class="token punctuation">,</span><span class="token string">&quot;error_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">155</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrRed<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_change_type<span class="token punctuation">,</span><span class="token string">&quot;change_type_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">185</span><span class="token punctuation">,</span><span class="token string">&quot;更改类型&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>m_lbl_add_size<span class="token punctuation">,</span><span class="token string">&quot;add_size_label&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">230</span><span class="token punctuation">,</span><span class="token string">&quot;添加到数组&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>clrBlack<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 创建控制元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateButton</span><span class="token punctuation">(</span>m_button_add<span class="token punctuation">,</span><span class="token string">&quot;add_button&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">15</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">295</span><span class="token punctuation">,</span><span class="token string">&quot;添加&quot;</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlue<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateButton</span><span class="token punctuation">(</span>m_button_free<span class="token punctuation">,</span><span class="token string">&quot;free_button&quot;</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">125</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">295</span><span class="token punctuation">,</span><span class="token string">&quot;释放&quot;</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span>clrBlue<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateComboBoxType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CreateComboBoxStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 初始变量 </span>
   m_arr_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 成功执行 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 创建按钮                                                          | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CreateButton</span><span class="token punctuation">(</span>CButton <span class="token operator">&amp;</span>button<span class="token punctuation">,</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> 
                                  <span class="token keyword">const</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span><span class="token keyword">const</span> string str<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> font_size<span class="token punctuation">,</span> 
                                  <span class="token keyword">const</span> <span class="token keyword">int</span> clr<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 创建按钮 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>button<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>m_chart_id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>m_subwin<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>x<span class="token operator">+</span><span class="token number">80</span><span class="token punctuation">,</span>y<span class="token operator">+</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 文本 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>button<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 字体大小 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>button<span class="token punctuation">.</span><span class="token function">FontSize</span><span class="token punctuation">(</span>font_size<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 标签颜色 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>button<span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span>clr<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 添加按钮到控制元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Add</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 成功执行 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 创建数组大小组合框                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CreateComboBoxStep</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 创建组合框 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>m_chart_id<span class="token punctuation">,</span><span class="token string">&quot;step_combobox&quot;</span><span class="token punctuation">,</span>m_subwin<span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">150</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">185</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">280</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">205</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 添加元素到组合框 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;100 000&quot;</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;1 000 000&quot;</span><span class="token punctuation">,</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;10 000 000&quot;</span><span class="token punctuation">,</span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;100 000 000&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置当前组合框元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">SelectByValue</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 添加组合框到控制元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Add</span><span class="token punctuation">(</span>m_combo_box_step<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 成功执行 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 创建数组类型组合框                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CreateComboBoxType</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 创建组合框 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>m_chart_id<span class="token punctuation">,</span><span class="token string">&quot;type_combobox&quot;</span><span class="token punctuation">,</span>m_subwin<span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">150</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">235</span><span class="token punctuation">,</span>X_START<span class="token operator">+</span><span class="token number">280</span><span class="token punctuation">,</span>Y_START<span class="token operator">+</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 添加元素到组合框 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;char&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;float&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;double&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">ItemAdd</span><span class="token punctuation">(</span><span class="token string">&quot;long&quot;</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置当前组合框元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">SelectByValue</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储当前组合框元素 </span>
   m_combo_box_type_value<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 添加组合框到控制元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Add</span><span class="token punctuation">(</span>m_combo_box_type<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 成功执行 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 创建标签                                                          | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">CreateLabel</span><span class="token punctuation">(</span>CLabel <span class="token operator">&amp;</span>lbl<span class="token punctuation">,</span><span class="token keyword">const</span> string name<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> 
                                 <span class="token keyword">const</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span><span class="token keyword">const</span> string str<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> font_size<span class="token punctuation">,</span> 
                                 <span class="token keyword">const</span> <span class="token keyword">int</span> clr<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 创建标签 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lbl<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>m_chart_id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>m_subwin<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 文本 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lbl<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 字体大小 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lbl<span class="token punctuation">.</span><span class="token function">FontSize</span><span class="token punctuation">(</span>font_size<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 颜色 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>lbl<span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span>clr<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 添加标签到控制元素 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Add</span><span class="token punctuation">(</span>lbl<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 成功 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 点击“添加”按钮事件的处理程序                                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">OnClickButtonAdd</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 提高数组大小 </span>
   m_arr_size<span class="token operator">+=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 尝试为当前数组分配内存 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CurrentArrayAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 分配内存，在屏幕上展示当前状态 </span>
      m_lbl_memory_available<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;可用内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_AVAILABLE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      m_lbl_memory_used<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;已用内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_USED<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      m_lbl_array_size<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组大小 = &quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>m_arr_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      m_lbl_error<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 分配内存失败，显示错误信息 </span>
      m_lbl_error<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;Array is too large, error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 返回之前的数组大小 </span>
      m_arr_size<span class="token operator">-=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>m_combo_box_step<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 点击“释放”按钮事件的处理程序                                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">OnClickButtonFree</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 释放当前数组的内存 </span>
   <span class="token function">CurrentArrayFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 在屏幕上显示当前状态 </span>
   m_lbl_memory_available<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;可用内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_AVAILABLE<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   m_lbl_memory_used<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;已用内存 = &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_MEMORY_USED<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; Mb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   m_lbl_array_size<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组大小 = 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   m_lbl_error<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 组合框更改事件的处理程序                                            | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token class-name">CMemoryControl</span><span class="token double-colon punctuation">::</span><span class="token function">OnChangeComboBoxType</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查数组类型是否更改 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span>m_combo_box_type_value<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 释放当前数组内存 </span>
      <span class="token function">OnClickButtonFree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 使用另一个数组类型 </span>
      m_combo_box_type_value<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>m_combo_box_type<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 在屏幕上显示新数组类型 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
         m_lbl_array_type<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组类型 = char&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> 
         m_lbl_array_type<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组类型 = int&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span> 
         m_lbl_array_type<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组类型 = float&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span> 
         m_lbl_array_type<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组类型 = double&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>m_combo_box_type_value<span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span> 
         m_lbl_array_type<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">&quot;数组类型 = long&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//--- CMemoryControl 类对象 </span>
CMemoryControl ExtDialog<span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 专家初始化类型                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 创建对话 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ExtDialog<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;内存控制&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>X_START<span class="token punctuation">,</span>Y_START<span class="token punctuation">,</span>X_SIZE<span class="token punctuation">,</span>Y_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 启动 </span>
   ExtDialog<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 专家去初始化函数                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- </span>
   ExtDialog<span class="token punctuation">.</span><span class="token function">Destroy</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 专家图表事件函数                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnChartEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span> 
                  <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>lparam<span class="token punctuation">,</span> 
                  <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>dparam<span class="token punctuation">,</span> 
                  <span class="token keyword">const</span> string <span class="token operator">&amp;</span>sparam<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   ExtDialog<span class="token punctuation">.</span><span class="token function">ChartEvent</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>lparam<span class="token punctuation">,</span>dparam<span class="token punctuation">,</span>sparam<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br></div></div><h2 id="_6-5-arraygetasseries"><a href="#_6-5-arraygetasseries" class="header-anchor">#</a> 6.5 ArrayGetAsSeries</h2> <p>检测数组索引的方向(是从左到右，还是 从右到左)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">ArrayGetAsSeries</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// 用于检测的数组 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 检测数组</p> <p>返回值</p> <p>如果指定的数组设置有AS_SERIES标帜，则返回true，即对数组的访问将和时间序列数组一样，从后往前。时间序列不同于普通的数组，因为时间序列的元素索引编号是从结尾到开头来执行的(数据从 最新的 到 最旧的)。</p> <p>注意</p> <p>要检查数组是否属于时间序列，请使用ArrayIsSeries()函数。将报价数据数组作为输入参数传递到OnCalculate()函数中时，不需要将索引方向与时间序列中相同。可以使用ArraySetAsSeries()函数设置必要的索引方向。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Indicator calculates absolute values of the difference between&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Open and Close or High and Low prices displaying them in a separate subwindow&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;as a histogram.&quot;</span></span>
<span class="token comment">//本指标计算 OCHL(开盘，收盘，最高，最低)价格之间的绝对差值，将它们以柱状图的形式显示在副图中。</span>
<span class="token comment">//---指标设置</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers  <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 绘制</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_HISTOGRAM</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">3</span></span></span>
<span class="token comment">//--- 输入参数</span>
input <span class="token keyword">bool</span> InpAsSeries<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 指标缓冲区的标引导向</span>
input <span class="token keyword">bool</span> InpPrices<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>   <span class="token comment">// 计算价格 (true - 开盘价，收盘价; false - 最高价，最低价)</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span> ExtBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 计算指标的值                                                       |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">CandleSizeOnBuffer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                        <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>first<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>second<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 计算柱形的开始变量</span>
   <span class="token keyword">int</span> start<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>
<span class="token comment">//--- 如果前一个订单号已经计算了指标值，那么使用最近的柱</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
      start<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token comment">//--- 定义数组的标引导向</span>
   <span class="token keyword">bool</span> as_series_first<span class="token operator">=</span><span class="token function">ArrayGetAsSeries</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">bool</span> as_series_second<span class="token operator">=</span><span class="token function">ArrayGetAsSeries</span><span class="token punctuation">(</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">bool</span> as_series_buffer<span class="token operator">=</span><span class="token function">ArrayGetAsSeries</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果有必要，直接替代标引导向</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>as_series_first<span class="token punctuation">)</span>
      <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>as_series_second<span class="token punctuation">)</span>
      <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>second<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>as_series_buffer<span class="token punctuation">)</span>
      <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 计算指标值</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
      buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">MathAbs</span><span class="token punctuation">(</span>first<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>second<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 绑定指标缓冲区</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ExtBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在指标缓冲区设置标引元素</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>ExtBuffer<span class="token punctuation">,</span>InpAsSeries<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查指标计算的价格</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>InpPrices<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 开盘价和收盘价</span>
      <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span><span class="token string">&quot;BodySize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 设置指标颜色</span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>clrOrange<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 最高价和最低价</span>
      <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span><span class="token string">&quot;ShadowSize&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 设置指标颜色</span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_COLOR<span class="token punctuation">,</span>clrDodgerBlue<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 根据标识值计算指标</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>InpPrices<span class="token punctuation">)</span>
      <span class="token function">CandleSizeOnBuffer</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">,</span>prev_calculated<span class="token punctuation">,</span>open<span class="token punctuation">,</span>close<span class="token punctuation">,</span>ExtBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      <span class="token function">CandleSizeOnBuffer</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">,</span>prev_calculated<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>ExtBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为下次调用返回prev_calculated值</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>相关参考
访问时间序列和指标数据 ，ArraySetAsSeries</p> <h2 id="_6-6-arrayinitialize"><a href="#_6-6-arrayinitialize" class="header-anchor">#</a> 6.6 ArrayInitialize</h2> <p>函数通过预设值初始化一个数组。
初始化字符型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   <span class="token keyword">char</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   <span class="token keyword">char</span>    value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>初始化短整型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   <span class="token keyword">short</span>   array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   <span class="token keyword">short</span>   value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>初始化长整型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   <span class="token keyword">long</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   <span class="token keyword">long</span>    value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>初始化浮点型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   <span class="token keyword">float</span>   array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   <span class="token keyword">float</span>   value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>初始化双精度型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   <span class="token keyword">double</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   <span class="token keyword">double</span>  value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>初始化布尔型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   <span class="token keyword">bool</span>    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   <span class="token keyword">bool</span>    value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>初始化无符号整型数组</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span> 
   uint    array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// 初始化的数组 </span>
   uint    value        <span class="token comment">// 将被设置的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>array[]</p> <p>[out] 需要初始化的数值数组</p> <p>value</p> <p>[in] 为所有数组元素建立新值</p> <p>返回值</p> <p>初始化元素的数量。</p> <p>注意</p> <p>ArrayResize()函数允许设置一个数组的大小，以便在没有内存的物理迁移的情况下进一步扩展。它是为了更好的性能而实现的，因为内存迁移的操作相当缓慢。</p> <p>使用ArrayInitialize(数组，init_val)初始化数组并不意味着初始化的值与分配给该数组的保留元素相同。在使用ArrayResize()函数进一步扩展数组时，将在数组的末尾添加元素，它们的值将是未定义的，在大多数情况下将不等于init_value。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 动态数组</span>
   <span class="token keyword">double</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 数组大小设为100个元素并为另10个元素保留缓冲区</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 初始化带有EMPTY_VALUE=DBL_MAX值的数组元素</span>
   <span class="token function">ArrayInitialize</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span>EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Values of 10 last elements after initialization&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;array[%d] = %G&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 数组扩展5个元素</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Values of 10 last elements after ArrayResize(array,105)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 最后的5个数组值可以从保留的缓冲区获得</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">95</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">105</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;array[%d] = %G&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_6-7-arrayfill"><a href="#_6-7-arrayfill" class="header-anchor">#</a> 6.7 ArrayFill</h2> <p>此函数以指定值填充数组。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">ArrayFill</span><span class="token punctuation">(</span> 
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>       <span class="token comment">// 数组 </span>
   uint   start<span class="token punctuation">,</span>         <span class="token comment">// 开始标引 </span>
   uint   count<span class="token punctuation">,</span>         <span class="token comment">// 填充的元素数量 </span>
   <span class="token keyword">void</span>   value          <span class="token comment">// 值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>array[]</p> <p>[out] 简单类型的数组 (char, uchar, short, ushort, int, uint, long, ulong, bool, color, datetime, float, double)。</p> <p>start</p> <p>[in] 开始索引编号。在这种情况下，指定的AS_SERIES 标帜被忽略。</p> <p>count</p> <p>[in] 填充的元素数量。</p> <p>value</p> <p>[in] 填充数组的值。</p> <p>返回值</p> <p>无返回值。</p> <p>注意</p> <p>当调用ArrayFill() 函数时，正常的索引编号方向(从左至右)始终隐藏。它意味着使用ArraySetAsSeries()函数改变访问数组元素的顺序被忽略。</p> <p>在ArrayFill()函数处理的情况下，多维数组显示为一维数组。例如，array[2][4] 处理为array[8]。 因此，当使用该数组时，您可以指定初始元素的索引等于5。因此，为 array[2][4] 调用ArrayFill(array, 5, 2, 3.14)，用3.14来填充array[1][1] 和 array[1][2]。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 声明动态数组</span>
   <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置大小</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 用123填充前5个元素</span>
   <span class="token function">ArrayFill</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 用456填充后5个元素 </span>
   <span class="token function">ArrayFill</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">456</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 显示值</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;a[%d] = %d&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_6-8-arrayisdynamic"><a href="#_6-8-arrayisdynamic" class="header-anchor">#</a> 6.8 ArrayIsDynamic</h2> <p>此函数检查数组是否为动态的。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">ArrayIsDynamic</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// 被检测的数组 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 检测数组.</p> <p>返回值</p> <p>数组是动态的，返回 true，否则返回 false。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;This indicator does not calculate values. It makes a single attempt to&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;apply the call of ArrayFree() function to three arrays: dynamic one, static one and&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;an indicator buffer. Results are shown in Experts journal.&quot;</span></span>
<span class="token comment">//这个指标不计算值。它只是尝试调用ArrayFree()函数应用到三个数组:动态的、静态的和指标缓冲数组。</span>
<span class="token comment">//--- 指标设置</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">double</span> ExtDynamic<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">// 动态数组</span>
<span class="token keyword">double</span> ExtStatic<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 静态数组</span>
<span class="token keyword">bool</span>   ExtFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>   <span class="token comment">// 标识</span>
<span class="token keyword">double</span> ExtBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// 指标缓冲区</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>ExtDynamic<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲区映射</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ExtBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> begin<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>price<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 执行一个分析</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ExtFlag<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 尝试释放数组内存</span>
      <span class="token comment">//--- 1. 动态数组</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;+============================+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;1. 检查动态数组:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;释放前数组占用的内存大小 = &quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtDynamic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;这是个动态数组吗？ = &quot;</span><span class="token punctuation">,</span><span class="token function">ArrayIsDynamic</span><span class="token punctuation">(</span>ExtDynamic<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 尝试释放数组内存</span>
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>ExtDynamic<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;释放后数组占用的内存大小 = &quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtDynamic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 2. 静态数组</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;2. 检查静态数组:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;释放前数组占用的内存大小 = &quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtStatic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;这是个动态数组吗? = &quot;</span><span class="token punctuation">,</span><span class="token function">ArrayIsDynamic</span><span class="token punctuation">(</span>ExtStatic<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 尝试释放数组内存</span>
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>ExtStatic<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;释放后数组占用的内存大小 = &quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtStatic<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 3. 指标缓冲区</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;3. 检查指标缓冲数组:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;释放前数组占用的内存大小 = &quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtBuff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;这是个动态数组吗? = &quot;</span><span class="token punctuation">,</span><span class="token function">ArrayIsDynamic</span><span class="token punctuation">(</span>ExtBuff<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Yes&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;No&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 尝试释放数组内存</span>
      <span class="token function">ArrayFree</span><span class="token punctuation">(</span>ExtBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;释放后数组占用的内存大小 = &quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtBuff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 改变标识的值</span>
      ExtFlag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 为下次调用返回prev_calculated值</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><p>ArrayIsSeries
此函数检查数组是否为 时间序列数组。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">ArrayIsSeries</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// 被检测的数组 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 被检测的数组</p> <p>返回值</p> <p>如果检测数组是 时间序列数组，就返回TRUE，否则返回FALSE。数组以形式参数传递到OnCalculate()函数必须通过 ArrayGetAsSeries()检测访问数组元素的顺序</p> <p>示例:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 标签图1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Label1&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span></span></span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>         Label1Buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 指标缓冲区绘图</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>Label1Buffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标循环函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ArrayIsSeries</span><span class="token punctuation">(</span>open<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;open[] is timeseries&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;open[] is not timeseries!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为下次调用返回prev_calculated值</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>相关参考
访问时间序列和指标</p> <h2 id="_6-9-arrayresize"><a href="#_6-9-arrayresize" class="header-anchor">#</a> 6.9 ArrayResize</h2> <p>函数建立新的第一维大小</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayResize</span><span class="token punctuation">(</span>
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token comment">// 引用传递的数组</span>
   <span class="token keyword">int</span>    new_size<span class="token punctuation">,</span>             <span class="token comment">// 新数组大小</span>
   <span class="token keyword">int</span>    reserve_size<span class="token operator">=</span><span class="token number">0</span>        <span class="token comment">// 保留尺寸值 (过量)</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参量</p> <p>array[]</p> <p>[out] 数组变化尺寸</p> <p>new_size</p> <p>[in] 第一维度新尺寸</p> <p>reserve_size=0</p> <p>[in] 获得存储的分散式大小</p> <p>返回值</p> <p>如果执行成功，在数组中改变规格后返回所有元素计数，否则，返回-1，数组不调整大小。</p> <p>如果ArrayResize() 应用于静态数组，timeseries或指标缓冲区，数组大小保持一致 –这些数组将不会被重新分配。在这种情况下，如果new_size&lt;=ArraySize(数组)，函数将只会返回 new_size；否则将会返回-1值。</p> <p>注释</p> <p>该函数只能应用在 动态数组。应该注意的是您不能改变通过SetIndexBuffer()函数分配的作为指标缓冲区的动态数组的大小。对于指标缓冲区，调整大小的所有操作都通过程序端的运行时间子系统来执行。</p> <p>数组中的元素总数不能超过 2147483647。</p> <p>随着频繁的内存分配，推荐使用设置存储以减少物理内存分配数量的第三方参数。后来的ArrayResize所有调用都不能导致重新分配物理内存，只是会在保留内存内改变第一数组维度的大小。应谨记，第三方参数只能在物理内存分配期间使用。例如：</p> <p>ArrayResize(arr,1000,1000);
for(int i=1;i &lt; 3000;i++)
ArrayResize(arr,i,1000);</p> <p>假若这样，内存将被重新分配两次，第一次是输入2000元素循环之前（数组大小将设为1000），第二次是i等于3000.如果我们跳过第三方参数，将会有2000重新分配物理内存，这将使程序减速。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序起始函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 计数器</span>
   ulong start<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   ulong now<span class="token punctuation">;</span>
   <span class="token keyword">int</span>   count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 用于快速版本维度的数组</span>
   <span class="token keyword">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查如何加速内存保留工作的变量</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;--- Test Fast: ArrayResize(arr,100000,100000)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">300000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 设置新数组大小指定储备100,000元素！</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 当到达整十整百的整数时，显示数组大小和花费的时间</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100000</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         now<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         count<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d. ArraySize(arr)=%d Time=%d ms&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>now<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         start<span class="token operator">=</span>now<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 现在显示，无保留内存的版本有多慢</span>
   <span class="token keyword">double</span> slow<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>slow<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   start<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;---- Test Slow: ArrayResize(slow,100000)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">300000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 设置新的数组大小，但是无额外储备</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>slow<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 当到达整十整百的整数时，显示数组大小和花费的时间</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>slow<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100000</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         now<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         count<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d. ArraySize(slow)=%d Time=%d ms&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>slow<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>now<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         start<span class="token operator">=</span>now<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">//--- 脚本的示例结果</span>
<span class="token comment">/*
   Test_ArrayResize (EURUSD,H1)   --- Test Fast: ArrayResize(arr,100000,100000)
   Test_ArrayResize (EURUSD,H1)   1. ArraySize(arr)=100000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   2. ArraySize(arr)=200000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   3. ArraySize(arr)=300000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   ---- Test Slow: ArrayResize(slow,100000)
   Test_ArrayResize (EURUSD,H1)   1. ArraySize(slow)=100000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   2. ArraySize(slow)=200000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   3. ArraySize(slow)=300000 Time=228511 ms
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>另见</p> <p>ArrayInitialize</p> <h2 id="_6-10-arraymaximum"><a href="#_6-10-arraymaximum" class="header-anchor">#</a> 6.10 ArrayMaximum</h2> <p>在多维数值数组中，搜索第一个维度中的最大的那个元素。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayMaximum</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>   array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token comment">// 用于搜索的数组 </span>
   <span class="token keyword">int</span>           start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// 搜索开始的索引编号</span>
   <span class="token keyword">int</span>           count<span class="token operator">=</span>WHOLE_ARRAY    <span class="token comment">// 搜索元素的数量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 数值数组，建立搜寻</p> <p>start=0</p> <p>[in] 开始搜索的索引编号</p> <p>count=WHOLE_ARRAY</p> <p>[in] 搜索元素的数量。默认在整个数组 (count=WHOLE_ARRAY)中搜索。</p> <p>返回值</p> <p>该函数返回被找到的元素的索引编号，并考虑到数组序列。如果失败，则返回 -1。</p> <p>注意</p> <p>搜索最大值时考虑AS_SERIES标帜。</p> <p>函数ArrayMaximum 和 ArrayMinimum 接受任何维度的数组为参数。然而，搜索却始终应用于第一(0)维度。</p> <p>示例：</p> <p>见下节</p> <h2 id="_6-11-arrayminimum"><a href="#_6-11-arrayminimum" class="header-anchor">#</a> 6.11 ArrayMinimum</h2> <p>在多维数值数组中，搜索第一个维度中的最小的那个元素。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayMinimum</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>   array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token comment">// 用来搜索的数组 </span>
   <span class="token keyword">int</span>           start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// 搜索开始的索引编号 </span>
   <span class="token keyword">int</span>           count<span class="token operator">=</span>WHOLE_ARRAY    <span class="token comment">// 搜索元素的数量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 数值数组，建立搜寻</p> <p>start=0</p> <p>[in] 开始搜索的索引编号</p> <p>count=WHOLE_ARRAY</p> <p>[in] 搜索元素的数量。默认在整个数组 (count=WHOLE_ARRAY)中搜索。</p> <p>返回值</p> <p>该函数返回被找到的元素的索引编号，并考虑到数组序列。如果失败，则返回 -1。</p> <p>注意</p> <p>搜索最小值时考虑AS_SERIES标帜。</p> <p>函数ArrayMaximum 和 ArrayMinimum 接受任何维度的数组为参数。然而，搜索却始终应用于第一(0)维度。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The indicator displays larger time frame's candlesticks on the current one.&quot;</span> </span>
<span class="token comment">//这个指标在当前图表上显示一个更大时间框架(默认H4)的K线柱。</span>
<span class="token comment">//--- 指标设置 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">16</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">8</span> </span></span>
<span class="token comment">//---- 图 1 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;BearBody&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrSeaGreen<span class="token punctuation">,</span>clrSeaGreen </span></span>
<span class="token comment">//---- 图 2 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label2  </span><span class="token string">&quot;BearBodyEnd&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color2  clrSeaGreen<span class="token punctuation">,</span>clrSeaGreen </span></span>
<span class="token comment">//---- 图 3 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label3  </span><span class="token string">&quot;BearShadow&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color3  clrSalmon<span class="token punctuation">,</span>clrSalmon </span></span>
<span class="token comment">//---- 图 4 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label4  </span><span class="token string">&quot;BearShadowEnd&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color4  clrSalmon<span class="token punctuation">,</span>clrSalmon </span></span>
<span class="token comment">//---- 图 5 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label5  </span><span class="token string">&quot;BullBody&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color5  clrOlive<span class="token punctuation">,</span>clrOlive </span></span>
<span class="token comment">//---- 图 6 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label6  </span><span class="token string">&quot;BullBodyEnd&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color6  clrOlive<span class="token punctuation">,</span>clrOlive </span></span>
<span class="token comment">//---- 图 7 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label7  </span><span class="token string">&quot;BullShadow&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color7  clrSkyBlue<span class="token punctuation">,</span>clrSkyBlue </span></span>
<span class="token comment">//---- 图 8 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label8  </span><span class="token string">&quot;BullShadowEnd&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color8  clrSkyBlue<span class="token punctuation">,</span>clrSkyBlue </span></span>
<span class="token comment">//--- 预定义常量 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INDICATOR_EMPTY_VALUE</span> <span class="token expression"><span class="token number">0.0</span> </span></span>
<span class="token comment">//--- 输入参数 </span>
input ENUM_TIMEFRAMES InpPeriod<span class="token operator">=</span>PERIOD_H4<span class="token punctuation">;</span>              <span class="token comment">// 指标计算的时间范围 </span>
input datetime        InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 分析起始日期 </span>
<span class="token comment">//--- 熊市蜡烛图的指标缓冲区 </span>
<span class="token keyword">double</span>   ExtBearBodyFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearBodySecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearBodyEndFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearBodyEndSecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearShadowFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearShadowSecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearShadowEndFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBearShadowEndSecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 牛市蜡烛图的指标缓冲区 </span>
<span class="token keyword">double</span>   ExtBullBodyFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullBodySecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullBodyEndFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullBodyEndSecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullShadowFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullShadowSecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullShadowEndFirst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token keyword">double</span>   ExtBullShadowEndSecond<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 全局变量 </span>
datetime ExtTimeBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// 较大时间帧的时间缓冲区 </span>
<span class="token keyword">int</span>      ExtSize<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">// 时间缓冲区大小 </span>
<span class="token keyword">int</span>      ExtCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">// 时间缓冲区的标引 </span>
<span class="token keyword">int</span>      ExtStartPos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 指标计算的初始位置 </span>
<span class="token keyword">bool</span>     ExtStartFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 接收初始位置的辅助标识 </span>
datetime ExtCurrentTime<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 生成较大时间帧柱形的最近时间 </span>
datetime ExtLastTime<span class="token punctuation">;</span>        <span class="token comment">// 较大时间帧的最近时间，执行计算 </span>
<span class="token keyword">bool</span>     ExtBearFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>   <span class="token comment">// 标记定义编写数据订单熊市指标缓冲区 </span>
<span class="token keyword">bool</span>     ExtBullFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>   <span class="token comment">// 标记定义编写数据订单牛市指标缓冲区 </span>
<span class="token keyword">int</span>      ExtIndexMax<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 数组中最大元素标引 </span>
<span class="token keyword">int</span>      ExtIndexMin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 数组中最小元素标引 </span>
<span class="token keyword">int</span>      ExtDirectionFlag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 当前蜡烛图的价格移动方向 </span>
<span class="token comment">//--- 正确绘制蜡烛图开盘价和收盘价之间的转换 </span>
<span class="token keyword">const</span> <span class="token keyword">double</span> ExtEmptyBodySize<span class="token operator">=</span><span class="token number">0.2</span><span class="token operator">*</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SYMBOL_POINT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填写蜡烛图的基本部分                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FillCandleMain</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    <span class="token keyword">const</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> last<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> fill_index<span class="token punctuation">,</span> 
                    <span class="token keyword">int</span> <span class="token operator">&amp;</span>index_max<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>index_min<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在数组中找出最大和最小元素的标引 </span>
   index_max<span class="token operator">=</span><span class="token function">ArrayMaximum</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span>ExtStartPos<span class="token punctuation">,</span>last<span class="token operator">-</span>start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最高极值 </span>
   index_min<span class="token operator">=</span><span class="token function">ArrayMinimum</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span>ExtStartPos<span class="token punctuation">,</span>last<span class="token operator">-</span>start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 最低极值 </span>
<span class="token comment">//--- 定义当前时间帧填充多少柱 </span>
   <span class="token keyword">int</span> count<span class="token operator">=</span>fill_index<span class="token operator">-</span>start<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果首柱的收盘价超过最后的柱，那么蜡烛图为熊市 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">&gt;</span>close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 如果蜡烛图之前牛市，清空牛市指标缓冲区的值 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ExtDirectionFlag<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
         <span class="token function">ClearCandle</span><span class="token punctuation">(</span>ExtBullBodyFirst<span class="token punctuation">,</span>ExtBullBodySecond<span class="token punctuation">,</span>ExtBullShadowFirst<span class="token punctuation">,</span>ExtBullShadowSecond<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 熊市蜡烛图 </span>
      ExtDirectionFlag<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 生成蜡烛图 </span>
      <span class="token function">FormCandleMain</span><span class="token punctuation">(</span>ExtBearBodyFirst<span class="token punctuation">,</span>ExtBearBodySecond<span class="token punctuation">,</span>ExtBearShadowFirst<span class="token punctuation">,</span>ExtBearShadowSecond<span class="token punctuation">,</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> 
                     close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>ExtBearFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 退出函数 </span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果首柱的收盘价少于最后的柱，那么蜡烛图为牛市 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">&lt;</span>close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 如果蜡烛图之前为熊市，清空熊市指标缓冲区的值 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ExtDirectionFlag<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span> 
         <span class="token function">ClearCandle</span><span class="token punctuation">(</span>ExtBearBodyFirst<span class="token punctuation">,</span>ExtBearBodySecond<span class="token punctuation">,</span>ExtBearShadowFirst<span class="token punctuation">,</span>ExtBearShadowSecond<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 牛市蜡烛图 </span>
      ExtDirectionFlag<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 生成蜡烛图 </span>
      <span class="token function">FormCandleMain</span><span class="token punctuation">(</span>ExtBullBodyFirst<span class="token punctuation">,</span>ExtBullBodySecond<span class="token punctuation">,</span>ExtBullShadowFirst<span class="token punctuation">,</span>ExtBullShadowSecond<span class="token punctuation">,</span>close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">,</span> 
                     open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>ExtBullFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 退出函数             </span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果您在这部分函数，首柱开盘价等于 </span>
<span class="token comment">//--- 最后柱的收盘价；这种蜡烛图被认为熊市图 </span>
<span class="token comment">//--- 如果在那之前蜡烛图为牛市，清空牛市指标缓冲区的值 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ExtDirectionFlag<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
      <span class="token function">ClearCandle</span><span class="token punctuation">(</span>ExtBullBodyFirst<span class="token punctuation">,</span>ExtBullBodySecond<span class="token punctuation">,</span>ExtBullShadowFirst<span class="token punctuation">,</span>ExtBullShadowSecond<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 熊市蜡烛图 </span>
   ExtDirectionFlag<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果收盘和开盘价相同，使用切换来正确显示 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token operator">!=</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">)</span> 
      <span class="token function">FormCandleMain</span><span class="token punctuation">(</span>ExtBearBodyFirst<span class="token punctuation">,</span>ExtBearBodySecond<span class="token punctuation">,</span>ExtBearShadowFirst<span class="token punctuation">,</span>ExtBearShadowSecond<span class="token punctuation">,</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> 
                     open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">-</span>ExtEmptyBodySize<span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>ExtBearFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">else</span> 
      <span class="token function">FormCandleMain</span><span class="token punctuation">(</span>ExtBearBodyFirst<span class="token punctuation">,</span>ExtBearBodySecond<span class="token punctuation">,</span>ExtBearShadowFirst<span class="token punctuation">,</span>ExtBearShadowSecond<span class="token punctuation">,</span> 
                     open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">-</span>ExtEmptyBodySize<span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span> 
                     high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token operator">-</span>ExtEmptyBodySize<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>ExtBearFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 填充蜡烛图末端                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FillCandleEnd</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token keyword">const</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> last<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> fill_index<span class="token punctuation">,</span> 
                   <span class="token keyword">const</span> <span class="token keyword">int</span> index_max<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> index_min<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 单柱时不要绘制 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>last<span class="token operator">-</span>start<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 如果首柱的收盘价超过最后的柱，蜡烛图为熊市 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">&gt;</span>close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 生成蜡烛图末端 </span>
      <span class="token function">FormCandleEnd</span><span class="token punctuation">(</span>ExtBearBodyEndFirst<span class="token punctuation">,</span>ExtBearBodyEndSecond<span class="token punctuation">,</span>ExtBearShadowEndFirst<span class="token punctuation">,</span>ExtBearShadowEndSecond<span class="token punctuation">,</span> 
                    open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span>close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">,</span>fill_index<span class="token punctuation">,</span>ExtBearFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 退出函数 </span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果首柱的收盘价小于最后的柱，蜡烛图为牛市 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">&lt;</span>close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 生成蜡烛图末端 </span>
      <span class="token function">FormCandleEnd</span><span class="token punctuation">(</span>ExtBullBodyEndFirst<span class="token punctuation">,</span>ExtBullBodyEndSecond<span class="token punctuation">,</span>ExtBullShadowEndFirst<span class="token punctuation">,</span>ExtBullShadowEndSecond<span class="token punctuation">,</span> 
                    close<span class="token punctuation">[</span>last<span class="token punctuation">]</span><span class="token punctuation">,</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">,</span>fill_index<span class="token punctuation">,</span>ExtBullFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 退出函数 </span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果您在这部分函数，首柱开盘价等于 </span>
<span class="token comment">//--- 最后柱的收盘价；这种蜡烛图被认为熊市图 </span>
<span class="token comment">//--- 生成蜡烛图末端 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token operator">!=</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">)</span> 
      <span class="token function">FormCandleEnd</span><span class="token punctuation">(</span>ExtBearBodyEndFirst<span class="token punctuation">,</span>ExtBearBodyEndSecond<span class="token punctuation">,</span>ExtBearShadowEndFirst<span class="token punctuation">,</span>ExtBearShadowEndSecond<span class="token punctuation">,</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">-</span>ExtEmptyBodySize<span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>low<span class="token punctuation">[</span>index_min<span class="token punctuation">]</span><span class="token punctuation">,</span>fill_index<span class="token punctuation">,</span>ExtBearFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">else</span> 
      <span class="token function">FormCandleEnd</span><span class="token punctuation">(</span>ExtBearBodyEndFirst<span class="token punctuation">,</span>ExtBearBodyEndSecond<span class="token punctuation">,</span>ExtBearShadowEndFirst<span class="token punctuation">,</span>ExtBearShadowEndSecond<span class="token punctuation">,</span>open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    open<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token operator">-</span>ExtEmptyBodySize<span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token punctuation">,</span>high<span class="token punctuation">[</span>index_max<span class="token punctuation">]</span><span class="token operator">-</span>ExtEmptyBodySize<span class="token punctuation">,</span>fill_index<span class="token punctuation">,</span>ExtBearFlag<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标初始化函数                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查指标周期 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">CheckPeriod</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">Period</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>InpPeriod<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 在前景显示价格数据 </span>
   <span class="token function">ChartSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_FOREGROUND<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 绑定指标缓冲区 </span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ExtBearBodyFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ExtBearBodySecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ExtBearBodyEndFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ExtBearBodyEndSecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>ExtBearShadowFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span>ExtBearShadowSecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span>ExtBearShadowEndFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>ExtBearShadowEndSecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>ExtBullBodyFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>ExtBullBodySecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>ExtBullBodyEndFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>ExtBullBodyEndSecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>ExtBullShadowFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span>ExtBullShadowSecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>ExtBullShadowEndFirst<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>ExtBullShadowEndSecond<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 设置一些属性值来创建指标 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>PLOT_DRAW_TYPE<span class="token punctuation">,</span>DRAW_FILLING<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图形结构类型 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>PLOT_LINE_STYLE<span class="token punctuation">,</span>STYLE_SOLID<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 绘制线型风格 </span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// 绘制线型宽度 </span>
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 自定义指标迭代函数                                                 | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span> 
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 如果没有计算的柱 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 接收较大时间帧柱形的到达时间 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetTimeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
         <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 设置直接索引 </span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 启动计算柱形的变量 </span>
   <span class="token keyword">int</span> start<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span> 
<span class="token comment">//--- 如果生成柱形，重新计算上面的指标值 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>start<span class="token operator">!=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> start<span class="token operator">==</span>rates_total<span class="token punctuation">)</span> 
      start<span class="token operator">--</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 循环计算指标值 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 用空值填充指标缓冲区的i元素 </span>
      <span class="token function">FillIndicatorBuffers</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 从InpDateStart日期开始计算柱形 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span>InpDateStart<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 定义值第一时间显示的持仓 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ExtStartFlag<span class="token punctuation">)</span> 
           <span class="token punctuation">{</span> 
            <span class="token comment">//--- 存储最初柱形的数量 </span>
            ExtStartPos<span class="token operator">=</span>i<span class="token punctuation">;</span> 
            <span class="token comment">//--- 定义超过time[i]的较大时间帧的初始日期 </span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span>ExtTimeBuff<span class="token punctuation">[</span>ExtCount<span class="token punctuation">]</span><span class="token punctuation">)</span> 
               <span class="token keyword">if</span><span class="token punctuation">(</span>ExtCount<span class="token operator">&lt;</span>ExtSize<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
                  ExtCount<span class="token operator">++</span><span class="token punctuation">;</span> 
            <span class="token comment">//--- 改变标识值以便不在这模块再次运行 </span>
            ExtStartFlag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
         <span class="token comment">//--- 检查数组中是否有任何元素 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>ExtCount<span class="token operator">&lt;</span>ExtSize<span class="token punctuation">)</span> 
           <span class="token punctuation">{</span> 
            <span class="token comment">//--- 等候当前时间帧的值到达较大时间帧的值 </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span>ExtTimeBuff<span class="token punctuation">[</span>ExtCount<span class="token punctuation">]</span><span class="token punctuation">)</span> 
              <span class="token punctuation">{</span> 
               <span class="token comment">//---  绘制蜡烛图的主要部分（不填写最后和倒数第二柱之间的区域） </span>
               <span class="token function">FillCandleMain</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span>close<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>ExtStartPos<span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>ExtIndexMax<span class="token punctuation">,</span>ExtIndexMin<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token comment">//--- 填充蜡烛图末端（最后和倒数第二柱之间的区域） </span>
               <span class="token function">FillCandleEnd</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span>close<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>ExtStartPos<span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>ExtIndexMax<span class="token punctuation">,</span>ExtIndexMin<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token comment">//--- 切换初始持仓以绘制下一个蜡烛图 </span>
               ExtStartPos<span class="token operator">=</span>i<span class="token punctuation">;</span> 
               <span class="token comment">//--- 增加数组计数器 </span>
               ExtCount<span class="token operator">++</span><span class="token punctuation">;</span> 
              <span class="token punctuation">}</span> 
            <span class="token keyword">else</span> 
               <span class="token keyword">continue</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
         <span class="token keyword">else</span> 
           <span class="token punctuation">{</span> 
            <span class="token comment">//--- 重置数组的值 </span>
            <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//--- 接收来自较大时间帧的最后日期 </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>InpPeriod<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>ExtCurrentTime<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
              <span class="token punctuation">{</span> 
               <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Data copy error, code = &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
              <span class="token punctuation">}</span> 
            <span class="token comment">//--- 如果新日期靠后，停止生成蜡烛图 </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ExtCurrentTime<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>ExtLastTime<span class="token punctuation">)</span> 
              <span class="token punctuation">{</span> 
               <span class="token comment">//--- 在主要指标缓冲区清空最后和倒数第二柱之间的区域 </span>
               <span class="token function">ClearEndOfBodyMain</span><span class="token punctuation">(</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token comment">//--- 使用辅助指标缓冲区填充该区域 </span>
               <span class="token function">FillCandleEnd</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span>close<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>ExtStartPos<span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>ExtIndexMax<span class="token punctuation">,</span>ExtIndexMin<span class="token punctuation">)</span><span class="token punctuation">;</span> 
               <span class="token comment">//--- 切换初始持仓以绘制下一个蜡烛图 </span>
               ExtStartPos<span class="token operator">=</span>i<span class="token punctuation">;</span> 
               <span class="token comment">//--- 重置价格方向标识 </span>
               ExtDirectionFlag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
               <span class="token comment">//--- 存储新的最近日期 </span>
               ExtLastTime<span class="token operator">=</span>ExtCurrentTime<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
              <span class="token punctuation">}</span> 
            <span class="token keyword">else</span> 
              <span class="token punctuation">{</span> 
               <span class="token comment">//--- 生成蜡烛图 </span>
               <span class="token function">FillCandleMain</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span>close<span class="token punctuation">,</span>high<span class="token punctuation">,</span>low<span class="token punctuation">,</span>ExtStartPos<span class="token punctuation">,</span>i<span class="token punctuation">,</span>i<span class="token punctuation">,</span>ExtIndexMax<span class="token punctuation">,</span>ExtIndexMin<span class="token punctuation">)</span><span class="token punctuation">;</span> 
              <span class="token punctuation">}</span> 
           <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 返回prev_calculated值以便下次调用 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 检查指定指标周期的正确性                                            | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">CheckPeriod</span><span class="token punctuation">(</span><span class="token keyword">int</span> current_period<span class="token punctuation">,</span><span class="token keyword">int</span> high_period<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 指标周期应该超过显示它的时间帧 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>current_period<span class="token operator">&gt;=</span>high_period<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Error! The value of the indicator period should exceed the value of the current time frame!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 如果指标周期是周或月份，周期则是正确的 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>high_period<span class="token operator">&gt;</span><span class="token number">32768</span><span class="token punctuation">)</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 转变周期值到分钟 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>high_period<span class="token operator">&gt;</span><span class="token number">30</span><span class="token punctuation">)</span> 
      high_period<span class="token operator">=</span><span class="token punctuation">(</span>high_period<span class="token operator">-</span><span class="token number">16384</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>current_period<span class="token operator">&gt;</span><span class="token number">30</span><span class="token punctuation">)</span> 
      current_period<span class="token operator">=</span><span class="token punctuation">(</span>current_period<span class="token operator">-</span><span class="token number">16384</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 指标周期应该是它显示的时间帧的几倍 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>high_period<span class="token operator">%</span>current_period<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Error! The value of the indicator period should be multiple of the value of the current time frame!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 指标周期应该超过它显示的时间帧的3或更多倍 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>high_period<span class="token operator">/</span>current_period <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Error! The indicator period should exceed the current time frame 3 or more times!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 指标周期在当前时间帧是正确的 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 接收来自较大时间帧的时间数据                                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">GetTimeData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 重置错误的值 </span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 复制当前时间的所有数据 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>InpPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ExtTimeBuff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 接收错误代码 </span>
      <span class="token keyword">int</span> code<span class="token operator">=</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 打印错误信息 </span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data copy error! %s&quot;</span><span class="token punctuation">,</span>code<span class="token operator">==</span><span class="token number">4401</span> 
                  <span class="token operator">?</span> <span class="token string">&quot;History is still being uploaded!&quot;</span> 
                  <span class="token operator">:</span> <span class="token string">&quot;Code = &quot;</span><span class="token operator">+</span><span class="token function">IntegerToString</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 返回false，反复尝试下载数据 </span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 接收数组大小 </span>
   ExtSize<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ExtTimeBuff<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 为数组设置循环指数为零 </span>
   ExtCount<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 在时间帧设置当前蜡烛图位置为零 </span>
   ExtStartPos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
   ExtStartFlag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 存储来自较大时间帧的最近时间值 </span>
   ExtLastTime<span class="token operator">=</span>ExtTimeBuff<span class="token punctuation">[</span>ExtSize<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 成功执行 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+--------------------------------------------------------------------------+ </span>
<span class="token comment">//| 函数形成了蜡烛图的主要部分。根据标识的                                         | </span>
<span class="token comment">//| 值，函数定义了要使用哪个数据和数组                                             | </span>
<span class="token comment">//| 以便正确显示                                                               | </span>
<span class="token comment">//+--------------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FormCandleMain</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>body_fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>body_snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    <span class="token keyword">double</span> <span class="token operator">&amp;</span>shadow_fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>shadow_snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                    <span class="token keyword">const</span> <span class="token keyword">double</span> fst_value<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> snd_value<span class="token punctuation">,</span> 
                    <span class="token keyword">const</span> <span class="token keyword">double</span> fst_extremum<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> snd_extremum<span class="token punctuation">,</span> 
                    <span class="token keyword">const</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">bool</span> flag<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查标识的值 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 生成蜡烛图主体 </span>
      <span class="token function">FormMain</span><span class="token punctuation">(</span>body_fst<span class="token punctuation">,</span>body_snd<span class="token punctuation">,</span>fst_value<span class="token punctuation">,</span>snd_value<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 生成蜡烛图影子 </span>
      <span class="token function">FormMain</span><span class="token punctuation">(</span>shadow_fst<span class="token punctuation">,</span>shadow_snd<span class="token punctuation">,</span>fst_extremum<span class="token punctuation">,</span>snd_extremum<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 生成蜡烛图主体 </span>
      <span class="token function">FormMain</span><span class="token punctuation">(</span>body_fst<span class="token punctuation">,</span>body_snd<span class="token punctuation">,</span>snd_value<span class="token punctuation">,</span>fst_value<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 生成蜡烛图影子 </span>
      <span class="token function">FormMain</span><span class="token punctuation">(</span>shadow_fst<span class="token punctuation">,</span>shadow_snd<span class="token punctuation">,</span>snd_extremum<span class="token punctuation">,</span>fst_extremum<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+--------------------------------------------------------------------------------+ </span>
<span class="token comment">//| 函数形成了蜡烛图的末端。根据标识的值，                                             | </span>
<span class="token comment">//| 函数定义了要使用哪个数据和数组                                                      | </span>
<span class="token comment">//| 以便正确显示。                                                                    | </span>
<span class="token comment">//+--------------------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FormCandleEnd</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>body_fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>body_snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token keyword">double</span> <span class="token operator">&amp;</span>shadow_fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>shadow_snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                   <span class="token keyword">const</span> <span class="token keyword">double</span> fst_value<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> snd_value<span class="token punctuation">,</span> 
                   <span class="token keyword">const</span> <span class="token keyword">double</span> fst_extremum<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> snd_extremum<span class="token punctuation">,</span> 
                   <span class="token keyword">const</span> <span class="token keyword">int</span> end<span class="token punctuation">,</span><span class="token keyword">bool</span> <span class="token operator">&amp;</span>flag<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查标识的值 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 生成蜡烛图主体的末端 </span>
      <span class="token function">FormEnd</span><span class="token punctuation">(</span>body_fst<span class="token punctuation">,</span>body_snd<span class="token punctuation">,</span>fst_value<span class="token punctuation">,</span>snd_value<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 生成蜡烛图影子的末端 </span>
      <span class="token function">FormEnd</span><span class="token punctuation">(</span>shadow_fst<span class="token punctuation">,</span>shadow_snd<span class="token punctuation">,</span>fst_extremum<span class="token punctuation">,</span>snd_extremum<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变标识值到相反方向 </span>
      flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 生成蜡烛图主体的末端 </span>
      <span class="token function">FormEnd</span><span class="token punctuation">(</span>body_fst<span class="token punctuation">,</span>body_snd<span class="token punctuation">,</span>snd_value<span class="token punctuation">,</span>fst_value<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 生成蜡烛图影子的末端 </span>
      <span class="token function">FormEnd</span><span class="token punctuation">(</span>shadow_fst<span class="token punctuation">,</span>shadow_snd<span class="token punctuation">,</span>snd_extremum<span class="token punctuation">,</span>fst_extremum<span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 改变标识值到相反方向 </span>
      flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+-------------------------------------------------------------------------------------+ </span>
<span class="token comment">//| 清空蜡烛图末端（最后和倒数第二柱之间的区域）                                                | </span>
<span class="token comment">//|                                                                                     | </span>
<span class="token comment">//+-------------------------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ClearEndOfBodyMain</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> ind<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token function">ClearCandle</span><span class="token punctuation">(</span>ExtBearBodyFirst<span class="token punctuation">,</span>ExtBearBodySecond<span class="token punctuation">,</span>ExtBearShadowFirst<span class="token punctuation">,</span>ExtBearShadowSecond<span class="token punctuation">,</span>ind<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ClearCandle</span><span class="token punctuation">(</span>ExtBullBodyFirst<span class="token punctuation">,</span>ExtBullBodySecond<span class="token punctuation">,</span>ExtBullShadowFirst<span class="token punctuation">,</span>ExtBullShadowSecond<span class="token punctuation">,</span>ind<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 清空蜡烛图                                                        | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">ClearCandle</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>body_fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>body_snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>shadow_fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
                 <span class="token keyword">double</span> <span class="token operator">&amp;</span>shadow_snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 以空值填充指标缓冲区 </span>
      <span class="token function">ArrayFill</span><span class="token punctuation">(</span>body_fst<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ArrayFill</span><span class="token punctuation">(</span>body_snd<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ArrayFill</span><span class="token punctuation">(</span>shadow_fst<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ArrayFill</span><span class="token punctuation">(</span>shadow_snd<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 生成蜡烛图的主要部分                                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FormMain</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> fst_value<span class="token punctuation">,</span> 
              <span class="token keyword">const</span> <span class="token keyword">double</span> snd_value<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> start<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 用值填充指标缓冲区 </span>
      <span class="token function">ArrayFill</span><span class="token punctuation">(</span>fst<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>fst_value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">ArrayFill</span><span class="token punctuation">(</span>snd<span class="token punctuation">,</span>start<span class="token punctuation">,</span>count<span class="token punctuation">,</span>snd_value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 生成蜡烛图末端                                                     | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FormEnd</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>fst<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>snd<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">double</span> fst_value<span class="token punctuation">,</span> 
             <span class="token keyword">const</span> <span class="token keyword">double</span> snd_value<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> last<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 用值填充指标缓冲区 </span>
   <span class="token function">ArrayFill</span><span class="token punctuation">(</span>fst<span class="token punctuation">,</span>last<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>fst_value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayFill</span><span class="token punctuation">(</span>snd<span class="token punctuation">,</span>last<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>snd_value<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 通过空值填充指标缓冲区的i元素                                        | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">FillIndicatorBuffers</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 在指标缓冲区单元设置空值 </span>
   ExtBearBodyFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearBodySecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearShadowFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearShadowSecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearBodyEndFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearBodyEndSecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearShadowEndFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBearShadowEndSecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullBodyFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullBodySecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullShadowFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullShadowSecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullBodyEndFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullBodyEndSecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullShadowEndFirst<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
   ExtBullShadowEndSecond<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br></div></div><h2 id="_6-12-arrayprint"><a href="#_6-12-arrayprint" class="header-anchor">#</a> 6.12 ArrayPrint</h2> <p>将 简单类型 或 简单结构 的数组打印输出到日志文本。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">ArrayPrint</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>   array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token comment">// 打印数组 </span>
   uint          digits<span class="token operator">=</span>_Digits<span class="token punctuation">,</span>      <span class="token comment">// 小数位数 </span>
   <span class="token keyword">const</span> string  separator<span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">,</span>      <span class="token comment">// 结构字段值的分隔符 </span>
   ulong         start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// 最初打印元素索引 </span>
   ulong         count<span class="token operator">=</span>WHOLE_ARRAY<span class="token punctuation">,</span>   <span class="token comment">// 打印元素数量 </span>
   ulong         flags<span class="token operator">=</span>ARRAYPRINT_HEADER<span class="token operator">|</span>ARRAYPRINT_INDEX<span class="token operator">|</span>ARRAYPRINT_LIMIT<span class="token operator">|</span>ARRAYPRINT_ALIGN     
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 简单类型 或 简单结构 的数组。</p> <p>digits=_Digits</p> <p>[in] 真实类型的数值保留的小数位数。默认值是 _Digits。</p> <p>separator=NULL</p> <p>[in] 结构元素字段值之间的分隔符。默认值NULL表示用空行分隔。这种情况下，使用空格作为分隔符。</p> <p>start=0</p> <p>[in] 开始打印数组元素的索引编号。默认从0开始。</p> <p>count=WHOLE_ARRAY</p> <p>[in] 打印的数组元素个数。默认为整个数组(count=WHOLE_ARRAY)。</p> <p>flags=ARRAYPRINT_HEADER|ARRAYPRINT_INDEX|ARRAYPRINT_LIMIT|ARRAYPRINT_ALIGN</p> <p>[in] 设置输出模式的标帜组合。默认情况下启用所有标帜:
◦ ARRAYPRINT_HEADER —— 打印结构数组标题
◦ ARRAYPRINT_INDEX —— 在左侧打印索引编号
◦ ARRAYPRINT_LIMIT —— 仅打印最初100个和最后100个数组元素。此标帜在您只想打印大型数组的一部分的时候使用。
◦ ARRAYPRINT_ALIGN —— 启用对齐打印值 —— 数字右侧对齐，而行是左侧对齐。
◦ ARRAYPRINT_DATE —— 打印日期时间的格式，以dd.mm.yyyy格式打印日期
◦ ARRAYPRINT_MINUTES —— 打印日期时间的格式，以HH:MM格式打印时间
◦ ARRAYPRINT_SECONDS —— 打印日期时间的格式，以HH:MM:SS格式打印时间</p> <p>返回值</p> <p>没有返回值</p> <p>注意</p> <p>ArrayPrint() 不会将全部结构数组字段打印到日志 —— 跳过数组和对象指针字段。之所以没有打印这些字段(列)只是为了更方便的展示。如果您需要打印结构中的全部字段，您需要按照所需的格式编写您自己的打印函数。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 打印最后10 个柱形图的值 </span>
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyRates</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">ArrayPrint</span><span class="token punctuation">(</span>rates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Check\n[time]\t[open]\t[high]\t[low]\t[close]\t[tick_volume]\t[spread]\t[real_volume]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;[%d]\t%s\t%G\t%G\t%G\t%G\t%G\t%G\t%I64d\t&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span> 
         <span class="token function">TimeToString</span><span class="token punctuation">(</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>time<span class="token punctuation">,</span>TIME_DATE<span class="token operator">|</span>TIME_MINUTES<span class="token operator">|</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">,</span> 
         rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">,</span> 
         rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tick_volume<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>spread<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>real_volume<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;CopyRates failed, error code=%d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 打印示例 </span>
<span class="token comment">/* 
                    [time]  [open]  [high]   [low] [close] [tick_volume] [spread] [real_volume] 
   [0] 2016.11.09 04:00:00 1.11242 1.12314 1.11187 1.12295         18110       10   17300175000 
   [1] 2016.11.09 05:00:00 1.12296 1.12825 1.11930 1.12747         17829        9   15632176000 
   [2] 2016.11.09 06:00:00 1.12747 1.12991 1.12586 1.12744         13458       10    9593492000 
   [3] 2016.11.09 07:00:00 1.12743 1.12763 1.11988 1.12194         15362        9   12352245000 
   [4] 2016.11.09 08:00:00 1.12194 1.12262 1.11058 1.11172         16833        9   12961333000 
   [5] 2016.11.09 09:00:00 1.11173 1.11348 1.10803 1.11052         15933        8   10720384000 
   [6] 2016.11.09 10:00:00 1.11052 1.11065 1.10289 1.10528         11888        9    8084811000 
   [7] 2016.11.09 11:00:00 1.10512 1.11041 1.10472 1.10915          7284       10    5087113000 
   [8] 2016.11.09 12:00:00 1.10915 1.11079 1.10892 1.10904          8710        9    6769629000 
   [9] 2016.11.09 13:00:00 1.10904 1.10913 1.10223 1.10263          8956        7    7192138000 
  检查 
   [time] [open] [high] [low] [close] [tick_volume] [spread] [real_volume] 
   [0] 2016.11.09 04:00:00 1.11242 1.12314 1.11187 1.12295 18110 10 17300175000  
   [1] 2016.11.09 05:00:00 1.12296 1.12825 1.1193 1.12747 17829 9 15632176000  
   [2] 2016.11.09 06:00:00 1.12747 1.12991 1.12586 1.12744 13458 10 9593492000  
   [3] 2016.11.09 07:00:00 1.12743 1.12763 1.11988 1.12194 15362 9 12352245000  
   [4] 2016.11.09 08:00:00 1.12194 1.12262 1.11058 1.11172 16833 9 12961333000  
   [5] 2016.11.09 09:00:00 1.11173 1.11348 1.10803 1.11052 15933 8 10720384000  
   [6] 2016.11.09 10:00:00 1.11052 1.11065 1.10289 1.10528 11888 9 8084811000  
   [7] 2016.11.09 11:00:00 1.10512 1.11041 1.10472 1.10915 7284 10 5087113000  
   [8] 2016.11.09 12:00:00 1.10915 1.11079 1.10892 1.10904 8710 9 6769629000  
   [9] 2016.11.09 13:00:00 1.10904 1.10913 1.10223 1.10263 8956 7 7192138000  
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>相关参考
FileSave, FileLoad</p> <h2 id="_6-13-arrayrange"><a href="#_6-13-arrayrange" class="header-anchor">#</a> 6.13 ArrayRange</h2> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayRange</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>   array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment">// 用于检测的数组 </span>
   <span class="token keyword">int</span>           rank_index    <span class="token comment">// 维数 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 用于检测的数组</p> <p>rank_index</p> <p>[in] 维度的索引编号</p> <p>返回值</p> <p>数组中选择维度中的元素个数。</p> <p>注意</p> <p>由于索引编号是从0开始的，因此数组维度上的元素个数比维度的索引编号大1。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 创建一个四维数组</span>
   <span class="token keyword">double</span> array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置维度零的大小</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打印输出维度</span>
   <span class="token keyword">int</span> temp<span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收i维度大小</span>
      temp<span class="token operator">=</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 打印</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;dim = %d, range = %d&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 结果</span>
<span class="token comment">// dim = 0, range = 10</span>
<span class="token comment">// dim = 1, range = 5</span>
<span class="token comment">// dim = 2, range = 2</span>
<span class="token comment">// dim = 3, range = 4</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="_6-14-arrayresize"><a href="#_6-14-arrayresize" class="header-anchor">#</a> 6.14 ArrayResize</h2> <p>此函数为数组的第一维度创建新的大小</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArrayResize</span><span class="token punctuation">(</span> 
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token comment">// 用于操作的数组 </span>
   <span class="token keyword">int</span>    new_size<span class="token punctuation">,</span>             <span class="token comment">// 新的大小 </span>
   <span class="token keyword">int</span>    reserve_size<span class="token operator">=</span><span class="token number">0</span>        <span class="token comment">// 保留大小 (超额的部分) </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>array[]</p> <p>[out] 用于操作的数组</p> <p>new_size</p> <p>[in] 第一维度新的大小</p> <p>reserve_size=0</p> <p>[in] 分配大小以获取储备。</p> <p>返回值</p> <p>如果成功执行，它将返回数组中包含的所有元素的计数，否则，返回-1，并且数组没有调整大小。</p> <p>如果ArrayResize() 应用于静态数组，时间序列 或 指标缓冲区，数组大小会保持不变 —— 因为这些数组将不会被重新分配。在这种情况下，如果new_size &lt;= ArraySize(数组)，函数将只会返回 new_size；否则将会返回 -1值。</p> <p>注意</p> <p>该函数只能应用在 动态数组。应该注意的是，您不能将此函数应用于SetIndexBuffer()函数绑定为指标缓冲区的 动态数组，期望更改它的大小。对于指标缓冲区，所有调整大小的操作都由终端的运行时(runtime)子系统执行。</p> <p>数组中的元素总数不能超过 2147483647个。 在频繁的内存分配中，建议使用第三个参数来设置一个预留空间来减少物理内存分配的数量。所有后续的ArrayResize调用都不会导致物理内存的重新分配，但只会改变保留内存中第一个数组维度的大小。应该记住，第三个参数只在物理内存分配时使用。例如:</p> <p>ArrayResize(arr,1000,1000);
for(int i=1;i&lt;3000;i++)
ArrayResize(arr,i,1000);</p> <p>在这种情况下，内存将被重新分配两次，在进入2000个元素循环之前(数组的大小将被设置为1000)，并且第二次使用i等于2000。如果我们不设置第三个参数，将会重新分配2000个元素的物理内存，这会减慢程序的运行速度。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序开始函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 计数器</span>
   ulong start<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   ulong now<span class="token punctuation">;</span>
   <span class="token keyword">int</span>   count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 用于快速版本维度的数组</span>
   <span class="token keyword">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查如何加速内存保留工作的变量</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;--- Test Fast: ArrayResize(arr,100000,100000)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">300000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 设置新数组大小指定保存100,000个元素！</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 当到达整十整百的整数时，显示数组大小和花费的时间</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100000</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         now<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         count<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d. ArraySize(arr)=%d Time=%d ms&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>now<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         start<span class="token operator">=</span>now<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 现在显示，无保留内存(即不设置ArrayResize的第三个参数)的版本有多慢</span>
   <span class="token keyword">double</span> slow<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>slow<span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- </span>
   count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   start<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;---- Test Slow: ArrayResize(slow,100000)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">300000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 设置新的数组大小，但是无额外储备内存</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>slow<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 当到达整十整百的整数时，显示数组大小和花费的时间</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>slow<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">100000</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         now<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         count<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d. ArraySize(slow)=%d Time=%d ms&quot;</span><span class="token punctuation">,</span>count<span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>slow<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>now<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         start<span class="token operator">=</span>now<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">//--- 脚本的示例结果</span>
<span class="token comment">/*
   Test_ArrayResize (EURUSD,H1)   --- Test Fast: ArrayResize(arr,100000,100000)
   Test_ArrayResize (EURUSD,H1)   1. ArraySize(arr)=100000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   2. ArraySize(arr)=200000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   3. ArraySize(arr)=300000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   ---- Test Slow: ArrayResize(slow,100000)
   Test_ArrayResize (EURUSD,H1)   1. ArraySize(slow)=100000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   2. ArraySize(slow)=200000 Time=0 ms
   Test_ArrayResize (EURUSD,H1)   3. ArraySize(slow)=300000 Time=228511 ms
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h2 id="_6-15-arraysetasseries"><a href="#_6-15-arraysetasseries" class="header-anchor">#</a> 6.15 ArraySetAsSeries</h2> <p>该函数为选定的一个动态数组的对象设置AS_SERIES标帜，元素将如 时间序列 一样被索引。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// 准备操作的数组 </span>
   <span class="token keyword">bool</span>         flag        <span class="token comment">// true表示倒序索引 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参量</p> <p>array[]</p> <p>[in][out] 准备操作的数组</p> <p>flag</p> <p>[in] 数组索引编号的方向</p> <p>返回值</p> <p>操作成功，返回true，否则返回 false.</p> <p>注意</p> <p>不能为 多维数组 或 静态数组（数组方框中的大小在编译时已经指定了明确的数值）设置 AS_SERIES 标帜。时间序列 中的索引不同于普通数组，时间序列的数组中，元素的索引编号是从后往前排序的(从最新的 到 最早的 数据)。</p> <p>示例：显示K线柱的指标</p> <p><img src="/mql5yao/assets/img/thi28.84e5aa8b.png" alt="Alt text"></p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图表的编号</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Numeration&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  CLR_NONE</span></span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>         NumerationBuffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 自定义缓冲区绘图</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>NumerationBuffer<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为类似 时间序列 的缓冲区设置指标</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>NumerationBuffer<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置数据窗口中显示的精确度</span>
   <span class="token function">IndicatorSetInteger</span><span class="token punctuation">(</span>INDICATOR_DIGITS<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 数组名称的标识符在数据窗口中如何显示</span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span><span class="token string">&quot;Bar #&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标循环函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//---  保存当前打开的零柱时间</span>
   <span class="token keyword">static</span> datetime currentBarTimeOpen<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 返回访问数组时间[] - 像时间序列一样</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果零柱时间不同于已经保存的</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>currentBarTimeOpen<span class="token operator">!=</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
     <span class="token comment">//--- 从当前图表 到 图表最左边 列举所有K线柱</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>rates_total<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span> NumerationBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">;</span>
      currentBarTimeOpen<span class="token operator">=</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 为下次调用返回prev_calculated值</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>相关参考
访问时间序列 ， ArrayGetAsSeries</p> <h2 id="_6-16-arraysize"><a href="#_6-16-arraysize" class="header-anchor">#</a> 6.16 ArraySize</h2> <p>此函数返回所选数组的元素数量</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">ArraySize</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// 检测的数组 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in] 任意类型的数组</p> <p>返回值</p> <p>整数型数值</p> <p>注意</p> <p>一维数组，值可以通过 ArraySize 返回，等于 ArrayRange(array,0)</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 创建数组</span>
   <span class="token keyword">double</span> one_dim<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span> four_dim<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 大小</span>
   <span class="token keyword">int</span> one_dim_size<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> reserve<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> four_dim_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">//--- 辅助变量</span>
   <span class="token keyword">int</span> size<span class="token punctuation">;</span>
<span class="token comment">//--- 分配内存没有预留空间</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>one_dim<span class="token punctuation">,</span>one_dim_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>four_dim<span class="token punctuation">,</span>four_dim_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 1. 一维数组</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;+==========================================================+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Array sizes:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;1. One-dimensional array&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>one_dim<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Zero dimension size = %d, Array size = %d&quot;</span><span class="token punctuation">,</span>one_dim_size<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 2. 多维数组</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;2. Multidimensional array&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>four_dim<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Zero dimension size = %d, Array size = %d&quot;</span><span class="token punctuation">,</span>four_dim_size<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 维度大小</span>
   <span class="token keyword">int</span> d_1<span class="token operator">=</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>four_dim<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> d_2<span class="token operator">=</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>four_dim<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> d_3<span class="token operator">=</span><span class="token function">ArrayRange</span><span class="token punctuation">(</span>four_dim<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Check:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Zero dimension = Array size / (First dimension * Second dimension * Third dimension)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d = %d / (%d * %d * %d)&quot;</span><span class="token punctuation">,</span>size<span class="token operator">/</span><span class="token punctuation">(</span>d_1<span class="token operator">*</span>d_2<span class="token operator">*</span>d_3<span class="token punctuation">)</span><span class="token punctuation">,</span>size<span class="token punctuation">,</span>d_1<span class="token punctuation">,</span>d_2<span class="token punctuation">,</span>d_3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 3. 备份内存的一维数组</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;3. One-dimensional array with memory backup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 双倍的值</span>
   one_dim_size<span class="token operator">*=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//--- 分配预留备份内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>one_dim<span class="token punctuation">,</span>one_dim_size<span class="token punctuation">,</span>reserve<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打印输出大小</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>one_dim<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Size with backup = %d, Actual array size = %d&quot;</span><span class="token punctuation">,</span>one_dim_size<span class="token operator">+</span>reserve<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="_6-17-arraysort"><a href="#_6-17-arraysort" class="header-anchor">#</a> 6.17 ArraySort</h2> <p>按升序排列多维数字数组中的第一个维度中的值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">ArraySort</span><span class="token punctuation">(</span> 
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment">// 数组排序 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>array[]</p> <p>[in][out] 数字数组用于排序</p> <p>返回值</p> <p>排序成功返回TRUE，否则是FALSE。</p> <p>注意</p> <p>数组通过 AS_SERIES 标签建立，并降序排列。</p> <p>注释</p> <p>数组总是按升序排序，而不考虑AS_SERIES标帜。</p> <p>函数ArraySort 和 ArrayBSearch 接受任何维度的数组为参数。然而，搜索和分类却始终应用于第一(0)维度。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The indicator analyzes data for the last month and draws all candlesticks with small&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;and large tick volumes. The tick volume array is sorted out&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;to define such candlesticks. The candlesticks having the volumes comprising the first InpSmallVolume&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;per cent of the array are considered small. The candlesticks having the tick volumes comprising &quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;the last InpBigVolume per cent of the array are considered large.&quot;</span></span>
<span class="token comment">//该指标对上个月的数据进行了分析，并按 报价次数 从小到大绘制了K线柱。K线柱数组被分类，以定义这样的K线。包含该数组中第一个InpSmallVolume的大小的K线柱被认为是小的(包含的报价次数最少)。在该数组中，包含最后一个InpBigVolume百分比的烛台被认为是大的。</span>
<span class="token comment">//--- 指标设置</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//--- 图</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;VolumeFactor&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_CANDLES</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrDodgerBlue<span class="token punctuation">,</span>clrOrange</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">2</span></span></span>
<span class="token comment">//--- 预定义常量</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INDICATOR_EMPTY_VALUE</span> <span class="token expression"><span class="token number">0.0</span></span></span>
<span class="token comment">//--- 输入参数</span>
input <span class="token keyword">int</span> InpSmallVolume<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">;</span> <span class="token comment">// 小型交易量的百分比值 (&lt;50)</span>
input <span class="token keyword">int</span> InpBigVolume<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>   <span class="token comment">// 大型交易量的百分比值 (&lt;50)</span>
<span class="token comment">//--- 分析起始时间 (将会改变)</span>
datetime ExtStartTime<span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓存区</span>
<span class="token keyword">double</span>   ExtOpenBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   ExtHighBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   ExtLowBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   ExtCloseBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   ExtColorBuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 显示蜡烛图的交易量边界值</span>
<span class="token keyword">long</span>     ExtLeftBorder<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">long</span>     ExtRightBorder<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 接收跳动量的边界值                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">bool</span> <span class="token function">GetVolumeBorders</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 变量</span>
   datetime stop_time<span class="token punctuation">;</span>  <span class="token comment">// 复制结束时间</span>
   <span class="token keyword">long</span>     buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// 用于复制的缓冲区</span>
<span class="token comment">//--- 结束时间是当前时间</span>
   stop_time<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 起始时间比当前时间早一个月</span>
   ExtStartTime<span class="token operator">=</span><span class="token function">GetStartTime</span><span class="token punctuation">(</span>stop_time<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收跳动量的值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTickVolume</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Period</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ExtStartTime<span class="token punctuation">,</span>stop_time<span class="token punctuation">,</span>buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收数据失败，返回false启动重新计算的命令</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to receive tick volume values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 计算数组大小</span>
   <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 分类数组</span>
   <span class="token function">ArraySort</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 定义跳动量左侧和右侧的边界值</span>
   ExtLeftBorder<span class="token operator">=</span>buff<span class="token punctuation">[</span>size<span class="token operator">*</span>InpSmallVolume<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   ExtRightBorder<span class="token operator">=</span>buff<span class="token punctuation">[</span><span class="token punctuation">(</span>size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token operator">-</span>InpBigVolume<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 成功执行</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 接收比已过月份少一个月的数据                                         |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
datetime <span class="token function">GetStartTime</span><span class="token punctuation">(</span><span class="token keyword">const</span> datetime stop_time<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 转换结束时间到MqlDateTime类型结构变量</span>
   MqlDateTime temp<span class="token punctuation">;</span>
   <span class="token function">TimeToStruct</span><span class="token punctuation">(</span>stop_time<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收少一个月的数据</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span>mon<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>
      temp<span class="token punctuation">.</span>mon<span class="token operator">-=</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 当前月份不是今年的第一个月，因此之前月份减一</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      temp<span class="token punctuation">.</span>mon<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>  <span class="token comment">// 当前月份是今年的第一个月，因此，前一个月是12月，</span>
      temp<span class="token punctuation">.</span>year<span class="token operator">-=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 而年份数减一</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 天数将不会超过28</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span>day<span class="token operator">&gt;</span><span class="token number">28</span><span class="token punctuation">)</span>
      temp<span class="token punctuation">.</span>day<span class="token operator">=</span><span class="token number">28</span><span class="token punctuation">;</span>
<span class="token comment">//--- 返回获得的日期</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">StructToTime</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 检查是否输入参数满足条件</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>InpSmallVolume<span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">||</span> InpSmallVolume<span class="token operator">&gt;=</span><span class="token number">50</span> <span class="token operator">||</span> InpBigVolume<span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">||</span> InpBigVolume <span class="token operator">&gt;=</span> <span class="token number">50</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Incorrect input parameters&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_PARAMETERS_INCORRECT<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 指标缓冲区映射</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ExtOpenBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>ExtHighBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>ExtLowBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>ExtCloseBuff<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>ExtColorBuff<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置不被显示的值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置指标缓冲区标签</span>
   <span class="token function">PlotIndexSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LABEL<span class="token punctuation">,</span><span class="token string">&quot;Open;High;Low;Close&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 检查未处理的柱形是否仍然存在</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>prev_calculated<span class="token operator">&lt;</span>rates_total<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收交易量右侧和左侧的新边界值</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVolumeBorders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 启动柱形计算的变量</span>
   <span class="token keyword">int</span> start<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>
<span class="token comment">//--- 如果在前一个订单号已经计算指标值，那么使用最近的柱形</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>start<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
      start<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置时间序列的直接标引</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>tick_volume<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 计算指标值的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>start<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 从初始日期填写蜡烛图</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ExtStartTime<span class="token operator">&lt;=</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 如果值不少于右侧边界，则填写蜡烛图</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>tick_volume<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span>ExtRightBorder<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 接收数据绘制蜡烛图</span>
            ExtOpenBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            ExtHighBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            ExtLowBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            ExtCloseBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 闪蓝色</span>
            ExtColorBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 继续循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 如果值不超过左侧边界，则填写蜡烛图</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>tick_volume<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>ExtLeftBorder<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 接收数据绘制蜡烛图</span>
            ExtOpenBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            ExtHighBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            ExtLowBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            ExtCloseBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 桔色</span>
            ExtColorBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 继续循环</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 为计算中不包含的柱设置空值</span>
      ExtOpenBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span>
      ExtHighBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span>
      ExtLowBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span>
      ExtCloseBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>INDICATOR_EMPTY_VALUE<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated的值以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br></div></div><p>相关参考
ArrayBsearch</p> <h2 id="_6-18-arrayswap"><a href="#_6-18-arrayswap" class="header-anchor">#</a> 6.18 ArraySwap</h2> <p>交换相同类型两个动态数组的内容。对于多维数组而言，除了第一个之外，所有维度中的元素数量都应该匹配。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">ArraySwap</span><span class="token punctuation">(</span> 
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment">//第一个数组 </span>
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array2<span class="token punctuation">[</span><span class="token punctuation">]</span>       <span class="token comment">//第二个数组 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>array1[]</p> <p>[in][out] 数值类型的数组。</p> <p>array2[]</p> <p>[in][out] 数值类型的数组。</p> <p>返回值</p> <p>如果成功返回true，否则返回false。在这种情况下，GetLastError()返回ERR_INVALID_ARRAY错误代码。</p> <p>注意</p> <p>该函数会接受相同类型的动态数组和除了第一个维度外的相同维度的数组。对于整数类型，可以忽略符号，例如char==uchar)</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 脚本程序起始函数                                    | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 存储报价的数组 </span>
   <span class="token keyword">double</span> source_array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   dest_array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 获得当前时间周期最新20个蜡烛图的数据 </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token function">CopyRates</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;CopyRates(%s,0,0,20,rates) failed, error=%d&quot;</span><span class="token punctuation">,</span> 
                  <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 为已复制的数据数量设置数组大小 </span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>source_array<span class="token punctuation">,</span>copied<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 使用来自rates[]的数据填写rate_array_1[]数组 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>copied<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>time<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tick_volume<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>spread<span class="token punctuation">;</span> 
      source_array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>real_volume<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 交换source_array[] 和dest_array[]之间的数据 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ArraySwap</span><span class="token punctuation">(</span>source_array<span class="token punctuation">,</span>dest_array<span class="token punctuation">)</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;ArraySwap(source_array,rate_array_2) failed, error code=%d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 确保原数组在交换之后变为零 </span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;ArraySwap() done: ArraySize(source_array)=%d&quot;</span><span class="token punctuation">,</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>source_array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 展示dest_array[]目标数组的数据 </span>
   <span class="token function">ArrayPrint</span><span class="token punctuation">(</span>dest_array<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>另见
ArrayCopy，ArrayFill，ArrayRange，ArrayIsDynamic</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mql5yao/Chapter/five.html" class="prev">
        05 第五章 普通函数
      </a></span> <span class="next"><a href="/mql5yao/Chapter/add1.html">
        07 第add1章 矩阵和向量方法
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mql5yao/assets/js/app.f23448f4.js" defer></script><script src="/mql5yao/assets/js/3.a8269cb7.js" defer></script><script src="/mql5yao/assets/js/13.1e1b93d8.js" defer></script>
  </body>
</html>
