<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能交易*姚 文档站</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mql5yao/favicon.ico">
    <meta name="description" content="这是智能交易的文档站点。">
    <meta name="keywords" content="MQL,EA,智能交易,自动交易,量化,编程,培训">
    
    <link rel="preload" href="/mql5yao/assets/css/0.styles.c167a2d0.css" as="style"><link rel="preload" href="/mql5yao/assets/js/app.33d9106b.js" as="script"><link rel="preload" href="/mql5yao/assets/js/3.64586e1a.js" as="script"><link rel="preload" href="/mql5yao/assets/js/45.9e7cd13e.js" as="script"><link rel="prefetch" href="/mql5yao/assets/js/10.f243be4a.js"><link rel="prefetch" href="/mql5yao/assets/js/11.e4fc3b61.js"><link rel="prefetch" href="/mql5yao/assets/js/12.d2b71f90.js"><link rel="prefetch" href="/mql5yao/assets/js/13.d47c9e61.js"><link rel="prefetch" href="/mql5yao/assets/js/14.59ded2e6.js"><link rel="prefetch" href="/mql5yao/assets/js/15.f2836d3d.js"><link rel="prefetch" href="/mql5yao/assets/js/16.fc4e3f11.js"><link rel="prefetch" href="/mql5yao/assets/js/17.069370d9.js"><link rel="prefetch" href="/mql5yao/assets/js/18.e47908ca.js"><link rel="prefetch" href="/mql5yao/assets/js/19.4e8a369f.js"><link rel="prefetch" href="/mql5yao/assets/js/2.7a050c47.js"><link rel="prefetch" href="/mql5yao/assets/js/20.37e31658.js"><link rel="prefetch" href="/mql5yao/assets/js/21.30dc9524.js"><link rel="prefetch" href="/mql5yao/assets/js/22.bb650486.js"><link rel="prefetch" href="/mql5yao/assets/js/23.84e246fd.js"><link rel="prefetch" href="/mql5yao/assets/js/24.3b441f03.js"><link rel="prefetch" href="/mql5yao/assets/js/25.3ceb7172.js"><link rel="prefetch" href="/mql5yao/assets/js/26.ba703a82.js"><link rel="prefetch" href="/mql5yao/assets/js/27.c0597566.js"><link rel="prefetch" href="/mql5yao/assets/js/28.50413136.js"><link rel="prefetch" href="/mql5yao/assets/js/29.04da6b07.js"><link rel="prefetch" href="/mql5yao/assets/js/30.c8071067.js"><link rel="prefetch" href="/mql5yao/assets/js/31.baace808.js"><link rel="prefetch" href="/mql5yao/assets/js/32.d399c058.js"><link rel="prefetch" href="/mql5yao/assets/js/33.9b2114b8.js"><link rel="prefetch" href="/mql5yao/assets/js/34.d6f49f42.js"><link rel="prefetch" href="/mql5yao/assets/js/35.3620d83f.js"><link rel="prefetch" href="/mql5yao/assets/js/36.e26f547b.js"><link rel="prefetch" href="/mql5yao/assets/js/37.c903bf3b.js"><link rel="prefetch" href="/mql5yao/assets/js/38.2f6e699d.js"><link rel="prefetch" href="/mql5yao/assets/js/39.aca9c106.js"><link rel="prefetch" href="/mql5yao/assets/js/4.21ff370e.js"><link rel="prefetch" href="/mql5yao/assets/js/40.3eb74932.js"><link rel="prefetch" href="/mql5yao/assets/js/41.4f244c9a.js"><link rel="prefetch" href="/mql5yao/assets/js/42.892231ce.js"><link rel="prefetch" href="/mql5yao/assets/js/43.3f173f86.js"><link rel="prefetch" href="/mql5yao/assets/js/44.4e79ffd4.js"><link rel="prefetch" href="/mql5yao/assets/js/46.240ea5cd.js"><link rel="prefetch" href="/mql5yao/assets/js/47.bc498cbd.js"><link rel="prefetch" href="/mql5yao/assets/js/48.752c3ae0.js"><link rel="prefetch" href="/mql5yao/assets/js/5.47d44717.js"><link rel="prefetch" href="/mql5yao/assets/js/6.ee422b91.js"><link rel="prefetch" href="/mql5yao/assets/js/7.b1ec5472.js"><link rel="prefetch" href="/mql5yao/assets/js/8.036d68c0.js"><link rel="prefetch" href="/mql5yao/assets/js/9.4c2d0d8b.js">
    <link rel="stylesheet" href="/mql5yao/assets/css/0.styles.c167a2d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mql5yao/" class="home-link router-link-active"><img src="/mql5yao/logo.png" alt="智能交易*姚 文档站" class="logo"> <span class="site-name can-hide">智能交易*姚 文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MQL5线上手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mql5yao/Chapter/start.html" class="sidebar-link">MQL5 参考</a></li><li><a href="/mql5yao/Chapter/one.html" class="sidebar-link">01 第一章 语言基础</a></li><li><a href="/mql5yao/Chapter/two.html" class="sidebar-link">02 第二章 标准常量，列举和架构</a></li><li><a href="/mql5yao/Chapter/three.html" class="sidebar-link">03 第三章 MQL5程序</a></li><li><a href="/mql5yao/Chapter/four.html" class="sidebar-link">04 第四章 预定义变量</a></li><li><a href="/mql5yao/Chapter/five.html" class="sidebar-link">05 第五章 普通函数</a></li><li><a href="/mql5yao/Chapter/six.html" class="sidebar-link">06 第六章 数组函数</a></li><li><a href="/mql5yao/Chapter/add1.html" class="sidebar-link">07 第add1章 矩阵和向量方法</a></li><li><a href="/mql5yao/Chapter/seven.html" class="sidebar-link">07 第七章 函数转换</a></li><li><a href="/mql5yao/Chapter/eight.html" class="sidebar-link">08 第八章 数学函数</a></li><li><a href="/mql5yao/Chapter/nine.html" class="sidebar-link">09 第九章 字符串函数</a></li><li><a href="/mql5yao/Chapter/ten.html" class="sidebar-link">10 第十章 日期和时间</a></li><li><a href="/mql5yao/Chapter/eleven.html" class="sidebar-link">11 第十一章 账户信息</a></li><li><a href="/mql5yao/Chapter/twelve.html" class="sidebar-link">12 第十二章 检测</a></li><li><a href="/mql5yao/Chapter/thirteen.html" class="sidebar-link">13 第十三章 事件处理</a></li><li><a href="/mql5yao/Chapter/fourteen.html" class="sidebar-link">14 第十四章 市场信息</a></li><li><a href="/mql5yao/Chapter/fifteen.html" class="sidebar-link">15 第十五章 经济日历函数</a></li><li><a href="/mql5yao/Chapter/sixteen.html" class="sidebar-link">16 第十六章 时间序列和指标访问</a></li><li><a href="/mql5yao/Chapter/seventeen.html" class="sidebar-link">17 第十七章 自定义交易品种</a></li><li><a href="/mql5yao/Chapter/eighteen.html" class="sidebar-link">18 第十八章 图表操作</a></li><li><a href="/mql5yao/Chapter/ninteen.html" class="sidebar-link">19 第十九章 交易函数</a></li><li><a href="/mql5yao/Chapter/twenty.html" class="sidebar-link">20 第二十章 交易信号</a></li><li><a href="/mql5yao/Chapter/twentyone.html" class="sidebar-link">21 第二十一章 网络函数</a></li><li><a href="/mql5yao/Chapter/twentytwo.html" class="sidebar-link">22 第二十二章 程序端全局变量</a></li><li><a href="/mql5yao/Chapter/twentythree.html" aria-current="page" class="active sidebar-link">23 第二十三章 文件函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-1-filefindfirst" class="sidebar-link">23.1 FileFindFirst</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-2-filefindnext" class="sidebar-link">23.2 FileFindNext</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-3-filefindclose" class="sidebar-link">23.3 FileFindClose</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-4-fileisexist" class="sidebar-link">23.4 FileIsExist</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-5-fileopen" class="sidebar-link">23.5 FileOpen</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-6-fileclose" class="sidebar-link">23.6 FileClose</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-7-filecopy" class="sidebar-link">23.7 FileCopy</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-8-filedelete" class="sidebar-link">23.8 FileDelete</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-9-filemove" class="sidebar-link">23.9 FileMove</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-10-fileflush" class="sidebar-link">23.10 FileFlush</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-11-filegetinteger" class="sidebar-link">23.11 FileGetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-12-fileisending" class="sidebar-link">23.12 FileIsEnding</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-13-fileislineending" class="sidebar-link">23.13 FileIsLineEnding</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-14-filereadarray" class="sidebar-link">23.14 FileReadArray</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-15-filereadbool" class="sidebar-link">23.15 FileReadBool</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-16-filereaddatetime" class="sidebar-link">23.16 FileReadDatetime</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-17-filereaddouble" class="sidebar-link">23.17 FileReadDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-18-filereadfloat" class="sidebar-link">23.18 FileReadFloat</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-19-filereadinteger" class="sidebar-link">23.19 FileReadInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-20-filereadlong" class="sidebar-link">23.20 FileReadLong</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-21-filereadnumber" class="sidebar-link">23.21 FileReadNumber</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-22-filereadstring" class="sidebar-link">23.22 FileReadString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-23-filereadstruct" class="sidebar-link">23.23 FileReadStruct</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-24-fileseek" class="sidebar-link">23.24 FileSeek</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-25-filesiez" class="sidebar-link">23.25 FileSiez</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-26-filetell" class="sidebar-link">23.26 FileTell</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-27-filewrite" class="sidebar-link">23.27 FileWrite</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-28-filewritearray" class="sidebar-link">23.28 FileWriteArray</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-29-filewritedouble" class="sidebar-link">23.29 FileWriteDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-30-filewritefloat" class="sidebar-link">23.30 FileWriteFloat</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-31-filewriteinteger" class="sidebar-link">23.31 FileWriteInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-32-filewritelong" class="sidebar-link">23.32 FileWriteLong</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-33-filewritestring" class="sidebar-link">23.33 FileWriteString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-34-filewritestruct" class="sidebar-link">23.34 FileWriteStruct</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-35-fileload" class="sidebar-link">23.35 FileLoad</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-36-filesave" class="sidebar-link">23.36 FileSave</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-37-foldercreate" class="sidebar-link">23.37 FolderCreate</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-38-folderdelete" class="sidebar-link">23.38 FolderDelete</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentythree.html#_23-39-folderclean" class="sidebar-link">23.39 FolderClean</a></li></ul></li><li><a href="/mql5yao/Chapter/twentyfour.html" class="sidebar-link">24 第二十四章 自定义指标</a></li><li><a href="/mql5yao/Chapter/twentyfive.html" class="sidebar-link">25 第二十五章 物件函数</a></li><li><a href="/mql5yao/Chapter/twentysix.html" class="sidebar-link">26 第二十六章 技术指标</a></li><li><a href="/mql5yao/Chapter/twentyseven.html" class="sidebar-link">27 第二十七章 处理优化结果</a></li><li><a href="/mql5yao/Chapter/twentyeight.html" class="sidebar-link">28 第二十八章 工作事件</a></li><li><a href="/mql5yao/Chapter/twentynine.html" class="sidebar-link">29 第二十九章 使用OpenCL工作</a></li><li><a href="/mql5yao/Chapter/thirty.html" class="sidebar-link">30 第三十章 使用数据库</a></li><li><a href="/mql5yao/Chapter/thirtyone.html" class="sidebar-link">31 第三十一章 使用DirectX</a></li><li><a href="/mql5yao/Chapter/thirtytwo.html" class="sidebar-link">32 第三十二章 集成</a></li><li><a href="/mql5yao/Chapter/add2.html" class="sidebar-link">32 第add2章 ONNX模型</a></li><li><a href="/mql5yao/Chapter/thirtythree.html" class="sidebar-link">33 第三十三章 标准程序库</a></li><li><a href="/mql5yao/Chapter/AppendixI.html" class="sidebar-link">34 附录一 来自MQL4</a></li><li><a href="/mql5yao/Chapter/AppendixII.html" class="sidebar-link">35 附录二 MQL5 函数列表</a></li><li><a href="/mql5yao/Chapter/AppendixIII.html" class="sidebar-link">36 附录三 MQL5常量列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2> 第二十三章 文件函数</h2> <p>这是一组关于文档工作的函数。</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>这是一组关于文档工作的函数。</p> <p>有两个目录(包含子目录)用于放置工作文档：
• <code>terminal_data_folder\MQL5\FILES\</code> (客户端菜单中点击&quot;文件&quot; <code>--&gt;</code> &quot;打开数据文件夹&quot;)；
• 安装在电脑中所有客户端的共用文件夹 ———— 通常在 <code>C:\Documents and Settings\All Users\Application Data\MetaQuotes\Terminal\Common\Files</code>目录中。</p> <p>这是一组关于文档工作的函数。</p> <p>通过使用TerminalInfoString()函数，以及使用ENUM_TERMINAL_INFO_STRING 表达式，可以在程序中获得这些目录的名称：</p> <p><code>//--- 存储程序端数据的文件夹 string terminal_data_path=TerminalInfoString(TERMINAL_DATA_PATH); //--- 客户端常用文件夹 string common_data_path=TerminalInfoString(TERMINAL_COMMONDATA_PATH);</code>
禁止使用来自其它目录的文件。 文件函数允许使用所谓的“命名管道”。 要做到这一点，只需使用适当的参数调用FileOpen()函数即可。</p> <table><thead><tr><th>函数</th> <th>功能</th></tr></thead> <tbody><tr><td>FileFindFirst</td> <td>根据指定的过滤条件开始搜索目录中的文件(查找)</td></tr> <tr><td>FileFindNext</td> <td>继续通过FileFindFirst()函数启动的搜索(查找下一个)</td></tr> <tr><td>FileFindClose</td> <td>结束搜索程序</td></tr> <tr><td>FileOpen</td> <td>打开指定名称的文件，并且带上 标帜(标帜用于说明打开文件的用途)。</td></tr> <tr><td>FileDelete</td> <td>删除指定文件</td></tr> <tr><td>FileFlush</td> <td>将 输入/输出 文件缓冲区中的所有数据写入磁盘</td></tr> <tr><td>FileGetInteger</td> <td>获得文件的 整数型 属性</td></tr> <tr><td>FileIsEnding</td> <td>读取过程中定义文件末尾</td></tr> <tr><td>FileIsLineEnding</td> <td>读取过程中定义文本行的末尾</td></tr> <tr><td>FileClose</td> <td>关闭之前打开的文件</td></tr> <tr><td>FileIsExist</td> <td>检测文件是否存在</td></tr> <tr><td>FileCopy</td> <td>从本地或者共享文件夹中复制一个原文件到另一个目标文件</td></tr> <tr><td>FileMove</td> <td>移动或者重命名文件</td></tr> <tr><td>FileReadArray</td> <td>从BIN类型文件中读取任何类型的数组，除了字符串外</td></tr> <tr><td>FileReadBool</td> <td>从CSV类型的文件中的当前位置读取一个字符串，<br>直到遇到分隔符(或直到文本行的末尾)为止，<br>并将读取的字符串转换为bool类型的值</td></tr> <tr><td>FileReadDatetime</td> <td>从CSV文件中读取一种格式的字符串：<br>“YYYY.MM.DD HH:MM:SS”，<br>“YYYY.MM.DD”<br>或“HH:MM:SS”<br>---- 并将其转换为 日期时间值</td></tr> <tr><td>FileReadDouble</td> <td>从文件指针当前位置读取 双精度值</td></tr> <tr><td>FileReadFloat</td> <td>从文件指针当前位置读取 浮点值</td></tr> <tr><td>FileReadInteger</td> <td>从文件指针当前位置读取 整型，短整型或者字符型值</td></tr> <tr><td>FileReadLong</td> <td>从文件指针当前位置读取 长整型值</td></tr> <tr><td>FileReadNumber</td> <td>从CSV类型的文件中的当前位置读取一个字符串，<br>直到遇到分隔符(或直到文本行的末尾)为止，<br>并将读取的字符串转换为 双精度值</td></tr> <tr><td>FileReadString</td> <td>在文件中文件指针当前位置读取 字符串</td></tr> <tr><td>FileReadStruct</td> <td>从二进制文件中，文件指针的当前位置，开始读取数据，作为形式参数传递给结构</td></tr> <tr><td>FileSeek</td> <td>根据指定的字节数，移动文件指针的位置到相对位置</td></tr> <tr><td>FileSize</td> <td>返回相应打开文件大小</td></tr> <tr><td>FileTell</td> <td>返回相应打开文件的文件指针的当前位置</td></tr> <tr><td>FileWrite</td> <td>向CSV或者TXT类型文件写入数据</td></tr> <tr><td>FileWriteArray</td> <td>写入任何类型的数组到BIN类型文件，除字符串以外</td></tr> <tr><td>FileWriteDouble</td> <td>从文件指针当前位置写入 双精度型值 到二进制文件</td></tr> <tr><td>FileWriteFloat</td> <td>从文件指针当前位置写入 浮点型值 到二进制文件</td></tr> <tr><td>FileWriteInteger</td> <td>从文件指针当前位置写入 整型值 到二进制文件</td></tr> <tr><td>FileWriteLong</td> <td>从文件指针当前位置写入 长整型值 到二进制文件</td></tr> <tr><td>FileWriteString</td> <td>从文件指针当前位置写入 字符串参数值 到BIN或者TXT文件</td></tr> <tr><td>FileWriteStruct</td> <td>从文件指针当前位置写入 传递到结构的参数 到二进制文件</td></tr> <tr><td>FileLoad</td> <td>将指定二进制文件的所有数据读取到 数组类型 或 简单结构的传递数组中</td></tr> <tr><td>FileSave</td> <td>将传递数组所有元素写入二进制文件作为参数</td></tr> <tr><td>FolderCreate</td> <td>在文件目录创建一个文件夹</td></tr> <tr><td>FolderDelete</td> <td>删除选定的目录。如果文件夹不是空的，那么无法删除。</td></tr> <tr><td>FolderClean</td> <td>删除指定文件夹中所有文件</td></tr></tbody></table> <p>使用FileOpen()打开文件时，在路径中指定的所有子文件夹都会自动创建(如果没有的话)。</p> <h2 id="_23-1-filefindfirst"><a href="#_23-1-filefindfirst" class="header-anchor">#</a> 23.1 FileFindFirst</h2> <p>此函数根据指定的过滤条件开始搜索文件夹中(包含子文件夹)的文件(查找文件)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">FileFindFirst</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> string   file_filter<span class="token punctuation">,</span>          <span class="token comment">// 字符串 - 搜寻过滤器 </span>
   string<span class="token operator">&amp;</span>        returned_filename<span class="token punctuation">,</span>    <span class="token comment">// 找到的文件名或子目录名 </span>
   <span class="token keyword">int</span>            common_flag<span class="token operator">=</span><span class="token number">0</span>         <span class="token comment">// 定义搜索 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_filter</p> <p>[in] 搜索过滤条件。与\Files 目录相关联的子目录(或者嵌套子目录的序列)，需要寻找文件的地方，指定在过滤条件中。</p> <p>returned_filename</p> <p>[out] 返回参数，这里，如果成功，则此变量中保存的是第一个找到的文件或子目录名称。仅返回文件名(包括扩展名)，无论它们是否在搜索过滤条件中指定，都不会包括目录和子目录名称。</p> <p>common_flag</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>返回被搜索对象的句柄，它应该用于通过FileFindNext()函数进一步分类文件和子目录，返回搜索物件的句柄，它应该用于在没有关于过滤器的文件和子目录时（尤其是目录为空时），通过函数或INVALID_HANDLE进一步分类文件和子目录。搜索之后，句柄必须使用FileFindClose()函数来关闭。</p> <p>返回搜索对象的句柄，当没有与过滤条件相符合的文件和子目录时(在特定情况下 ---- 当目录为空时)，应该用FileFindNext()函数 或 INVALID_HANDLE进一步对文件和子目录进行排序。 搜索后，必须使用FileFindClose()函数关闭句柄。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 显示启动脚本时的导入参量的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 过滤条件</span>
input string InpFilter<span class="token operator">=</span><span class="token string">&quot;Dir1\\*&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序开始函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string file_name<span class="token punctuation">;</span>
   string int_dir<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>    i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>pos<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>last_pos<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">//--- 搜索最后一个反斜杠</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">IsStopped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      pos<span class="token operator">=</span><span class="token function">StringFind</span><span class="token punctuation">(</span>InpFilter<span class="token punctuation">,</span><span class="token string">&quot;\\&quot;</span><span class="token punctuation">,</span>pos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>pos<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
         last_pos<span class="token operator">=</span>pos<span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token keyword">break</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 过滤器包含文件夹名称</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>last_pos<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
      int_dir<span class="token operator">=</span><span class="token function">StringSubstr</span><span class="token punctuation">(</span>InpFilter<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>last_pos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 获得搜索句柄在本地文件夹的根目录</span>
   <span class="token keyword">long</span> search_handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>InpFilter<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查 FileFindFirst() 是否成功执行</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>search_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 检查循环中传递的字符串是否是文件或目录名称</span>
      <span class="token keyword">do</span>
        <span class="token punctuation">{</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果这是一个文件，函数返回true，如果是目录，它返回错误 ERR_FILE_IS_DIRECTORY</span>
         <span class="token function">FileIsExist</span><span class="token punctuation">(</span>int_dir<span class="token operator">+</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d : %s name = %s&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>ERR_FILE_IS_DIRECTORY <span class="token operator">?</span> <span class="token string">&quot;Directory&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭搜索句柄</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Files not found!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>相关参考
FileFindNext， FileFindClose</p> <h2 id="_23-2-filefindnext"><a href="#_23-2-filefindnext" class="header-anchor">#</a> 23.2 FileFindNext</h2> <p>继续通过FileFindFirst()函数启动的搜索条件(查找下一个)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileFindNext</span><span class="token punctuation">(</span> 
   <span class="token keyword">long</span>      search_handle<span class="token punctuation">,</span>         <span class="token comment">// 搜索处理程序 </span>
   string<span class="token operator">&amp;</span>   returned_filename      <span class="token comment">// 找到的文件或子目录的名称 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>search_handle [in]</p> <p>搜索处理，通过 FileFindFirst()恢复。</p> <p>returned_filename [out]</p> <p>找到的下一个文件或子目录名称。仅返回文件名(包括扩展名)，无论它们是否在搜索过滤条件中指定，都不会包括目录和子目录名称。 返回值 如果成功，返回true值，否则返回false值。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 过滤条件</span>
input string InpFilter<span class="token operator">=</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动开始                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string file_name<span class="token punctuation">;</span>
   <span class="token keyword">int</span>    i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在本地文件夹根目录下接收搜索句柄</span>
   <span class="token keyword">long</span> search_handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>InpFilter<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查FileFindFirst()函数是否成功执行</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>search_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 检查循环中传递的字符串是否是文件或目录名称</span>
      <span class="token keyword">do</span>
        <span class="token punctuation">{</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果是文件，函数将返回true，如果是目录，函数将生成错误ERR_FILE_IS_DIRECTORY。 </span>
         <span class="token function">FileIsExist</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d : %s name = %s&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>ERR_FILE_IS_DIRECTORY <span class="token operator">?</span> <span class="token string">&quot;Directory&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭搜索句柄</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Files not found!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>相关参考
FileFindFirst， FileFindClose</p> <h2 id="_23-3-filefindclose"><a href="#_23-3-filefindclose" class="header-anchor">#</a> 23.3 FileFindClose</h2> <p>此函数关闭搜索处理。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">FileFindClose</span><span class="token punctuation">(</span> 
   <span class="token keyword">long</span>  search_handle      <span class="token comment">//  搜索处理程序 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>search_handle</p> <p>[in] 通过 FileFindFirst()启动的搜索处理。</p> <p>返回值</p> <p>无返回值。</p> <p>注意</p> <p>必须调用函数来释放系统资源。</p> <p>示例:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时启动输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 过滤条件</span>
input string InpFilter<span class="token operator">=</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string file_name<span class="token punctuation">;</span>
   <span class="token keyword">int</span>    i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在本地文件夹根目录下接收搜索句柄</span>
   <span class="token keyword">long</span> search_handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>InpFilter<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查FileFindFirst()函数是否成功执行</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>search_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 检查循环中传递的字符串是否是文件或目录名称</span>
      <span class="token keyword">do</span>
        <span class="token punctuation">{</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果是文件，函数将返回true，如果是目录，函数将生成错误5018。</span>
         <span class="token function">FileIsExist</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d : %s name = %s&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">5018</span> <span class="token operator">?</span> <span class="token string">&quot;Directory&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;File&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         i<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭搜索句柄</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Files not found!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>相关参考
FileFindFirst, FileFindNext</p> <h2 id="_23-4-fileisexist"><a href="#_23-4-fileisexist" class="header-anchor">#</a> 23.4 FileIsExist</h2> <p>检测文件是否存在。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileIsExist</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> string  file_name<span class="token punctuation">,</span>       <span class="token comment">// 文件名 </span>
   <span class="token keyword">int</span>           common_flag<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment">// 搜索区 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_name</p> <p>[in] 被检测的文件名</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>如果指定文件存在返回true值。</p> <p>注意</p> <p>检测的文件可能是一个子文件夹目录。这种情况下，FileIsExist()函数将返回false，_LastError变量将会记录错误5018 - &quot;这是一个目录，而不是文件&quot; (请见FileFindFirst 函数示例)。</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files，否则函数在客户端的数据文件夹中寻找文件 (MQL5 \ Files 或 MQL5 \ Tester \ Files 在本例的测试中)。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 旧文件的日期</span>
input datetime InpFilesDate<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string   file_name<span class="token punctuation">;</span>      <span class="token comment">// 存储文件名称的变量</span>
   string   filter<span class="token operator">=</span><span class="token string">&quot;*.txt&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 搜索文件的过滤器</span>
   datetime create_date<span class="token punctuation">;</span>    <span class="token comment">// 文件创建日期</span>
   string   files<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 文件名称列表</span>
   <span class="token keyword">int</span>      def_size<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span>    <span class="token comment">// 默认数组大小</span>
   <span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">// 文件名称</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在本地文件夹根目录下接收搜索句柄</span>
   <span class="token keyword">long</span> search_handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查FileFindFirst()函数是否成功执行</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>search_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 在循环中搜索文件</span>
      <span class="token keyword">do</span>
        <span class="token punctuation">{</span>
         files<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span>file_name<span class="token punctuation">;</span>
         <span class="token comment">//--- 增加数组大小</span>
         size<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            def_size<span class="token operator">+=</span><span class="token number">25</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 重置错误值</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 接收文件创建日期</span>
         create_date<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">FileGetInteger</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span>FILE_CREATE_DATE<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 检查文件是否是旧的</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>create_date<span class="token operator">&lt;</span>InpFilesDate<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file deleted!&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 删除旧文件</span>
            <span class="token function">FileDelete</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭搜索句柄</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Files not found!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 检查已保留哪些文件</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Results:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileIsExist</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file exists!&quot;</span><span class="token punctuation">,</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file deleted!&quot;</span><span class="token punctuation">,</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>相关参考</p> <p>FileFindFirst</p> <h2 id="_23-5-fileopen"><a href="#_23-5-fileopen" class="header-anchor">#</a> 23.5 FileOpen</h2> <p>打开指定名称的文件，并且带上 标帜(标帜用于说明打开文件的用途)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">FileOpen</span><span class="token punctuation">(</span> 
   string  file_name<span class="token punctuation">,</span>           <span class="token comment">// 文件名 </span>
   <span class="token keyword">int</span>     open_flags<span class="token punctuation">,</span>          <span class="token comment">// 标帜的组合 </span>
   <span class="token keyword">short</span>   delimiter<span class="token operator">=</span><span class="token char">'\t'</span><span class="token punctuation">,</span>      <span class="token comment">// 分隔符 </span>
   uint    codepage<span class="token operator">=</span>CP_ACP      <span class="token comment">// 字符集代码 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>file_name</p> <p>[in] 文件名称可以包括子文件夹，如果文件标帜为 写入(WRITE)，就会创建子文件夹。</p> <p>open_flags</p> <p>[in] 标帜的组合。决定文件的操作方式，标帜的定义如下：
FILE_READ为读取打开
FILE_WRITE 为写入展开
FILE_BIN 二进制读写模式(不转换字符串)
FILE_CSV 打CSV类型文件(所有项目转换成unicode字符串 或 ansi类型，并用分隔符分开)
FILE_TXT 简单的文本文件(与csv相同，但不考虑分隔符)
FILE_ANSI ANSI类型的行(单字节的字符)
FILE_UNICODE UNICODE类型的(双字节字符)
FILE_SHARE_READ 从几个程序共享读取
FILE_SHARE_WRITE 从几个程序共享写入
FILE_COMMON 所有客户端的共同文件夹中的文件位置 \Terminal\Common\Files.</p> <p>delimiter='\t'</p> <p>[in] 在txt或者csv文件中使用的分隔符，如果csv文件没有指定标识符，默认为 table(8个空格)，如果txt文件没有指定标识符，就不使用分隔符。如果分隔符清晰建立成0，不使用分隔符。</p> <p>codepage=CP_ACP</p> <p>[in] 字符编码集，最常使用的是 字符编码集 提供的枚举值常量。</p> <p>返回值</p> <p>如果文件成功打开，函数返回文件的句柄处理，然后访问文件数据，失败则返回 INVALID_HANDLE。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>如果文件应该以特定的编码方式(指定包含 字符编码集 的codepage参数)读取，请确保设置FILE_ANSI标帜。如果没有指定的FILE_ANSI标帜，则文本文件将以Unicode形式读取，而无需进行任何转换。</p> <p>文件在客户端子文件夹 MQL5\Files(或 testing_agent_directory\MQL5\Files)中打开，如果指定了FILE_COMMON标帜，则文件在所有客户端的共同文件中打开。</p> <p>&quot;命名管道&quot;可以根据以下规则打开： • 管道名称 是一个字符串，应该如下所示：&quot;\servername\pipe\pipename&quot;, 这里servername ---- 网络中的服务器名称，而pipename是管道名称。如果管道用在同一个计算机上，服务器名称可以忽略，但有一个点应该被插入以替代它：&quot;\.\pipe\pipename&quot;。尝试连接管道的客户应该知道其名称。</p> <p>• FileFlush() 和 FileSeek() 在从管道读取和写入的顺序操作之间，应该在文件开始时被调用。</p> <p>特殊符号 '' 应该用于显示字符串。因此，'' 应该在MQL5应用程序编写名称时，使用双杠。这意味着上面示例应该显示如下代码：&quot;\\servername\pipe\pipename&quot;。</p> <p>使用 命名管道 的更多信息可以查看文章&quot;通过MetaTrader 5沟通使用命名管道，而非DLLs &quot;</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 启动函数的脚本程序                                                  | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 错误的打开文件方法 </span>
   string terminal_data_path<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   string filename<span class="token operator">=</span>terminal_data_path<span class="token operator">+</span><span class="token string">&quot;\\MQL5\\Files\\&quot;</span><span class="token operator">+</span><span class="token string">&quot;fractals.csv&quot;</span><span class="token punctuation">;</span> 
   <span class="token keyword">int</span> filehandle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>filehandle <span class="token number">0</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open the file by the absolute path &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Error code &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- “文件沙盒效应”中正确的工作方法 </span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   filehandle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span><span class="token string">&quot;fractals.csv&quot;</span><span class="token punctuation">,</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>filehandle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">FileWrite</span><span class="token punctuation">(</span>filehandle<span class="token punctuation">,</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">EnumToString</span><span class="token punctuation">(</span>_Period<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">FileClose</span><span class="token punctuation">(</span>filehandle<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;FileOpen OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Operation FileOpen failed, error &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---在MQL5\Files\中创建附着目录的另一个示例 </span>
   string subfolder<span class="token operator">=</span><span class="token string">&quot;Research&quot;</span><span class="token punctuation">;</span> 
   filehandle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>subfolder<span class="token operator">+</span><span class="token string">&quot;\\fractals.txt&quot;</span><span class="token punctuation">,</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>filehandle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">FileWrite</span><span class="token punctuation">(</span>filehandle<span class="token punctuation">,</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">EnumToString</span><span class="token punctuation">(</span>_Period<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">FileClose</span><span class="token punctuation">(</span>filehandle<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;The file must be created in the folder &quot;</span><span class="token operator">+</span>terminal_data_path<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>subfolder<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File open failed, error &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>相关参考</p> <p>FileFindFirst， 创建文件夹， 打开文件标记</p> <h2 id="_23-6-fileclose"><a href="#_23-6-fileclose" class="header-anchor">#</a> 23.6 FileClose</h2> <p>关闭先前通过 FileOpen() 打开的文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">FileClose</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle      <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数 file_handle [in] 由FileOpen()返回的文件描述符。 返回值 无返回值。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 目录名称</span>
input <span class="token keyword">int</span>    InpEncodingType<span class="token operator">=</span>FILE_ANSI<span class="token punctuation">;</span> <span class="token comment">// ANSI=32 或 UNICODE=64</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打印文件将要使用的路径</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Working %s\\Files\\ folder&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开阅读文件(如果文件不存在，错误将产生)</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_TXT<span class="token operator">|</span>InpEncodingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 打印文件内容</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">FileReadString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error, code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_23-7-filecopy"><a href="#_23-7-filecopy" class="header-anchor">#</a> 23.7 FileCopy</h2> <p>此函数从本地或者共享文件夹中复制一个原始文件到另一个目标文件中。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileCopy</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> string  src_file_name<span class="token punctuation">,</span>     <span class="token comment">// 源文件名称 </span>
   <span class="token keyword">int</span>           common_flag<span class="token punctuation">,</span>       <span class="token comment">// 位置 </span>
   <span class="token keyword">const</span> string  dst_file_name<span class="token punctuation">,</span>     <span class="token comment">// 目标文件名称 </span>
   <span class="token keyword">int</span>           mode_flags         <span class="token comment">// 存取访问模式 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>src_file_name</p> <p>[in] 复制的文件名称。</p> <p>common_flag</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。(例如，common_flag=0)。</p> <p>dst_file_name</p> <p>[in] 结果文件名。</p> <p>mode_flags</p> <p>[in] 存取访问标帜。此参数只包括2个标签：FILE_REWRITE 和/或 FILE_COMMON ---忽略其它标签。如果文件已经存在，但未指定FILE_REWRITE标帜，文件就不能再写入，函数返回错误值。</p> <p>返回值</p> <p>若失败函数返回false。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>如果目标文件已经存在，则将根据mode_flags参数中FILE_REWRITE标帜的可用性进行复制。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpSrc<span class="token operator">=</span><span class="token string">&quot;source.txt&quot;</span><span class="token punctuation">;</span>       <span class="token comment">// 源</span>
input string InpDst<span class="token operator">=</span><span class="token string">&quot;destination.txt&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 复制</span>
input <span class="token keyword">int</span>    InpEncodingType<span class="token operator">=</span>FILE_ANSI<span class="token punctuation">;</span> <span class="token comment">// ANSI=32 或 UNICODE=64</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 显示源内容（它必须存在）</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileDisplay</span><span class="token punctuation">(</span>InpSrc<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查复制文件是否已经存在(可能没有创建)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileDisplay</span><span class="token punctuation">(</span>InpDst<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 复制文件不存在，无FILE_REWRITE标识复制 (正确复制)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileCopy</span><span class="token punctuation">(</span>InpSrc<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDst<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File is copied!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File is not copied!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 复制文件已经存在，尝试无FILE_REWRITE标识复制(不正确复制)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileCopy</span><span class="token punctuation">(</span>InpSrc<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDst<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File is copied!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File is not copied!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- InpDst 文件的内容保持不变</span>
      <span class="token function">FileDisplay</span><span class="token punctuation">(</span>InpDst<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 再次使用FILE_REWRITE标识复制(如果文件存在，正确复制)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileCopy</span><span class="token punctuation">(</span>InpSrc<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDst<span class="token punctuation">,</span>FILE_REWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File is copied!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File is not copied!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收InpSrc文件复制</span>
   <span class="token function">FileDisplay</span><span class="token punctuation">(</span>InpDst<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 阅读文件内容                                                       |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">bool</span> <span class="token function">FileDisplay</span><span class="token punctuation">(</span><span class="token keyword">const</span> string file_name<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_TXT<span class="token operator">|</span>InpEncodingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 在循环中显示文件内容</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;+---------------------+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File name = %s&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">FileReadString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;+---------------------+&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 打开文件失败</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s is not opened, error = %d&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h2 id="_23-8-filedelete"><a href="#_23-8-filedelete" class="header-anchor">#</a> 23.8 FileDelete</h2> <p>在客户端本地文件夹中删除指定文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileDelete</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> string  file_name<span class="token punctuation">,</span>     <span class="token comment">// 要删除的文件名 </span>
   <span class="token keyword">int</span>           common_flag<span class="token operator">=</span><span class="token number">0</span>  <span class="token comment">// 要删除的文件位置 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_name</p> <p>[in] 文件名称。</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>如果失败函数返回 false。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>删除客户端中本地文件夹中的指定文件(MQL5\files or MQL5\tester\files in case of testing). 如果common_flag = FILE_COMMON，函数就会从所有客户端的共用文件中删除文件。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 旧文件的日期</span>
input datetime InpFilesDate<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string   file_name<span class="token punctuation">;</span>      <span class="token comment">// 存储文件名称的变量</span>
   string   filter<span class="token operator">=</span><span class="token string">&quot;*.txt&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 搜索文件的过滤器</span>
   datetime create_date<span class="token punctuation">;</span>    <span class="token comment">// 文件创建日期</span>
   string   files<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 文件名称列表</span>
   <span class="token keyword">int</span>      def_size<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">;</span>    <span class="token comment">// 默认数组大小</span>
   <span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">// 文件名称</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在本地文件夹根目录下接收搜索句柄</span>
   <span class="token keyword">long</span> search_handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查FileFindFirst()函数是否成功执行</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>search_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 在循环中搜索文件</span>
      <span class="token keyword">do</span>
        <span class="token punctuation">{</span>
         files<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span>file_name<span class="token punctuation">;</span>
         <span class="token comment">//--- 增加数组大小</span>
         size<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            def_size<span class="token operator">+=</span><span class="token number">25</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 重置错误值</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 接收文件创建日期</span>
         create_date<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">FileGetInteger</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span>FILE_CREATE_DATE<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 检查文件是否是旧的</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>create_date<span class="token operator">&lt;</span>InpFilesDate<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file deleted!&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 删除旧文件</span>
            <span class="token function">FileDelete</span><span class="token punctuation">(</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭搜索句柄</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Files not found!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 检查已保留哪些文件</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Results:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileIsExist</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file exists!&quot;</span><span class="token punctuation">,</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file deleted!&quot;</span><span class="token punctuation">,</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h2 id="_23-9-filemove"><a href="#_23-9-filemove" class="header-anchor">#</a> 23.9 FileMove</h2> <p>从本地或共用文件夹中移动一个文件到另一个文件夹中。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileMove</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> string  src_file_name<span class="token punctuation">,</span>    <span class="token comment">// 进行移动操作的文件名 </span>
   <span class="token keyword">int</span>           common_flag<span class="token punctuation">,</span>      <span class="token comment">// 位置 </span>
   <span class="token keyword">const</span> string  dst_file_name<span class="token punctuation">,</span>    <span class="token comment">// 目标文件名 </span>
   <span class="token keyword">int</span>           mode_flags        <span class="token comment">// 访问模式 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>src_file_name</p> <p>[in] 移动/重命名的文件名称。</p> <p>common_flag</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>dst_file_name</p> <p>[in] 操作后的文件名称。</p> <p>mode_flags</p> <p>[in] 访问标帜。此参量只包括2个标签：FILE_REWRITE 和/或 FILE_COMMON ----忽略另外标签。如果文件已经存在并且FILE_REWRITE 标帜未指定，文件不会被写入，函数返回false值。</p> <p>返回值</p> <p>如果失败，函数返回false值。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>如果目标文件已经存在，则将根据mode_flags参数中FILE_REWRITE标帜的可用性进行复制。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpSrcName<span class="token operator">=</span><span class="token string">&quot;data.txt&quot;</span><span class="token punctuation">;</span>
input string InpDstName<span class="token operator">=</span><span class="token string">&quot;newdata.txt&quot;</span><span class="token punctuation">;</span>
input string InpSrcDirectory<span class="token operator">=</span><span class="token string">&quot;SomeFolder&quot;</span><span class="token punctuation">;</span>
input string InpDstDirectory<span class="token operator">=</span><span class="token string">&quot;OtherFolder&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string local<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
   string common<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收文件路径</span>
   string src_path<span class="token punctuation">;</span>
   string dst_path<span class="token punctuation">;</span>
   <span class="token function">StringConcatenate</span><span class="token punctuation">(</span>src_path<span class="token punctuation">,</span>InpSrcDirectory<span class="token punctuation">,</span><span class="token string">&quot;//&quot;</span><span class="token punctuation">,</span>InpSrcName<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">StringConcatenate</span><span class="token punctuation">(</span>dst_path<span class="token punctuation">,</span>InpDstDirectory<span class="token punctuation">,</span><span class="token string">&quot;//&quot;</span><span class="token punctuation">,</span>InpDstName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查源文件是否存在（如果不 - 退出）</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileIsExist</span><span class="token punctuation">(</span>src_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file exists in the %s\\Files\\%s folder&quot;</span><span class="token punctuation">,</span>InpSrcName<span class="token punctuation">,</span>local<span class="token punctuation">,</span>InpSrcDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error, %s source file not found&quot;</span><span class="token punctuation">,</span>InpSrcName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 检查结果文件是否已经存在</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileIsExist</span><span class="token punctuation">(</span>dst_path<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file exists in the %s\\Files\\%s folder&quot;</span><span class="token punctuation">,</span>InpDstName<span class="token punctuation">,</span>common<span class="token punctuation">,</span>InpDstDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 如果文件存在，移动应该通过FILE_REWRITE标识来完成</span>
      <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileMove</span><span class="token punctuation">(</span>src_path<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>dst_path<span class="token punctuation">,</span>FILE_COMMON<span class="token operator">|</span>FILE_REWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file moved&quot;</span><span class="token punctuation">,</span>InpSrcName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error! Code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file does not exist in the %s\\Files\\%s folder&quot;</span><span class="token punctuation">,</span>InpDstName<span class="token punctuation">,</span>common<span class="token punctuation">,</span>InpDstDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 如果文件不存在，移动应该无需通过FILE_REWRITE标识来完成</span>
      <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileMove</span><span class="token punctuation">(</span>src_path<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>dst_path<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file moved&quot;</span><span class="token punctuation">,</span>InpSrcName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error! Code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 文件被移动；我们去看看</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileIsExist</span><span class="token punctuation">(</span>dst_path<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">FileIsExist</span><span class="token punctuation">(</span>src_path<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Success!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Error!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>相关参考
FileIsExist</p> <h2 id="_23-10-fileflush"><a href="#_23-10-fileflush" class="header-anchor">#</a> 23.10 FileFlush</h2> <p>将 输入/输出 文件缓冲区中的所有保留数据写入到磁盘中。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">FileFlush</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle      <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回文件描述。</p> <p>返回值</p> <p>没有返回值。</p> <p>注意</p> <p>当在程序中编辑文件时，可能在过一段时间之后才会实际上发现数据已经写入。要即时在文件中保存数据，请使用FileFlush()函数。如果没有使用此函数，则磁盘中还未保存的部分数据，将只会在使用FileClose()函数关闭文件时写入。</p> <p>当写入数据具有特定值时，应使用该函数。应该记住，频繁的函数调用可能会影响程序的运行速度。</p> <p>函数FileFlush ()必须在 读取 和 写入 文件操作之间调用。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 编写的文件名称</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;example.csv&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 写入文件数据</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 调用编写函数</span>
         <span class="token function">FileWrite</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SYMBOL_BID<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SYMBOL_ASK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 每128次迭代时，在磁盘中保存数据</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">&amp;</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">127</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 现在，数据将位于文件并且不会丢失，以防严重的错误。 </span>
            <span class="token function">FileFlush</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;i = %d, OK&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 0.01 秒暂停</span>
         <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error, code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>相关参考
FileClose</p> <h2 id="_23-11-filegetinteger"><a href="#_23-11-filegetinteger" class="header-anchor">#</a> 23.11 FileGetInteger</h2> <p>获得文件的 整数型 属性。该函数有两个变体。</p> <ol><li>通过文件句柄获得属性。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">FileGetInteger</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>                         file_handle<span class="token punctuation">,</span>   <span class="token comment">// 文件句柄 </span>
   ENUM_FILE_PROPERTY_INTEGER  property_id    <span class="token comment">// 属性ID </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>通过文件名称获得属性。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">FileGetInteger</span><span class="token punctuation">(</span> 
   <span class="token keyword">const</span> string                file_name<span class="token punctuation">,</span>            <span class="token comment">// 文件名 </span>
   ENUM_FILE_PROPERTY_INTEGER  property_id<span class="token punctuation">,</span>          <span class="token comment">// 属性 ID </span>
   <span class="token keyword">bool</span>                        common_folder<span class="token operator">=</span><span class="token boolean">false</span>   <span class="token comment">// 文件在本地文件夹查看(false) </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>file_name</p> <p>[in] 文件名。</p> <p>property_id</p> <p>[in] 文件属性ID。取值范围是ENUM_FILE_PROPERTY_INTEGER枚举值之一。如果使用函数的第二种变体，您只能收到以下属性的值：FILE_EXISTS，FILE_CREATE_DATE，FILE_MODIFY_DATE， FILE_ACCESS_DATE 和 FILE_SIZE。</p> <p>common_folder=false</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>属性的值。如果错误，则返回 -1。想要获得错误代码，请使用GetLastError()函数。</p> <p>如果在通过名称获得属性时指定文件夹，函数无论如何都将有5018错误(ERR_MQL_FILE_IS_DIRECTORY)，虽然返回值可能是正确的。</p> <p>注意</p> <p>函数经常改变错误代码。如果成功完成，错误代码重置为NULL。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;data.csv&quot;</span><span class="token punctuation">;</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;SomeFolder&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序起始函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string path<span class="token operator">=</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">;</span>
   <span class="token keyword">long</span>   l<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 打印有关文件的所有信息</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>InpFileName<span class="token punctuation">,</span><span class="token string">&quot; file info:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_EXISTS<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_CREATE_DATE<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_MODIFY_DATE<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_ACCESS_DATE<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_SIZE<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_POSITION<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_END<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_COMMON<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_TEXT<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_BINARY<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_CSV<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_ANSI<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_READABLE<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileInfo</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_WRITABLE<span class="token punctuation">,</span>l<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is not opened, ErrorCode = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 显示文件属性的值                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">FileInfo</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> handle<span class="token punctuation">,</span><span class="token keyword">const</span> ENUM_FILE_PROPERTY_INTEGER id<span class="token punctuation">,</span>
              <span class="token keyword">long</span> l<span class="token punctuation">,</span><span class="token keyword">const</span> string type<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 接收属性值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>l<span class="token operator">=</span><span class="token function">FileGetInteger</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收的值，以正确格式显示</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">StringCompare</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span><span class="token string">&quot;bool&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot; = &quot;</span><span class="token punctuation">,</span>l <span class="token operator">?</span> <span class="token string">&quot;true&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">StringCompare</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span><span class="token string">&quot;date&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot; = &quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">StringCompare</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span><span class="token string">&quot;other&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot; = &quot;</span><span class="token punctuation">,</span>l<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Error, Code = &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>相关参考</p> <p>文件操作， 文件属性</p> <h2 id="_23-12-fileisending"><a href="#_23-12-fileisending" class="header-anchor">#</a> 23.12 FileIsEnding</h2> <p>在读取过程中定义文件的结尾。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileIsEnding</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle      <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>如果在读取或移动文件指针的过程中已达到文件结尾，则函数返回true。</p> <p>注意</p> <p>要定义文件结尾，该函数尝试从这里读取下一个字符串。如果字符串不存在，函数返回true，否则返回false。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 目录名称</span>
input <span class="token keyword">int</span>    InpEncodingType<span class="token operator">=</span>FILE_ANSI<span class="token punctuation">;</span> <span class="token comment">// ANSI=32 或 UNICODE=64</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打印文件将要使用的路径</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Working %s\\Files\\ folder&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件，用于读取(如果文件不存在，错误将产生)</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_TXT<span class="token operator">|</span>InpEncodingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 打印文件内容</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">FileReadString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error, code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_23-13-fileislineending"><a href="#_23-13-fileislineending" class="header-anchor">#</a> 23.13 FileIsLineEnding</h2> <p>在读取文件的过程中定义文本文件中一行的结尾。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileIsLineEnding</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle      <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。。</p> <p>返回值</p> <p>如果读取 txt 文件 或 csv文件过程中到达一行的末尾，返回真值(字符CR-LF)。</p> <p>示例： (此处使用的示例文件，是在执行FileWriteString函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                        Demo_FileIsLineEnding.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                              https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Overbought &amp; Oversold&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_BARS</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span> clrBlue</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">2</span></span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;RSI.csv&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>   open_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   high_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   low_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   color_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 买超变量</span>
<span class="token keyword">int</span>      ovb_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      ovb_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
datetime ovb_time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 卖超变量</span>
<span class="token keyword">int</span>      ovs_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      ovs_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
datetime ovs_time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 默认数组大小的变量</span>
   <span class="token keyword">int</span> ovb_def_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> ovs_def_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>ovb_time<span class="token punctuation">,</span>ovb_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>ovs_time<span class="token punctuation">,</span>ovs_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token operator">|</span>FILE_ANSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> value<span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 读取字符串的第一个值</span>
         value<span class="token operator">=</span><span class="token function">FileReadNumber</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 根据函数结果读取不同的数组</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">&gt;=</span><span class="token number">70</span><span class="token punctuation">)</span>
            <span class="token function">ReadData</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>ovb_time<span class="token punctuation">,</span>ovb_size<span class="token punctuation">,</span>ovb_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">else</span>
            <span class="token function">ReadData</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>ovs_time<span class="token punctuation">,</span>ovs_size<span class="token punctuation">,</span>ovs_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>open_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>high_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>low_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>close_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>color_buff<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 读取文件的字符串数据                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">ReadData</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> file_handle<span class="token punctuation">,</span>datetime <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>size<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>def_size<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">bool</span> flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//--- 读取直至到达字符串或文件的末尾</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsLineEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 读取数量后转变这里</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
         <span class="token function">FileReadNumber</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 存储当前日期</span>
      arr<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadDatetime</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      size<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 必要时增加数组大小</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         def_size<span class="token operator">+=</span><span class="token number">100</span><span class="token punctuation">;</span>
         <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 滑过第一迭代</span>
      flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ovb_ind<span class="token operator">&lt;</span>ovb_size<span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ovb_ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ovb_size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，柱形在超买区域</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>ovb_time<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 0 - 红色</span>
               color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ovb_ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
      <span class="token comment">//--- 检查是否任何数据仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ovs_ind<span class="token operator">&lt;</span>ovs_size<span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ovs_ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ovs_size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，柱形在超卖区域</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>ovs_time<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 1 - 蓝色</span>
               color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ovs_ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| ChartEvent 事件处理程序                                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnChartEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>lparam<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>dparam<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> string <span class="token operator">&amp;</span>sparam
                  <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 根据比例更改指标宽度</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ChartGetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_SCALE<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br></div></div><h2 id="_23-14-filereadarray"><a href="#_23-14-filereadarray" class="header-anchor">#</a> 23.14 FileReadArray</h2> <p>从BIN类型文件中读取任何类型的数组，除了字符串外(可以是一个结构数组，但不包括字符串，和 动态数组)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileReadArray</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>    file_handle<span class="token punctuation">,</span>               <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                   <span class="token comment">// 要记录的数组 </span>
   <span class="token keyword">int</span>    start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>                   <span class="token comment">// 开始编写数组位置 </span>
   <span class="token keyword">int</span>    count<span class="token operator">=</span>WHOLE_ARRAY          <span class="token comment">// 读取计数 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>array[]</p> <p>[out] 用于接收加载数据的数组。</p> <p>start=0</p> <p>[in] 写入数组的开始索引位置。</p> <p>count=WHOLE_ARRAY</p> <p>[in] 读取元素的数量。默认读取整个数组 (count=WHOLE_ARRAY)。</p> <p>返回值</p> <p>读取元素的数量。</p> <p>注意</p> <p>字符串数组只能从TXT类型文件中读取，如果必要的话，函数会尝试增加数组大小。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteArray函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;data.bin&quot;</span><span class="token punctuation">;</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;SomeFolder&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 存储价格数据的结构                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">struct</span> <span class="token class-name">prices</span>
  <span class="token punctuation">{</span>
   datetime          date<span class="token punctuation">;</span> <span class="token comment">// 日期</span>
   <span class="token keyword">double</span>            bid<span class="token punctuation">;</span>  <span class="token comment">// 卖价</span>
   <span class="token keyword">double</span>            ask<span class="token punctuation">;</span>  <span class="token comment">// 买价</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序起始函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 结构数组</span>
   prices arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 文件路径</span>
   string path<span class="token operator">=</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 读取来自数组文件的所有数据</span>
      <span class="token function">FileReadArray</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 接收数组大小</span>
      <span class="token keyword">int</span> size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 打印数组数据</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Date = &quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">,</span><span class="token string">&quot; Bid = &quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>bid<span class="token punctuation">,</span><span class="token string">&quot; Ask = &quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>ask<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Total data = &quot;</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;File open failed, error &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>相关参考</p> <p>变量, FileWriteArray</p> <h2 id="_23-15-filereadbool"><a href="#_23-15-filereadbool" class="header-anchor">#</a> 23.15 FileReadBool</h2> <p>从CSV类型的文件中的当前位置读取一个字符串，直到遇到分隔符(或直到文本行的末尾)为止，并将读取的字符串转换为bool类型的值</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileReadBool</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>按行读取可以设置为“true”，“false”或整数“0”或“1”的符号表示。非零值被转换为逻辑真值。该函数返回转换后的值。</p> <p>示例 (此处使用的示例文件，是在执行FileWrite函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                            Demo_FileReadBool.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">2</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;UpSignal&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_ARROW</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">4</span></span></span>
<span class="token comment">//---- 图 Label2</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label2  </span><span class="token string">&quot;DownSignal&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type2   DRAW_ARROW</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color2  clrRed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style2  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width2  <span class="token number">4</span></span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;MACD.csv&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>      ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">// 指数</span>
<span class="token keyword">double</span>   upbuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// 向上箭头的指标缓冲区</span>
<span class="token keyword">double</span>   downbuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 向下箭头的指标缓冲区</span>
<span class="token keyword">bool</span>     sign_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 信号数组 (true - 买入, false - 卖出)</span>
datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 信号到达时间数组</span>
<span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 信号数组大小</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is open for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，阅读信号的数量</span>
      size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">FileReadNumber</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 为数组分配内存</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>sign_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 信号时间</span>
         time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadDatetime</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 信号价值</span>
         sign_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadBool</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>upbuff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>downbuff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置PLOT_ARROW中绘制的交易品种代码 </span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span><span class="token number">241</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span><span class="token number">242</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      upbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      downbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>time_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 根据信号绘制箭头</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>sign_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                  upbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">else</span>
                  downbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated 值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><p>相关参考
布尔类型, FileWrite</p> <h2 id="_23-16-filereaddatetime"><a href="#_23-16-filereaddatetime" class="header-anchor">#</a> 23.16 FileReadDatetime</h2> <p>从CSV文件中读取一种格式的字符串： “YYYY.MM.DD HH:MM:SS”， “YYYY.MM.DD” 或 “HH:MM:SS” ---- 并将其转换为 日期时间值</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>datetime  <span class="token function">FileReadDatetime</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>日期时间类型 值。</p> <p>示例 (此处使用的示例文件，是在执行FileWrite函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                        Demo_FileReadDateTime.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">2</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;UpSignal&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_ARROW</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">4</span></span></span>
<span class="token comment">//---- 图 Label2</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label2  </span><span class="token string">&quot;DownSignal&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type2   DRAW_ARROW</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color2  clrRed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style2  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width2  <span class="token number">4</span></span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;MACD.csv&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>      ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">// 指数</span>
<span class="token keyword">double</span>   upbuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// 向上箭头的指标缓冲区</span>
<span class="token keyword">double</span>   downbuff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 向下箭头的指标缓冲区</span>
<span class="token keyword">bool</span>     sign_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 信号数组 (true - 买入，false - 卖出)</span>
datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 信号到达时间数组</span>
<span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">// 信号数组大小</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is open for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，阅读信号的数量</span>
      size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">FileReadNumber</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 为数组分配内存</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>sign_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 信号时间</span>
         time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadDatetime</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 信号价值</span>
         sign_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadBool</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>upbuff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>downbuff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 设置PLOT_ARROW中绘制的交易品种代码</span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span><span class="token number">241</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>PLOT_ARROW<span class="token punctuation">,</span><span class="token number">242</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      upbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      downbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>time_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 根据信号绘制箭头</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>sign_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
                  upbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token keyword">else</span>
                  downbuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated 值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><p>相关参考
日期时间类型, 字符串到时间, 时间到字符串, FileWrite</p> <h2 id="_23-17-filereaddouble"><a href="#_23-17-filereaddouble" class="header-anchor">#</a> 23.17 FileReadDouble</h2> <p>从文件指针当前位置读取 双精度值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">double</span>  <span class="token function">FileReadDouble</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle 参数</p> <p>[in] 通过FileOpen()返回的文件描述。。 参数</p> <p>返回值 参数</p> <p>双精度类型值。 参数</p> <p>注意 参数</p> <p>关于错误的更多细节，请调用 GetLastError()。 参数</p> <p>示例 (此处使用的示例文件，是在执行FileWriteDouble函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                          Demo_FileReadDouble.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;MA&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrGreen</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;MA.csv&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>      ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   ma_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>   buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，阅读文件中的数据量</span>
      size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">FileReadDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 为数组分配内存</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>ma_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">FileReadDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         ma_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组和指数为0的指标缓冲区</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>time_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>ma_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated 值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br></div></div><p>相关参考
真实型（双精度型，浮点型）, 字符串到双精度, 双精度到字符串, FileWriteDouble</p> <h2 id="_23-18-filereadfloat"><a href="#_23-18-filereadfloat" class="header-anchor">#</a> 23.18 FileReadFloat</h2> <p>从文件指针当前位置读取单精度 浮点值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">float</span>  <span class="token function">FileReadFloat</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>浮点类型值。</p> <p>注意</p> <p>关于错误的更多细节，请调用 GetLastError()。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteFloat函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                           Demo_FileReadFloat.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;CloseLine&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_LINE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span>clrBlue</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">2</span></span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;Close.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>      ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>   buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   color_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">int</span> def_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>close_buff<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 阅读时间和价格的值</span>
         time_buff<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">FileReadDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         close_buff<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token function">FileReadFloat</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         size<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果超过增加数组大小</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            def_size<span class="token operator">+=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>close_buff<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is read, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组和指标缓冲区</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>color_buff<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 默认为红色</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>time_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 接收价格</span>
               buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 如果当前价格超过之前的价格，为蓝色</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>buff<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                  color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated 值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br></div></div><p>相关参考</p> <p>真实型（双精度型，浮点型）, FileReadDouble, FileWriteFloat</p> <h2 id="_23-19-filereadinteger"><a href="#_23-19-filereadinteger" class="header-anchor">#</a> 23.19 FileReadInteger</h2> <p>从文件指针当前位置读取 整型，短整型或者字符型值，取决于规定字节长度。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">FileReadInteger</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle<span class="token punctuation">,</span>        <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">int</span>  size<span class="token operator">=</span>INT_VALUE      <span class="token comment">// 读取字节的长度 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>size=INT_VALUE</p> <p>[in] 应该读取的字节数(最多4个)。提供相应的常量：CHAR_VALUE = 1，SHORT_VALUE = 2和INT_VALUE = 4，因此函数可以读取字符型(char)，短整型(short) 或 整数型(int)的值。</p> <p>返回值</p> <p>整数型(int)的值。该函数的结果必须明确的(显式)转换为目标类型，即确定为需要读取的数据类型。由于返回了整数型(int)类型的值，因此可以轻松将其转换为任何整数值。文件指针就是被读取的字节数偏移量。</p> <p>注意</p> <p>当读取少于4个字节时，收到的结果总是正的。 如果读取一个或两个字节，则可以通过确定的(显式)转换为 字符型char(1字节) 或 短整型short(2个字节)来确定数字的符号。因为没有相应的基础类型，所以读取三字节数字的符号并不重要。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteInteger函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                         Demo_FileReadInteger.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Trends&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_SECTION</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span></span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;Trend.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>      ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>   buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">int</span> def_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 附加变量</span>
      <span class="token keyword">int</span>    arr_size<span class="token punctuation">;</span>
      uchar  arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 找出多少交易品种用于编写时间</span>
         arr_size<span class="token operator">=</span><span class="token function">FileReadInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>INT_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>arr_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr_size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token function">FileReadInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>CHAR_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 存储时间价值</span>
         time_buff<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">StringToTime</span><span class="token punctuation">(</span><span class="token function">CharArrayToString</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         size<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果超过增加数组大小</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            def_size<span class="token operator">+=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is read, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组和指标缓冲区</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>time_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 接收价格</span>
               buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated 值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br></div></div><p>相关参考
整数到字符串, 字符串到整数, 整数类型, FileWriteInteger</p> <h2 id="_23-20-filereadlong"><a href="#_23-20-filereadlong" class="header-anchor">#</a> 23.20 FileReadLong</h2> <p>从文件指针当前位置读取 长整型值(8字节)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">FileReadLong</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>长整型值。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteLong函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                            Demo_FileReadLong.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Volume&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_LINE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrYellow</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;Volume.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>      ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">long</span>     volume_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>   buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is open for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，阅读文件中的数据量</span>
      size<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">FileReadLong</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 为数组分配内存</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>volume_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">FileReadLong</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         volume_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadLong</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is read, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组和指数为0的指标缓冲区</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>time_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>volume_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p>相关参考</p> <p>整数类型, FileReadInteger, FileWriteLong</p> <h2 id="_23-21-filereadnumber"><a href="#_23-21-filereadnumber" class="header-anchor">#</a> 23.21 FileReadNumber</h2> <p>从CSV类型的文件中的当前位置读取一个字符串，直到遇到分隔符(或直到文本行的末尾)为止，并将读取的字符串转换为 双精度值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">double</span>  <span class="token function">FileReadNumber</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>双精度型值。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteString函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                          Demo_FileReadNumber.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_chart_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Overbought &amp; Oversold&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_COLOR_BARS</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrRed<span class="token punctuation">,</span> clrBlue</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">2</span></span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;RSI.csv&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>   open_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   high_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   low_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>   color_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 超买变量</span>
<span class="token keyword">int</span>      ovb_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      ovb_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
datetime ovb_time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 超卖变量</span>
<span class="token keyword">int</span>      ovs_ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>      ovs_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
datetime ovs_time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 默认数组大小的变量</span>
   <span class="token keyword">int</span> ovb_def_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> ovs_def_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>ovb_time<span class="token punctuation">,</span>ovb_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>ovs_time<span class="token punctuation">,</span>ovs_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token operator">|</span>FILE_ANSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">double</span> value<span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 读取字符串的第一个值</span>
         value<span class="token operator">=</span><span class="token function">FileReadNumber</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 根据函数结果读取不同的数组</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">&gt;=</span><span class="token number">70</span><span class="token punctuation">)</span>
            <span class="token function">ReadData</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>ovb_time<span class="token punctuation">,</span>ovb_size<span class="token punctuation">,</span>ovb_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">else</span>
            <span class="token function">ReadData</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>ovs_time<span class="token punctuation">,</span>ovs_size<span class="token punctuation">,</span>ovs_def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 绑定数组</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>open_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>high_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>low_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>close_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span>color_buff<span class="token punctuation">,</span>INDICATOR_COLOR_INDEX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---- 设置图表上看不到的指标值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 读取文件的字符串数据                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">ReadData</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> file_handle<span class="token punctuation">,</span>datetime <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>size<span class="token punctuation">,</span><span class="token keyword">int</span> <span class="token operator">&amp;</span>def_size<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">bool</span> flag<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token comment">//--- 阅读直至到达字符串或文件的末尾</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsLineEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 阅读数量后转变这里</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
         <span class="token function">FileReadNumber</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 存储当前日期</span>
      arr<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileReadDatetime</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      size<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 必要时增加数组大小</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         def_size<span class="token operator">+=</span><span class="token number">100</span><span class="token punctuation">;</span>
         <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 滑过第一迭代</span>
      flag<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>open<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>high<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>close<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的柱的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ovb_ind<span class="token operator">&lt;</span>ovb_size<span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ovb_ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ovb_size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，柱形在超买区域</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>ovb_time<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 0 - 红色</span>
               color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ovb_ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
      <span class="token comment">//--- 检查是否任何数据仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ovs_ind<span class="token operator">&lt;</span>ovs_size<span class="token punctuation">)</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ovs_ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>ovs_size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，柱形在超卖区域</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>ovs_time<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>open<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>high<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>low<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>close<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 1 - 蓝色</span>
               color_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ovs_ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| ChartEvent 事件处理程序                                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnChartEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>lparam<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>dparam<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> string <span class="token operator">&amp;</span>sparam
                  <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 根据比例更改指标宽度</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ChartGetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CHART_SCALE<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      <span class="token function">PlotIndexSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_LINE_WIDTH<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br></div></div><p>相关参考</p> <p>FileWriteString</p> <h2 id="_23-22-filereadstring"><a href="#_23-22-filereadstring" class="header-anchor">#</a> 23.22 FileReadString</h2> <p>在文件中文件指针当前位置读取 字符串。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string  <span class="token function">FileReadString</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle<span class="token punctuation">,</span>     <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">int</span>  length<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>        <span class="token comment">// 字符串长度 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>length=-1</p> <p>[in] 读取的字符串长度。</p> <p>返回值</p> <p>读取一行(字符串)。</p> <p>注意</p> <p>当从二进制(BIN)文件读取时。必须指定要读取的字符串的长度。从txt文件读取时，不需要指定字符串长度，字符串将从当前位置开始读取，直到遇到换行符“\ r \ n”为止。从csv文件读取时，也不需要指定字符串长度，字符串将从当前位置读到最近的一个 分隔符 或 直到文本字符串结束字符为止。</p> <p>如果打开文件时，使用了 FILE_ANSI 标帜, ,则按行读取将会转换到 同一 字符代码集。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteInteger函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 读取数据的参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;Trend.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token operator">|</span>FILE_ANSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 附加变量</span>
      <span class="token keyword">int</span>    str_size<span class="token punctuation">;</span>
      string str<span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 找出多少交易品种用于编写时间</span>
         str_size<span class="token operator">=</span><span class="token function">FileReadInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>INT_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 读取字符串</span>
         str<span class="token operator">=</span><span class="token function">FileReadString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>str_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 打印字符串</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is read, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>相关参考
字符串类型, 数据转换, FileWriteInteger</p> <h2 id="_23-23-filereadstruct"><a href="#_23-23-filereadstruct" class="header-anchor">#</a> 23.23 FileReadStruct</h2> <p>从二进制文件中，文件指针的当前位置，开始读取数据，作为形式参数传递给结构。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileReadStruct</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          file_handle<span class="token punctuation">,</span>        <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  struct_object<span class="token punctuation">,</span>      <span class="token comment">// 读取的目标结构 </span>
   <span class="token keyword">int</span>          size<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>             <span class="token comment">// 字节中结构大小 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 打开二进制文件的文件描述句柄。</p> <p>struct_object</p> <p>[out] 这个结构的对象。该结构不应该包含字符串，动态数组或虚函数。</p> <p>size=-1</p> <p>[in] 应该读取的字节数。如果未指定大小 或 指定的值 大于 结构定义的大小，则会使用指定结构的大小为准。</p> <p>返回值</p> <p>如果成功，函数返回读取的字节数量，文件指针通过相同的字节数量移动。</p> <p>示例 (此处使用的示例文件，是在执行FileWriteStruct函数示例期间获得的)</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                          Demo_FileReadStruct.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_buffers <span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_plots   <span class="token number">1</span></span></span>
<span class="token comment">//---- 图 Label1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_label1  </span><span class="token string">&quot;Candles&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_type1   DRAW_CANDLES</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_color1  clrOrange</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_style1  STYLE_SOLID</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_width1  <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">indicator_separate_window</span></span>
<span class="token comment">//--- 接收数据的参数</span>
input string  InpFileName<span class="token operator">=</span><span class="token string">&quot;EURUSD.txt&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string  InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 存储蜡烛图数据的结构                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">struct</span> <span class="token class-name">candlesticks</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">double</span>            open<span class="token punctuation">;</span>  <span class="token comment">// 开盘价</span>
   <span class="token keyword">double</span>            close<span class="token punctuation">;</span> <span class="token comment">// 收盘价</span>
   <span class="token keyword">double</span>            high<span class="token punctuation">;</span>  <span class="token comment">// 最高价</span>
   <span class="token keyword">double</span>            low<span class="token punctuation">;</span>   <span class="token comment">// 最低价</span>
   datetime          date<span class="token punctuation">;</span>  <span class="token comment">// 日期</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//--- 指标缓冲区</span>
<span class="token keyword">double</span>       open_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>       close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>       high_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">double</span>       low_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 全局变量</span>
candlesticks cand_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>          size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>          ind<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标初始化函数                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">int</span> default_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>cand_buff<span class="token punctuation">,</span>default_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_BIN<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 读取文件数据</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 编写数组数据</span>
         <span class="token function">FileReadStruct</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>cand_buff<span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         size<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 检查数组是否超过</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>size<span class="token operator">==</span>default_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 增加数组维数</span>
            default_size<span class="token operator">+=</span><span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>cand_buff<span class="token punctuation">,</span>default_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is read, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 指标缓冲区映射</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>open_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>high_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>low_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">SetIndexBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>close_buff<span class="token punctuation">,</span>INDICATOR_DATA<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 空值</span>
   <span class="token function">PlotIndexSetDouble</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>PLOT_EMPTY_VALUE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 自定义指标迭代函数                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnCalculate</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> rates_total<span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> prev_calculated<span class="token punctuation">,</span>
                <span class="token keyword">const</span> datetime <span class="token operator">&amp;</span>time<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>open<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>high<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>low<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>close<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>tick_volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>volume<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>spread<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span> 
   <span class="token function">ArraySetAsSeries</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 还未处理的蜡烛图的循环</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span>prev_calculated<span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rates_total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 默认为0</span>
      open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查任何日期是否仍然存在</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ind<span class="token operator">&lt;</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span>ind<span class="token punctuation">;</span>j<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果日期一致，使用文件的值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span>cand_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>cand_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">;</span>
               close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>cand_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">;</span>
               high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>cand_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">;</span>
               low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>cand_buff<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">;</span>
               <span class="token comment">//--- 增加计数器</span>
               ind<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回prev_calculated 值，以便下次调用</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>rates_total<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br></div></div><p>相关参考</p> <p>结构和类, FileWriteStruct</p> <h2 id="_23-24-fileseek"><a href="#_23-24-fileseek" class="header-anchor">#</a> 23.24 FileSeek</h2> <p>根据指定的字节数，移动文件指针的位置到相对位置。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileSeek</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>                  file_handle<span class="token punctuation">,</span>     <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">long</span>                 offset<span class="token punctuation">,</span>          <span class="token comment">// 字节 </span>
   ENUM_FILE_POSITION   origin           <span class="token comment">// 参考位置 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>offset</p> <p>[in] 字节偏移步长(也许获取负值)。</p> <p>origin</p> <p>[in] 移动的起始点。取值范围是 ENUM_FILE_POSITION枚举值之一。</p> <p>返回值</p> <p>如果成功返回true， 否则false。关于错误的更多细节，请调用 GetLastError()。</p> <p>注意</p> <p>如果FileSeek()函数的执行导致负移位(超出文件的“水平边界”)，则文件指针将被设置到文件开头处。</p> <p>如果指针位置的设置超出文件的“右边界”(大于文件大小)，则下一次写入文件将不会从文件末尾执行，而会从设置的指针位置执行。在这种情况下，将为前一个文件的末尾 和 指针位置设置一个不确定的值。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                                Demo_FileSeek.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                              https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 目录名称</span>
input <span class="token keyword">int</span>    InpEncodingType<span class="token operator">=</span>FILE_ANSI<span class="token punctuation">;</span> <span class="token comment">// ANSI=32 或 UNICODE=64</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 指定生成随机数字的变量值</span>
   _RandomSeed<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 字符串起始点位置的变量</span>
   ulong pos<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>   size<span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_TXT<span class="token operator">|</span>InpEncodingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 接收文件中每个字符串的起始位置</span>
      <span class="token function">GetStringPositions</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 定义文件中的字符串数量</span>
      size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 如果文件没有字符串，则停止</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is empty!&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 随机选择一个字符串数</span>
      <span class="token keyword">int</span> ind<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>size<span class="token punctuation">;</span>
      <span class="token comment">//--- 字符串起始点的转换位置 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileSeek</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>pos<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token boolean">true</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
      <span class="token comment">//--- 阅读和打印ind数字的字符串 </span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;String text with %d number: \&quot;%s\&quot;&quot;</span><span class="token punctuation">,</span>ind<span class="token punctuation">,</span><span class="token function">FileReadString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+-------------------------------------------------------------------------------+</span>
<span class="token comment">//| 函数定义了文件中每个字符串的起始点并在arr数组放置它                                  |</span>
<span class="token comment">//|                                                                               |</span>
<span class="token comment">//+-------------------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">GetStringPositions</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> handle<span class="token punctuation">,</span>ulong <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 默认数组大小</span>
   <span class="token keyword">int</span> def_size<span class="token operator">=</span><span class="token number">127</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 字符串计数器</span>
   <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果这不是文件结尾，那么至少有一个字符串</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileTell</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      i<span class="token operator">++</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 文件为空，退出</span>
<span class="token comment">//--- 根据编码定义字节转换</span>
   <span class="token keyword">int</span> shift<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileGetInteger</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_ANSI<span class="token punctuation">)</span><span class="token punctuation">)</span>
      shift<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      shift<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//--- 通过循环中的字符串</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 阅读字符串</span>
      <span class="token function">FileReadString</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查文件结尾</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 存储下一个字符串的位置</span>
         arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileTell</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token operator">+</span>shift<span class="token punctuation">;</span>
         i<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果超过增加数组大小</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            def_size<span class="token operator">+=</span>def_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
         <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 文件结尾，退出</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 定义数组的实际大小</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><h2 id="_23-25-filesiez"><a href="#_23-25-filesiez" class="header-anchor">#</a> 23.25 FileSiez</h2> <p>函数返回文件字节大小。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ulong  <span class="token function">FileSize</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>整型值。</p> <p>注意</p> <p>关于错误的更多细节，请调用 GetLastError()。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input ulong  InpThresholdSize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>        <span class="token comment">// 千字节的文件门槛大小</span>
input string InpBigFolderName<span class="token operator">=</span><span class="token string">&quot;big&quot;</span><span class="token punctuation">;</span>     <span class="token comment">// 大型文件的文件夹</span>
input string InpSmallFolderName<span class="token operator">=</span><span class="token string">&quot;small&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 小型文件的文件夹</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string   file_name<span class="token punctuation">;</span>      <span class="token comment">// 存储文件名称的变量</span>
   string   filter<span class="token operator">=</span><span class="token string">&quot;*.csv&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 搜索文件的过滤器</span>
   ulong    file_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// 文件的字节大小</span>
   <span class="token keyword">int</span>      size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">// 文件数</span>
<span class="token comment">//--- 打印我们将要使用的文件路径</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Working in %s\\Files\\ folder&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收所有程序端普通文件夹根目录下的搜索程序</span>
   <span class="token keyword">long</span> search_handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>filter<span class="token punctuation">,</span>file_name<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查FileFindFirst()是否成功执行</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>search_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 根据大小循环移动文件</span>
      <span class="token keyword">do</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 打开文件</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_CSV<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 接收文件大小</span>
            file_size<span class="token operator">=</span><span class="token function">FileSize</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 关闭文件</span>
            <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token keyword">else</span>
           <span class="token punctuation">{</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 打印文件大小</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Size of %s file is equal to %d bytes&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">,</span>file_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 定义移动文件的路径</span>
         string path<span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>file_size<span class="token operator">&gt;</span>InpThresholdSize<span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span>
            path<span class="token operator">=</span>InpBigFolderName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>file_name<span class="token punctuation">;</span>
         <span class="token keyword">else</span>
            path<span class="token operator">=</span>InpSmallFolderName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>file_name<span class="token punctuation">;</span>
         <span class="token comment">//--- 移动文件</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileMove</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">,</span>path<span class="token punctuation">,</span>FILE_REWRITE<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is moved&quot;</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">else</span>
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error, code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">,</span>file_name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭搜索程序</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>search_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Files not found!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h2 id="_23-26-filetell"><a href="#_23-26-filetell" class="header-anchor">#</a> 23.26 FileTell</h2> <p>返回相应打开文件的文件指针的当前位置。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ulong  <span class="token function">FileTell</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle    <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>返回值</p> <p>对应从文件开头 到 指针当前位置，以字节数表示。</p> <p>注意</p> <p>关于错误的更多细节，请调用 GetLastError()。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                                Demo_FileTell.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;file.txt&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件名称</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 目录名称</span>
input <span class="token keyword">int</span>    InpEncodingType<span class="token operator">=</span>FILE_ANSI<span class="token punctuation">;</span> <span class="token comment">// ANSI=32 或 UNICODE=64</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 指定生成随机数字的变量值</span>
   _RandomSeed<span class="token operator">=</span><span class="token function">GetTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 字符串起始点位置的变量</span>
   ulong pos<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>   size<span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_TXT<span class="token operator">|</span>InpEncodingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for reading&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 接收文件中每个字符串的起始位置</span>
      <span class="token function">GetStringPositions</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 定义文件中的字符串数量</span>
      size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>size<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 如果文件没有字符串，则停止</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is empty!&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 随机选择一个字符串数</span>
      <span class="token keyword">int</span> ind<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span>size<span class="token punctuation">;</span>
      <span class="token comment">//--- 字符串起始点的转换位置</span>
      <span class="token function">FileSeek</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>pos<span class="token punctuation">[</span>ind<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 阅读和打印ind数字的字符串</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;String text with %d number: \&quot;%s\&quot;&quot;</span><span class="token punctuation">,</span>ind<span class="token punctuation">,</span><span class="token function">FileReadString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+-------------------------------------------------------------------------------+</span>
<span class="token comment">//| 函数定义了文件中每个字符串的起始点并在arr数组放置它                                  |</span>
<span class="token comment">//|                                                                               |</span>
<span class="token comment">//+-------------------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">GetStringPositions</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> handle<span class="token punctuation">,</span>ulong <span class="token operator">&amp;</span>arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 默认数组大小</span>
   <span class="token keyword">int</span> def_size<span class="token operator">=</span><span class="token number">127</span><span class="token punctuation">;</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 字符串计数器</span>
   <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果这不是文件结尾，那么至少有一个字符串</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileTell</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      i<span class="token operator">++</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 文件为空，退出</span>
<span class="token comment">//--- 根据编码定义字节转换</span>
   <span class="token keyword">int</span> shift<span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FileGetInteger</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>FILE_IS_ANSI<span class="token punctuation">)</span><span class="token punctuation">)</span>
      shift<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      shift<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">//--- 通过循环中的字符串</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 阅读字符串</span>
      <span class="token function">FileReadString</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 检查文件结尾</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileIsEnding</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 存储下一个字符串的位置</span>
         arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FileTell</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token operator">+</span>shift<span class="token punctuation">;</span>
         i<span class="token operator">++</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 如果超过增加数组大小</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span>def_size<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            def_size<span class="token operator">+=</span>def_size<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>def_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
         <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// 文件结尾，退出</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 定义数组的实际大小</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br></div></div><h2 id="_23-27-filewrite"><a href="#_23-27-filewrite" class="header-anchor">#</a> 23.27 FileWrite</h2> <p>向CSV或者TXT类型文件写入数据。该函数用于将数据写入CSV文件，分隔符将自动插入，除非其等于0。在写入文件后，会添加行结束字符“\ r \ n”。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWrite</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle<span class="token punctuation">,</span>   <span class="token comment">// 文件句柄 </span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                 <span class="token comment">// 记录参数的列表 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>...</p> <p>[in] 参数表由逗号分开，写入文件中，写入参数的数量最高为63个。</p> <p>返回值</p> <p>写入的字节数。</p> <p>注意</p> <p>数量转换成文本输出（参看Print()函数）。双精度数据以小数点后16位精确度输出，数据以传统或科学模式显示-依据该模式是最紧凑的。浮点型数据以小数点后5位显示，为了以不同精确度输出真实数字或以清晰的指定模式，使用 DoubleToString()。</p> <p>数字将在输出中转换为文本(请参阅Print()函数)。双精度型数据以小数点后16位的精度输出，数据可以按 传统 或 科学形式 显示 ---- 取决于哪种格式更紧凑。浮点类型的数据在小数点后显示5位数字。要以不同的 精度 或 以明确指定的格式 输出实数，请使用DoubleToString()。</p> <p>布尔类型数量以true&quot; 或者 &quot;false&quot;字符串显示，日期时间类型的数字以&quot;YYYY.MM.DD HH:MI:SS&quot;的格式显示。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                               Demo_FileWrite.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string             InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURUSD&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES    InpSymbolPeriod<span class="token operator">=</span>PERIOD_H1<span class="token punctuation">;</span>        <span class="token comment">// 时间帧</span>
input <span class="token keyword">int</span>                InpFastEMAPeriod<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">;</span>              <span class="token comment">// 快速 EMA 周期</span>
input <span class="token keyword">int</span>                InpSlowEMAPeriod<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">;</span>              <span class="token comment">// 慢速 EMA 周期</span>
input <span class="token keyword">int</span>                InpSignalPeriod<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">;</span>                <span class="token comment">// 不同平均周期</span>
input ENUM_APPLIED_PRICE InpAppliedPrice<span class="token operator">=</span>PRICE_CLOSE<span class="token punctuation">;</span>      <span class="token comment">// 价格类型</span>
input datetime           InpDateStart<span class="token operator">=</span>D<span class="token char">'2012.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string             InpFileName<span class="token operator">=</span><span class="token string">&quot;MACD.csv&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 文件名称</span>
input string             InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime date_finish<span class="token punctuation">;</span> <span class="token comment">// 复制结束日期的数据</span>
   <span class="token keyword">bool</span>     sign_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 信号数组 (true - 买入，false - 卖出)</span>
   datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 信号到达时间数组</span>
   <span class="token keyword">int</span>      sign_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 信号数组大小</span>
   <span class="token keyword">double</span>   macd_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 指标值数组</span>
   datetime date_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 指标日期数组</span>
   <span class="token keyword">int</span>      macd_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 指标数组大小</span>
<span class="token comment">//--- 结束时间是当前时间</span>
   date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收 MACD 指标句柄</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> macd_handle<span class="token operator">=</span><span class="token function">iMACD</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpFastEMAPeriod<span class="token punctuation">,</span>InpSlowEMAPeriod<span class="token punctuation">,</span>InpSignalPeriod<span class="token punctuation">,</span>InpAppliedPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>macd_handle<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收指标句柄失败</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error when receiving indicator handle. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 循环直至指标计算所有值</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">BarsCalculated</span><span class="token punctuation">(</span>macd_handle<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂停允许指标计算所有值</span>
<span class="token comment">//--- 复制某段时间周期的指标值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>macd_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>macd_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy indicator values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制相应的指标值时间</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>date_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 释放指标占据的内存</span>
   <span class="token function">IndicatorRelease</span><span class="token punctuation">(</span>macd_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收缓冲区大小</span>
   macd_size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>macd_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 分析数据，保存数组的指标信号</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>sign_buff<span class="token punctuation">,</span>macd_size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">,</span>macd_size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>macd_size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 买入信号</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>macd_buff<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> macd_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         sign_buff<span class="token punctuation">[</span>sign_size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
         time_buff<span class="token punctuation">[</span>sign_size<span class="token punctuation">]</span><span class="token operator">=</span>date_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         sign_size<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 卖出信号</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>macd_buff<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> macd_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         sign_buff<span class="token punctuation">[</span>sign_size<span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
         time_buff<span class="token punctuation">[</span>sign_size<span class="token punctuation">]</span><span class="token operator">=</span>date_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
         sign_size<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 打开编写指标值的文件（如果文件不在，则自动创建）</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，写下信号的数量</span>
      <span class="token function">FileWrite</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>sign_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 写下文件的信号时间和信号值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>sign_size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
         <span class="token function">FileWrite</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>sign_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p>相关参考
注释， 打印， 字符串格式化</p> <h2 id="_23-28-filewritearray"><a href="#_23-28-filewritearray" class="header-anchor">#</a> 23.28 FileWriteArray</h2> <p>写入任何类型的数组到BIN类型文件，除字符串以外(可以是不包含字符串 或 动态数组的结构数组)。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteArray</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          file_handle<span class="token punctuation">,</span>         <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  array<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>             <span class="token comment">// 数组 </span>
   <span class="token keyword">int</span>          start<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// 数组中的开始索引编号 </span>
   <span class="token keyword">int</span>          count<span class="token operator">=</span>WHOLE_ARRAY    <span class="token comment">// 单元号 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>array[]</p> <p>[out] 记录数组。</p> <p>start=0</p> <p>[in] 数组的索引开始位置(第一个记录元素的索引编号)。</p> <p>count=WHOLE_ARRAY</p> <p>[in] 要写入的项目元素数量(WHOLE_ARRAY意味着数组中的全部元素都将被写入文件中)。</p> <p>返回值</p> <p>记录元素项目的总数量。</p> <p>注意</p> <p>字符串数组可以记录在TXT文件中，字符串可以自动以 &quot;\r\n&quot;字节结尾，依据文件的字符代码集类型 ANSI 或者 UNICODE，字符串可以转换成ANSI编码。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                          Demo_FileWriteArray.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 输入参数</span>
input string InpFileName<span class="token operator">=</span><span class="token string">&quot;data.bin&quot;</span><span class="token punctuation">;</span>
input string InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;SomeFolder&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 存储价格数据的结构                                                 |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">struct</span> <span class="token class-name">prices</span>
  <span class="token punctuation">{</span>
   datetime          date<span class="token punctuation">;</span> <span class="token comment">// 日期</span>
   <span class="token keyword">double</span>            bid<span class="token punctuation">;</span>  <span class="token comment">// 买入价</span>
   <span class="token keyword">double</span>            ask<span class="token punctuation">;</span>  <span class="token comment">// 卖出价</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//--- 全局变量</span>
<span class="token keyword">int</span>    count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span>    size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
string path<span class="token operator">=</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">;</span>
prices arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 为数组分配内存</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家去初始化函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 如果计数，编写其余的计数字符串&lt;n</span>
   <span class="token function">WriteData</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家订单号函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 保存数组数据</span>
   arr<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   arr<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>bid<span class="token operator">=</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SYMBOL_BID<span class="token punctuation">)</span><span class="token punctuation">;</span>
   arr<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>ask<span class="token operator">=</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>SYMBOL_ASK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 显示当前数据</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Date = &quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token punctuation">,</span><span class="token string">&quot; Bid = &quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>bid<span class="token punctuation">,</span><span class="token string">&quot; Ask = &quot;</span><span class="token punctuation">,</span>arr<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">.</span>ask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 增加计数器</span>
   count<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果填写数组，向文件写入数据和零</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span>size<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">WriteData</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 向文件写下数组的n元素                                               |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">WriteData</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 打开文件</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 向文件结尾写下数组数据</span>
      <span class="token function">FileSeek</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">FileWriteArray</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>arr<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open the file, error &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br></div></div><p>相关参考
变量 , FileSeek</p> <h2 id="_23-29-filewritedouble"><a href="#_23-29-filewritedouble" class="header-anchor">#</a> 23.29 FileWriteDouble</h2> <p>从文件指针当前位置写入 双精度型值 到二进制文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteDouble</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>     file_handle<span class="token punctuation">,</span>     <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">double</span>  value            <span class="token comment">// 书写值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>value</p> <p>[in] 双精度类型值。</p> <p>返回值</p> <p>如果成功，函数返回写入的字节数(在这种情况下sizeof(double)= 8)。文件指针移动的步长与字节数相同。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                         Demo_FileWriteDouble.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string             InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURJPY&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES    InpSymbolPeriod<span class="token operator">=</span>PERIOD_M15<span class="token punctuation">;</span>       <span class="token comment">// 时间帧</span>
input <span class="token keyword">int</span>                InpMAPeriod<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>                   <span class="token comment">// 平滑期</span>
input <span class="token keyword">int</span>                InpMAShift<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                     <span class="token comment">// 指标变化</span>
input ENUM_MA_METHOD     InpMAMethod<span class="token operator">=</span>MODE_SMA<span class="token punctuation">;</span>             <span class="token comment">// 平滑类型</span>
input ENUM_APPLIED_PRICE InpAppliedPrice<span class="token operator">=</span>PRICE_CLOSE<span class="token punctuation">;</span>      <span class="token comment">// 价格类型</span>
input datetime           InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string             InpFileName<span class="token operator">=</span><span class="token string">&quot;MA.csv&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 文件名称</span>
input string             InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>   ma_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>      size<span class="token punctuation">;</span>
<span class="token comment">//--- 接收 MA 指标句柄</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> ma_handle<span class="token operator">=</span><span class="token function">iMA</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpMAPeriod<span class="token punctuation">,</span>InpMAShift<span class="token punctuation">,</span>InpMAMethod<span class="token punctuation">,</span>InpAppliedPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>ma_handle<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收指标句柄失败</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error when receiving indicator handle. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 循环直至指标计算所有值</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">BarsCalculated</span><span class="token punctuation">(</span>ma_handle<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂停允许指标计算所有值</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Indicator values starting from %s will be written to the file&quot;</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>InpDateStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 复制指标值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>ma_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>ma_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy the indicator values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制相应的柱形到达时间</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>time_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收缓冲区大小</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>ma_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 释放指标占据的内存</span>
   <span class="token function">IndicatorRelease</span><span class="token punctuation">(</span>ma_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开编写指标值的文件（如果文件不在，则自动创建）</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，写下数据样本的大小</span>
      <span class="token function">FileWriteDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 写下文件的指标时间和值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">FileWriteDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">FileWriteDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>ma_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br></div></div><p>相关参考
真实型（双精度型，浮点型）</p> <h2 id="_23-30-filewritefloat"><a href="#_23-30-filewritefloat" class="header-anchor">#</a> 23.30 FileWriteFloat</h2> <p>从文件指针当前位置写入 单精度浮点型(float)值 到二进制文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteFloat</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>    file_handle<span class="token punctuation">,</span>     <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">float</span>  value            <span class="token comment">// 被写入的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述</p> <p>value</p> <p>[in] 浮点类型值。</p> <p>返回值</p> <p>如果成功，函数返回写入的字节数(在这种情况下sizeof(double)= 4)。文件指针移动的步长与字节数相同。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                          Demo_FileWriteFloat.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string          InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURUSD&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES InpSymbolPeriod<span class="token operator">=</span>PERIOD_M15<span class="token punctuation">;</span>       <span class="token comment">// 时间帧</span>
input datetime        InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string          InpFileName<span class="token operator">=</span><span class="token string">&quot;Close.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string          InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>   close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>      size<span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 复制每个柱的收盘价</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyClose</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>close_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy close price values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制每个柱形的时间</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>time_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy the time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收缓冲区大小</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>close_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开编写指标值的文件（如果文件不在，则自动创建） </span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is open for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 写下文件的收盘价时间和值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">FileWriteDouble</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">FileWriteFloat</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>相关参考
真实型（双精度型，浮点型）， FileWriteDouble</p> <h2 id="_23-31-filewriteinteger"><a href="#_23-31-filewriteinteger" class="header-anchor">#</a> 23.31 FileWriteInteger</h2> <p>从文件指针当前位置写入 整型值 到二进制文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteInteger</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  file_handle<span class="token punctuation">,</span>        <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">int</span>  value<span class="token punctuation">,</span>              <span class="token comment">// 被编写值 </span>
   <span class="token keyword">int</span>  size<span class="token operator">=</span>INT_VALUE      <span class="token comment">// 字节大小 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>value</p> <p>[in] 整数值。</p> <p>size = INT_VALUE</p> <p>[in] 可以写入的字节数量(最多包括4字节)。提供类似常量：CHAR_VALUE=1, SHORT_VALUE=2 和 INT_VALUE=4,因此函数可以写入 字符型，无符号字符型，短整型，无符号短整型，整数型 或 无符号整数型的整数值。</p> <p>返回值</p> <p>如果成功，函数返回写入的字节数。文件指针移动的步长与字节数相同。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                        Demo_FileWriteInteger.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string             InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURUSD&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES    InpSymbolPeriod<span class="token operator">=</span>PERIOD_H1<span class="token punctuation">;</span>        <span class="token comment">// 时间帧</span>
input datetime           InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string             InpFileName<span class="token operator">=</span><span class="token string">&quot;Trend.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string             InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>   close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>      size<span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 复制每个柱的收盘价</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyClose</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>close_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy the values of close prices. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制每个柱形的时间</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>time_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收缓冲区大小</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>close_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开编写值的文件（如果文件不在，则自动创建）</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- </span>
      <span class="token keyword">int</span>   up_down<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 趋势标识</span>
      <span class="token keyword">int</span>   arr_size<span class="token punctuation">;</span>  <span class="token comment">// arr 数组大小</span>
      uchar arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// uchar 类型数组</span>
      <span class="token comment">//--- 写下文件的时间值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 比较当前柱和下一柱的收盘价</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span>close_buff<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>up_down<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 使用FileWriteInteger写下文件的日期值</span>
               <span class="token function">StringToCharArray</span><span class="token punctuation">(</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
               arr_size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 首先，写下数组中的交易品种数量</span>
               <span class="token function">FileWriteInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>arr_size<span class="token punctuation">,</span>INT_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 写下交易品种</span>
               <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr_size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
                  <span class="token function">FileWriteInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>CHAR_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 改变趋势标识</span>
               up_down<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
         <span class="token keyword">else</span>
           <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>up_down<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 使用FileWriteInteger写下文件的日期值</span>
               <span class="token function">StringToCharArray</span><span class="token punctuation">(</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
               arr_size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 首先，写下数组中的交易品种数量</span>
               <span class="token function">FileWriteInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>arr_size<span class="token punctuation">,</span>INT_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 写下交易品种</span>
               <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>arr_size<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
                  <span class="token function">FileWriteInteger</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>CHAR_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//--- 改变趋势标识</span>
               up_down<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><p>相关参考</p> <p>整数到字符串， 字符串到整数， 整数类型</p> <h2 id="_23-32-filewritelong"><a href="#_23-32-filewritelong" class="header-anchor">#</a> 23.32 FileWriteLong</h2> <p>从文件指针当前位置写入 长整型值 到二进制文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteLong</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>   file_handle<span class="token punctuation">,</span>     <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">long</span>  value            <span class="token comment">// 被写入的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>value</p> <p>[in] 长整型值。</p> <p>返回值</p> <p>如果成功，函数返回写入的字节数(在这种情况下sizeof(long)= 8)。文件指针移动的步长与字节数相同。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                           Demo_FileWriteLong.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string          InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURUSD&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES InpSymbolPeriod<span class="token operator">=</span>PERIOD_H1<span class="token punctuation">;</span>        <span class="token comment">// 时间帧</span>
input datetime        InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string          InpFileName<span class="token operator">=</span><span class="token string">&quot;Volume.bin&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 文件名称</span>
input string          InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span>     volume_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   datetime time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>      size<span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 复制每个柱的跳动量</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTickVolume</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>volume_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy values of the tick volume. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制每个柱形的时间</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>time_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收缓冲区大小</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>volume_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开编写指标值的文件（如果文件不在，则自动创建）</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_BIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 首先，写下数据样本的大小</span>
      <span class="token function">FileWriteLong</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 写下文件的时间和交易量值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">FileWriteLong</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">FileWriteLong</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>volume_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>相关参考
整数类型， FileWriteInteger</p> <h2 id="_23-33-filewritestring"><a href="#_23-33-filewritestring" class="header-anchor">#</a> 23.33 FileWriteString</h2> <p>从文件指针当前位置写入 字符串参数值 到BIN或者TXT文件。当写入CSV或TXT文件时：如果在一个字符串中出现了'\ n'(LF)，但前一个字符却不是'\ r'(CR)，则在自动在 \ n之前添加缺少的 '\ r'。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteString</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>           file_handle<span class="token punctuation">,</span>    <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">const</span> string  text_string<span class="token punctuation">,</span>    <span class="token comment">// 要编写的字符串 </span>
   <span class="token keyword">int</span>           length<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>       <span class="token comment">// 交易品种数量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>text_string</p> <p>[in] 字符串。</p> <p>length=-1</p> <p>[in] 您想要写入的字符数量。将字符串写入二进制(BIN)文件需要设置此参数。如果未指定大小，则全部末尾没有0的字符串都能被写入。如果指定数值 小于 字符串的长度，则会写入尾部没有0的字符串的一部分。如果指定数值 大于 字符串长度，则该字符串会填充适当数量的0。对于CSV和TXT类型的文件，该参数将被忽略，并且字符串会被完全写入。</p> <p>返回值</p> <p>如果成功，函数返回写入的字节数。文件指针移动的步长与字节数相同。</p> <p>注意</p> <p>当通过FILE_UNICODE 标帜(或者没有 FILE_ANSI标帜)打开写入文件时，写入的字节数量是字符串字节的两倍大。当写入文件以FILE_ANSI标帜打开时，字节写入数量会与字符串字节数量一致。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                         Demo_FileWriteString.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string             InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURUSD&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES    InpSymbolPeriod<span class="token operator">=</span>PERIOD_H1<span class="token punctuation">;</span>        <span class="token comment">// 时间帧</span>
input <span class="token keyword">int</span>                InpMAPeriod<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">;</span>                   <span class="token comment">// MA周期</span>
input ENUM_APPLIED_PRICE InpAppliedPrice<span class="token operator">=</span>PRICE_CLOSE<span class="token punctuation">;</span>      <span class="token comment">// 价格类型</span>
input datetime           InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string             InpFileName<span class="token operator">=</span><span class="token string">&quot;RSI.csv&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 文件名称</span>
input string             InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime date_finish<span class="token punctuation">;</span> <span class="token comment">// 复制结束日期的数据</span>
   <span class="token keyword">double</span>   rsi_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 指标值数组</span>
   datetime date_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 指标日期数组</span>
   <span class="token keyword">int</span>      rsi_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 指标数组大小</span>
<span class="token comment">//--- 结束时间是当前时间</span>
   date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收 RSI 指标句柄</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> rsi_handle<span class="token operator">=</span><span class="token function">iRSI</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpMAPeriod<span class="token punctuation">,</span>InpAppliedPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>rsi_handle<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 接收指标句柄失败</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Error when receiving indicator handle. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 循环直至指标计算所有值</span>
   <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">BarsCalculated</span><span class="token punctuation">(</span>rsi_handle<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 暂停允许指标计算所有值</span>
<span class="token comment">//--- 复制某段时间周期的指标值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyBuffer</span><span class="token punctuation">(</span>rsi_handle<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>rsi_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy indicator values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 复制相应的指标值时间</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>date_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 释放指标占据的内存</span>
   <span class="token function">IndicatorRelease</span><span class="token punctuation">(</span>rsi_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收缓冲区大小</span>
   rsi_size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>rsi_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 打开编写指标值的文件（如果文件不在，则自动创建）</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_CSV<span class="token operator">|</span>FILE_ANSI<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is available for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 准备附加变量</span>
      string str<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">bool</span>   is_formed<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 写下形成超买和超卖区域的日期</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rsi_size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 检查指标值</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>rsi_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;=</span><span class="token number">70</span> <span class="token operator">||</span> rsi_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&lt;=</span><span class="token number">30</span><span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 如果该值是该区域的第一个值</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>is_formed<span class="token punctuation">)</span>
              <span class="token punctuation">{</span>
               <span class="token comment">//--- 添加值和日期</span>
               str<span class="token operator">=</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>rsi_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>date_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
               is_formed<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
               str<span class="token operator">+=</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>rsi_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>date_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//--- 移动到下个循环迭代</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
         <span class="token comment">//--- 检查标识</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>is_formed<span class="token punctuation">)</span>
           <span class="token punctuation">{</span>
            <span class="token comment">//--- 字符串形成，将其写入文件</span>
            <span class="token function">FileWriteString</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>str<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            is_formed<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br></div></div><p>相关参考
字符串类型， 字符串格式化</p> <h2 id="_23-34-filewritestruct"><a href="#_23-34-filewritestruct" class="header-anchor">#</a> 23.34 FileWriteStruct</h2> <p>从文件指针当前位置写入 传递到结构的参数 到二进制文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">FileWriteStruct</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          file_handle<span class="token punctuation">,</span>       <span class="token comment">// 文件句柄 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  struct_object<span class="token punctuation">,</span>     <span class="token comment">// 连接一个物件 </span>
   <span class="token keyword">int</span>          size<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>            <span class="token comment">// 写入字节大小 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_handle</p> <p>[in] 通过FileOpen()返回的文件描述。</p> <p>struct_object</p> <p>[in] 参考这个结构的对象。该结构不应该包含字符串，动态数组或虚函数。</p> <p>size=-1</p> <p>[in] 您想要记录的字节数。如果未指定大小或指定的字节数 大于 结构的大小，则会写入整个结构。</p> <p>返回值</p> <p>如果成功，函数返回写入的字节数。文件指针移动的步长与字节数相同。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                          Demo_FileWiteStruct.mq5 |</span>
<span class="token comment">//|                        Copyright 2013, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2013, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 启动脚本时显示输入参数的窗口</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 接收程序端数据的参数</span>
input string          InpSymbolName<span class="token operator">=</span><span class="token string">&quot;EURUSD&quot;</span><span class="token punctuation">;</span>           <span class="token comment">// 货币组</span>
input ENUM_TIMEFRAMES InpSymbolPeriod<span class="token operator">=</span>PERIOD_H1<span class="token punctuation">;</span>        <span class="token comment">// 时间帧</span>
input datetime        InpDateStart<span class="token operator">=</span>D<span class="token char">'2013.01.01 00:00'</span><span class="token punctuation">;</span> <span class="token comment">// 复制起始日期的数据</span>
<span class="token comment">//--- 编写文件数据的参数</span>
input string          InpFileName<span class="token operator">=</span><span class="token string">&quot;EURUSD.txt&quot;</span><span class="token punctuation">;</span>         <span class="token comment">// 文件名称</span>
input string          InpDirectoryName<span class="token operator">=</span><span class="token string">&quot;Data&quot;</span><span class="token punctuation">;</span>          <span class="token comment">// 目录名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 存储蜡烛图数据的结构                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">struct</span> <span class="token class-name">candlesticks</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">double</span>            open<span class="token punctuation">;</span>  <span class="token comment">// 开盘价</span>
   <span class="token keyword">double</span>            close<span class="token punctuation">;</span> <span class="token comment">// 收盘价</span>
   <span class="token keyword">double</span>            high<span class="token punctuation">;</span>  <span class="token comment">// 最高价</span>
   <span class="token keyword">double</span>            low<span class="token punctuation">;</span>   <span class="token comment">// 最低价</span>
   datetime          date<span class="token punctuation">;</span>  <span class="token comment">// 日期</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   datetime     date_finish<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>          size<span class="token punctuation">;</span>
   datetime     time_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>       open_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>       close_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>       high_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">double</span>       low_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   candlesticks cand_buff<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//--- 重置错误值</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收范围内柱形到达时间</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyTime</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>time_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy time values. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收范围内柱形的最高价</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyHigh</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>high_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy values of high prices. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收范围内柱形的最低价</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyLow</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>low_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy values of low prices. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收范围内柱形的开盘价</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyOpen</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>open_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy values of open prices. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 接收范围内柱形的收盘价</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CopyClose</span><span class="token punctuation">(</span>InpSymbolName<span class="token punctuation">,</span>InpSymbolPeriod<span class="token punctuation">,</span>InpDateStart<span class="token punctuation">,</span>date_finish<span class="token punctuation">,</span>close_buff<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to copy values of close prices. Error code = %d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 定义数组维数</span>
   size<span class="token operator">=</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>time_buff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在结构数组保存所有数据</span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>cand_buff<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      cand_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token operator">=</span>open_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      cand_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token operator">=</span>close_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      cand_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token operator">=</span>high_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      cand_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token operator">=</span>low_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      cand_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>date<span class="token operator">=</span>time_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 
<span class="token comment">//--- 打开用于编写文件结构数组的文件(如果文件不在，则自动创建)</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> file_handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>InpDirectoryName<span class="token operator">+</span><span class="token string">&quot;//&quot;</span><span class="token operator">+</span>InpFileName<span class="token punctuation">,</span>FILE_READ<span class="token operator">|</span>FILE_WRITE<span class="token operator">|</span>FILE_BIN<span class="token operator">|</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>file_handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s file is open for writing&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File path: %s\\Files\\&quot;</span><span class="token punctuation">,</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 准备字节数量的计数器</span>
      uint counter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 写下循环数组值</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>size<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
         counter<span class="token operator">+=</span><span class="token function">FileWriteStruct</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">,</span>cand_buff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d bytes of information is written to %s file&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Total number of bytes: %d * %d * %d = %d, %s&quot;</span><span class="token punctuation">,</span>size<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span>size<span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">,</span>size<span class="token operator">*</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">==</span>counter <span class="token operator">?</span> <span class="token string">&quot;Correct&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 关闭文件</span>
      <span class="token function">FileClose</span><span class="token punctuation">(</span>file_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Data is written, %s file is closed&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open %s file, Error code = %d&quot;</span><span class="token punctuation">,</span>InpFileName<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br></div></div><p>相关参考
结构和类</p> <h2 id="_23-35-fileload"><a href="#_23-35-fileload" class="header-anchor">#</a> 23.35 FileLoad</h2> <p>将指定二进制文件的所有数据读取到 数组类型 或 简单结构的传递数组中。该函数允许您快速的将已知类型的数据读入相应的数组。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileLoad</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          file_name<span class="token punctuation">,</span>         <span class="token comment">// 文件名 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// 数值类型或简单结构的数组 </span>
   <span class="token keyword">int</span>          common_flag<span class="token operator">=</span><span class="token number">0</span>      <span class="token comment">// 在&lt;data_folder&gt;\MQL5\Files\ 默认的搜索文件位置的标帜 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_name</p> <p>[in] 用于读取数据的文件名称。</p> <p>buffer</p> <p>[out] 数值类型 或 简单结构数组。</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>读取的元素数量 或 错误时返回 -1。</p> <p>注意</p> <p>FileLoad()函数从文件中读取数组元素大小的整倍数。假设文件大小为10个字节，并且该函数将数据读入双精度(double)类型的数组(sizeof(double)= 8)。在这种情况下，函数将只读取8个字节，文件末尾的剩余2个字节将被删除，并且函数FileLoad()将返回1(读取1个元素)。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                Demo_FileLoad.mq5 | </span>
<span class="token comment">//|                        Copyright 2016, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2016, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2016, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      bars_to_save<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// Number of bars </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 脚本程序起始函数                                    | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   string  filename<span class="token operator">=</span>_Symbol<span class="token operator">+</span><span class="token string">&quot;_rates.bin&quot;</span><span class="token punctuation">;</span> 
   MqlRates rates<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token function">CopyRates</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>_Period<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bars_to_save<span class="token punctuation">,</span>rates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot; CopyRates(%s) copied %d bars&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span>copied<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//---  报价写入文件 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileSave</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>rates<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">)</span> 
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;FileSave() failed, error=%d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed CopyRates(%s), error=&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 现在阅读这些返回到文件的报价 </span>
   <span class="token function">ArrayFree</span><span class="token punctuation">(</span>rates<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">long</span> count<span class="token operator">=</span><span class="token function">FileLoad</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>rates<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Time\tOpen\tHigh\tLow\tClose\tTick Voulme\tSpread\tReal Volume&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s\t%G\t%G\t%G\t%G\t%I64u\t%d\t%I64u&quot;</span><span class="token punctuation">,</span> 
                     <span class="token function">TimeToString</span><span class="token punctuation">(</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>time<span class="token punctuation">,</span>TIME_DATE<span class="token operator">|</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">,</span> 
                     rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>open<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>high<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>low<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>close<span class="token punctuation">,</span> 
                     rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>tick_volume<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>spread<span class="token punctuation">,</span>rates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>real_volume<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>相关参考
Structures and Classes，FileReadArra，FileReadStruct</p> <h2 id="_23-36-filesave"><a href="#_23-36-filesave" class="header-anchor">#</a> 23.36 FileSave</h2> <p>将传递数组所有元素写入二进制文件作为参数。该函数允许您快速写入数值类型或简单结构的数组为一个字符串。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FileSave</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          file_name<span class="token punctuation">,</span>         <span class="token comment">// 文件名 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  buffer<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// 数值类型或简单结构的数组 </span>
   <span class="token keyword">int</span>          common_flag<span class="token operator">=</span><span class="token number">0</span>      <span class="token comment">// 文件标识，默认文件写入&lt;data_folderɬ\MQL5\Files\ </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>file_name</p> <p>[in] 用于写入数据数组的文件名称。</p> <p>buffer</p> <p>[in] 数值类型或 简单结构数组。</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>如果失败返回false。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//|                                                Demo_FileSave.mq5 | </span>
<span class="token comment">//|                        Copyright 2016, MetaQuotes Software Corp. | </span>
<span class="token comment">//|                                             https://www.mql5.com | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2016, MetaQuotes Software Corp.&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs </span></span>
<span class="token comment">//--- 输入参数 </span>
input <span class="token keyword">int</span>      ticks_to_save<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span> <span class="token comment">// Number of ticks </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 脚本程序起始函数                                    | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   string  filename<span class="token operator">=</span>_Symbol<span class="token operator">+</span><span class="token string">&quot;_ticks.bin&quot;</span><span class="token punctuation">;</span> 
   MqlTick ticks<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
u<span class="token comment">//--- </span>
   <span class="token keyword">int</span> copied<span class="token operator">=</span><span class="token function">CopyTicks</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>ticks<span class="token punctuation">,</span>COPY_TICKS_ALL<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>ticks_to_save<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>copied<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot; CopyTicks(%s) copied %d ticks&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span>copied<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//--- 如果报价历史被同步，错误代码等于零 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> 
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s: Ticks are not synchronized, error=%d&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span>copied<span class="token punctuation">,</span>_LastError<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token comment">//---  报价写入文件 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">FileSave</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>ticks<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">)</span> 
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;FileSave() failed, error=%d&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> 
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed CopyTicks(%s), Error=&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 现在将这些报价读入文件 </span>
   <span class="token function">ArrayFree</span><span class="token punctuation">(</span>ticks<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">long</span> count<span class="token operator">=</span><span class="token function">FileLoad</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>ticks<span class="token punctuation">,</span>FILE_COMMON<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">!=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Time\tBid\tAsk\tLast\tVolume\tms\tflags&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s.%03I64u:\t%G\t%G\t%G\t%I64u\t0x%04x&quot;</span><span class="token punctuation">,</span> 
         <span class="token function">TimeToString</span><span class="token punctuation">(</span>ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>time<span class="token punctuation">,</span>TIME_DATE<span class="token operator">|</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">,</span>ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>time_msc<span class="token operator">%</span><span class="token number">1000</span><span class="token punctuation">,</span> 
         ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>bid<span class="token punctuation">,</span>ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>ask<span class="token punctuation">,</span>ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>last<span class="token punctuation">,</span>ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>volume<span class="token punctuation">,</span>ticks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>flags<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>相关参考
结构 和 类，FileWriteArray，FileWriteStruct</p> <h2 id="_23-37-foldercreate"><a href="#_23-37-foldercreate" class="header-anchor">#</a> 23.37 FolderCreate</h2> <p>在文件夹中创建一个文件夹 (依据 common_flag的值 )。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FolderCreate</span><span class="token punctuation">(</span> 
   string  folder_name<span class="token punctuation">,</span>       <span class="token comment">// 带有新文件夹名的字符串 </span>
   <span class="token keyword">int</span>     common_flag<span class="token operator">=</span><span class="token number">0</span>      <span class="token comment">// 范围 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>folder_name</p> <p>[in] 想要新建的目录文件夹的名称，包括文件夹的全部路径。</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，表示在客户端的 数据文件夹 中。</p> <p>返回值</p> <p>如果成功返回true， 否则返回 false。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                            Demo_FolderCreate.mq5 |</span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 描述</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The script shows a sample use of FolderCreate().&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;An external parameter defines the folder for creating folders.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;After running the script, a structure of folders is created&quot;</span></span>
 
<span class="token comment">//--- 启动脚本时显示输入参数对话框</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数定义脚本运行的文件夹</span>
input <span class="token keyword">bool</span>     common_folder<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 所有程序端的共享文件夹</span>
<span class="token keyword">int</span>            flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>              <span class="token comment">// 标识值决定了运行文件操作的位置 </span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string working_folder<span class="token punctuation">;</span>
<span class="token comment">//--- 设置标识值，如果外部参数common_folder==true</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>common_folder<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      flag<span class="token operator">=</span>FILE_COMMON<span class="token punctuation">;</span>
      <span class="token comment">//--- 找出我们正在工作的文件夹</span>
      working_folder<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_COMMONDATA_PATH<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\MQL5\\Files&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span> working_folder<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\MQL5\\Files&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 将被创建在MQL5\Files文件夹的文件夹</span>
   string root<span class="token operator">=</span><span class="token string">&quot;Folder_A&quot;</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CreateFolder</span><span class="token punctuation">(</span>working_folder<span class="token punctuation">,</span>root<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 在Child_Folder_B1创建子文件夹</span>
      string folder_B1<span class="token operator">=</span><span class="token string">&quot;Child_Folder_B1&quot;</span><span class="token punctuation">;</span>
      string path<span class="token operator">=</span>root<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>folder_B1<span class="token punctuation">;</span>          <span class="token comment">// 基于结构创建文件夹名称</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CreateFolder</span><span class="token punctuation">(</span>working_folder<span class="token punctuation">,</span>path<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token comment">//--- 在该文件夹创建3个子文件夹</span>
         string folder_C11<span class="token operator">=</span><span class="token string">&quot;Child_Folder_C11&quot;</span><span class="token punctuation">;</span>
         string child_path<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>folder_C11<span class="token punctuation">;</span><span class="token comment">// 基于结构创建文件夹名称</span>
         <span class="token function">CreateFolder</span><span class="token punctuation">(</span>working_folder<span class="token punctuation">,</span>child_path<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 第二个子文件夹</span>
         string folder_C12<span class="token operator">=</span><span class="token string">&quot;Child_Folder_C12&quot;</span><span class="token punctuation">;</span>
         child_path<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>folder_C12<span class="token punctuation">;</span>
         <span class="token function">CreateFolder</span><span class="token punctuation">(</span>working_folder<span class="token punctuation">,</span>child_path<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
         <span class="token comment">//--- 第三个子文件夹</span>
         string folder_C13<span class="token operator">=</span><span class="token string">&quot;Child_Folder_C13&quot;</span><span class="token punctuation">;</span>
         child_path<span class="token operator">=</span>path<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>folder_C13<span class="token punctuation">;</span>
         <span class="token function">CreateFolder</span><span class="token punctuation">(</span>working_folder<span class="token punctuation">,</span>child_path<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 试图创建文件夹并显示信息                                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">bool</span> <span class="token function">CreateFolder</span><span class="token punctuation">(</span>string working_folder<span class="token punctuation">,</span>string folder_path<span class="token punctuation">,</span><span class="token keyword">int</span> file_flag<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 调试信息   </span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;folder_path=%s&quot;</span><span class="token punctuation">,</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 试图创建MQL5\Files路径相关的文件夹 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FolderCreate</span><span class="token punctuation">(</span>folder_path<span class="token punctuation">,</span>file_flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 向已创建的文件夹显示整个路径</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Folder %s has been created&quot;</span><span class="token punctuation">,</span>working_folder<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>folder_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 重置错误代码</span>
      <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 返回成功结果</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create folder %s. Error code %d&quot;</span><span class="token punctuation">,</span>working_folder<span class="token operator">+</span>folder_path<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 失败</span>
   <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>相关参考</p> <p>FileOpen(), FolderClean(), FileCopy()</p> <h2 id="_23-38-folderdelete"><a href="#_23-38-folderdelete" class="header-anchor">#</a> 23.38 FolderDelete</h2> <p>删除指定的目录文件夹。如果文件夹不是空的，那么无法删除。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FolderDelete</span><span class="token punctuation">(</span> 
   string  folder_name<span class="token punctuation">,</span>       <span class="token comment">// 带有要删除的文件夹名的字符串 </span>
   <span class="token keyword">int</span>     common_flag<span class="token operator">=</span><span class="token number">0</span>      <span class="token comment">// 范围 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>folder_name</p> <p>[in] 想要删除的目录文件夹名称，包括文件夹的全部路径。</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>如果成功返回true， 否则false。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>如果目录文件夹中至少包含一个文件 和/或 子目录，该目录就不能被删除，必须先清理。使用 FolderClean()函数可以清理文件夹中所有文件或者子目录。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                            Demo_FolderDelete.mq5 |</span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 描述</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The script shows a sample use of FolderDelete().&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;First two folders are created; one of them is empty, the second one contains a file.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;When trying to delete a non-empty folder, an error is returned and a warning is shown.&quot;</span></span>
 
<span class="token comment">//--- 启动脚本时显示输入参数对话框</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string   firstFolder<span class="token operator">=</span><span class="token string">&quot;empty&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// 空文件夹</span>
input string   secondFolder<span class="token operator">=</span><span class="token string">&quot;nonempty&quot;</span><span class="token punctuation">;</span><span class="token comment">// 将会创建文件的文件夹</span>
string filename<span class="token operator">=</span><span class="token string">&quot;delete_me.txt&quot;</span><span class="token punctuation">;</span>       <span class="token comment">// 将在secondFolder文件夹创建的文件名称</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 在这里写下文件句柄</span>
   <span class="token keyword">int</span> handle<span class="token punctuation">;</span>
<span class="token comment">//--- 找出我们正在工作的文件夹</span>
   string working_folder<span class="token operator">=</span><span class="token function">TerminalInfoString</span><span class="token punctuation">(</span>TERMINAL_DATA_PATH<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\MQL5\\Files&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 调试信息   </span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;working_folder=%s&quot;</span><span class="token punctuation">,</span>working_folder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 试图创建MQL5\Files路径相关的空文件夹</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FolderCreate</span><span class="token punctuation">(</span>firstFolder<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0 意味着我们在程序端的本地文件夹工作</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 向已创建的文件夹输入全路径</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Folder %s has been created&quot;</span><span class="token punctuation">,</span>working_folder<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>firstFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 重置错误代码</span>
      <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create folder %s. Error code %d&quot;</span><span class="token punctuation">,</span>working_folder<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>firstFolder<span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//--- 现在使用FileOpen()函数创建一个非空文件夹</span>
   string filepath<span class="token operator">=</span>secondFolder<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>filename<span class="token punctuation">;</span>  <span class="token comment">// 形成我们想要打开写在不存在文件夹中的路径文件</span>
   handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span>FILE_WRITE<span class="token operator">|</span>FILE_TXT<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这种情况下FILE_WRITE标识是必须的，请见Help查询FileOpen</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File %s has been opened for reading&quot;</span><span class="token punctuation">,</span>working_folder<span class="token operator">+</span><span class="token string">&quot;\\&quot;</span><span class="token operator">+</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create file %s in folder %s. Error code=&quot;</span><span class="token punctuation">,</span>filename<span class="token punctuation">,</span>secondFolder<span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
   <span class="token function">Comment</span><span class="token punctuation">(</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Prepare to delete folders %s and %s&quot;</span><span class="token punctuation">,</span> firstFolder<span class="token punctuation">,</span> secondFolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 短暂停顿5秒来阅读图表中的信息</span>
   <span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Sleep() 不能用在指标中！</span>
 
<span class="token comment">//--- 显示询问用户的对话框</span>
   <span class="token keyword">int</span> choice<span class="token operator">=</span><span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Do you want to delete folders %s and %s?&quot;</span><span class="token punctuation">,</span> firstFolder<span class="token punctuation">,</span> secondFolder<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;Deleting folders&quot;</span><span class="token punctuation">,</span>
                         MB_YESNO<span class="token operator">|</span>MB_ICONQUESTION<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  两个按钮 - &quot;Yes&quot; 和 &quot;No&quot;</span>
 
<span class="token comment">//--- 根据选定的变量运行一个行为</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>choice<span class="token operator">==</span>IDYES<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 从图表删除评论</span>
      <span class="token function">Comment</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 添加信息到“专家”日志</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Trying to delete folders %s and %s&quot;</span><span class="token punctuation">,</span>firstFolder<span class="token punctuation">,</span> secondFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 删除空文件夹</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FolderDelete</span><span class="token punctuation">(</span>firstFolder<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token comment">//--- 由于文件夹为空，应该会出现以下信息</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Folder %s has been successfully deleted&quot;</span><span class="token punctuation">,</span>firstFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to delete folder %s. Error code=%d&quot;</span><span class="token punctuation">,</span> firstFolder<span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
      <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 删除包含文件的文件夹 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FolderDelete</span><span class="token punctuation">(</span>secondFolder<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Folder %s has been successfully deleted&quot;</span><span class="token punctuation">,</span> secondFolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token comment">//--- 由于文件夹包含文件，应该会出现下列信息</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to delete folder %s. Error code=%d&quot;</span><span class="token punctuation">,</span> secondFolder<span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Deletion canceled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><p>相关参考
FileOpen(), FolderClean(), FileMove()</p> <h2 id="_23-39-folderclean"><a href="#_23-39-folderclean" class="header-anchor">#</a> 23.39 FolderClean</h2> <p>此函数用于删除指定文件夹中所有文件。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">FolderClean</span><span class="token punctuation">(</span> 
   string  folder_name<span class="token punctuation">,</span>       <span class="token comment">// 带有已删除的文件夹名的字符串 </span>
   <span class="token keyword">int</span>     common_flag<span class="token operator">=</span><span class="token number">0</span>      <span class="token comment">// 范围 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>folder_name</p> <p>[in] 想要删除所有文件的目录文件夹名称，包括文件夹的全部路径。</p> <p>common_flag=0</p> <p>[in] 标帜，决定文件位置，如果common_flag = FILE_COMMON,表示文件在为所有客户端的共用文件夹中 \Terminal\Common\Files。否则，文件放置在客户端的数据文件夹中。</p> <p>返回值</p> <p>如果成功返回true， 否则false。</p> <p>注意</p> <p>出于安全考虑，工作文件必须严格由MQL5语言管理。使用MQL5实施文件操作的文件意味着不能位于文件沙箱之外。</p> <p>请慎重使用该函数，所有文件和子目录都会被彻底删除。</p> <p>示例 :</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//|                                             Demo_FolderClean.mq5 |</span>
<span class="token comment">//|                        Copyright 2011, MetaQuotes Software Corp. |</span>
<span class="token comment">//|                                             https://www.mql5.com |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">copyright </span><span class="token string">&quot;Copyright 2011, MetaQuotes Software Corp.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">link      </span><span class="token string">&quot;https://www.mql5.com&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">version   </span><span class="token string">&quot;1.00&quot;</span></span>
<span class="token comment">//--- 描述</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;The script shows a sample use of FolderClean().&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;First, files are created in the specified folder using the FileOpen() function.&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Then, before the files are deleted, a warning is shown using MessageBox().&quot;</span></span>
 
<span class="token comment">//--- 启动脚本时显示输入参数对话框</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">script_show_inputs</span></span>
<span class="token comment">//--- 输入参数</span>
input string   foldername<span class="token operator">=</span><span class="token string">&quot;demo_folder&quot;</span><span class="token punctuation">;</span>  <span class="token comment">// 在MQL5/Files/创建一个文件夹</span>
input <span class="token keyword">int</span>      files<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>                   <span class="token comment">// 要创建和删除的文件数量</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 脚本程序启动函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string name<span class="token operator">=</span><span class="token string">&quot;testfile&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 首先在程序端数据文件夹打开或创建文件</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> N<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>N<span class="token operator">&lt;</span>files<span class="token punctuation">;</span>N<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 'demo_folder\testfileN.txt'格式的文件名称</span>
      string filemane<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s\\%s%d.txt&quot;</span><span class="token punctuation">,</span>foldername<span class="token punctuation">,</span>name<span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 打开用于编写的标识文件，在这种情况下将会自动创建'demo_folder'</span>
      <span class="token keyword">int</span> handle<span class="token operator">=</span><span class="token function">FileOpen</span><span class="token punctuation">(</span>filemane<span class="token punctuation">,</span>FILE_WRITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 找出FileOpen()函数是否成功</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>handle<span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to create file %s. Error code&quot;</span><span class="token punctuation">,</span>filemane<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File %s has been successfully opened&quot;</span><span class="token punctuation">,</span>filemane<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 打开的文件不再需要，所以请关闭它</span>
         <span class="token function">FileClose</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
 
<span class="token comment">//--- 检查文件夹中的文件数量 </span>
   <span class="token keyword">int</span> k<span class="token operator">=</span><span class="token function">FilesInFolder</span><span class="token punctuation">(</span>foldername<span class="token operator">+</span><span class="token string">&quot;\\*.*&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Totally the folder %s contains %d files&quot;</span><span class="token punctuation">,</span>foldername<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//--- 显示询问用户的对话框</span>
   <span class="token keyword">int</span> choice<span class="token operator">=</span><span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;You are going to delete %d files from folder %s. Do you want to continue?&quot;</span><span class="token punctuation">,</span>foldername<span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token string">&quot;Deleting files from the folder&quot;</span><span class="token punctuation">,</span>
                         MB_YESNO<span class="token operator">|</span>MB_ICONQUESTION<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  两个按钮 - &quot;Yes&quot; 和 &quot;No&quot;</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//--- 根据选定的变量运行一个行为</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>choice<span class="token operator">==</span>IDYES<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 开始删除文件</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Trying to delete all files from folder %s&quot;</span><span class="token punctuation">,</span>foldername<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">FolderClean</span><span class="token punctuation">(</span>foldername<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Files have been successfully deleted, %d files left in folder %s&quot;</span><span class="token punctuation">,</span>
                     foldername<span class="token punctuation">,</span>
                     <span class="token function">FilesInFolder</span><span class="token punctuation">(</span>foldername<span class="token operator">+</span><span class="token string">&quot;\\*.*&quot;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">else</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to delete files from folder %s. Error code %d&quot;</span><span class="token punctuation">,</span>foldername<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Deletion canceled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 在指定文件夹返回文件数量                                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">FilesInFolder</span><span class="token punctuation">(</span>string path<span class="token punctuation">,</span><span class="token keyword">int</span> flag<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   <span class="token keyword">int</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">long</span> handle<span class="token punctuation">;</span>
   string filename<span class="token punctuation">;</span>
<span class="token comment">//---</span>
   handle<span class="token operator">=</span><span class="token function">FileFindFirst</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>filename<span class="token punctuation">,</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果至少一个文件被找到，请搜索更多的文件</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>handle<span class="token operator">!=</span>INVALID_HANDLE<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 显示文件名称</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File %s found&quot;</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 增加找到的文件/文件夹的计数器</span>
      count<span class="token operator">++</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 在所有文件/文件夹中开始搜索</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">FileFindNext</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;File %s found&quot;</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
         count<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 完成时不要忘记关闭搜索句柄</span>
      <span class="token function">FileFindClose</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span> <span class="token comment">// 获得句柄失败</span>
     <span class="token punctuation">{</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Files search in folder %s failed&quot;</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回结果</span>
   <span class="token keyword">return</span> count<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br></div></div><p>相关参考
FileFindFirst, FileFindNext, FileFindClose</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mql5yao/Chapter/twentytwo.html" class="prev">
        22 第二十二章 程序端全局变量
      </a></span> <span class="next"><a href="/mql5yao/Chapter/twentyfour.html">
        24 第二十四章 自定义指标
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mql5yao/assets/js/app.33d9106b.js" defer></script><script src="/mql5yao/assets/js/3.64586e1a.js" defer></script><script src="/mql5yao/assets/js/45.9e7cd13e.js" defer></script>
  </body>
</html>
