<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能交易*姚 文档站</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mql5yao/favicon.ico">
    <meta name="description" content="这是智能交易的文档站点。">
    <meta name="keywords" content="MQL,EA,智能交易,自动交易,量化,编程,培训">
    
    <link rel="preload" href="/mql5yao/assets/css/0.styles.c167a2d0.css" as="style"><link rel="preload" href="/mql5yao/assets/js/app.33d9106b.js" as="script"><link rel="preload" href="/mql5yao/assets/js/3.64586e1a.js" as="script"><link rel="preload" href="/mql5yao/assets/js/43.3f173f86.js" as="script"><link rel="prefetch" href="/mql5yao/assets/js/10.f243be4a.js"><link rel="prefetch" href="/mql5yao/assets/js/11.e4fc3b61.js"><link rel="prefetch" href="/mql5yao/assets/js/12.d2b71f90.js"><link rel="prefetch" href="/mql5yao/assets/js/13.d47c9e61.js"><link rel="prefetch" href="/mql5yao/assets/js/14.59ded2e6.js"><link rel="prefetch" href="/mql5yao/assets/js/15.f2836d3d.js"><link rel="prefetch" href="/mql5yao/assets/js/16.fc4e3f11.js"><link rel="prefetch" href="/mql5yao/assets/js/17.069370d9.js"><link rel="prefetch" href="/mql5yao/assets/js/18.e47908ca.js"><link rel="prefetch" href="/mql5yao/assets/js/19.4e8a369f.js"><link rel="prefetch" href="/mql5yao/assets/js/2.7a050c47.js"><link rel="prefetch" href="/mql5yao/assets/js/20.37e31658.js"><link rel="prefetch" href="/mql5yao/assets/js/21.30dc9524.js"><link rel="prefetch" href="/mql5yao/assets/js/22.bb650486.js"><link rel="prefetch" href="/mql5yao/assets/js/23.84e246fd.js"><link rel="prefetch" href="/mql5yao/assets/js/24.3b441f03.js"><link rel="prefetch" href="/mql5yao/assets/js/25.3ceb7172.js"><link rel="prefetch" href="/mql5yao/assets/js/26.ba703a82.js"><link rel="prefetch" href="/mql5yao/assets/js/27.c0597566.js"><link rel="prefetch" href="/mql5yao/assets/js/28.50413136.js"><link rel="prefetch" href="/mql5yao/assets/js/29.04da6b07.js"><link rel="prefetch" href="/mql5yao/assets/js/30.c8071067.js"><link rel="prefetch" href="/mql5yao/assets/js/31.baace808.js"><link rel="prefetch" href="/mql5yao/assets/js/32.d399c058.js"><link rel="prefetch" href="/mql5yao/assets/js/33.9b2114b8.js"><link rel="prefetch" href="/mql5yao/assets/js/34.d6f49f42.js"><link rel="prefetch" href="/mql5yao/assets/js/35.3620d83f.js"><link rel="prefetch" href="/mql5yao/assets/js/36.e26f547b.js"><link rel="prefetch" href="/mql5yao/assets/js/37.c903bf3b.js"><link rel="prefetch" href="/mql5yao/assets/js/38.2f6e699d.js"><link rel="prefetch" href="/mql5yao/assets/js/39.aca9c106.js"><link rel="prefetch" href="/mql5yao/assets/js/4.21ff370e.js"><link rel="prefetch" href="/mql5yao/assets/js/40.3eb74932.js"><link rel="prefetch" href="/mql5yao/assets/js/41.4f244c9a.js"><link rel="prefetch" href="/mql5yao/assets/js/42.892231ce.js"><link rel="prefetch" href="/mql5yao/assets/js/44.4e79ffd4.js"><link rel="prefetch" href="/mql5yao/assets/js/45.9e7cd13e.js"><link rel="prefetch" href="/mql5yao/assets/js/46.240ea5cd.js"><link rel="prefetch" href="/mql5yao/assets/js/47.bc498cbd.js"><link rel="prefetch" href="/mql5yao/assets/js/48.752c3ae0.js"><link rel="prefetch" href="/mql5yao/assets/js/5.47d44717.js"><link rel="prefetch" href="/mql5yao/assets/js/6.ee422b91.js"><link rel="prefetch" href="/mql5yao/assets/js/7.b1ec5472.js"><link rel="prefetch" href="/mql5yao/assets/js/8.036d68c0.js"><link rel="prefetch" href="/mql5yao/assets/js/9.4c2d0d8b.js">
    <link rel="stylesheet" href="/mql5yao/assets/css/0.styles.c167a2d0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mql5yao/" class="home-link router-link-active"><img src="/mql5yao/logo.png" alt="智能交易*姚 文档站" class="logo"> <span class="site-name can-hide">智能交易*姚 文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MQL5线上手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mql5yao/Chapter/start.html" class="sidebar-link">MQL5 参考</a></li><li><a href="/mql5yao/Chapter/one.html" class="sidebar-link">01 第一章 语言基础</a></li><li><a href="/mql5yao/Chapter/two.html" class="sidebar-link">02 第二章 标准常量，列举和架构</a></li><li><a href="/mql5yao/Chapter/three.html" class="sidebar-link">03 第三章 MQL5程序</a></li><li><a href="/mql5yao/Chapter/four.html" class="sidebar-link">04 第四章 预定义变量</a></li><li><a href="/mql5yao/Chapter/five.html" class="sidebar-link">05 第五章 普通函数</a></li><li><a href="/mql5yao/Chapter/six.html" class="sidebar-link">06 第六章 数组函数</a></li><li><a href="/mql5yao/Chapter/add1.html" class="sidebar-link">07 第add1章 矩阵和向量方法</a></li><li><a href="/mql5yao/Chapter/seven.html" class="sidebar-link">07 第七章 函数转换</a></li><li><a href="/mql5yao/Chapter/eight.html" class="sidebar-link">08 第八章 数学函数</a></li><li><a href="/mql5yao/Chapter/nine.html" class="sidebar-link">09 第九章 字符串函数</a></li><li><a href="/mql5yao/Chapter/ten.html" class="sidebar-link">10 第十章 日期和时间</a></li><li><a href="/mql5yao/Chapter/eleven.html" class="sidebar-link">11 第十一章 账户信息</a></li><li><a href="/mql5yao/Chapter/twelve.html" class="sidebar-link">12 第十二章 检测</a></li><li><a href="/mql5yao/Chapter/thirteen.html" class="sidebar-link">13 第十三章 事件处理</a></li><li><a href="/mql5yao/Chapter/fourteen.html" class="sidebar-link">14 第十四章 市场信息</a></li><li><a href="/mql5yao/Chapter/fifteen.html" class="sidebar-link">15 第十五章 经济日历函数</a></li><li><a href="/mql5yao/Chapter/sixteen.html" class="sidebar-link">16 第十六章 时间序列和指标访问</a></li><li><a href="/mql5yao/Chapter/seventeen.html" class="sidebar-link">17 第十七章 自定义交易品种</a></li><li><a href="/mql5yao/Chapter/eighteen.html" class="sidebar-link">18 第十八章 图表操作</a></li><li><a href="/mql5yao/Chapter/ninteen.html" class="sidebar-link">19 第十九章 交易函数</a></li><li><a href="/mql5yao/Chapter/twenty.html" class="sidebar-link">20 第二十章 交易信号</a></li><li><a href="/mql5yao/Chapter/twentyone.html" class="sidebar-link">21 第二十一章 网络函数</a></li><li><a href="/mql5yao/Chapter/twentytwo.html" class="sidebar-link">22 第二十二章 程序端全局变量</a></li><li><a href="/mql5yao/Chapter/twentythree.html" class="sidebar-link">23 第二十三章 文件函数</a></li><li><a href="/mql5yao/Chapter/twentyfour.html" class="sidebar-link">24 第二十四章 自定义指标</a></li><li><a href="/mql5yao/Chapter/twentyfive.html" class="sidebar-link">25 第二十五章 物件函数</a></li><li><a href="/mql5yao/Chapter/twentysix.html" class="sidebar-link">26 第二十六章 技术指标</a></li><li><a href="/mql5yao/Chapter/twentyseven.html" class="sidebar-link">27 第二十七章 处理优化结果</a></li><li><a href="/mql5yao/Chapter/twentyeight.html" class="sidebar-link">28 第二十八章 工作事件</a></li><li><a href="/mql5yao/Chapter/twentynine.html" aria-current="page" class="active sidebar-link">29 第二十九章 使用OpenCL工作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-1-clhandletype" class="sidebar-link">29.1 CLHandleType</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-2-clgetinfointeger" class="sidebar-link">29.2 CLGetInfoInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-3-clgetinfostring" class="sidebar-link">29.3 CLGetInfoString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-4-clcontextcreate" class="sidebar-link">29.4 CLContextCreate</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-5-clcontextfree" class="sidebar-link">29.5 CLContextFree</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-6-clgetdeviceinfo" class="sidebar-link">29.6 CLGetDeviceInfo</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-7-clprogramcreate" class="sidebar-link">29.7 CLProgramCreate</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-8-clprogramfree" class="sidebar-link">29.8 CLProgramFree</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-9-clkernelcreate" class="sidebar-link">29.9 CLKernelCreate</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-10-clkernelfree" class="sidebar-link">29.10 CLKernelFree</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-11-clsetkernelarg" class="sidebar-link">29.11 CLSetKernelArg</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-12-clsetkernelargmem" class="sidebar-link">29.12 CLSetKernelArgMem</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-13-clsetkernelargmemlocal" class="sidebar-link">29.13 CLSetKernelArgMemLocal</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-14-clbuffercreate" class="sidebar-link">29.14 CLBufferCreate</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-15-clbufferfree" class="sidebar-link">29.15 CLBufferFree</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_28-16-clbufferwrite" class="sidebar-link">28.16 CLBufferWrite</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-17-clbufferread" class="sidebar-link">29.17 CLBufferRead</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-18-clexecute" class="sidebar-link">29.18 CLExecute</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/twentynine.html#_29-19-clexecutionstatus" class="sidebar-link">29.19 CLExecutionStatus</a></li></ul></li><li><a href="/mql5yao/Chapter/thirty.html" class="sidebar-link">30 第三十章 使用数据库</a></li><li><a href="/mql5yao/Chapter/thirtyone.html" class="sidebar-link">31 第三十一章 使用DirectX</a></li><li><a href="/mql5yao/Chapter/thirtytwo.html" class="sidebar-link">32 第三十二章 集成</a></li><li><a href="/mql5yao/Chapter/add2.html" class="sidebar-link">32 第add2章 ONNX模型</a></li><li><a href="/mql5yao/Chapter/thirtythree.html" class="sidebar-link">33 第三十三章 标准程序库</a></li><li><a href="/mql5yao/Chapter/AppendixI.html" class="sidebar-link">34 附录一 来自MQL4</a></li><li><a href="/mql5yao/Chapter/AppendixII.html" class="sidebar-link">35 附录二 MQL5 函数列表</a></li><li><a href="/mql5yao/Chapter/AppendixIII.html" class="sidebar-link">36 附录三 MQL5常量列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2>第二十九章 使用OpenCL工作</h2> <p>OpenCL 程序用来执行支持OpenCL 1.1或更高版本的视频卡上的计算。 现代视频卡包含数百个小型专用处理器，可以同时与输入数据流进行简单的数学运算。 OpenCL语言组织了并行计算并且为一类特定任务提供了更快的速度。</p> <p>在一些图形卡中默认禁止处理 双精度(double)类型数字。这可能会导致编译错误5105。若要启用支持 双精度(double)类型数字，请添加以下指令到您的OpenCL程序：</p> <p><code>#pragma OPENCL EXTENSION cl_khr_fp64 : enable</code></p> <p>更多详情请参考以下链接</p> <p><code>https://www.khronos.org/registry/OpenCL/sdk/1.0/docs/man/xhtml/cl_khr_fp64.html</code></p> <p>但是，如果图形卡不支持 双精度(double)型，启用该指令则不会有帮助。</p> <p>建议以单独的CL文件编写OpenCL源代码，稍后将其包含进使用资源变量MQL5程序。</p> <p>运行OpenCL程序中的函数:</p> <table><thead><tr><th>函数</th> <th>功能</th></tr></thead> <tbody><tr><td>CLHandleType</td> <td>返回OpenCL句柄的类型，作为ENUM_OPENCL_HANDLE_TYPE枚举值</td></tr> <tr><td>CLGetInfoInteger</td> <td>为OpenCL对象 或 设备返回一个整数属性值</td></tr> <tr><td>CLContextCreate</td> <td>创建OpenCL上下文(容器)</td></tr> <tr><td>CLContextFree</td> <td>移除OpenCL上下文(容器)</td></tr> <tr><td>CLGetDeviceInfo</td> <td>从OpenCL驱动程序接收设备属性</td></tr> <tr><td>CLProgramCreate</td> <td>从源代码创建OpenCL程序</td></tr> <tr><td>CLProgramFree</td> <td>移除OpenCL程序</td></tr> <tr><td>CLKernelCreate</td> <td>创建OpenCL开始函数</td></tr> <tr><td>CLKernelFree</td> <td>移除OpenCL开始函数</td></tr> <tr><td>CLSetKernelArg</td> <td>为OpenCL函数设置一个参数</td></tr> <tr><td>CLSetKernelArgMem</td> <td>设置OpenCL缓冲作为OpenCL函数的参数</td></tr> <tr><td>CLSetKernelArgMemLocal</td> <td>设置本地缓冲区作为内核函数参数</td></tr> <tr><td>CLBufferCreate</td> <td>创建OpenCL缓冲</td></tr> <tr><td>CLBufferFree</td> <td>删除OpenCL缓冲</td></tr> <tr><td>CLBufferWrite</td> <td>写入数组到OpenCL缓冲</td></tr> <tr><td>CLBufferRead</td> <td>读取OpenCL缓冲到数组</td></tr> <tr><td>CLExecute</td> <td>运行OpenCL程序</td></tr> <tr><td>CLExecutionStatus</td> <td>返回OpenCL程序执行状态。</td></tr></tbody></table> <p>相关参考</p> <p>OpenCL, 资源</p> <h2 id="_29-1-clhandletype"><a href="#_29-1-clhandletype" class="header-anchor">#</a> 29.1 CLHandleType</h2> <p>返回OpenCL句柄的类型，作为ENUM_OPENCL_HANDLE_TYPE枚举的值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ENUM_OPENCL_HANDLE_TYPE  <span class="token function">CLHandleType</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  handle     <span class="token comment">// OpenCL对象处理 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>handle</p> <p>[in] OpenCL对象的句柄：上下文，内核或OpenCL程序。</p> <p>返回值</p> <p>OpenCL句柄的类型，作为ENUM_OPENCL_HANDLE_TYPE枚举的值。</p> <p><strong>ENUM_OPENCL_HANDLE_TYPE</strong></p> <table><thead><tr><th>标识符</th> <th>描述</th></tr></thead> <tbody><tr><td>OPENCL_INVALID</td> <td>不正确处理</td></tr> <tr><td>OPENCL_CONTEXT</td> <td>OpenCL上下文的句柄</td></tr> <tr><td>OPENCL_PROGRAM</td> <td>OpenCL程序的句柄</td></tr> <tr><td>OPENCL_KERNEL</td> <td>OpenCL内核的句柄</td></tr> <tr><td>OPENCL_BUFFER</td> <td>OpenCL缓冲的句柄</td></tr></tbody></table> <h2 id="_29-2-clgetinfointeger"><a href="#_29-2-clgetinfointeger" class="header-anchor">#</a> 29.2 CLGetInfoInteger</h2> <p>返回OpenCL对象 或 设备的整数属性的值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  handle<span class="token punctuation">,</span>                           <span class="token comment">// OpenCL对象处理或OpenCL设备编号 </span>
   ENUM_OPENCL_PROPERTY_INTEGER  prop     <span class="token comment">// 被请求属性 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>handle</p> <p>[in] OpenCL对象的句柄或OpenCL设备的编号。 OpenCL设备的编号从零开始。</p> <p>prop</p> <p>[in] 从ENUM_OPENCL_PROPERTY_INTEGER枚举中请求的属性的类型，您要获取的值。</p> <p>返回值</p> <p>如果成功则返回 属性的值，或 一旦错误则返回 -1。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p><strong>ENUM_OPENCL_PROPERTY_INTEGER</strong></p> <table><thead><tr><th>标识符</th> <th>描述</th> <th>类型</th></tr></thead> <tbody><tr><td>CL_DEVICE_COUNT</td> <td>OpenCL支持的设备编号. 此属性不要求第一个参数规范，即你可以处理参数通过一个为零的值</td> <td>int</td></tr> <tr><td>CL_DEVICE_TYPE</td> <td>设备类型</td> <td>ENUM_CL_DEVICE_TYPE</td></tr> <tr><td>CL_DEVICE_VENDOR_ID</td> <td>唯一的供应商识别</td> <td>uint</td></tr> <tr><td>CL_DEVICE_MAX_COMPUTE_UNITS</td> <td>OpenCL设备中的并行计算任务编号. 一个工作组解决了一个计算任务.最低值为1</td> <td>uint</td></tr> <tr><td>CL_DEVICE_MAX_CLOCK_FREQUENCY</td> <td>设备最高的固定频率兆赫.</td> <td>uint</td></tr> <tr><td>CL_DEVICE_GLOBAL_MEM_SIZE</td> <td>设备的全局内存字节大小</td> <td>ulong</td></tr> <tr><td>CL_DEVICE_LOCAL_MEM_SIZE</td> <td>处理数据（事件）本地内存的字节大小</td> <td>uint</td></tr> <tr><td>CL_BUFFER_SIZE</td> <td>OpenCL字节缓冲区的实际大小</td> <td>ulong</td></tr> <tr><td>CL_DEVICE_MAX_WORK_GROUP_SIZE</td> <td>可用于OpenCL设备的本地工作组总数。</td> <td>ulong</td></tr> <tr><td>CL_KERNEL_WORK_GROUP_SIZE</td> <td>可用于OpenCL程序的本地工作组总数。</td> <td>ulong</td></tr> <tr><td>CL_KERNEL_LOCAL_MEM_SIZE</td> <td>由OpenCL程序用于解决一组全部并行任务的本地存储器大小（字节）。 使用CL_DEVICE_LOCAL_MEM_SIZE 接收最大可用值</td> <td>ulong</td></tr> <tr><td>CL_KERNEL_PRIVATE_MEM_SIZE</td> <td>OpenCL程序内核中，每个任务使用的最小专有存储器大小（字节）。</td> <td>ulong</td></tr></tbody></table> <p>ENUM_CL_DEVICE_TYPE枚举包含了可能支持OpenCL的设备类型。您可以通过调用CLGetInfoInteger（handle_or_deviceN，CL_DEVICE_TYPE），通过其编号或OpenCL对象的句柄来接收设备类型。</p> <p><strong>ENUM_CL_DEVICE_TYPE</strong></p> <table><thead><tr><th>标识符</th> <th>描述</th></tr></thead> <tbody><tr><td>CL_DEVICE_ACCELERATOR</td> <td>OpenCL专用加速器 (比如, IBM CELL Blade). 这些设备使用外设互连如PCIe与主处理器进行通信.</td></tr> <tr><td>CL_DEVICE_CPU</td> <td>一个OpenCL主机处理器设备. 主机处理器运行OpenCL运转且为一个单核或多核CPU.</td></tr> <tr><td>CL_DEVICE_GPU</td> <td>一个OpenCL设备是GPU.</td></tr> <tr><td>CL_DEVICE_DEFAULT</td> <td>系统默认的OpenCL设备. 默认设备不能为</td></tr> <tr><td>CL_DEVICE_CUSTOM</td> <td>专用的加速器不支持OpenCL C编写的程序.</td></tr></tbody></table> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">int</span> cl_ctx<span class="token punctuation">;</span> 
<span class="token comment">//--- 初始化 OpenCL 上下文 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_ctx<span class="token operator">=</span><span class="token function">CLContextCreate</span><span class="token punctuation">(</span>CL_USE_GPU_ONLY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 显示有关OpenCL设备的常规信息 </span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL type: &quot;</span><span class="token punctuation">,</span><span class="token function">EnumToString</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ENUM_CL_DEVICE_TYPE<span class="token punctuation">)</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL vendor ID: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_VENDOR_ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL units: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_MAX_COMPUTE_UNITS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL freq: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_MAX_CLOCK_FREQUENCY<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot; MHz&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL global mem: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_GLOBAL_MEM_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL local mem: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_LOCAL_MEM_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot; bytes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="_29-3-clgetinfostring"><a href="#_29-3-clgetinfostring" class="header-anchor">#</a> 29.3 CLGetInfoString</h2> <p>返回OpenCL对象 或 设备的属性的字符串值。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">CLGetInfoString</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  handle<span class="token punctuation">,</span>                           <span class="token comment">// OpenCL对象处理或者OpenCL设备号码 </span>
   ENUM_OPENCL_PROPERTY_STRING  prop<span class="token punctuation">,</span>     <span class="token comment">// 被请求的属性 </span>
   string<span class="token operator">&amp;</span>  value                         <span class="token comment">// 引用字符串 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>handle</p> <p>[in] OpenCL对象句柄或OpenCL设备号。 OpenCL设备的编号从零开始。 prop</p> <p>[in] 从 ENUM_OPENCL_PROPERTY_STRING 枚举中请求的属性的类型，您要获取的值</p> <p>value</p> <p>[out] 接收属性值的字符串.</p> <p>返回值</p> <p>成功则返回true, 否则返回 false. 想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p><strong>ENUM_OPENCL_PROPERTY_STRING</strong></p> <table><thead><tr><th>标识符</th> <th>描述</th></tr></thead> <tbody><tr><td>CL_PLATFORM_PROFILE</td> <td>OpenCL简介.  简介名称可以是以下值中的某一个:<br>FULL_PROFILE - 实现支持OpenCL（功能定义为核心规范的一部分而无需为OpenCL支持额外的扩展） ;<br>EMBEDDED_PROFILE - 实现支持OpenCL作为增补. 修订简介被定义为每个OpenCL版本的子集.</td></tr> <tr><td>CL_PLATFORM_VERSION</td> <td>OpenCL版本</td></tr> <tr><td>CL_PLATFORM_VENDOR</td> <td>平台供应商名称</td></tr> <tr><td>CL_PLATFORM_EXTENSIONS</td> <td>由平台支持的扩展名列表。扩展名应该能被所有与这个平台相</td></tr> <tr><td>CL_DEVICE_NAME</td> <td>设备名称</td></tr> <tr><td>CL_DEVICE_VENDOR</td> <td>供应商名称</td></tr> <tr><td>CL_DRIVER_VERSION</td> <td>major_number.minor_number格式OpenCL设备版本</td></tr> <tr><td>CL_DEVICE_PROFILE</td> <td>OpenCL设备简介. 简介名称可以是以下值的某一个:<br>FULL_PROFILE -  实现支持OpenCL（功能定义为核心规范的一部分而无需为OpenCL支持额外的扩展）;<br>EMBEDDED_PROFILE -实现支持OpenCL作为增补. 修订简介被定义为每个OpenCL版本的子集.</td></tr> <tr><td>CL_DEVICE_VERSION</td> <td><code>OpenCL&lt;space&gt;&lt;major_version.minor_version&gt;&lt;space&gt;&lt;vendor-specific information&gt;</code>格式OpenCL版本</td></tr> <tr><td>CL_DEVICE_EXTENSIONS</td> <td>设备所支持的扩展名列表。列表可以包含由供应商支持的扩展，以及一个或多个批准名称:<br>   cl_khr_int64_base_atomics<br>   cl_khr_int64_extended_atomics<br>   cl_khr_fp16<br>   cl_khr_gl_sharing<br>   cl_khr_gl_event<br>   cl_khr_d3d10_sharing<br>   cl_khr_dx9_media_sharing<br>   cl_khr_d3d11_sharing<br></td></tr> <tr><td>CL_DEVICE_BUILT_IN_KERNELS</td> <td>可支持的内核列表用 &quot;;&quot;分割.</td></tr> <tr><td>CL_DEVICE_OPENCL_C_VERSION</td> <td>这个设备的编译器所支持的最大版本。版本格式:<br><code>OpenCL&lt;space&gt;C&lt;space&gt;&lt;major_version.minor_version&gt;&lt;space&gt;&lt;vendor-specific information&gt;</code></td></tr></tbody></table> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">int</span> cl_ctx<span class="token punctuation">;</span> 
   string str<span class="token punctuation">;</span> 
<span class="token comment">//--- 初始化 OpenCL 上下文 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_ctx<span class="token operator">=</span><span class="token function">CLContextCreate</span><span class="token punctuation">(</span>CL_USE_GPU_ONLY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 显示平台信息 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_PLATFORM_NAME<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL platform name: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_PLATFORM_VENDOR<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL platform vendor: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_PLATFORM_VERSION<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL platform ver: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_PLATFORM_PROFILE<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL platform profile: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_PLATFORM_EXTENSIONS<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL platform ext: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 显示设备信息 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_NAME<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL device name: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_PROFILE<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL device profile: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_BUILT_IN_KERNELS<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL device kernels: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_EXTENSIONS<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL device ext: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_VENDOR<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL device vendor: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_VERSION<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL device ver: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_OPENCL_C_VERSION<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL open c ver: &quot;</span><span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 显示OpenCL设备的常规信息 </span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL type: &quot;</span><span class="token punctuation">,</span><span class="token function">EnumToString</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ENUM_CL_DEVICE_TYPE<span class="token punctuation">)</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL vendor ID: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_VENDOR_ID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL units: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_MAX_COMPUTE_UNITS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL freq: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_MAX_CLOCK_FREQUENCY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL global mem: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_GLOBAL_MEM_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL local mem: &quot;</span><span class="token punctuation">,</span><span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>CL_DEVICE_LOCAL_MEM_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//---  </span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="_29-4-clcontextcreate"><a href="#_29-4-clcontextcreate" class="header-anchor">#</a> 29.4 CLContextCreate</h2> <p>创建一个OpenCL上下文并返回其句柄。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">CLContextCreate</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  device     <span class="token comment">// OpenCL设备或宏的序列号 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>device</p> <p>[in] 系统中的OpenCL设备序号. 你可以指定下列值之一，而不是一个具体的数字:</p> <p>• CL_USE_ANY —— 任何支持OpenCL的有效设备均被允许; <br>
• CL_USE_CPU_ONLY —— 仅CPU中的OpenCL仿真被允许;<br>
• CL_USE_GPU_ONLY —— OpenCL仿真被禁止并且仅有OpenCL支持的专业设备 (视频卡) 可以被使用.</p> <p>返回值</p> <p>如果成功创建OpenCL上下文对象将返回句柄。一旦出错 则返回 -1 . 想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <h2 id="_29-5-clcontextfree"><a href="#_29-5-clcontextfree" class="header-anchor">#</a> 29.5 CLContextFree</h2> <p>删除一个OpenCL上下文并返回其句柄。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">CLContextFree</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  context     <span class="token comment">// 一个OpenCL上下文的句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>context</p> <p>[in] OpenCL 上下文的句柄。</p> <p>返回值</p> <p>无。 在内部错误情况下 _LastError 的值会改变。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <h2 id="_29-6-clgetdeviceinfo"><a href="#_29-6-clgetdeviceinfo" class="header-anchor">#</a> 29.6 CLGetDeviceInfo</h2> <p>此函数从OpenCL驱动中接收设备的属性信息。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">CLGetDeviceInfo</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>     handle<span class="token punctuation">,</span>          <span class="token comment">// OpenCL设备处理 </span>
   <span class="token keyword">int</span>     property_id<span class="token punctuation">,</span>     <span class="token comment">// 被请求的属性 ID  </span>
   uchar<span class="token operator">&amp;</span>  data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// 数据接收数组 </span>
   uint<span class="token operator">&amp;</span>   size             <span class="token comment">// 数组中的元素转换，默认为0 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>参数</p> <p>handle</p> <p>[in] 由CLContextCreate()函数创建的OpenCL设备索引 或 OpenCL句柄。</p> <p>property_id</p> <p>[in] 应接收的OpenCL设备属性的ID。这些值可能是下表中列出的枚举值之一。</p> <p>data[]</p> <p>[out] 用于接收所请求属性的数据的数组。</p> <p>size</p> <p>[out] 接收数据的数组 data[] 的大小.</p> <p>返回值</p> <p>如果成功则为true ，否则为 false. 想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p>注意</p> <p>对于一维数组，考虑AS_SERIES标帜计算从中读取OpenCL缓冲区的数据的元素的数量。</p> <p>OpenCL设备属性的可用ID列表</p> <p>可以在OpenCL官方网站(https://www.khronos.org/opencl/)上找到该属性及其功能的确切描述。</p> <table border="1"><tbody><tr bgcolor="#add8e6"><td><p>标识符 </p></td> <td><p>值 </p></td></tr> <tr><td><p>CL_DEVICE_TYPE</p></td> <td><p>0x1000</p></td></tr> <tr><td><p>CL_DEVICE_VENDOR_ID</p></td> <td><p>0x1001</p></td></tr> <tr><td><p>CL_DEVICE_MAX_COMPUTE_UNITS</p></td> <td><p>0x1002</p></td></tr> <tr><td><p>CL_DEVICE_MAX_WORK_ITEM_DIMENSIONS</p></td> <td><p>0x1003</p></td></tr> <tr><td><p>CL_DEVICE_MAX_WORK_GROUP_SIZE</p></td> <td><p>0x1004</p></td></tr> <tr><td><p>CL_DEVICE_MAX_WORK_ITEM_SIZES</p></td> <td><p>0x1005</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_CHAR</p></td> <td><p>0x1006</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_SHORT</p></td> <td><p>0x1007</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_INT</p></td> <td><p>0x1008</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_LONG</p></td> <td><p>0x1009</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_FLOAT</p></td> <td><p>0x100A</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_DOUBLE</p></td> <td><p>0x100B</p></td></tr> <tr><td><p>CL_DEVICE_MAX_CLOCK_FREQUENCY</p></td> <td><p>0x100C</p></td></tr> <tr><td><p>CL_DEVICE_ADDRESS_BITS</p></td> <td><p>0x100D</p></td></tr> <tr><td><p>CL_DEVICE_MAX_READ_IMAGE_ARGS</p></td> <td><p>0x100E</p></td></tr> <tr><td><p>CL_DEVICE_MAX_WRITE_IMAGE_ARGS</p></td> <td><p>0x100F</p></td></tr> <tr><td><p>CL_DEVICE_MAX_MEM_ALLOC_SIZE</p></td> <td><p>0x1010</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE2D_MAX_WIDTH</p></td> <td><p>0x1011</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE2D_MAX_HEIGHT</p></td> <td><p>0x1012</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE3D_MAX_WIDTH</p></td> <td><p>0x1013</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE3D_MAX_HEIGHT</p></td> <td><p>0x1014</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE3D_MAX_DEPTH</p></td> <td><p>0x1015</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE_SUPPORT</p></td> <td><p>0x1016</p></td></tr> <tr><td><p>CL_DEVICE_MAX_PARAMETER_SIZE</p></td> <td><p>0x1017</p></td></tr> <tr><td><p>CL_DEVICE_MAX_SAMPLERS</p></td> <td><p>0x1018</p></td></tr> <tr><td><p>CL_DEVICE_MEM_BASE_ADDR_ALIGN</p></td> <td><p>0x1019</p></td></tr> <tr><td><p>CL_DEVICE_MIN_DATA_TYPE_ALIGN_SIZE</p></td> <td><p>0x101A</p></td></tr> <tr><td><p>CL_DEVICE_SINGLE_FP_CONFIG</p></td> <td><p>0x101B</p></td></tr> <tr><td><p>CL_DEVICE_GLOBAL_MEM_CACHE_TYPE</p></td> <td><p>0x101C</p></td></tr> <tr><td><p>CL_DEVICE_GLOBAL_MEM_CACHELINE_SIZE</p></td> <td><p>0x101D</p></td></tr> <tr><td><p>CL_DEVICE_GLOBAL_MEM_CACHE_SIZE</p></td> <td><p>0x101E</p></td></tr> <tr><td><p>CL_DEVICE_GLOBAL_MEM_SIZE</p></td> <td><p>0x101F</p></td></tr> <tr><td><p>CL_DEVICE_MAX_CONSTANT_BUFFER_SIZE</p></td> <td><p>0x1020</p></td></tr> <tr><td><p>CL_DEVICE_MAX_CONSTANT_ARGS</p></td> <td><p>0x1021</p></td></tr> <tr><td><p>CL_DEVICE_LOCAL_MEM_TYPE</p></td> <td><p>0x1022</p></td></tr> <tr><td><p>CL_DEVICE_LOCAL_MEM_SIZE</p></td> <td><p>0x1023</p></td></tr> <tr><td><p>CL_DEVICE_ERROR_CORRECTION_SUPPORT</p></td> <td><p>0x1024</p></td></tr> <tr><td><p>CL_DEVICE_PROFILING_TIMER_RESOLUTION</p></td> <td><p>0x1025</p></td></tr> <tr><td><p>CL_DEVICE_ENDIAN_LITTLE</p></td> <td><p>0x1026</p></td></tr> <tr><td><p>CL_DEVICE_AVAILABLE</p></td> <td><p>0x1027</p></td></tr> <tr><td><p>CL_DEVICE_COMPILER_AVAILABLE</p></td> <td><p>0x1028</p></td></tr> <tr><td><p>CL_DEVICE_EXECUTION_CAPABILITIES</p></td> <td><p>0x1029</p></td></tr> <tr><td><p>CL_DEVICE_QUEUE_PROPERTIES</p></td> <td><p>0x102A</p></td></tr> <tr><td><p>CL_DEVICE_NAME</p></td> <td><p>0x102B</p></td></tr> <tr><td><p>CL_DEVICE_VENDOR</p></td> <td><p>0x102C</p></td></tr> <tr><td><p>CL_DRIVER_VERSION</p></td> <td><p>0x102D</p></td></tr> <tr><td><p>CL_DEVICE_PROFILE</p></td> <td><p>0x102E</p></td></tr> <tr><td><p>CL_DEVICE_VERSION</p></td> <td><p>0x102F</p></td></tr> <tr><td><p>CL_DEVICE_EXTENSIONS</p></td> <td><p>0x1030</p></td></tr> <tr><td><p>CL_DEVICE_PLATFORM</p></td> <td><p>0x1031</p></td></tr> <tr><td><p>CL_DEVICE_DOUBLE_FP_CONFIG</p></td> <td><p>0x1032</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_VECTOR_WIDTH_HALF</p></td> <td><p>0x1034</p></td></tr> <tr><td><p>CL_DEVICE_HOST_UNIFIED_MEMORY</p></td> <td><p>0x1035</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_CHAR</p></td> <td><p>0x1036</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_SHORT</p></td> <td><p>0x1037</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_INT</p></td> <td><p>0x1038</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_LONG</p></td> <td><p>0x1039</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_FLOAT</p></td> <td><p>0x103A</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_DOUBLE</p></td> <td><p>0x103B</p></td></tr> <tr><td><p>CL_DEVICE_NATIVE_VECTOR_WIDTH_HALF</p></td> <td><p>0x103C</p></td></tr> <tr><td><p>CL_DEVICE_OPENCL_C_VERSION</p></td> <td><p>0x103D</p></td></tr> <tr><td><p>CL_DEVICE_LINKER_AVAILABLE</p></td> <td><p>0x103E</p></td></tr> <tr><td><p>CL_DEVICE_BUILT_IN_KERNELS</p></td> <td><p>0x103F</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE_MAX_BUFFER_SIZE</p></td> <td><p>0x1040</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE_MAX_ARRAY_SIZE</p></td> <td><p>0x1041</p></td></tr> <tr><td><p>CL_DEVICE_PARENT_DEVICE</p></td> <td><p>0x1042</p></td></tr> <tr><td><p>CL_DEVICE_PARTITION_MAX_SUB_DEVICES</p></td> <td><p>0x1043</p></td></tr> <tr><td><p>CL_DEVICE_PARTITION_PROPERTIES</p></td> <td><p>0x1044</p></td></tr> <tr><td><p>CL_DEVICE_PARTITION_AFFINITY_DOMAIN</p></td> <td><p>0x1045</p></td></tr> <tr><td><p>CL_DEVICE_PARTITION_TYPE</p></td> <td><p>0x1046</p></td></tr> <tr><td><p>CL_DEVICE_REFERENCE_COUNT</p></td> <td><p>0x1047</p></td></tr> <tr><td><p>CL_DEVICE_PREFERRED_INTEROP_USER_SYNC</p></td> <td><p>0x1048</p></td></tr> <tr><td><p>CL_DEVICE_PRINTF_BUFFER_SIZE</p></td> <td><p>0x1049</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE_PITCH_ALIGNMENT</p></td> <td><p>0x104A</p></td></tr> <tr><td><p>CL_DEVICE_IMAGE_BASE_ADDRESS_ALIGNMENT</p></td> <td><p>0x104B</p></td></tr></tbody></table>
示例：
<div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//---  </span>
   <span class="token keyword">int</span> dCount<span class="token operator">=</span> <span class="token function">CLGetInfoInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>CL_DEVICE_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>dCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">int</span> clCtx<span class="token operator">=</span><span class="token function">CLContextCreate</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span>clCtx <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> 
         <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;ERROR in CLContextCreate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      string device<span class="token punctuation">;</span> 
      <span class="token function">CLGetInfoString</span><span class="token punctuation">(</span>clCtx<span class="token punctuation">,</span>CL_DEVICE_NAME<span class="token punctuation">,</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">&quot;: &quot;</span><span class="token punctuation">,</span>device<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      uchar data<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
      uint size<span class="token punctuation">;</span> 
      <span class="token function">CLGetDeviceInfo</span><span class="token punctuation">(</span>clCtx<span class="token punctuation">,</span>CL_DEVICE_VENDOR<span class="token punctuation">,</span>data<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;size = &quot;</span><span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      string str<span class="token operator">=</span><span class="token function">CharArrayToString</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//--- example of entries in Experts journal </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      2: Advanced Micro Devices, Inc. </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      size = 32 </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      Tahiti </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      Intel(R) Corporation </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      size = 21 </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      1:        Intel(R) Core(TM) i7-3770 CPU @ 3.40GHz </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      NVIDIA Corporation </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      size = 19 </span>
<span class="token comment">//  2013.07.24 10:50:48     opencl (EURUSD,H1)      0: GeForce GTX 580</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="_29-7-clprogramcreate"><a href="#_29-7-clprogramcreate" class="header-anchor">#</a> 29.7 CLProgramCreate</h2> <p>从源代码创建一个OpenCL程序.</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">CLProgramCreate</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>           context<span class="token punctuation">,</span>     <span class="token comment">// 一个OpenCL上下文的句柄 </span>
   <span class="token keyword">const</span> string  source       <span class="token comment">// 源代码 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>重载函数版本创建OpenCL程序并将编译器消息写入传递的字符串。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">CLProgramCreate</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>           context<span class="token punctuation">,</span>     <span class="token comment">// Handle to an OpenCL context </span>
   <span class="token keyword">const</span> string  source<span class="token punctuation">,</span>      <span class="token comment">// Source code </span>
   string       <span class="token operator">&amp;</span>build_log    <span class="token comment">// A string for receiving the compilation log </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>context</p> <p>[in] 一个OpenCL上下文的句柄。</p> <p>source</p> <p>[in] OpenCL程序源代码字符串。</p> <p>&amp;build_log</p> <p>[in] 用于接收OpenCL编译器消息的字符串。</p> <p>返回值</p> <p>如果成功，则为OpenCL对象的句柄。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p>注意</p> <p>目前，以下错误代码正在使用:<br>
• ERR_OPENCL_INVALID_HANDLE —— OpenCL上下文的句柄无效。<br>
• ERR_INVALID_PARAMETER —— 无效的字符串参数。<br>
• ERR_NOT_ENOUGH_MEMORY —— 内存不足无法完成操作。<br>
• ERR_OPENCL_PROGRAM_CREATE —— OpenCL 内部错误或编译错误。<br></p> <p>在一些图形卡中默认禁止处理 双精度(double)类型数字。这可能会导致编译错误5105。若要启用支持 双精度(double)类型数字，请添加以下指令到您的OpenCL程序：</p> <p><code>#pragma OPENCL EXTENSION cl_khr_fp64 : enable</code>
更多详情请参考以下链接 https://www.khronos.org/registry/OpenCL/sdk/1.0/docs/man/xhtml/cl_khr_fp64.html</p> <p>但是，如果图形卡不支持 双精度(double)型，启用该指令则不会有帮助。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| OpenCL kernel                                                    | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">const</span> string 
cl_src<span class="token operator">=</span> 
       <span class="token comment">//--- 默认一些 GPU 不支持双精度类型 </span>
       <span class="token comment">//--- cl_khr_fp64 指令用于启用处理双精度类型 </span>
       <span class="token string">&quot;#pragma OPENCL EXTENSION cl_khr_fp64 : enable      \r\n&quot;</span> 
       <span class="token comment">//--- OpenCL 核函数 </span>
       <span class="token string">&quot;__kernel void Test_GPU(__global double *data,      \r\n&quot;</span> 
       <span class="token string">&quot;                       const    int N,             \r\n&quot;</span> 
       <span class="token string">&quot;                       const    int total_arrays)  \r\n&quot;</span> 
       <span class="token string">&quot;  {                                                \r\n&quot;</span> 
       <span class="token string">&quot;   uint kernel_index=get_global_id(0);             \r\n&quot;</span> 
       <span class="token string">&quot;   if (kernel_index&gt;total_arrays) return;          \r\n&quot;</span> 
       <span class="token string">&quot;   uint local_start_offset=kernel_index*N;         \r\n&quot;</span> 
       <span class="token string">&quot;   for(int i=0; i&lt;N; i++)                          \r\n&quot;</span> 
       <span class="token string">&quot;     {                                             \r\n&quot;</span> 
       <span class="token string">&quot;       data[i+local_start_offset] *= 2.0;          \r\n&quot;</span> 
       <span class="token string">&quot;     }                                             \r\n&quot;</span> 
       <span class="token string">&quot;  }                                                \r\n&quot;</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| Test_CPU                                                         | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">bool</span> <span class="token function">Test_CPU</span><span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">&amp;</span>data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> N<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">int</span> total_arrays<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 检查数组大小 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ArraySize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 检查数组索引 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">&gt;</span>total_arrays<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 通过索引id计算数组局部偏移 </span>
   <span class="token keyword">int</span> local_start_offset<span class="token operator">=</span>id<span class="token operator">*</span>N<span class="token punctuation">;</span> 
<span class="token comment">//--- 元素乘以2 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      data<span class="token punctuation">[</span>i<span class="token operator">+</span>local_start_offset<span class="token punctuation">]</span><span class="token operator">*=</span><span class="token number">2.0</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ARRAY_SIZE</span>   <span class="token expression"><span class="token number">100</span>  </span><span class="token comment">// size of the array </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TOTAL_ARRAYS</span> <span class="token expression"><span class="token number">5</span>    </span><span class="token comment">// total arrays </span></span>
<span class="token comment">//--- OpenCL 处理程序 </span>
<span class="token keyword">int</span> cl_ctx<span class="token punctuation">;</span>  <span class="token comment">// OpenCL 内容处理 </span>
<span class="token keyword">int</span> cl_prg<span class="token punctuation">;</span>  <span class="token comment">// OpenCL 程序处理 </span>
<span class="token keyword">int</span> cl_krn<span class="token punctuation">;</span>  <span class="token comment">// OpenCL 核处理 </span>
<span class="token keyword">int</span> cl_mem<span class="token punctuation">;</span>  <span class="token comment">// OpenCL 缓冲处理 </span>
<span class="token comment">//--- </span>
<span class="token keyword">double</span> DataArray1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用于CPU计算的数据数组 </span>
<span class="token keyword">double</span> DataArray2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 用于GPU计算的数据数组 </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 脚本程序起始函数                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 初始化OpenCL对象 </span>
<span class="token comment">//--- 创建OpenCL 环境 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_ctx<span class="token operator">=</span><span class="token function">CLContextCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL not found. Error=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 创建 OpenCL 程序 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_prg<span class="token operator">=</span><span class="token function">CLProgramCreate</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>cl_src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">CLContextFree</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL program create failed. Error=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 创建OpenCL 内核 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_krn<span class="token operator">=</span><span class="token function">CLKernelCreate</span><span class="token punctuation">(</span>cl_prg<span class="token punctuation">,</span><span class="token string">&quot;Test_GPU&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">CLProgramFree</span><span class="token punctuation">(</span>cl_prg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">CLContextFree</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL kernel create failed. Error=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 创建 OpenCL 缓冲 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cl_mem<span class="token operator">=</span><span class="token function">CLBufferCreate</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">,</span>ARRAY_SIZE<span class="token operator">*</span>TOTAL_ARRAYS<span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">,</span>CL_MEM_READ_WRITE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span>INVALID_HANDLE<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">CLKernelFree</span><span class="token punctuation">(</span>cl_krn<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">CLProgramFree</span><span class="token punctuation">(</span>cl_prg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">CLContextFree</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;OpenCL buffer create failed. Error=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 设置OpenCL 内核常量参数 </span>
   <span class="token function">CLSetKernelArgMem</span><span class="token punctuation">(</span>cl_krn<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>cl_mem<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">CLSetKernelArg</span><span class="token punctuation">(</span>cl_krn<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>ARRAY_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">CLSetKernelArg</span><span class="token punctuation">(</span>cl_krn<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>TOTAL_ARRAYS<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 准备数据数组 </span>
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>DataArray1<span class="token punctuation">,</span>ARRAY_SIZE<span class="token operator">*</span>TOTAL_ARRAYS<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token function">ArrayResize</span><span class="token punctuation">(</span>DataArray2<span class="token punctuation">,</span>ARRAY_SIZE<span class="token operator">*</span>TOTAL_ARRAYS<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 用数据填写数组 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>TOTAL_ARRAYS<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算 jth 数组局部开始偏移 </span>
      uint local_offset<span class="token operator">=</span>j<span class="token operator">*</span>ARRAY_SIZE<span class="token punctuation">;</span> 
      <span class="token comment">//--- 准备 j 索引数组 </span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>ARRAY_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 用MathCos(i+j)函数填写数组; </span>
         DataArray1<span class="token punctuation">[</span>i<span class="token operator">+</span>local_offset<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">MathCos</span><span class="token punctuation">(</span>i<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         DataArray2<span class="token punctuation">[</span>i<span class="token operator">+</span>local_offset<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">MathCos</span><span class="token punctuation">(</span>i<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 测试CPU 计算 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>TOTAL_ARRAYS<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算 j 索引数组  </span>
      <span class="token function">Test_CPU</span><span class="token punctuation">(</span>DataArray1<span class="token punctuation">,</span>ARRAY_SIZE<span class="token punctuation">,</span>j<span class="token punctuation">,</span>TOTAL_ARRAYS<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 准备 CLExecute 参数 </span>
   uint  offset<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 全局工作大小 </span>
   uint  work<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>TOTAL_ARRAYS<span class="token punctuation">}</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 编写数据到 OpenCL 缓冲 </span>
   <span class="token function">CLBufferWrite</span><span class="token punctuation">(</span>cl_mem<span class="token punctuation">,</span>DataArray2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 执行OpenCL 内核 </span>
   <span class="token function">CLExecute</span><span class="token punctuation">(</span>cl_krn<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>offset<span class="token punctuation">,</span>work<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 从OpenCL缓冲阅读数据 </span>
   <span class="token function">CLBufferRead</span><span class="token punctuation">(</span>cl_mem<span class="token punctuation">,</span>DataArray2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 总误差 </span>
   <span class="token keyword">double</span> total_error<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 比较结果和计算误差 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>TOTAL_ARRAYS<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 计算 jth 数组局部偏移 </span>
      uint local_offset<span class="token operator">=</span>j<span class="token operator">*</span>ARRAY_SIZE<span class="token punctuation">;</span> 
      <span class="token comment">//--- 比较结果 </span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>ARRAY_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token keyword">double</span> v1<span class="token operator">=</span>DataArray1<span class="token punctuation">[</span>i<span class="token operator">+</span>local_offset<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         <span class="token keyword">double</span> v2<span class="token operator">=</span>DataArray2<span class="token punctuation">[</span>i<span class="token operator">+</span>local_offset<span class="token punctuation">]</span><span class="token punctuation">;</span> 
         <span class="token keyword">double</span> delta<span class="token operator">=</span><span class="token function">MathAbs</span><span class="token punctuation">(</span>v2<span class="token operator">-</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         total_error<span class="token operator">+=</span>delta<span class="token punctuation">;</span> 
         <span class="token comment">//--- 显示初始和最后的数组 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>j<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>j<span class="token operator">==</span>TOTAL_ARRAYS<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;array %d of %d, element [%d]:  %f, %f, [error]=%f&quot;</span><span class="token punctuation">,</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>TOTAL_ARRAYS<span class="token punctuation">,</span>i<span class="token punctuation">,</span>v1<span class="token punctuation">,</span>v2<span class="token punctuation">,</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Total error: %f&quot;</span><span class="token punctuation">,</span>total_error<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 删除OpenCL 对象 </span>
<span class="token comment">//--- 释放 OpenCL 缓冲 </span>
   <span class="token function">CLBufferFree</span><span class="token punctuation">(</span>cl_mem<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 释放 OpenCL 内核 </span>
   <span class="token function">CLKernelFree</span><span class="token punctuation">(</span>cl_krn<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 释放 OpenCL 程序 </span>
   <span class="token function">CLProgramFree</span><span class="token punctuation">(</span>cl_prg<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 释放 OpenCL 环境 </span>
   <span class="token function">CLContextFree</span><span class="token punctuation">(</span>cl_ctx<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br></div></div><h2 id="_29-8-clprogramfree"><a href="#_29-8-clprogramfree" class="header-anchor">#</a> 29.8 CLProgramFree</h2> <p>删除一个OpenCL程序.</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">CLProgramFree</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  program     <span class="token comment">// 一个OpenCL句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>program</p> <p>[in] OpenCL句柄。</p> <p>返回值</p> <p>无。 在内部错误情况下 _LastError 的值会改变。想要获取有关错误的详细信息，请调用 GetLastError() 函数。</p> <h2 id="_29-9-clkernelcreate"><a href="#_29-9-clkernelcreate" class="header-anchor">#</a> 29.9 CLKernelCreate</h2> <p>创建OpenCL程序内核并返回其句柄。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">CLKernelCreate</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>           program<span class="token punctuation">,</span>        <span class="token comment">// 一个OpenCL句柄 </span>
   <span class="token keyword">const</span> string  kernel_name     <span class="token comment">// 内核名称 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>program</p> <p>[in] 一个OpenCL句柄。</p> <p>kernel_name</p> <p>[in] 适当的OpenCL程序中的内核函数的名称，执行开始。</p> <p>返回值</p> <p>如果成功将创建一个OpenCL句柄。一旦出错 返回-1。 想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p>注意</p> <p>目前，以下错误代码正在使用:<br>
• ERR_OPENCL_INVALID_HANDLE —— 无效的 OpenCL的句柄。<br>
• ERR_INVALID_PARAMETER —— 无效的字符串参数。<br>
• ERR_OPENCL_TOO_LONG_KERNEL_NAME —— 内核名称超过127个字符。<br>
• ERR_OPENCL_KERNEL_CREATE —— 创建OpenCL对象时发生的内部错误。</p> <h2 id="_29-10-clkernelfree"><a href="#_29-10-clkernelfree" class="header-anchor">#</a> 29.10 CLKernelFree</h2> <p>删除一个OpenCL启动函数.</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">CLKernelFree</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  kernel     <span class="token comment">// 处理OpenCL程序的内核 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>kernel_name</p> <p>[in] 处理OpenCL程序的内核。</p> <p>返回值</p> <p>无。 在内部错误情况下 _LastError 的值会改变。想要获取有关错误的详细信息，请调用 GetLastError() 函数。</p> <h2 id="_29-11-clsetkernelarg"><a href="#_29-11-clsetkernelarg" class="header-anchor">#</a> 29.11 CLSetKernelArg</h2> <p>为OpenCL函数设置一个参数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">CLSetKernelArg</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>   kernel<span class="token punctuation">,</span>        <span class="token comment">// 处理一个OpenCL程序内核 </span>
   uint  arg_index<span class="token punctuation">,</span>     <span class="token comment">// OpenCL函数幅角的数量 </span>
   <span class="token keyword">void</span>  arg_value      <span class="token comment">// 源代码 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>kernel</p> <p>[in] 处理一个OpenCL程序内核.</p> <p>arg_index</p> <p>[in] 函数参数的编号，编号从零开始。</p> <p>arg_value</p> <p>[in] 函数参数的值.</p> <p>返回值</p> <p>如果成功则返回true, 否则返回false。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p>注意</p> <p>目前，以下错误代码正在使用:<br>
• ERR_INVALID_PARAMETER —— 无效的参数<br>
• ERR_OPENCL_INVALID_HANDLE —— OpenCL内核的句柄无效<br>
• ERR_OPENCL_SET_KERNEL_PARAMETER —— OpenCL内部错误</p> <h2 id="_29-12-clsetkernelargmem"><a href="#_29-12-clsetkernelargmem" class="header-anchor">#</a> 29.12 CLSetKernelArgMem</h2> <p>设置一个OpenCL缓冲作为OpenCL函数的参数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">CLSetKernelArgMem</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>   kernel<span class="token punctuation">,</span>           <span class="token comment">// 处理一个OpenCL程序的内核 </span>
   uint  arg_index<span class="token punctuation">,</span>        <span class="token comment">// OpenCL函数参数的数量 </span>
   <span class="token keyword">int</span>   cl_mem_handle     <span class="token comment">// 处理一个OpenCL缓冲 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>kernel</p> <p>[in] 处理一个OpenCL程序的内核。</p> <p>arg_index</p> <p>[in] 函数参数的编号，编号从零开始。</p> <p>cl_mem_handle</p> <p>[in] 一个OpenCL缓冲处理句柄。</p> <p>返回值</p> <p>如果成功则返回true, 否则返回false。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <h2 id="_29-13-clsetkernelargmemlocal"><a href="#_29-13-clsetkernelargmemlocal" class="header-anchor">#</a> 29.13 CLSetKernelArgMemLocal</h2> <p>设置本地缓冲区作为内核函数参数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">CLSetKernelArgMemLocal</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>    kernel<span class="token punctuation">,</span>           <span class="token comment">// 处理OpenCL程序的内核 </span>
   uint   arg_index<span class="token punctuation">,</span>        <span class="token comment">// OpenCL函数参数的数值 </span>
   ulong  local_mem_size    <span class="token comment">// 缓冲区大小 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>kernel</p> <p>[in] 处理OpenCL程序的内核。</p> <p>arg_index</p> <p>[in] 函数参数的编号，编号从零开始。</p> <p>local_mem_size</p> <p>[in] 缓冲区的字节大小。</p> <p>返回值</p> <p>如果成功返回true，否则返回false。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <h2 id="_29-14-clbuffercreate"><a href="#_29-14-clbuffercreate" class="header-anchor">#</a> 29.14 CLBufferCreate</h2> <p>创建一个OpenCL缓冲并返回其句柄。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">CLBufferCreate</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>   context<span class="token punctuation">,</span>     <span class="token comment">// 一个OpenCL 上下文句柄 </span>
   uint  size<span class="token punctuation">,</span>        <span class="token comment">// 缓冲大小 </span>
   uint  flags        <span class="token comment">// 指定OpenCL缓冲性能的标志组合  </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>context</p> <p>[in] 一个OpenCL 上下文句柄。</p> <p>size</p> <p>[in] 缓冲字节大小。</p> <p>flags</p> <p>[in] 使用组合标帜的缓冲性能: CL_MEM_READ_WRITE, CL_MEM_WRITE_ONLY, CL_MEM_READ_ONLY, CL_MEM_ALLOC_HOST_PTR。</p> <p>返回值</p> <p>如果成功，则返回OpenCL缓冲的句柄。 一旦出错 返回-1。想要获取有关错误的详细信息，请调用 GetLastError() 函数.</p> <p>注意</p> <p>目前，以下错误代码正在使用:<br>
• ERR_OPENCL_INVALID_HANDLE —— 无效的OpenCL上下文句柄。<br>
• ERR_NOT_ENOUGH_MEMORY —— 内存不足。<br>
• ERR_OPENCL_BUFFER_CREATE —— 创建缓冲区时发生内部错误。<br></p> <h2 id="_29-15-clbufferfree"><a href="#_29-15-clbufferfree" class="header-anchor">#</a> 29.15 CLBufferFree</h2> <p>删除OpenCL缓冲。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span>  <span class="token function">CLBufferFree</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>   buffer     <span class="token comment">// 一个OpenCL缓冲句柄 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>buffer</p> <p>[in] 一个OpenCL缓冲句柄。</p> <p>返回值</p> <p>无。 在内部错误情况下 _LastError 的值会改变。想要获取有关错误的详细信息，请调用 GetLastError() 函数。</p> <h2 id="_28-16-clbufferwrite"><a href="#_28-16-clbufferwrite" class="header-anchor">#</a> 28.16 CLBufferWrite</h2> <p>写入OpenCL缓冲区并返回写入元素的数量。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">CLBufferWrite</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          buffer<span class="token punctuation">,</span>                    <span class="token comment">// 一个OpenCL缓冲句柄 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token comment">// 值的数组 </span>
   uint         buffer_offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>           <span class="token comment">// 字节区偏移的OpenCL缓冲，默认为0 </span>
   uint         data_offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// 元素中数组的偏移，默认为0 </span>
   uint         data_count<span class="token operator">=</span>WHOLE_ARRAY     <span class="token comment">// 从阵列写入的值的数量，默认整个阵列 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参数</p> <p>buffer</p> <p>[in] 一个OpenCL缓冲句柄。</p> <p>data[]</p> <p>[in] 应该在OpenCL缓冲区中写入的值数组。 通过引用传递。</p> <p>buffer_offset</p> <p>[in] OpenCL缓冲区中的偏移量，以字节为单位，从中开始写入。默认情况下，从缓冲区的开头开始写入。</p> <p>data_offset</p> <p>[in] 第一个数组元素的索引，从数组中的值开始写入OpenCL缓冲区。默认情况下，从数组的最开始处获取值。</p> <p>data_count</p> <p>[in] 应写入的值的数量。 默认情况下，为该数组的所有值。</p> <p>返回值</p> <p>写入元素的数量. 错误情况下返回0。想要获取有关错误的详细信息，请调用 GetLastError() 函数。</p> <p>注意</p> <p>对于一维数组，在读取数据用于写入OpenCL缓冲区的元素时，计算的数量，是在考虑了AS_SERIES标帜的情况下得出的。</p> <p>一个二维或多维的数组被表示为一维时。在这种情况下，data_offset是表示中应该跳过的元素数量，而不是第一个维度中的元素数量。</p> <h2 id="_29-17-clbufferread"><a href="#_29-17-clbufferread" class="header-anchor">#</a> 29.17 CLBufferRead</h2> <p>读取OpenCL缓冲区并返回写入元素的数量。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>uint  <span class="token function">CLBufferRead</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>          buffer<span class="token punctuation">,</span>                    <span class="token comment">// 处理一个OpenCL缓冲 </span>
   <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">&amp;</span>  data<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token comment">// 一个值的数组 </span>
   uint         buffer_offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>           <span class="token comment">// 在字节缓冲区偏移的OpenCL，默认为0 </span>
   uint         data_offset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// 在元素的数组的偏移量，默认为0 </span>
   uint         data_count<span class="token operator">=</span>WHOLE_ARRAY     <span class="token comment">// 用于读取的缓冲值的个数，默认为整个缓冲区 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参数</p> <p>buffer</p> <p>[in] 一个OpenCL缓冲句柄。</p> <p>data[]</p> <p>[in] 用于从OpenCL缓冲区接收值的数组。 通过引用传递。</p> <p>buffer_offset</p> <p>[in] OpenCL缓冲区中的偏移量，以字节为单位，从中开始写入。默认情况下，从缓冲区的开头开始写入。</p> <p>data_offset</p> <p>[in] 第一个数组元素的索引，从数组中的值开始写入OpenCL缓冲区。默认情况下，从数组的最开始处获取值。</p> <p>data_count</p> <p>[in] 应读取的值的数量。默认情况下，为该数组的所有值。</p> <p>返回值</p> <p>读取元素的数量. 错误情况下返回0。想要获取有关错误的详细信息，请调用 GetLastError() 函数。</p> <p>注意</p> <p>对于一维数组，在读取数据用于写入OpenCL缓冲区的元素时，计算的数量，是在考虑了AS_SERIES标帜的情况下得出的。</p> <p>一个二维或多维的数组被表示为一维时。在这种情况下，data_offset是表示中应该跳过的元素数量，而不是第一个维度中的元素数量。</p> <h2 id="_29-18-clexecute"><a href="#_29-18-clexecute" class="header-anchor">#</a> 29.18 CLExecute</h2> <p>此函数运行一个 OpenCL程序。有三个版本的变体：</p> <ol><li>用一个内核启动内核函数</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  CLExecute( 
   int          kernel                    // 处理一个OpenCL程序的内核 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>启动几个内核副本 (OpenCL函数) 与任务空间描述</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  CLExecute( 
   int          kernel,                   // 处理一个OpenCL程序的内核 
   uint         work_dim,                 // 任务空间维度 
   const uint&amp;  global_work_offset[],     // 在任务空间初始偏移 
   const uint&amp;  global_work_size[]        // 任务总数 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>启动几个内核副本 (OpenCL函数) 与任务空间描述以及集合本地任务子集大小规范</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  CLExecute( 
   int          kernel,                   // 处理一个OpenCL程序的内核 
   uint         work_dim,                 // 任务空间维度 
   const uint&amp;  global_work_offset[],     // 在任务空间初始偏移 
   const uint&amp;  global_work_size[],       // 任务总数 
   const uint&amp;  local_work_size[]         // 在本地集合中的任务数 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参数</p> <p>kernel</p> <p>[in] 处理OpenCL内核。</p> <p>work_dim</p> <p>[in] 任务空间维度。</p> <p>global_work_offset[]</p> <p>[in] 在任务空间初始偏移。</p> <p>global_work_size[]</p> <p>[in] 任务子集大小。</p> <p>local_work_size[]</p> <p>[in] 集合本地任务子集大小。</p> <p>返回值</p> <p>如果成功则返回true, 否则返回false。 想要获取有关错误的详细信息，请调用 GetLastError() 函数。</p> <p>注意</p> <p>以下例子中要考虑参数的使用：<br>
• work_dim 指定 work_items[] 描述任务的阵列维度. 如果work_dim=3,三维阵列work_items[N1, N2, N3] 将被使用。<br>
• global_work_size[] 包含设定 work_items[]阵列大小的值. 如果 work_dim=3， global_work_size[3] 阵列将是 {40, 100, 320}。 然后我们将得到 work_items[40, 100, 320]。 所以，任务总数是 is 40 x 100 x 320 = 1 280 000。<br>
• local_work_size[] 设定任务的子集将由OpenCL程序的指定内核来执行。 其维度等于 work_items[] 维度并允许共同任务子集精确分割成更小的子集。 事实上，应当选择 local_work_size[] 从而使全局任务设定分割成更小的子集。 <br></p> <p>local_work_size[3]={10, 10, 10} 将适合当前的例子， 比如work_items[40, 100, 320] 能被 local_items[10, 10, 10] 阵列毫无剩余的收集起来。</p> <h2 id="_29-19-clexecutionstatus"><a href="#_29-19-clexecutionstatus" class="header-anchor">#</a> 29.19 CLExecutionStatus</h2> <p>返回OpenCL程序执行状态。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  CLExecutionStatus( 
   int   kernel            // 处理OpenCL程序的内核 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>kernel</p> <p>[in] 处理OpenCL程序的内核。</p> <p>返回值</p> <p>返回OpenCL程序状态。该值可以是以下值的其中一个：<br>
• CL_COMPLETE=0 —— 程序完成，<br>
• CL_RUNNING=1 —— 运行，<br>
• CL_SUBMITTED=2 —— 提交执行，<br>
• CL_QUEUED=3 —— 排队，<br>
• -1 (负1) —— 执行CLExecutionStatus()时出现错误。<br></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mql5yao/Chapter/twentyeight.html" class="prev">
        28 第二十八章 工作事件
      </a></span> <span class="next"><a href="/mql5yao/Chapter/thirty.html">
        30 第三十章 使用数据库
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mql5yao/assets/js/app.33d9106b.js" defer></script><script src="/mql5yao/assets/js/3.64586e1a.js" defer></script><script src="/mql5yao/assets/js/43.3f173f86.js" defer></script>
  </body>
</html>
