<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能交易*姚 文档站</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/mql5yao/favicon.ico">
    <meta name="description" content="这是智能交易的文档站点。">
    <meta name="keywords" content="MQL,EA,智能交易,自动交易,量化,编程,培训">
    
    <link rel="preload" href="/mql5yao/assets/css/0.styles.7f3ae2a1.css" as="style"><link rel="preload" href="/mql5yao/assets/js/app.8a48e4d1.js" as="script"><link rel="preload" href="/mql5yao/assets/js/2.8ccfeae3.js" as="script"><link rel="preload" href="/mql5yao/assets/js/1.abd3212e.js" as="script"><link rel="preload" href="/mql5yao/assets/js/49.0b669611.js" as="script"><link rel="prefetch" href="/mql5yao/assets/js/10.f43632ba.js"><link rel="prefetch" href="/mql5yao/assets/js/11.1d038644.js"><link rel="prefetch" href="/mql5yao/assets/js/12.e50722f3.js"><link rel="prefetch" href="/mql5yao/assets/js/13.bc6e6556.js"><link rel="prefetch" href="/mql5yao/assets/js/14.5cb8131f.js"><link rel="prefetch" href="/mql5yao/assets/js/15.bc368dfb.js"><link rel="prefetch" href="/mql5yao/assets/js/16.60e872ed.js"><link rel="prefetch" href="/mql5yao/assets/js/17.15a8a4c2.js"><link rel="prefetch" href="/mql5yao/assets/js/18.a3079194.js"><link rel="prefetch" href="/mql5yao/assets/js/19.2e53fae9.js"><link rel="prefetch" href="/mql5yao/assets/js/20.ff88a6ab.js"><link rel="prefetch" href="/mql5yao/assets/js/21.24994246.js"><link rel="prefetch" href="/mql5yao/assets/js/22.5048fb10.js"><link rel="prefetch" href="/mql5yao/assets/js/23.b0f62895.js"><link rel="prefetch" href="/mql5yao/assets/js/24.47212fdf.js"><link rel="prefetch" href="/mql5yao/assets/js/25.31655e4d.js"><link rel="prefetch" href="/mql5yao/assets/js/26.eaeeac1b.js"><link rel="prefetch" href="/mql5yao/assets/js/27.62ad36df.js"><link rel="prefetch" href="/mql5yao/assets/js/28.69609490.js"><link rel="prefetch" href="/mql5yao/assets/js/29.bd4055a1.js"><link rel="prefetch" href="/mql5yao/assets/js/3.0ebc6d24.js"><link rel="prefetch" href="/mql5yao/assets/js/30.f43e33e8.js"><link rel="prefetch" href="/mql5yao/assets/js/31.08aac79a.js"><link rel="prefetch" href="/mql5yao/assets/js/32.e40034cb.js"><link rel="prefetch" href="/mql5yao/assets/js/33.f14c86ef.js"><link rel="prefetch" href="/mql5yao/assets/js/34.35c02b74.js"><link rel="prefetch" href="/mql5yao/assets/js/35.048a5906.js"><link rel="prefetch" href="/mql5yao/assets/js/36.7be7df03.js"><link rel="prefetch" href="/mql5yao/assets/js/37.caf30399.js"><link rel="prefetch" href="/mql5yao/assets/js/38.7081ef66.js"><link rel="prefetch" href="/mql5yao/assets/js/39.8b16de3c.js"><link rel="prefetch" href="/mql5yao/assets/js/4.64cdca5a.js"><link rel="prefetch" href="/mql5yao/assets/js/40.c4bcc68d.js"><link rel="prefetch" href="/mql5yao/assets/js/41.9e814ceb.js"><link rel="prefetch" href="/mql5yao/assets/js/42.626ed300.js"><link rel="prefetch" href="/mql5yao/assets/js/43.9e56dbd2.js"><link rel="prefetch" href="/mql5yao/assets/js/44.b0aa6080.js"><link rel="prefetch" href="/mql5yao/assets/js/45.1ee1c2de.js"><link rel="prefetch" href="/mql5yao/assets/js/46.c7e60312.js"><link rel="prefetch" href="/mql5yao/assets/js/47.294d2506.js"><link rel="prefetch" href="/mql5yao/assets/js/48.9896cb6c.js"><link rel="prefetch" href="/mql5yao/assets/js/5.6e0bc11f.js"><link rel="prefetch" href="/mql5yao/assets/js/50.d4317362.js"><link rel="prefetch" href="/mql5yao/assets/js/51.7cde1a30.js"><link rel="prefetch" href="/mql5yao/assets/js/52.593fbf2b.js"><link rel="prefetch" href="/mql5yao/assets/js/53.47314628.js"><link rel="prefetch" href="/mql5yao/assets/js/54.9177a36c.js"><link rel="prefetch" href="/mql5yao/assets/js/55.890a40de.js"><link rel="prefetch" href="/mql5yao/assets/js/56.950e221a.js"><link rel="prefetch" href="/mql5yao/assets/js/57.42541ac8.js"><link rel="prefetch" href="/mql5yao/assets/js/58.b782ed1e.js"><link rel="prefetch" href="/mql5yao/assets/js/59.0f7a8fa5.js"><link rel="prefetch" href="/mql5yao/assets/js/6.30ab1089.js"><link rel="prefetch" href="/mql5yao/assets/js/60.bb949f49.js"><link rel="prefetch" href="/mql5yao/assets/js/61.fb831bab.js"><link rel="prefetch" href="/mql5yao/assets/js/62.1d11fcd0.js"><link rel="prefetch" href="/mql5yao/assets/js/63.5e21940a.js"><link rel="prefetch" href="/mql5yao/assets/js/7.7481afc6.js"><link rel="prefetch" href="/mql5yao/assets/js/vendors~docsearch.b8e67d2d.js">
    <link rel="stylesheet" href="/mql5yao/assets/css/0.styles.7f3ae2a1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mql5yao/" class="home-link router-link-active"><img src="/mql5yao/logo.png" alt="智能交易*姚 文档站" class="logo"> <span class="site-name can-hide">智能交易*姚 文档站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mql5yao/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/mql5yao/Chapter/start.html" class="nav-link">
  文档
</a></div><div class="nav-item"><a href="/mql5yao/Cutleeks/" class="nav-link">
  割韭菜XX招
</a></div><div class="nav-item"><a href="/mql5yao/support/" class="nav-link">
  支持本站
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MQL5线上手册</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mql5yao/Chapter/start.html" class="sidebar-link">MQL5 参考</a></li><li><a href="/mql5yao/Chapter/one.html" class="sidebar-link">01 第一章 语言基础</a></li><li><a href="/mql5yao/Chapter/two.html" class="sidebar-link">02 第二章 标准常量，列举和架构</a></li><li><a href="/mql5yao/Chapter/three.html" class="sidebar-link">03 第三章 MQL5程序</a></li><li><a href="/mql5yao/Chapter/four.html" class="sidebar-link">04 第四章 预定义变量</a></li><li><a href="/mql5yao/Chapter/five.html" class="sidebar-link">05 第五章 普通函数</a></li><li><a href="/mql5yao/Chapter/six.html" class="sidebar-link">06 第六章 数组函数</a></li><li><a href="/mql5yao/Chapter/add1.html" class="sidebar-link">07 第七章 矩阵和向量方法</a></li><li><a href="/mql5yao/Chapter/seven.html" class="sidebar-link">08 第八章 函数转换</a></li><li><a href="/mql5yao/Chapter/eight.html" class="sidebar-link">09 第九章 数学函数</a></li><li><a href="/mql5yao/Chapter/nine.html" class="sidebar-link">10 第十章 字符串函数</a></li><li><a href="/mql5yao/Chapter/ten.html" class="sidebar-link">11 第十一章 日期和时间</a></li><li><a href="/mql5yao/Chapter/eleven.html" class="sidebar-link">12 第十二章 账户信息</a></li><li><a href="/mql5yao/Chapter/twelve.html" class="sidebar-link">13 第十三章 检测</a></li><li><a href="/mql5yao/Chapter/thirteen.html" class="sidebar-link">14 第十四章 事件处理</a></li><li><a href="/mql5yao/Chapter/fourteen.html" class="sidebar-link">15 第十五章 市场信息</a></li><li><a href="/mql5yao/Chapter/fifteen.html" class="sidebar-link">16 第十六章 经济日历函数</a></li><li><a href="/mql5yao/Chapter/sixteen.html" class="sidebar-link">17 第十七章 时间序列和指标访问</a></li><li><a href="/mql5yao/Chapter/seventeen.html" class="sidebar-link">18 第十八章 自定义交易品种</a></li><li><a href="/mql5yao/Chapter/eighteen.html" class="sidebar-link">19 第十九章 图表操作</a></li><li><a href="/mql5yao/Chapter/ninteen.html" aria-current="page" class="active sidebar-link">20 第二十章 交易函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-1-ordercalcmargin" class="sidebar-link">19.1 OrderCalcMargin</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-2-ordercalcprofit" class="sidebar-link">19.2 OrderCalcProfit</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-3-ordercheck" class="sidebar-link">19.3 OrderCheck</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-4-ordersend" class="sidebar-link">19.4 OrderSend</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-5-ordersendasync" class="sidebar-link">19.5 OrderSendAsync</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-6-positionstotal" class="sidebar-link">19.6 PositionsTotal</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-7-positiongetsymbol" class="sidebar-link">19.7 PositionGetSymbol</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-8-positionselect" class="sidebar-link">19.8 PositionSelect</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-9-positionselectbyticket" class="sidebar-link">19.9 PositionSelectByTicket</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-10-positiongetdouble" class="sidebar-link">19.10 PositionGetDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-11-positiongetinteger" class="sidebar-link">19.11 PositionGetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-12-positiongetstring" class="sidebar-link">19.12 PositionGetString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-13-positiongetticket" class="sidebar-link">19.13 PositionGetTicket</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-14-orderstotal" class="sidebar-link">19.14 OrdersTotal</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-15-ordergetticket" class="sidebar-link">19.15 OrderGetTicket</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-16-orderselect" class="sidebar-link">19.16 OrderSelect</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-17-ordergetdouble" class="sidebar-link">19.17 OrderGetDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-18-ordergetinteger" class="sidebar-link">19.18 OrderGetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-19-ordergetstring" class="sidebar-link">19.19 OrderGetString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-20-historyselect" class="sidebar-link">19.20 HistorySelect</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-21-historyselectbyposition" class="sidebar-link">19.21 HistorySelectByPosition</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-22-historyorderselect" class="sidebar-link">19.22 HistoryOrderSelect</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-23-historyorderstotal" class="sidebar-link">19.23 HistoryOrdersTotal</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-24-historyordergetticket" class="sidebar-link">19.24 HistoryOrderGetTicket</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-25-historyordergetstring" class="sidebar-link">19.25 HistoryOrderGetString</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-26-historyordergetdouble" class="sidebar-link">19.26 HistoryOrderGetDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-27-historyordergetinteger" class="sidebar-link">19.27 HistoryOrderGetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-28-historydealselect" class="sidebar-link">19.28 HistoryDealSelect</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-29-historydealstotal" class="sidebar-link">19.29 HistoryDealsTotal</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-30-historydealgetticket" class="sidebar-link">19.30 HistoryDealGetTicket</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-31-historydealgetdouble" class="sidebar-link">19.31 HistoryDealGetDouble</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-32-historydealgetinteger" class="sidebar-link">19.32 HistoryDealGetInteger</a></li><li class="sidebar-sub-header"><a href="/mql5yao/Chapter/ninteen.html#_19-33-historydealgetstring" class="sidebar-link">19.33 HistoryDealGetString</a></li></ul></li><li><a href="/mql5yao/Chapter/twenty.html" class="sidebar-link">21 第廿一章 交易信号</a></li><li><a href="/mql5yao/Chapter/twentyone.html" class="sidebar-link">22 第廿二章 网络函数</a></li><li><a href="/mql5yao/Chapter/twentytwo.html" class="sidebar-link">23 第廿三章 程序端全局变量</a></li><li><a href="/mql5yao/Chapter/twentythree.html" class="sidebar-link">24 第廿四章 文件函数</a></li><li><a href="/mql5yao/Chapter/twentyfour.html" class="sidebar-link">25 第廿五章 自定义指标</a></li><li><a href="/mql5yao/Chapter/twentyfive.html" class="sidebar-link">26 第廿六章 物件函数</a></li><li><a href="/mql5yao/Chapter/twentysix.html" class="sidebar-link">27 第廿七章 技术指标</a></li><li><a href="/mql5yao/Chapter/twentyseven.html" class="sidebar-link">28 第甘八章 处理优化结果</a></li><li><a href="/mql5yao/Chapter/twentyeight.html" class="sidebar-link">29 第廿九章 工作事件</a></li><li><a href="/mql5yao/Chapter/twentynine.html" class="sidebar-link">30 第三十章 使用OpenCL工作</a></li><li><a href="/mql5yao/Chapter/thirty.html" class="sidebar-link">31 第卅一章 使用数据库</a></li><li><a href="/mql5yao/Chapter/thirtyone.html" class="sidebar-link">32 第卅二章 使用DirectX</a></li><li><a href="/mql5yao/Chapter/thirtytwo.html" class="sidebar-link">33 第卅三章 MetaTrader与Python集成的模块</a></li><li><a href="/mql5yao/Chapter/add2.html" class="sidebar-link">34 第卅四章 ONNX模型</a></li><li><a href="/mql5yao/Chapter/thirtythree.html" class="sidebar-link">35 第卅五章 标准程序库</a></li><li><a href="/mql5yao/Chapter/AppendixI.html" class="sidebar-link">36 附录一 来自MQL4</a></li><li><a href="/mql5yao/Chapter/AppendixII.html" class="sidebar-link">37 附录二 MQL5 函数列表</a></li><li><a href="/mql5yao/Chapter/AppendixIII.html" class="sidebar-link">38 附录三 MQL5常量列表</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2> 第十九章 交易函数 </h2> <p>这是用于管理交易活动的一组函数。</p> <p>交易函数在EA程序 或 脚本 中使用，只有在EA交易的属性 或 脚本中勾选启用了“允许实时自动交易”复选框，交易函数才能被调用。<br>
根据“交易权限”部分中描述的各种因素，交易可以被允许或禁止。</p> <table><thead><tr><th>函数</th> <th>功能</th></tr></thead> <tbody><tr><td>OrderCalcMargin</td> <td>以存款货币为单位计算指定订单类型所需的保证金</td></tr> <tr><td>OrderCalcProfit</td> <td>以存款货币为单位,根据传递的形式参数计算利润</td></tr> <tr><td>OrderCheck</td> <td>检测是否有足够资金执行所请求的交易操作.</td></tr> <tr><td>OrderSend</td> <td>发送 交易请求 到服务器</td></tr> <tr><td>OrderSendAsync</td> <td>异步发送交易请求，意即无需等待交易服务器的响应</td></tr> <tr><td>PositionsTotal</td> <td>返回持仓头寸仓位的总数量</td></tr> <tr><td>PositionGetSymbol</td> <td>返回与相应持仓头寸仓位的交易品种</td></tr> <tr><td>PositionSelect</td> <td>选中一个仓位以便进行下一步工作</td></tr> <tr><td>PositionSelectByTicket</td> <td>通过指定的单号选中一个仓位以便下一步工作</td></tr> <tr><td>PositionGetDouble</td> <td>请求返回一个仓位的(双精度类型)属性</td></tr> <tr><td>PositionGetInteger</td> <td>请求返回一个仓位的(日期时间 或 整型)属性</td></tr> <tr><td>PositionGetString</td> <td>请求返回一个仓位的(字符串型)属性</td></tr> <tr><td>PositionGetTicket</td> <td>返回仓位列表中指定索引编号的订单号</td></tr> <tr><td>OrdersTotal</td> <td>返回订单总数量</td></tr> <tr><td>OrderGetTicket</td> <td>返回相应订单的订单号</td></tr> <tr><td>OrderSelect</td> <td>选中一个订单以便进行下一步工作</td></tr> <tr><td>OrderGetDouble</td> <td>请求返回一个订单的(双精度类型)属性</td></tr> <tr><td>OrderGetInteger</td> <td>请求返回一个订单的(日期时间 或 整型)属性</td></tr> <tr><td>OrderGetString</td> <td>请求返回一个订单的(字符串型)属性</td></tr> <tr><td>HistorySelect</td> <td>检索服务器上指定时间段内的交易事务和订单历史记录</td></tr> <tr><td>HistorySelectByPosition</td> <td>请求指定仓位标识符交易的历史记录</td></tr> <tr><td>HistoryOrderSelect</td> <td>选中一个历史订单以便进行下一步工作</td></tr> <tr><td>HistoryOrdersTotal</td> <td>返回历史记录中订单总数</td></tr> <tr><td>HistoryOrderGetTicket</td> <td>返回历史记录中相关订单的订单号</td></tr> <tr><td>HistoryOrderGetDouble</td> <td>请求返回一个历史订单的(双精度类型)属性</td></tr> <tr><td>HistoryOrderGetInteger</td> <td>请求返回一个历史订单的(日期时间 或 整型)属性</td></tr> <tr><td>HistoryOrderGetString</td> <td>请求返回一个历史订单的(字符串型)属性</td></tr> <tr><td>HistoryDealSelect</td> <td>在历史记录中选中一笔交易，以便通过适当的函数进一步调用</td></tr> <tr><td>HistoryDealsTotal</td> <td>返回历史记录中的交易总数量</td></tr> <tr><td>HistoryDealGetTicket</td> <td>返回历史记录中相关交易的订单号</td></tr> <tr><td>HistoryDealGetDouble</td> <td>请求返回历史记录中一笔交易的(双精度类型)属性</td></tr> <tr><td>HistoryDealGetInteger</td> <td>请求返回历史记录中一笔交易的(日期时间 或 整型)属性</td></tr> <tr><td>HistoryDealGetString</td> <td>请求返回历史记录中一笔交易的(字符串型)属性</td></tr></tbody></table> <h2 id="_19-1-ordercalcmargin"><a href="#_19-1-ordercalcmargin" class="header-anchor">#</a> 19.1 OrderCalcMargin</h2> <p>该函数计算当前市场环境下当前账户中指定定单类型所需的保证金，但不考虑当前挂单和未平仓头寸。它允许为计划的交易事务评估保证金。该值以账户货币单位返回。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderCalcMargin</span><span class="token punctuation">(</span> 
   ENUM_ORDER_TYPE       action<span class="token punctuation">,</span>           <span class="token comment">// 订单类型 </span>
   string                symbol<span class="token punctuation">,</span>           <span class="token comment">// 交易品种名称 </span>
   <span class="token keyword">double</span>                volume<span class="token punctuation">,</span>           <span class="token comment">// 交易量 </span>
   <span class="token keyword">double</span>                price<span class="token punctuation">,</span>            <span class="token comment">// 开盘价 </span>
   <span class="token keyword">double</span><span class="token operator">&amp;</span>               margin            <span class="token comment">// 为获取保证金值的值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>参数</p> <p>action</p> <p>[in] 订单类型，取值范围是 ENUM_ORDER_TYPE 枚举值之一。</p> <p>symbol</p> <p>[in] 交易品种名称。</p> <p>volume</p> <p>[in] 成交量。</p> <p>price</p> <p>[in] 打开订单的价格。</p> <p>margin</p> <p>[out] 保存保证金数值的变量。在函数执行成功的情况下将写入所需的保证金的值。计算过程就好像当前账户没有 挂单 和 持有仓位一样。保证金的值取决于许多因素，并且可能在不同的市场环境中有所不同。</p> <p>返回值</p> <p>如果成功，函数返回true，否则返回false，如果想要获得有关的错误信息，请调用 GetLastError() 函数。</p> <p>相关参考</p> <p>OrderSend()， 订单属性， 交易操作类型</p> <h2 id="_19-2-ordercalcprofit"><a href="#_19-2-ordercalcprofit" class="header-anchor">#</a> 19.2 OrderCalcProfit</h2> <p>该函数根据传递的形式参数计算当前市场状况下，当前账户的利润。 该函数用于交易操作结果的预评估。返回值以账户货币为单位。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderCalcProfit</span><span class="token punctuation">(</span> 
   ENUM_ORDER_TYPE       action<span class="token punctuation">,</span>           <span class="token comment">// 订单类型 (ORDER_TYPE_BUY 或者 ORDER_TYPE_SELL) </span>
   string                symbol<span class="token punctuation">,</span>           <span class="token comment">// 交易品种名称 </span>
   <span class="token keyword">double</span>                volume<span class="token punctuation">,</span>           <span class="token comment">// 交易量 </span>
   <span class="token keyword">double</span>                price_open<span class="token punctuation">,</span>       <span class="token comment">// 开盘价 </span>
   <span class="token keyword">double</span>                price_close<span class="token punctuation">,</span>      <span class="token comment">// 收盘价 </span>
   <span class="token keyword">double</span><span class="token operator">&amp;</span>               profit            <span class="token comment">// 为获得利润值的变量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>参数</p> <p>action</p> <p>[in] 订单类型，取值范围是 ENUM_ORDER_TYPE 枚举的ORDER_TYPE_BUY 或 ORDER_TYPE_SELL值中之一。<br>
symbol</p> <p>[in] 交易品种名称。</p> <p>volume</p> <p>[in] 成交量。</p> <p>price_open</p> <p>[in] 打开订单的价格。</p> <p>price_close</p> <p>[in] 关闭平仓时的价格。</p> <p>profit</p> <p>[out] 保存计算得出的利润值的变量，在函数成功执行后写入，估计利润值取决于许多因素，并且可能在不同的市场环境中有所不同。</p> <p>返回值</p> <p>如果成功，函数返回true,否则返回false。如果指定无效订单类型，函数返回false。如果想要获得有关的错误信息，请调用 GetLastError() 函数。</p> <p>相关参考</p> <p>OrderSend()， 订单属性， 交易操作类型</p> <h2 id="_19-3-ordercheck"><a href="#_19-3-ordercheck" class="header-anchor">#</a> 19.3 OrderCheck</h2> <p>OrderCheck()函数检测是否有足够的资金执行请求的交易操作。检测结果会保存在MqlTradeCheckResult结构的字段域中。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderCheck</span><span class="token punctuation">(</span> 
   MqlTradeRequest<span class="token operator">&amp;</span>       request<span class="token punctuation">,</span>      <span class="token comment">// 请求结构 </span>
   MqlTradeCheckResult<span class="token operator">&amp;</span>   result        <span class="token comment">// 结果结构 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>request</p> <p>[in] 指向MqlTradeRequest类型的结构的指针，它描述了所请求的交易操作。</p> <p>result</p> <p>[in,out] 指向保存检查结果的MqlTradeCheckResult类型的结构的指针。</p> <p>返回值</p> <p>如果资金不足以完成操作，或者参数填写不正确，则该函数返回false。如果对结构进行了成功的基本检查(检查指针)，则返回true。 但是，这并不表示所请求的交易操作肯定会成功执行。有关函数执行结果的更详细描述，请分析结果结构的字段。</p> <p>如果想要获得有关的错误信息，请调用 GetLastError() 函数。</p> <p>相关参考</p> <p>OrderSend()， 交易操作类型， 交易请求结构， 检测结果请求结构， 交易请求结果结构</p> <h2 id="_19-4-ordersend"><a href="#_19-4-ordersend" class="header-anchor">#</a> 19.4 OrderSend</h2> <p>发送 交易请求 到服务器，OrderSend()函数用来执行交易操作。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderSend</span><span class="token punctuation">(</span> 
   MqlTradeRequest<span class="token operator">&amp;</span>  request<span class="token punctuation">,</span>      <span class="token comment">// query structure </span>
   MqlTradeResult<span class="token operator">&amp;</span>   result        <span class="token comment">// structure of the answer </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>request</p> <p>[in] 指向描述客户端交易活动的MqlTradeRequest类型结构的指针。</p> <p>result</p> <p>[in,out] 指向MqlTradeResult类型结构的指针，描述成功完成交易操作的结果(如果返回true)。</p> <p>返回值</p> <p>成功的基础检查结构(索引检查)返回true。 然而，这并不是成功执行交易事务的标志。有关函数执行结果的更详细描述，请分析结果结构的字段。</p> <p>注意</p> <p>交易请求需要经过交易服务器上的多个步骤检查。第一，它检查请求参数的所有必填字段是否正确填写。如果没有错误，则服务器接受订单以进一步处理。如果交易服务器成功接受订单，则OrderSend()函数返回true。</p> <p>建议在将 交易请求 发送到交易服务器之前先检查交易请求。要检查交易请求，请使用OrderCheck()函数。它检查是否有足够的资金来执行交易操作，并在交易请求检查结果中返回许多有用的参数：</p> <p>• 返回码 在检测请求中包含的错误信息；<br>
• 在交易操作执行后显示账户 余额；<br>
• 在交易操作执行后显示帐户 净值；<br>
• 在交易操作执行后显示 浮点值；<br>
• 交易操作所需保证金；<br>
• 在交易操作执行后可用的净值数量；<br>
• 在交易操作执行后设定的保证金比例；<br>
• 注释回应代码，描述错误信息。</p> <p>在发送市场订单(MqlTradeRequest.action = TRADE_ACTION_DEAL)时，OrderSend()函数的成功结果并不意味着该订单已被执行(适当的交易已执行)。在这种情况下，“TRUE”只意味着订单已成功放入交易系统以供进一步执行。交易服务器可能在返回的 交易请求结果结构 (MqlTradeResult) 中填写 ‘deal’(交易) 或 ‘order’(定单) 字段的值，如果它在形成对OrderSend()调用的响应时感知到这些数据。通常，在发送对OrderSend()调用的响应之后，可能发生执行与订单相对应的交易的事件。因此，对于任何类型的交易请求，当接收到OrderSend()执行结果时，我们应该首先检查获得的 结果结构 中可用的 交易服务器响应代码(retcode) 和 外部系统响应代码(retcode_external)(如果需要)。</p> <p>应该注意的是，成功完成OrderSend()方法操作并不总是意味着在下达市价单时成功完成交易。根据返回结果中的操作类型检查包含交易服务器返回代码的交易码值，以及 ‘deal’(交易) 或 ‘order’(定单) 字段的值。</p> <p>每个接收到的订单都存储在交易服务器中排队处理，直到可以执行的条件发生：
• 到达过期时间，
出现相反的交易请求，
• 当执行价格出现时即执行订单，
• 收到的取消订单的命令。</p> <p>在订单处理的时刻，交易服务器向客户端发送关于交易事件发生的消息，消息可以由OnTrade()函数处理。</p> <p>在通过OrderSend()函数发送的服务器上执行交易请求的结果可以通过OnTradeTransaction 处理程序跟踪。应该注意，当执行交易请求时，将会多次调用OnTradeTransaction处理程序。</p> <p>例如，当发送市场买入(buy)订单时，它会被处理，为该账户创建一个适当的买入(buy)订单，然后执行订单并从持仓订单列表中移除，然后它被添加到订单历史记录中，相应的交易(deal)也被添加到历史记录中 并 创建一个新的持仓位。OnTradeTransaction函数将会为这里每个事件进行调用。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//--- ORDER_MAGIC值 </span>
input <span class="token keyword">long</span> order_magic<span class="token operator">=</span><span class="token number">55555</span><span class="token punctuation">;</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 启动函数的脚本程序                                                  | </span>
<span class="token comment">//| 此脚本为 MQL5 专用，仅适用于 MT5 客户端   (智能交易*姚 注)               | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 确保账户是样本 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_TRADE_MODE<span class="token punctuation">)</span><span class="token operator">==</span>ACCOUNT_TRADE_MODE_REAL<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Script operation is not allowed on a live account!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 下订单或者删除订单 </span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">GetOrdersTotalByMagic</span><span class="token punctuation">(</span>order_magic<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>  
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 无当前订单 - 下订单 </span>
      uint res<span class="token operator">=</span><span class="token function">SendRandomPendingOrder</span><span class="token punctuation">(</span>order_magic<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Return code of the trade server &quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span> <span class="token comment">// 有订单 - 删除订单 </span>
     <span class="token punctuation">{</span> 
      <span class="token function">DeleteAllOrdersByMagic</span><span class="token punctuation">(</span>order_magic<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 接收当前带有指定的ORDER_MAGIC的订单号                                | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">int</span> <span class="token function">GetOrdersTotalByMagic</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">const</span> magic_number<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   ulong order_ticket<span class="token punctuation">;</span> 
   <span class="token keyword">int</span> total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 检查通过所有挂单 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>order_ticket<span class="token operator">=</span><span class="token function">OrderGetTicket</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span> 
         <span class="token keyword">if</span><span class="token punctuation">(</span>magic_number<span class="token operator">==</span><span class="token function">OrderGetInteger</span><span class="token punctuation">(</span>ORDER_MAGIC<span class="token punctuation">)</span><span class="token punctuation">)</span> total<span class="token operator">++</span><span class="token punctuation">;</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 删除所有带有指定ORDER_MAGIC的挂单                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">void</span> <span class="token function">DeleteAllOrdersByMagic</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">const</span> magic_number<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   ulong order_ticket<span class="token punctuation">;</span> 
<span class="token comment">//--- 检查所有挂单 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span> 
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>order_ticket<span class="token operator">=</span><span class="token function">OrderGetTicket</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> 
         <span class="token comment">//--- 带有恰当ORDER_MAGIC的订单  </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>magic_number<span class="token operator">==</span><span class="token function">OrderGetInteger</span><span class="token punctuation">(</span>ORDER_MAGIC<span class="token punctuation">)</span><span class="token punctuation">)</span> 
           <span class="token punctuation">{</span> 
            MqlTradeResult result<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
            MqlTradeRequest request<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
            request<span class="token punctuation">.</span>order<span class="token operator">=</span>order_ticket<span class="token punctuation">;</span> 
            request<span class="token punctuation">.</span>action<span class="token operator">=</span>TRADE_ACTION_REMOVE<span class="token punctuation">;</span> 
            <span class="token function">OrderSend</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//--- 编写服务器回复到日志 </span>
            <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot;: &quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>comment<span class="token punctuation">,</span><span class="token string">&quot; reply code &quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>retcode<span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 随机设置挂单                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
uint <span class="token function">SendRandomPendingOrder</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">const</span> magic_number<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 准备请求 </span>
   MqlTradeRequest request<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
   request<span class="token punctuation">.</span>action<span class="token operator">=</span>TRADE_ACTION_PENDING<span class="token punctuation">;</span>         <span class="token comment">// 设置挂单 </span>
   request<span class="token punctuation">.</span>magic<span class="token operator">=</span>magic_number<span class="token punctuation">;</span>                  <span class="token comment">// ORDER_MAGIC </span>
   request<span class="token punctuation">.</span>symbol<span class="token operator">=</span>_Symbol<span class="token punctuation">;</span>                      <span class="token comment">// 交易品种 </span>
   request<span class="token punctuation">.</span>volume<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>                          <span class="token comment">// 0.1为单位的交易量 </span>
   request<span class="token punctuation">.</span>sl<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                                <span class="token comment">// 没有指定止损价位 </span>
   request<span class="token punctuation">.</span>tp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                                <span class="token comment">// 没有指定盈利价位 </span>
<span class="token comment">//--- 形成订单类型 </span>
   request<span class="token punctuation">.</span>type<span class="token operator">=</span><span class="token function">GetRandomType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// 订单类型 </span>
<span class="token comment">//--- 形成挂单价格 </span>
   request<span class="token punctuation">.</span>price<span class="token operator">=</span><span class="token function">GetRandomPrice</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 开盘价 </span>
<span class="token comment">//--- 发送交易请求 </span>
   MqlTradeResult result<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
   <span class="token function">OrderSend</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 编写服务器回复到日志  </span>
   <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>comment<span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>retcode<span class="token operator">==</span><span class="token number">10016</span><span class="token punctuation">)</span> <span class="token function">Print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>bid<span class="token punctuation">,</span>result<span class="token punctuation">.</span>ask<span class="token punctuation">,</span>result<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 返回交易服务器回复的代码 </span>
   <span class="token keyword">return</span> result<span class="token punctuation">.</span>retcode<span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 返回随机挂单类型                                                   | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
ENUM_ORDER_TYPE <span class="token function">GetRandomType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">int</span> t<span class="token operator">=</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">4</span><span class="token punctuation">;</span> 
<span class="token comment">//---   0&lt;=t&lt;4 </span>
   <span class="token keyword">switch</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">return</span><span class="token punctuation">(</span>ORDER_TYPE_BUY_LIMIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">return</span><span class="token punctuation">(</span>ORDER_TYPE_SELL_LIMIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">return</span><span class="token punctuation">(</span>ORDER_TYPE_BUY_STOP<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">return</span><span class="token punctuation">(</span>ORDER_TYPE_SELL_STOP<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 不正确值 </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>WRONG_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 返回随机价格                                                       | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token keyword">double</span> <span class="token function">GetRandomPrice</span><span class="token punctuation">(</span>ENUM_ORDER_TYPE type<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   <span class="token keyword">int</span> t<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>type<span class="token punctuation">;</span> 
<span class="token comment">//--- 交易品种止损水平 </span>
   <span class="token keyword">int</span> distance<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">SymbolInfoInteger</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>SYMBOL_TRADE_STOPS_LEVEL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 接收上一个订单号数据 </span>
   MqlTick last_tick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
   <span class="token function">SymbolInfoTick</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>last_tick<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 按照类型计算价格 </span>
   <span class="token keyword">double</span> price<span class="token punctuation">;</span> 
   <span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token operator">==</span><span class="token number">2</span> <span class="token operator">||</span> t<span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// ORDER_TYPE_BUY_LIMIT or ORDER_TYPE_SELL_STOP </span>
     <span class="token punctuation">{</span> 
      price<span class="token operator">=</span>last_tick<span class="token punctuation">.</span>bid<span class="token punctuation">;</span> <span class="token comment">// 不同于卖价 </span>
      price<span class="token operator">=</span>price<span class="token operator">-</span><span class="token punctuation">(</span>distance<span class="token operator">+</span><span class="token punctuation">(</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">*</span>_Point<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">else</span>             <span class="token comment">// ORDER_TYPE_SELL_LIMIT or ORDER_TYPE_BUY_STOP </span>
     <span class="token punctuation">{</span> 
      price<span class="token operator">=</span>last_tick<span class="token punctuation">.</span>ask<span class="token punctuation">;</span> <span class="token comment">// 不同于买价 </span>
      price<span class="token operator">=</span>price<span class="token operator">+</span><span class="token punctuation">(</span>distance<span class="token operator">+</span><span class="token punctuation">(</span><span class="token function">MathRand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">*</span>_Point<span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br></div></div><p>相关参考<br>
交易操作类型， 交易请求结构， 请求检测结果结构， 交易请求结果结构</p> <h2 id="_19-5-ordersendasync"><a href="#_19-5-ordersendasync" class="header-anchor">#</a> 19.5 OrderSendAsync</h2> <p>OrderSendAsync()函数用于执行异步 交易操作，意即，无需等待 交易服务器 对 发送的交易请求的 响应。 该函数专为高频交易而设计，在交易算法条款下，浪费时间等待服务器的响应是不可接受的。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderSendAsync</span><span class="token punctuation">(</span> 
   MqlTradeRequest<span class="token operator">&amp;</span>  request<span class="token punctuation">,</span>      <span class="token comment">// 请求架构 </span>
   MqlTradeResult<span class="token operator">&amp;</span>   result        <span class="token comment">// 请求架构 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>request</p> <p>[in] 指向描述客户端交易行为的MqlTradeRequest类型结构的指针。</p> <p>result</p> <p>[in,out] 一个指向MqlTradeResult类型的结构的指针，该类型描述成功执行函数(如果返回true)时交易操作的结果。</p> <p>返回值</p> <p>如果请求被发送到交易服务器，则返回true。如果请求未被发送，则返回false。在发送请求的情况下，在结果变量中，响应代码包含TRADE_RETCODE_PLACED值(代码10008) —— “已下单”。成功执行意味着只是发送的事实，但是不保证请求到达交易服务器和已被接受处理。当处理接收的请求时，交易服务器向客户端发送回应，通知引起生成交易事件的持仓当前状态，订单和交易的变化。</p> <p>在通过OrderSendAsync()函数发送的服务器上执行交易请求的结果可以通过OnTradeTransaction处理程序跟踪。应该注意，当执行交易请求时，将会多次调用OnTradeTransaction处理程序。</p> <p>例如，当发送市场买入(buy)订单时，它会被处理，为该账户创建一个适当的买入(buy)订单，然后执行订单并从持仓订单列表中移除，然后它被添加到订单历史记录中，相应的交易(deal)也被添加到历史记录中 并 创建一个新的持仓位。OnTradeTransaction函数将会为这里每个事件进行调用。若要获得这种数据，应该分析函数参数：
• trans —— 该参数获取描述应用到交易账户的交易事务的 MqlTradeTransaction 结构；
• request —— 该参数获取描述一个交易事务得出的交易请求的 MqlTradeRequest 结构；
• result —— 该参数获取描述交易请求执行结果的 MqlTradeResult 结构。</p> <p>注意<br>
在 目的 和 参数 方面，该函数与OrderSend()类似，但与其不同的是，它是异步(非同步)的，即在等待函数执行结果时不保存程序操作。您可以使用示例EA比较这两个函数的交易操作的比率。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Expert Advisor for sending trade requests &quot;</span></span>
                      <span class="token string">&quot; using OrderSendAsync() function.\r\n&quot;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Handling trading events using&quot;</span></span>
                      <span class="token string">&quot; OnTrade() and OnTradeTransaction() handler functions is displayed\r\n&quot;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;Expert Advisor parameters allow setting Magic Number&quot;</span></span>
                      <span class="token string">&quot; (unique ID) &quot;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">property</span> <span class="token expression">description </span><span class="token string">&quot;and the mode of displaying messages in Experts log. All details are displayed by default.\r\n&quot;</span></span>
<span class="token comment">//--- 输入参数</span>
input <span class="token keyword">int</span>  MagicNumber<span class="token operator">=</span><span class="token number">1234567</span><span class="token punctuation">;</span>      <span class="token comment">// EA交易 ID</span>
input <span class="token keyword">bool</span> DescriptionModeFull<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 详细的输出模式</span>
<span class="token comment">//--- HistorySelect()调用使用的变量</span>
datetime history_start<span class="token punctuation">;</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家初始化函数                                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">int</span> <span class="token function">OnInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 检查是否允许自动交易</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">TerminalInfoInteger</span><span class="token punctuation">(</span>TERMINAL_TRADE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Autotrading in the terminal is disabled, Expert Advisor will be removed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ExpertRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 不能交易真实账户</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_TRADE_MODE<span class="token punctuation">)</span><span class="token operator">==</span>ACCOUNT_TRADE_MODE_REAL<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Expert Advisor cannot trade on a real account!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ExpertRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 检查是否可以在该账户交易（例如，使用只读密码时不能交易）</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">AccountInfoInteger</span><span class="token punctuation">(</span>ACCOUNT_TRADE_ALLOWED<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Alert</span><span class="token punctuation">(</span><span class="token string">&quot;Trading on this account is disabled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">ExpertRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 节省启动EA交易的时间来接收交易历史记录</span>
   history_start<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token function">CreateBuySellButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>INIT_SUCCEEDED<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 专家去初始化函数                                                   |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnDeinit</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> reason<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 删除所有图形对象</span>
   <span class="token function">ObjectDelete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectDelete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| TradeTransaction 函数                                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTradeTransaction</span><span class="token punctuation">(</span><span class="token keyword">const</span> MqlTradeTransaction <span class="token operator">&amp;</span>trans<span class="token punctuation">,</span>
                        <span class="token keyword">const</span> MqlTradeRequest <span class="token operator">&amp;</span>request<span class="token punctuation">,</span>
                        <span class="token keyword">const</span> MqlTradeResult <span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 标题命名在交易事件处理程序函数之后 </span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;=&gt; &quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot; at &quot;</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收事务类型作为枚举值 </span>
   ENUM_TRADE_TRANSACTION_TYPE type<span class="token operator">=</span>trans<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
<span class="token comment">//--- 如果事务是请求处理的结果</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>type<span class="token operator">==</span>TRADE_TRANSACTION_REQUEST<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 显示事务名称</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 然后显示已处理请求的字符串描述</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;------------RequestDescription\r\n&quot;</span><span class="token punctuation">,</span>
            <span class="token function">RequestDescription</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>DescriptionModeFull<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 并显示请求结果的描述</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;------------ ResultDescription\r\n&quot;</span><span class="token punctuation">,</span>
            <span class="token function">TradeResultDescription</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span>DescriptionModeFull<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span> <span class="token comment">// 显示另一类型事务的完整描述</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;------------ TransactionDescription\r\n&quot;</span><span class="token punctuation">,</span>
            <span class="token function">TransactionDescription</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span>DescriptionModeFull<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---     </span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 交易函数                                                          |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 存储交易账户状态的静态成员</span>
   <span class="token keyword">static</span> <span class="token keyword">int</span> prev_positions<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>prev_orders<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>prev_deals<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>prev_history_orders<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">//--- 请求交易历史记录</span>
   <span class="token keyword">bool</span> update<span class="token operator">=</span><span class="token function">HistorySelect</span><span class="token punctuation">(</span>history_start<span class="token punctuation">,</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistorySelect(%s , %s) = %s&quot;</span><span class="token punctuation">,</span>
               <span class="token function">TimeToString</span><span class="token punctuation">(</span>history_start<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 标题命名在交易事件处理程序函数之后</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;=&gt; &quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot; at &quot;</span><span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>TIME_SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 显示处理程序名称和处理时期订单数量</span>
   <span class="token keyword">int</span> curr_positions<span class="token operator">=</span><span class="token function">PositionsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> curr_orders<span class="token operator">=</span><span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> curr_deals<span class="token operator">=</span><span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> curr_history_orders<span class="token operator">=</span><span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 用括号显示订单数量，持仓，成交，以及改变 </span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;PositionsTotal() = %d (%+d)&quot;</span><span class="token punctuation">,</span>
               curr_positions<span class="token punctuation">,</span><span class="token punctuation">(</span>curr_positions<span class="token operator">-</span>prev_positions<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;OrdersTotal() = %d (%+d)&quot;</span><span class="token punctuation">,</span>
               curr_orders<span class="token punctuation">,</span>curr_orders<span class="token operator">-</span>prev_orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistoryOrdersTotal() = %d (%+d)&quot;</span><span class="token punctuation">,</span>
               curr_deals<span class="token punctuation">,</span>curr_deals<span class="token operator">-</span>prev_deals<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistoryDealsTotal() = %d (%+d)&quot;</span><span class="token punctuation">,</span>
               curr_history_orders<span class="token punctuation">,</span>curr_history_orders<span class="token operator">-</span>prev_history_orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 插入字符串断点，更便于查看日志</span>
   <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 保存账户状态</span>
   prev_positions<span class="token operator">=</span>curr_positions<span class="token punctuation">;</span>
   prev_orders<span class="token operator">=</span>curr_orders<span class="token punctuation">;</span>
   prev_deals<span class="token operator">=</span>curr_deals<span class="token punctuation">;</span>
   prev_history_orders<span class="token operator">=</span>curr_history_orders<span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| ChartEvent 函数                                                  |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnChartEvent</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> id<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> <span class="token keyword">long</span> <span class="token operator">&amp;</span>lparam<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> <span class="token keyword">double</span> <span class="token operator">&amp;</span>dparam<span class="token punctuation">,</span>
                  <span class="token keyword">const</span> string <span class="token operator">&amp;</span>sparam<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 处理 CHARTEVENT_CLICK 事件 (&quot;点击图表&quot;)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>id<span class="token operator">==</span>CHARTEVENT_OBJECT_CLICK<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;=&gt; &quot;</span><span class="token punctuation">,</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot;: sparam = &quot;</span><span class="token punctuation">,</span>sparam<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 成交的最小交易量</span>
      <span class="token keyword">double</span> volume_min<span class="token operator">=</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span>SYMBOL_VOLUME_MIN<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 如果按下&quot;买入&quot;按钮，则买入</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>sparam<span class="token operator">==</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Buy %s %G lot&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span>volume_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">BuyAsync</span><span class="token punctuation">(</span>volume_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 不按下该按钮</span>
         <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_STATE<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token comment">//--- 如果按下&quot;卖出&quot;按钮，则卖出</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>sparam<span class="token operator">==</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Sell %s %G lot&quot;</span><span class="token punctuation">,</span>_Symbol<span class="token punctuation">,</span>volume_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">SellAsync</span><span class="token punctuation">(</span>volume_min<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//--- 不按下该按钮</span>
         <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_STATE<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token function">ChartRedraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---         </span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 返回交易事务的文本描述                                              |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
string <span class="token function">TransactionDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> MqlTradeTransaction <span class="token operator">&amp;</span>trans<span class="token punctuation">,</span>
                              <span class="token keyword">const</span> <span class="token keyword">bool</span> detailed<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 准备从函数返回的字符串</span>
   string desc<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在详细模式添加所有可能的数据</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>detailed<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Symbol: &quot;</span><span class="token operator">+</span>trans<span class="token punctuation">.</span>symbol<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Deal ticket: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>trans<span class="token punctuation">.</span>deal<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Deal type: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>deal_type<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order ticket: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>trans<span class="token punctuation">.</span>order<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order type: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>order_type<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order state: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>order_state<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order time type: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>time_type<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order expiration: &quot;</span><span class="token operator">+</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>time_expiration<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Price: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>trans<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Price trigger: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>trans<span class="token punctuation">.</span>price_trigger<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Stop Loss: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>trans<span class="token punctuation">.</span>price_sl<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Take Profit: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>trans<span class="token punctuation">.</span>price_tp<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Volume: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>trans<span class="token punctuation">.</span>volume<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回接收的字符串</span>
   <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 返回交易请求的文本描述                                              |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
string <span class="token function">RequestDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> MqlTradeRequest <span class="token operator">&amp;</span>request<span class="token punctuation">,</span>
                          <span class="token keyword">const</span> <span class="token keyword">bool</span> detailed<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 准备从函数返回的字符串</span>
   string desc<span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>action<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在详细模式添加所有可用的数据</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>detailed<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Symbol: &quot;</span><span class="token operator">+</span>request<span class="token punctuation">.</span>symbol<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Magic Number: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>magic<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order ticket: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>request<span class="token punctuation">.</span>order<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order type: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order filling: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>type_filling<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order time type: &quot;</span><span class="token operator">+</span><span class="token function">EnumToString</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>type_time<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order expiration: &quot;</span><span class="token operator">+</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>expiration<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Price: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Deviation points: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>deviation<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Stop Loss: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>sl<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Take Profit: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>tp<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Stop Limit: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>stoplimit<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Volume: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>request<span class="token punctuation">.</span>volume<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Comment: &quot;</span><span class="token operator">+</span>request<span class="token punctuation">.</span>comment<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回接收的字符串</span>
   <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 返回请求处理结果的文本描述                                           |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
string <span class="token function">TradeResultDescription</span><span class="token punctuation">(</span><span class="token keyword">const</span> MqlTradeResult <span class="token operator">&amp;</span>result<span class="token punctuation">,</span>
                              <span class="token keyword">const</span> <span class="token keyword">bool</span> detailed<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 准备从函数返回的字符串</span>
   string desc<span class="token operator">=</span><span class="token string">&quot;Retcode &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>result<span class="token punctuation">.</span>retcode<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//--- 在详细模式添加所有可用的数据</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>detailed<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Request ID: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>request_id<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Order ticket: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>result<span class="token punctuation">.</span>order<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Deal ticket: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>result<span class="token punctuation">.</span>deal<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Volume: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>volume<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Price: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Ask: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>ask<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Bid: &quot;</span><span class="token operator">+</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%G&quot;</span><span class="token punctuation">,</span>result<span class="token punctuation">.</span>bid<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
      desc<span class="token operator">+=</span><span class="token string">&quot;Comment: &quot;</span><span class="token operator">+</span>result<span class="token punctuation">.</span>comment<span class="token operator">+</span><span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 返回接收的字符串</span>
   <span class="token keyword">return</span> desc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 为买入和卖出创建两个按钮                                            |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">CreateBuySellButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 检查名称为“买入”的对象</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ObjectFind</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 如果发现的对象不是按钮，请删除</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ObjectGetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_TYPE<span class="token punctuation">)</span><span class="token operator">!=</span>OBJ_BUTTON<span class="token punctuation">)</span>
         <span class="token function">ObjectDelete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJ_BUTTON<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建“买入”按钮</span>
<span class="token comment">//--- 配置“买入”按钮</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_CORNER<span class="token punctuation">,</span>CORNER_RIGHT_UPPER<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_XDISTANCE<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_YDISTANCE<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_XSIZE<span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_YSIZE<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_TEXT<span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Buy&quot;</span><span class="token punctuation">,</span>OBJPROP_COLOR<span class="token punctuation">,</span>clrRed<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 检查名称为“卖出”的对象</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ObjectFind</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 如果发现的对象不是按钮，请删除</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ObjectGetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_TYPE<span class="token punctuation">)</span><span class="token operator">!=</span>OBJ_BUTTON<span class="token punctuation">)</span>
         <span class="token function">ObjectDelete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJ_BUTTON<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建“卖出”按钮</span>
<span class="token comment">//--- 配置“卖出”按钮</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_CORNER<span class="token punctuation">,</span>CORNER_RIGHT_UPPER<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_XDISTANCE<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_YDISTANCE<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_XSIZE<span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_YSIZE<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_TEXT<span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;Sell&quot;</span><span class="token punctuation">,</span>OBJPROP_COLOR<span class="token punctuation">,</span>clrBlue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 执行强制更新图表，立即查看按钮</span>
   <span class="token function">ChartRedraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 使用OrderSendAsync()异步函数进行买入                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">BuyAsync</span><span class="token punctuation">(</span><span class="token keyword">double</span> volume<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 准备请求</span>
   MqlTradeRequest req<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>action      <span class="token operator">=</span>TRADE_ACTION_DEAL<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>symbol      <span class="token operator">=</span>_Symbol<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>magic       <span class="token operator">=</span>MagicNumber<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>volume      <span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>type        <span class="token operator">=</span>ORDER_TYPE_BUY<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>price       <span class="token operator">=</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>symbol<span class="token punctuation">,</span>SYMBOL_ASK<span class="token punctuation">)</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>deviation   <span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>comment     <span class="token operator">=</span><span class="token string">&quot;Buy using OrderSendAsync()&quot;</span><span class="token punctuation">;</span>
   MqlTradeResult  res<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">OrderSendAsync</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot;: error &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;, retcode = &quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>retcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 使用OrderSendAsync()异步函数进行卖出                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">SellAsync</span><span class="token punctuation">(</span><span class="token keyword">double</span> volume<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 准备请求</span>
   MqlTradeRequest req<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>action      <span class="token operator">=</span>TRADE_ACTION_DEAL<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>symbol      <span class="token operator">=</span>_Symbol<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>magic       <span class="token operator">=</span>MagicNumber<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>volume      <span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>type        <span class="token operator">=</span>ORDER_TYPE_SELL<span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>price       <span class="token operator">=</span><span class="token function">SymbolInfoDouble</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>symbol<span class="token punctuation">,</span>SYMBOL_BID<span class="token punctuation">)</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>deviation   <span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
   req<span class="token punctuation">.</span>comment     <span class="token operator">=</span><span class="token string">&quot;Sell using OrderSendAsync()&quot;</span><span class="token punctuation">;</span>
   MqlTradeResult  res<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">OrderSendAsync</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot;: error &quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;, retcode = &quot;</span><span class="token punctuation">,</span>res<span class="token punctuation">.</span>retcode<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br></div></div><p>在“专家”日志显示消息的示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnChartEvent<span class="token operator">:</span> sparam <span class="token operator">=</span> Sell
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Sell EURUSD <span class="token number">0.01</span> lot
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTradeTransaction at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   TRADE_TRANSACTION_REQUEST
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>RequestDescription
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   TRADE_ACTION_DEAL
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Symbol<span class="token operator">:</span> EURUSD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Magic Number<span class="token operator">:</span> <span class="token number">1234567</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order ticket<span class="token operator">:</span> <span class="token number">16361998</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order type<span class="token operator">:</span> ORDER_TYPE_SELL
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order filling<span class="token operator">:</span> ORDER_FILLING_FOK
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order time type<span class="token operator">:</span> ORDER_TIME_GTC
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order expiration<span class="token operator">:</span> <span class="token number">1970.01</span><span class="token punctuation">.</span><span class="token number">01</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deviation points<span class="token operator">:</span> <span class="token number">10</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Stop Loss<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Take Profit<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Stop Limit<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Volume<span class="token operator">:</span> <span class="token number">0.1</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Comment<span class="token operator">:</span> Sell <span class="token keyword">using</span> <span class="token function">OrderSendAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> ResultDescription
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Retcode <span class="token number">10009</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Request ID<span class="token operator">:</span> <span class="token number">2</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order ticket<span class="token operator">:</span> <span class="token number">16361998</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal ticket<span class="token operator">:</span> <span class="token number">15048668</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Volume<span class="token operator">:</span> <span class="token number">0.1</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Ask<span class="token operator">:</span> <span class="token number">1.29319</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Bid<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Comment<span class="token operator">:</span> 
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistorySelect</span><span class="token punctuation">(</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">34</span> <span class="token punctuation">,</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTrade at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">PositionsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTradeTransaction at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> TransactionDescription
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   TRADE_TRANSACTION_ORDER_ADD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Symbol<span class="token operator">:</span> EURUSD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal ticket<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal type<span class="token operator">:</span> DEAL_TYPE_BUY
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order ticket<span class="token operator">:</span> <span class="token number">16361998</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order type<span class="token operator">:</span> ORDER_TYPE_SELL
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order state<span class="token operator">:</span> ORDER_STATE_STARTED
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order time type<span class="token operator">:</span> ORDER_TIME_GTC
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order expiration<span class="token operator">:</span> <span class="token number">1970.01</span><span class="token punctuation">.</span><span class="token number">01</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price trigger<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Stop Loss<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Take Profit<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Volume<span class="token operator">:</span> <span class="token number">0.1</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTradeTransaction at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> TransactionDescription
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   TRADE_TRANSACTION_ORDER_DELETE
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Symbol<span class="token operator">:</span> EURUSD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal ticket<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal type<span class="token operator">:</span> DEAL_TYPE_BUY
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order ticket<span class="token operator">:</span> <span class="token number">16361998</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order type<span class="token operator">:</span> ORDER_TYPE_SELL
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order state<span class="token operator">:</span> ORDER_STATE_STARTED
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order time type<span class="token operator">:</span> ORDER_TIME_GTC
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order expiration<span class="token operator">:</span> <span class="token number">1970.01</span><span class="token punctuation">.</span><span class="token number">01</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price trigger<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Stop Loss<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Take Profit<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Volume<span class="token operator">:</span> <span class="token number">0.1</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistorySelect</span><span class="token punctuation">(</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">34</span> <span class="token punctuation">,</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTrade at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">PositionsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTradeTransaction at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> TransactionDescription
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   TRADE_TRANSACTION_HISTORY_ADD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Symbol<span class="token operator">:</span> EURUSD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal ticket<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal type<span class="token operator">:</span> DEAL_TYPE_BUY
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order ticket<span class="token operator">:</span> <span class="token number">16361998</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order type<span class="token operator">:</span> ORDER_TYPE_SELL
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order state<span class="token operator">:</span> ORDER_STATE_FILLED
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order time type<span class="token operator">:</span> ORDER_TIME_GTC
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order expiration<span class="token operator">:</span> <span class="token number">1970.01</span><span class="token punctuation">.</span><span class="token number">01</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price trigger<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Stop Loss<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Take Profit<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Volume<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistorySelect</span><span class="token punctuation">(</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">34</span> <span class="token punctuation">,</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTrade at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">PositionsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTradeTransaction at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> TransactionDescription
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   TRADE_TRANSACTION_DEAL_ADD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Symbol<span class="token operator">:</span> EURUSD
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal ticket<span class="token operator">:</span> <span class="token number">15048668</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Deal type<span class="token operator">:</span> DEAL_TYPE_SELL
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order ticket<span class="token operator">:</span> <span class="token number">16361998</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order type<span class="token operator">:</span> ORDER_TYPE_BUY
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order state<span class="token operator">:</span> ORDER_STATE_STARTED
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order time type<span class="token operator">:</span> ORDER_TIME_GTC
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Order expiration<span class="token operator">:</span> <span class="token number">1970.01</span><span class="token punctuation">.</span><span class="token number">01</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price<span class="token operator">:</span> <span class="token number">1.29313</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Price trigger<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Stop Loss<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Take Profit<span class="token operator">:</span> <span class="token number">0</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   Volume<span class="token operator">:</span> <span class="token number">0.1</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistorySelect</span><span class="token punctuation">(</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">34</span> <span class="token punctuation">,</span> <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token boolean">true</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token operator">=</span><span class="token operator">&gt;</span> OnTrade at <span class="token number">09</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">53</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">PositionsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   <span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
 <span class="token number">12</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">52</span>   <span class="token function">ExpertAdvisor</span> <span class="token punctuation">(</span>EURUSD<span class="token punctuation">,</span>H1<span class="token punctuation">)</span>   
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br></div></div><h2 id="_19-6-positionstotal"><a href="#_19-6-positionstotal" class="header-anchor">#</a> 19.6 PositionsTotal</h2> <p>返回持有仓位的总数量。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">PositionsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回值</p> <p>整数值</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>相关参考</p> <p>PositionGetSymbol()， PositionSelect()， 仓位属性</p> <h2 id="_19-7-positiongetsymbol"><a href="#_19-7-positiongetsymbol" class="header-anchor">#</a> 19.7 PositionGetSymbol</h2> <p>根据 仓位 的索引编号位置返回相对应的 交易品种，并使用函数PositionGetDouble，PositionGetInteger，PositionGetString自动选中该 仓位 以便进一步使用它。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string  <span class="token function">PositionGetSymbol</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  index      <span class="token comment">// 仓位列表中的索引编号数字 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>index</p> <p>[in] 持有仓位列表中的索引编号数字。</p> <p>返回值</p> <p>字符串 型值，如果找不到仓位，则返回 空字符串，如果想要获得 错误代码，需调用 GetLastError() 函数。</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>交易账户中 仓位 的总数不可能超过 金融工具(交易品种) 的总数量。</p> <p>相关参考</p> <p>PositionsTotal()， PositionSelect()， 仓位属性</p> <h2 id="_19-8-positionselect"><a href="#_19-8-positionselect" class="header-anchor">#</a> 19.8 PositionSelect</h2> <p>根据 交易品种 名称(代码符号)选中一个仓位，如果函数成功完成，返回true，如果失败返回false，调用 GetLastError()函数可获取错误信息。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">PositionSelect</span><span class="token punctuation">(</span> 
   string  symbol      <span class="token comment">// 交易品种名称 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>symbol</p> <p>[in] 交易品种(金融工具) 名称</p> <p>返回值</p> <p>布尔型值</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>函数PositionSelect()将有关 仓位 的数据复制到程序环境中，并且在进一步调用函数PositionGetDouble()，PositionGetInteger()和PositionGetString()时会返回之前已复制的数据。这意味着该 仓位 本身可能已发生变化(或其 交易量，方向等已发生变化)，但仍可获得该仓位 的数据。为确保收到有关 仓位 的最新数据，建议在引用它们之前即时调用一次PositionSelect()。</p> <p>相关参考</p> <p>PositionGetSymbol()， PositionsTotal()， 仓位属性</p> <h2 id="_19-9-positionselectbyticket"><a href="#_19-9-positionselectbyticket" class="header-anchor">#</a> 19.9 PositionSelectByTicket</h2> <p>根据指定的 订单编号 选中一个仓位。如果成功,返回true。如果函数失败，返回false。调用GetLastError()获取错误细节。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">PositionSelectByTicket</span><span class="token punctuation">(</span> 
   ulong   ticket     <span class="token comment">// 持有 仓位 的 订单编号(不是索引位置编号) </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>ticket</p> <p>[in] 持有 仓位 的 订单编号(不是索引位置编号) 。</p> <p>返回值</p> <p>布尔 型值。</p> <p>注意</p> <p>函数PositionSelectByTicket() 将有关 仓位 的数据复制到程序环境中。并且在进一步调用函数PositionGetDouble()，PositionGetInteger()和PositionGetString()时会返回之前已复制的数据。这意味着该 仓位 本身可能已发生变化(或其 交易量，方向等已发生变化)，但仍可获得该仓位 的数据。为确保收到有关 仓位 的最新数据，建议在引用它们之前即时调用一次PositionSelect()。</p> <p>相关参考</p> <p>PositionGetSymbol()，PositionsTotal()，持仓属性</p> <h2 id="_19-10-positiongetdouble"><a href="#_19-10-positiongetdouble" class="header-anchor">#</a> 19.10 PositionGetDouble</h2> <p>此函数请求返回一个持有 仓位 的属性值，仓位 是之前使用PositionGetSymbol或者 PositionSelect选中的，请求获取的 仓位属性 值必须是双精度型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">double</span>  <span class="token function">PositionGetDouble</span><span class="token punctuation">(</span> 
   ENUM_POSITION_PROPERTY_DOUBLE  property_id      <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>返回true或者false，取决于函数执行成功与否，如果成功，属性值保存在形式参数中。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">PositionGetDouble</span><span class="token punctuation">(</span> 
   ENUM_POSITION_PROPERTY_DOUBLE  property_id<span class="token punctuation">,</span>     <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">double</span><span class="token operator">&amp;</span>                        double_var       <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>property_id</p> <p>[in] 仓位属性标识符。取值范围是ENUM_POSITION_PROPERTY_DOUBLE 枚举值之一。</p> <p>double_var</p> <p>[out] 双精度类型值，如果函数调用失败，返回0。</p> <p>返回值</p> <p>双精度 类型值。如果函数失败，返回0 。</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保接收到的是关于 仓位 的最新数据，在之前应该即时调用一次 PositionSelect() 函数。</p> <p>相关参考<br>
PositionGetSymbol()， PositionSelect()， 仓位属性</p> <h2 id="_19-11-positiongetinteger"><a href="#_19-11-positiongetinteger" class="header-anchor">#</a> 19.11 PositionGetInteger</h2> <p>此函数请求返回一个持有 仓位 的属性值，仓位 是之前使用PositionGetSymbol或者 PositionSelect选中的，请求获取的 仓位属性 值必须是 日期时间型，整数型，此函数有两种变体。</p> <ol><li>直接返回属性值</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">PositionGetInteger</span><span class="token punctuation">(</span> 
   ENUM_POSITION_PROPERTY_INTEGER  property_id      <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>返回true或者false，取决于函数执行成功与否，如果成功，属性值保存在形式参数中。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">PositionGetInteger</span><span class="token punctuation">(</span> 
   ENUM_POSITION_PROPERTY_INTEGER  property_id<span class="token punctuation">,</span>     <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">long</span><span class="token operator">&amp;</span>                           long_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>property_id</p> <p>[in] 仓位属性标识符，取值范围是 ENUM_POSITION_PROPERTY_INTEGER 枚举值之一。</p> <p>long_var</p> <p>[out] 用于保存 属性值的长整型数值。</p> <p>返回值</p> <p>长整型值。如果函数失败，返回0。</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保接收到的是关于 仓位 的最新数据，在之前应该即时调用一次 PositionSelect() 函数。</p> <p>例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 交易函数                                                          |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 检查持仓是否存在并显示其变化的时间</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">PositionSelect</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>     
<span class="token comment">//--- 接收持仓ID为进一步工作</span>
      ulong position_ID<span class="token operator">=</span><span class="token function">PositionGetInteger</span><span class="token punctuation">(</span>POSITION_IDENTIFIER<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>_Symbol<span class="token punctuation">,</span><span class="token string">&quot; postion #&quot;</span><span class="token punctuation">,</span>position_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收从1970.01.01开始的毫秒为单位的形成持仓的时间</span>
      <span class="token keyword">long</span> create_time_msc<span class="token operator">=</span><span class="token function">PositionGetInteger</span><span class="token punctuation">(</span>POSITION_TIME_MSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Position #%d  POSITION_TIME_MSC = %i64 milliseconds =&gt; %s&quot;</span><span class="token punctuation">,</span>position_ID<span class="token punctuation">,</span>
                  create_time_msc<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>create_time_msc<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收从1970.01.01开始的秒为单位的持仓最近变化的时间</span>
      <span class="token keyword">long</span> update_time_sec<span class="token operator">=</span><span class="token function">PositionGetInteger</span><span class="token punctuation">(</span>POSITION_TIME_UPDATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Position #%d  POSITION_TIME_UPDATE = %i64 seconds =&gt; %s&quot;</span><span class="token punctuation">,</span>
                  position_ID<span class="token punctuation">,</span>update_time_sec<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>update_time_sec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 接收从1970.01.01开始的毫秒为单位的持仓最近变化的时间</span>
      <span class="token keyword">long</span> update_time_msc<span class="token operator">=</span><span class="token function">PositionGetInteger</span><span class="token punctuation">(</span>POSITION_TIME_UPDATE_MSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Position #%d  POSITION_TIME_UPDATE_MSC = %i64 milliseconds =&gt; %s&quot;</span><span class="token punctuation">,</span>
                  position_ID<span class="token punctuation">,</span>update_time_msc<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>update_time_msc<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>相关参考<br>
PositionGetSymbol()， PositionSelect()， 仓位属性</p> <h2 id="_19-12-positiongetstring"><a href="#_19-12-positiongetstring" class="header-anchor">#</a> 19.12 PositionGetString</h2> <p>此函数请求返回一个持有 仓位 的属性值，仓位 是之前使用PositionGetSymbol或者 PositionSelect选中的，请求获取的 仓位属性 值必须是 字符串型，此函数有两种变体。</p> <ol><li>直接返回属性值</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string  <span class="token function">PositionGetString</span><span class="token punctuation">(</span> 
   ENUM_POSITION_PROPERTY_STRING  property_id      <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>返回true或者false，取决于函数执行成功与否，如果成功，属性值保存在形式参数中。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>bool  PositionGetString( 
   ENUM_POSITION_PROPERTY_STRING  property_id,     // 属性标识符 
   string&amp;                        string_var       // 这里接受属性值 
   );
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>property_id</p> <p>[in] 仓位属性标识符，取值范围是 ENUM_POSITION_PROPERTY_STRING 枚举值之一。</p> <p>long_var</p> <p>[out] 用于保存 属性值 的 字符串 值。</p> <p>返回值</p> <p>字符串型值。如果函数失败，返回0。</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个交易的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保接收到的是关于 仓位 的最新数据，在之前应该即时调用一次 PositionSelect() 函数。</p> <p>相关参考</p> <p>PositionGetSymbol()， PositionSelect()， 仓位属性</p> <h2 id="_19-13-positiongetticket"><a href="#_19-13-positiongetticket" class="header-anchor">#</a> 19.13 PositionGetTicket</h2> <p>根据指定的索引编号返回一个持有 仓位 的订单编号，并使用函数PositionGetDouble，PositionGetInteger，PositionGetString自动选中该 仓位 以便进一步使用它。/p&gt;</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ulong  <span class="token function">PositionGetTicket</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  index      <span class="token comment">// 仓位 列表中的索引编号 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>index</p> <p>[in] 持有 仓位 列表中的索引，编号从0开始。</p> <p>返回值</p> <p>仓位的订单编号。如果函数失败，返回0。</p> <p>注意</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保接收到的是关于 仓位 的最新数据，在之前应该即时调用一次 PositionSelect() 函数。</p> <p>相关参考</p> <p>PositionGetSymbol()，PositionSelect()，Position Properties</p> <h2 id="_19-14-orderstotal"><a href="#_19-14-orderstotal" class="header-anchor">#</a> 19.14 OrdersTotal</h2> <p>返回当前订单总数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回值</p> <p>整数型数值。 br&gt;</p> <p>注意</p> <p>不要与 当前挂单 和/或 仓位 相混淆，它们也显示在客户端“工具箱”的“交易”标签中。订单是执行交易(deal)的请求，而 仓位(头寸) 是一个或多个交易的结果。</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>相关参考</p> <p>OrderSelect()， OrderGetTicket() ， 订单属性</p> <h2 id="_19-15-ordergetticket"><a href="#_19-15-ordergetticket" class="header-anchor">#</a> 19.15 OrderGetTicket</h2> <p>根据指定的 索引编号 返回 订单编号，并自动选中该订单，以便进一步调用函数处理。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ulong  <span class="token function">OrderGetTicket</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  index      <span class="token comment">// 订单列表中的数量 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>index</p> <p>[in] 当前订单列表中的 索引数字。</p> <p>返回值</p> <p>无符号长整型 值。如果函数失败，返回0。</p> <p>注意</p> <p>不要与 当前挂单 和/或 仓位 相混淆，它们也显示在客户端“工具箱”的“交易”标签中。订单是执行交易(deal)的请求，而 仓位(头寸) 是一个或多个交易的结果。</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>函数OrderGetTicket()将有关 订单 的数据复制到程序环境中，并且在进一步调用函数OrderGetDouble()，OrderGetInteger()，OrderGetString()时会返回之前已复制的数据。这意味着订单本身可能已发生变化(或其 开仓进场的价格，止损/止盈价格 或 到期日期 已更改)，但仍可获得此 订单 的数据。为确保收到有关 订单 的最新数据，建议在引用它们之前即时调用一次OrderGetTicket()。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
<span class="token comment">//--- 订单属性返回值的变量 </span>
   ulong    ticket<span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   open_price<span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   initial_volume<span class="token punctuation">;</span> 
   datetime time_setup<span class="token punctuation">;</span> 
   string   symbol<span class="token punctuation">;</span> 
   string   type<span class="token punctuation">;</span> 
   <span class="token keyword">long</span>     order_magic<span class="token punctuation">;</span> 
<span class="token comment">//--- 当前挂单量 </span>
   uint     total<span class="token operator">=</span><span class="token function">OrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 反复检查通过订单 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>uint i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 通过列表中的仓位返回订单报价 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ticket<span class="token operator">=</span><span class="token function">OrderGetTicket</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 返回订单属性 </span>
         open_price    <span class="token operator">=</span><span class="token function">OrderGetDouble</span><span class="token punctuation">(</span>ORDER_PRICE_OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         time_setup    <span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">OrderGetInteger</span><span class="token punctuation">(</span>ORDER_TIME_SETUP<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         symbol        <span class="token operator">=</span><span class="token function">OrderGetString</span><span class="token punctuation">(</span>ORDER_SYMBOL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         order_magic   <span class="token operator">=</span><span class="token function">OrderGetInteger</span><span class="token punctuation">(</span>ORDER_MAGIC<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         positionID    <span class="token operator">=</span><span class="token function">OrderGetInteger</span><span class="token punctuation">(</span>ORDER_POSITION_ID<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         initial_volume<span class="token operator">=</span><span class="token function">OrderGetDouble</span><span class="token punctuation">(</span>ORDER_VOLUME_INITIAL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         type          <span class="token operator">=</span><span class="token function">EnumToString</span><span class="token punctuation">(</span><span class="token function">ENUM_ORDER_TYPE</span><span class="token punctuation">(</span><span class="token function">OrderGetInteger</span><span class="token punctuation">(</span>ORDER_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 准备和显示订单信息 </span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;#ticket %d %s %G %s at %G was set up at %s&quot;</span><span class="token punctuation">,</span> 
                ticket<span class="token punctuation">,</span>                 <span class="token comment">// 订单报价 </span>
                type<span class="token punctuation">,</span>                   <span class="token comment">// 类型 </span>
                initial_volume<span class="token punctuation">,</span>         <span class="token comment">// 已下交易量 </span>
                symbol<span class="token punctuation">,</span>                 <span class="token comment">// 交易品种 </span>
                open_price<span class="token punctuation">,</span>             <span class="token comment">// 规定的开盘价 </span>
                <span class="token function">TimeToString</span><span class="token punctuation">(</span>time_setup<span class="token punctuation">)</span><span class="token comment">// 下订单时间 </span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>相关参考<br>
OrdersTotal()， OrderSelect()， OrderGetInteger()</p> <h2 id="_19-16-orderselect"><a href="#_19-16-orderselect" class="header-anchor">#</a> 19.16 OrderSelect</h2> <p>选择一个 订单。如果函数成功调用返回TRUE值，如果函数没能完成，则返回错误值，了解更多关于错误调用的信息，可以使用 GetLastError()。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderSelect</span><span class="token punctuation">(</span> 
   ulong   ticket      <span class="token comment">// 订单编号(不是索引位置编号) </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>ticket</p> <p>[in] 订单编号。不是索引位置编号。</p> <p>返回值</p> <p>布尔型值。</p> <p>注意</p> <p>不要与 当前挂单 和/或 仓位 相混淆，它们也显示在客户端“工具箱”的“交易”标签中。订单是执行交易(deal)的请求，而 仓位(头寸) 是一个或多个交易的结果。</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>函数OrderSelect()将有关 订单 的数据复制到程序环境中，并且在进一步调用函数OrderGetDouble()，OrderGetInteger()，OrderGetString()时会返回之前已复制的数据。这意味着订单本身可能已发生变化(或其 开仓进场的价格，止损/止盈价格 或 到期日期 已更改)，但仍可获得此 订单 的数据。为确保收到有关 订单 的最新数据，建议在引用它们之前即时调用一次OrderSelect()。</p> <p>相关参考</p> <p>OrderGetInteger()， OrderGetDouble()， OrderGetString()， OrderCalcProfit()， OrderGetTicket()， 订单属性</p> <h2 id="_19-17-ordergetdouble"><a href="#_19-17-ordergetdouble" class="header-anchor">#</a> 19.17 OrderGetDouble</h2> <p>此函数请求返回一个 订单 的属性值，订单 是之前使用 OrderGetTicket 或者 OrderSelect选中的，请求获取的 订单属性 值必须是 双精度类型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">double</span>  <span class="token function">OrderGetDouble</span><span class="token punctuation">(</span> 
   ENUM_ORDER_PROPERTY_DOUBLE  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderGetDouble</span><span class="token punctuation">(</span> 
   ENUM_ORDER_PROPERTY_DOUBLE  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">double</span><span class="token operator">&amp;</span>                     double_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>property_id</p> <p>[in] 订单 的属性标识符，取值范围是 ENUM_ORDER_PROPERTY_DOUBLE 枚举值之一。</p> <p>double_var</p> <p>[out] 接收属性值的 双精度类型 变量。</p> <p>返回值</p> <p>双精度 值。如果函数失败，返回0。</p> <p>注意</p> <p>不要与 当前挂单 和/或 仓位 相混淆，它们也显示在客户端“工具箱”的“交易”标签中。订单是执行交易(deal)的请求，而 仓位(头寸) 是一个或多个交易的结果。</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保获取的是关于 订单 的最新数据，推荐调用此函数之前，即时调用一次 OrderSelect() 函数。</p> <p>相关参考</p> <p>OrdersTotal()， OrderGetTicket()， 订单属性</p> <h2 id="_19-18-ordergetinteger"><a href="#_19-18-ordergetinteger" class="header-anchor">#</a> 19.18 OrderGetInteger</h2> <p>此函数请求返回一个 订单 的属性值，订单 是之前使用 OrderGetTicket 或者 OrderSelect选中的，请求获取的 订单属性 值必须是 日期时间型，整数型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">OrderGetInteger</span><span class="token punctuation">(</span> 
   ENUM_ORDER_PROPERTY_INTEGER  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderGetInteger</span><span class="token punctuation">(</span> 
   ENUM_ORDER_PROPERTY_INTEGER  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">long</span><span class="token operator">&amp;</span>                        long_var           <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>property_id</p> <p>[in] 订单 的属性标识符，取值范围是ENUM_ORDER_PROPERTY_INTEGER枚举值之一。</p> <p>long_var</p> <p>[out] 接收属性值的 长整数类型 变量。</p> <p>返回值</p> <p>长整数 值。如果函数失败，返回0。</p> <p>注意</p> <p>不要与 当前挂单 和/或 仓位 相混淆，它们也显示在客户端“工具箱”的“交易”标签中。订单是执行交易(deal)的请求，而 仓位(头寸) 是一个或多个交易的结果。</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保获取的是关于 订单 的最新数据，推荐调用此函数之前，即时调用一次 OrderSelect() 函数。</p> <p>相关参考</p> <p>OrdersTotal()， OrderGetTicket()， 订单属性</p> <h2 id="_19-19-ordergetstring"><a href="#_19-19-ordergetstring" class="header-anchor">#</a> 19.19 OrderGetString</h2> <p>此函数请求返回一个 订单 的属性值，订单 是之前使用 OrderGetTicket 或者 OrderSelect选中的，请求获取的 订单属性 值必须是 字符串类型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string  <span class="token function">OrderGetString</span><span class="token punctuation">(</span> 
   ENUM_ORDER_PROPERTY_STRING  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">OrderGetString</span><span class="token punctuation">(</span> 
   ENUM_ORDER_PROPERTY_STRING  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   string<span class="token operator">&amp;</span>                     string_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>property_id</p> <p>[in] 订单 的属性标识符，取值范围是 ENUM_ORDER_PROPERTY_STRING 枚举值之一。</p> <p>string_var</p> <p>[out] 接收属性值的 字符串类型 变量。</p> <p>返回值</p> <p>字符串类型 值。如果函数失败，返回0。</p> <p>注意</p> <p>不要与 当前挂单 和/或 仓位 相混淆，它们也显示在客户端“工具箱”的“交易”标签中。订单是执行交易(deal)的请求，而 仓位(头寸) 是一个或多个交易的结果。</p> <p>对于&quot;单边&quot; 持仓 (ACCOUNT_MARGIN_MODE_RETAIL_NETTING 和 ACCOUNT_MARGIN_MODE_EXCHANGE)，无论任何时候一个交易品种只可能存在一个持有仓位。仓位 是一个或多个 交易 的结果。不要将 仓位 与有效的挂单相混淆，这些订单也显示在工具箱窗口的交易标签上。</p> <p>如果允许单独持仓头寸(ACCOUNT_MARGIN_MODE_RETAIL_HEDGING)，那么则可以为一个 交易品种 同时打开持有多个头寸。</p> <p>为确保获取的是关于 订单 的最新数据，推荐调用此函数之前，即时调用一次 OrderSelect() 函数。</p> <p>相关参考</p> <p>OrdersTotal()， OrderGetTicket()， 订单属性</p> <h2 id="_19-20-historyselect"><a href="#_19-20-historyselect" class="header-anchor">#</a> 19.20 HistorySelect</h2> <p>按指定的时间段，检索服务器上的交易和订单的历史记录。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistorySelect</span><span class="token punctuation">(</span> 
   datetime  from_date<span class="token punctuation">,</span>     <span class="token comment">// 开始日期 </span>
   datetime  to_date        <span class="token comment">// 结束日期 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>参数</p> <p>from_date</p> <p>[in] 请求检索的开始日期。</p> <p>to_date</p> <p>[in] 请求检索的结束日期。</p> <p>返回值</p> <p>如果成功返回true，否则返回false。</p> <p>注意</p> <p>HistorySelect()在MQL5程序中创建一个订单列表和一个交易列表，以便进一步使用相应的函数引用列表中的元素。交易清单列表的大小可以使用HistoryDealsTotal()函数返回; 历史订单列表的大小可以使用HistoryOrdersTotal()函数返回。在 订单列表 中选择某一条记录，使用 HistoryOrderGetTicket()更适合。在 交易列表 中选择某一条记录，使用 HistoryDealGetTicket() 更适合。</p> <p>在使用 HistoryOrderSelect()后，MQL5程序中可用的历史 订单列表 就会重设，如果成功执行了 HistoryOrderSelect()函数，则列表会被新发现的订单填满。这同样适用于MQL5程序中可用的 交易列表 —— 通过执行 HistoryDealSelect()函数重设更表并再次成功填满新发现的 交易 记录。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   color BuyColor <span class="token operator">=</span>clrBlue<span class="token punctuation">;</span> 
   color SellColor<span class="token operator">=</span>clrRed<span class="token punctuation">;</span> 
<span class="token comment">//--- 请求交易历史记录 </span>
   <span class="token function">HistorySelect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 创建物件 </span>
   string   name<span class="token punctuation">;</span> 
   uint     total<span class="token operator">=</span><span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   ulong    ticket<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   price<span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   profit<span class="token punctuation">;</span> 
   datetime time<span class="token punctuation">;</span> 
   string   symbol<span class="token punctuation">;</span> 
   <span class="token keyword">long</span>     type<span class="token punctuation">;</span> 
   <span class="token keyword">long</span>     entry<span class="token punctuation">;</span> 
<span class="token comment">//--- 所有交易 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>uint i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 尝试获取 交易(deal) 单的编号 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ticket<span class="token operator">=</span><span class="token function">HistoryDealGetTicket</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 获得交易单属性 </span>
         price <span class="token operator">=</span><span class="token function">HistoryDealGetDouble</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>DEAL_PRICE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         time  <span class="token operator">=</span><span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>DEAL_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         symbol<span class="token operator">=</span><span class="token function">HistoryDealGetString</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>DEAL_SYMBOL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         type  <span class="token operator">=</span><span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>DEAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         entry <span class="token operator">=</span><span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>DEAL_ENTRY<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         profit<span class="token operator">=</span><span class="token function">HistoryDealGetDouble</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>DEAL_PROFIT<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 只对当前交易品种 </span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>price <span class="token operator">&amp;&amp;</span> time <span class="token operator">&amp;&amp;</span> symbol<span class="token operator">==</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
           <span class="token punctuation">{</span> 
            <span class="token comment">//--- 创建价格对象 </span>
            name<span class="token operator">=</span><span class="token string">&quot;TradeHistory_Deal_&quot;</span><span class="token operator">+</span><span class="token function">string</span><span class="token punctuation">(</span>ticket<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span> <span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJ_ARROW_RIGHT_PRICE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>time<span class="token punctuation">,</span>price<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">else</span>      <span class="token function">ObjectCreate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJ_ARROW_LEFT_PRICE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>time<span class="token punctuation">,</span>price<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">//--- 设置物件属性 </span>
            <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_SELECTABLE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_BACK<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token function">ObjectSetInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_COLOR<span class="token punctuation">,</span>type<span class="token operator">?</span>BuyColor<span class="token operator">:</span>SellColor<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token keyword">if</span><span class="token punctuation">(</span>profit<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">ObjectSetString</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>name<span class="token punctuation">,</span>OBJPROP_TEXT<span class="token punctuation">,</span><span class="token string">&quot;Profit: &quot;</span><span class="token operator">+</span><span class="token function">string</span><span class="token punctuation">(</span>profit<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
           <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- 应用于图表 </span>
   <span class="token function">ChartRedraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>相关参考<br>
HistoryOrderSelect()， HistoryDealSelect(),HistorySelectByPosition</p> <p>根据 仓位标识符 检索历史记录中的交易和订单。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistorySelectByPosition</span><span class="token punctuation">(</span> 
   <span class="token keyword">long</span>   position_id     <span class="token comment">// 仓位标识符 - POSITION_IDENTIFIER </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>position_id</p> <p>[in] 仓位标识符，对应每个已执行成功的交易单 和 交易。</p> <p>返回值</p> <p>如果成功返回TRUE值，否则返回错误值。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>HistorySelectByPosition()在MQL5程序中创建一个订单列表和一个具有指定 仓位标识符 的交易(deal)单列表，以便进一步使用相应的函数引用列表中的元素。要获取交易(deal)单列表的大小，可以使用函数HistoryDealsTotal()。要获取 历史订单列表的大小，可以使用函数HistoryOrdersTotal()。要遍历 历史订单列表 中的所有元素，请使用HistoryOrderGetTicket()，要遍历 交易(deal)单列表 中的所有元素，请使用HistoryDealGetTicket()。</p> <p>在使用 HistoryOrderSelect()后，MQL5程序中可用的历史 订单列表 就会重设，如果成功执行了 HistoryOrderSelect()函数，则列表会被新发现的订单填满。这同样适用于MQL5程序中可用的 交易列表 —— 通过执行 HistoryDealSelect()函数重设更表并再次成功填满新发现的 交易 记录。</p> <p>相关参考</p> <p>HistorySelect()， HistoryOrderGetTicket()， 订单属性</p> <h2 id="_19-21-historyselectbyposition"><a href="#_19-21-historyselectbyposition" class="header-anchor">#</a> 19.21 HistorySelectByPosition</h2> <p>检索特殊位置标识符交易和订单历史记录。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistorySelectByPosition</span><span class="token punctuation">(</span>
   <span class="token keyword">long</span>   position_id     <span class="token comment">// 仓位标识符 - POSITION_IDENTIFIER</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参量</p> <p>position_id</p> <p>[in] 位置标识符设置每个已执行命令和每笔交易。</p> <p>返回值</p> <p>如果成功返回真值，否则返回错误值。</p> <p>注释</p> <p>不能把出现在客户端&quot;工具箱&quot;的&quot;交易&quot; 标签中的当前挂单和交易历史订单弄乱。取消的或者导致的交易的订单列表可以在&quot;工具箱&quot;客户端中的&quot;历史记录&quot;标签浏览。</p> <p>HistorySelectByPosition()建立一系列命令列表和MQL5程序的交易，使用类似 仓位标识符 函数来执行列表元素。订单列表大小可以使用 HistoryDealsTotal(),函数返回。使用HistoryOrdersTotal()。可以显示历史订单列表的大小。使用HistoryOrderGetTicket(),运行订单列表元素，订单列表元素— HistoryDealGetTicket()。</p> <p>在使用 HistoryOrderSelect(), 后，MQL5程序中的历史可用订单列表就会重设并被发现的订单填满。如果成功执行 通过报价搜索订单同样适用于MQL5程序可行性订单中-通过 HistoryDealSelect() 重设并再次成功填满。</p> <p>另见</p> <p>HistorySelect()， HistoryOrderGetTicket()， 订单属性</p> <h2 id="_19-22-historyorderselect"><a href="#_19-22-historyorderselect" class="header-anchor">#</a> 19.22 HistoryOrderSelect</h2> <p>从历史记录中选择一个订单，以便进一步使用适当的函数调用它。如果该函数操作成功，将返回true。如果函数操作失败，则返回false。 要想获取有关错误的更详细信息，可以调用GetLastError()函数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryOrderSelect</span><span class="token punctuation">(</span> 
   ulong  ticket      <span class="token comment">// 订单号 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>ticket</p> <p>[in] 订单编号。</p> <p>返回值</p> <p>如果成功，返回真值，否则返回错误值。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>HistoryOrderSelect()在MQL5程序从历史记录中删除一系列订单，如果成功执行HistoryOrderSelect ()，可用调用和复制的单个字节，如果需要通过 HistorySelect()运行所有订单，最好使用 HistoryOrderGetTicket()。</p> <p>如果HistoryOrderSelect()的执行已成功完成，则HistoryOrderSelect()会在MQL5程序中清除历史记录中可用于调用的订单列表，并将复制其中一个订单。如果您需要遍历HistorySelect()所选择的所有交易，则最好使用HistoryOrderGetTicket()函数。</p> <p>相关参考</p> <p>HistorySelect()， HistoryOrderGetTicket()， 订单属性</p> <h2 id="_19-23-historyorderstotal"><a href="#_19-23-historyorderstotal" class="header-anchor">#</a> 19.23 HistoryOrdersTotal</h2> <p>返回历史记录中订单的总数量。在调用HistoryOrdersTotal()之前，首先需要使用HistorySelect()或者 HistorySelectByPosition() 函数接收 交易(deal)单 和 订单 的历史记录。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回值</p> <p>整数型数值。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>相关参考</p> <p>HistorySelect()， HistoryOrderSelect()， HistoryOrderGetTicket()， 订单属性</p> <h2 id="_19-24-historyordergetticket"><a href="#_19-24-historyordergetticket" class="header-anchor">#</a> 19.24 HistoryOrderGetTicket</h2> <p>根据指定的 索引编号 返回历史记录中相应的订单。在调用HistoryOrderGetTicket()之前，首先需要使用HistorySelect()或者 HistorySelectByPosition() 函数接收 交易(deal)单 和 订单 的历史记录。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ulong  <span class="token function">HistoryOrderGetTicket</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  index      <span class="token comment">// 订单列表中的索引编号数字  从0 开始 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>index</p> <p>[in] 订单列表中的索引编号数字，从0 开始。</p> <p>返回值</p> <p>无符号长整型数值。如果函数失败，则返回0。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   datetime from<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> 
   datetime to<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 要求全部历史记录 </span>
   <span class="token function">HistorySelect</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 返回订单属性值变量 </span>
   ulong    ticket<span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   open_price<span class="token punctuation">;</span> 
   <span class="token keyword">double</span>   initial_volume<span class="token punctuation">;</span> 
   datetime time_setup<span class="token punctuation">;</span> 
   datetime time_done<span class="token punctuation">;</span> 
   string   symbol<span class="token punctuation">;</span> 
   string   type<span class="token punctuation">;</span> 
   <span class="token keyword">long</span>     order_magic<span class="token punctuation">;</span> 
   <span class="token keyword">long</span>     positionID<span class="token punctuation">;</span> 
<span class="token comment">//--- 当前挂单数量 </span>
   uint     total<span class="token operator">=</span><span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//--- 循环检测通过订单 </span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>uint i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> total<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token comment">//--- 通过其列表中的位置返回订单报价 </span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ticket<span class="token operator">=</span><span class="token function">HistoryOrderGetTicket</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span> 
         <span class="token comment">//--- 返回订单属性 </span>
         open_price<span class="token operator">=</span>       <span class="token function">HistoryOrderGetDouble</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_PRICE_OPEN<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         time_setup<span class="token operator">=</span>       <span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_TIME_SETUP<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         time_done<span class="token operator">=</span>        <span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_TIME_DONE<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         symbol<span class="token operator">=</span>           <span class="token function">HistoryOrderGetString</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_SYMBOL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         order_magic<span class="token operator">=</span>      <span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_MAGIC<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         positionID <span class="token operator">=</span>      <span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_POSITION_ID<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         initial_volume<span class="token operator">=</span>   <span class="token function">HistoryOrderGetDouble</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_VOLUME_INITIAL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
         type<span class="token operator">=</span><span class="token function">GetOrderType</span><span class="token punctuation">(</span><span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>ticket<span class="token punctuation">,</span>ORDER_TYPE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
         <span class="token comment">//--- 准备并显示订单信息 </span>
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;#ticket %d %s %G %s at %G was set up at %s =&gt; done at %s, pos ID=%d&quot;</span><span class="token punctuation">,</span> 
                ticket<span class="token punctuation">,</span>                  <span class="token comment">// 订单报价 </span>
                type<span class="token punctuation">,</span>                    <span class="token comment">// 类型 </span>
                initial_volume<span class="token punctuation">,</span>          <span class="token comment">// 已下的交易量 </span>
                symbol<span class="token punctuation">,</span>                  <span class="token comment">// 交易品种 </span>
                open_price<span class="token punctuation">,</span>              <span class="token comment">// 规定的开盘价 </span>
                <span class="token function">TimeToString</span><span class="token punctuation">(</span>time_setup<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 下订单时间 </span>
                <span class="token function">TimeToString</span><span class="token punctuation">(</span>time_done<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 订单执行或者删除时间 </span>
                positionID               <span class="token comment">// 一个包括订单交易的仓位ID </span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
     <span class="token punctuation">}</span> 
<span class="token comment">//--- </span>
  <span class="token punctuation">}</span> 
<span class="token comment">//+------------------------------------------------------------------+ </span>
<span class="token comment">//| 返回订单类型字符串名称                                              | </span>
<span class="token comment">//+------------------------------------------------------------------+ </span>
string <span class="token function">GetOrderType</span><span class="token punctuation">(</span><span class="token keyword">long</span> type<span class="token punctuation">)</span> 
  <span class="token punctuation">{</span> 
   string str_type<span class="token operator">=</span><span class="token string">&quot;unknown operation&quot;</span><span class="token punctuation">;</span> 
   <span class="token keyword">switch</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> 
     <span class="token punctuation">{</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_BUY<span class="token punctuation">)</span><span class="token operator">:</span>            <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;buy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_SELL<span class="token punctuation">)</span><span class="token operator">:</span>           <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;sell&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_BUY_LIMIT<span class="token punctuation">)</span><span class="token operator">:</span>      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;buy limit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_SELL_LIMIT<span class="token punctuation">)</span><span class="token operator">:</span>     <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;sell limit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_BUY_STOP<span class="token punctuation">)</span><span class="token operator">:</span>       <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;buy stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_SELL_STOP<span class="token punctuation">)</span><span class="token operator">:</span>      <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;sell stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_BUY_STOP_LIMIT<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;buy stop limit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">case</span> <span class="token punctuation">(</span>ORDER_TYPE_SELL_STOP_LIMIT<span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">&quot;sell stop limit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token punctuation">}</span> 
   <span class="token keyword">return</span><span class="token punctuation">(</span>str_type<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p>相关参考</p> <p>HistorySelect()， HistoryOrdersTotal()， HistoryOrderSelect()， 订单属性</p> <h2 id="_19-25-historyordergetstring"><a href="#_19-25-historyordergetstring" class="header-anchor">#</a> 19.25 HistoryOrderGetString</h2> <p>此函数请求返回一个 历史订单 的属性值，请求获取的 历史订单 的属性值必须是 字符串型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string  <span class="token function">HistoryOrderGetString</span><span class="token punctuation">(</span> 
   ulong                       ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_ORDER_PROPERTY_STRING  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryOrderGetString</span><span class="token punctuation">(</span> 
   ulong                       ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_ORDER_PROPERTY_STRING  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   string<span class="token operator">&amp;</span>                     string_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>ticket_number</p> <p>[in] 订单编号。</p> <p>property_id</p> <p>[in] 订单属性标识符。取值范围是 ENUM_ORDER_PROPERTY_STRING 枚举值之一。</p> <p>string_var</p> <p>[out] 字符串型变量。</p> <p>返回值</p> <p>字符串。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>相关参考</p> <p>HistorySelect()， HistoryOrdersTotal()， HistoryOrderSelect()， 订单属性</p> <h2 id="_19-26-historyordergetdouble"><a href="#_19-26-historyordergetdouble" class="header-anchor">#</a> 19.26 HistoryOrderGetDouble</h2> <p>此函数请求返回一个 历史订单 的属性值，请求获取的 历史订单 的属性值必须是 双精度类型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">double</span>  <span class="token function">HistoryOrderGetDouble</span><span class="token punctuation">(</span> 
   ulong                       ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_ORDER_PROPERTY_DOUBLE  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryOrderGetDouble</span><span class="token punctuation">(</span> 
   ulong                       ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_ORDER_PROPERTY_DOUBLE  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">double</span><span class="token operator">&amp;</span>                     double_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>ticket_number</p> <p>[in] 订单编号。</p> <p>property_id</p> <p>[in] 订单属性标识符。取值范围是 ENUM_ORDER_PROPERTY_DOUBLE 枚举值之一。</p> <p>string_var</p> <p>[out] 双精度类型变量。</p> <p>返回值</p> <p>双精度型数值。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>相关参考</p> <p>HistorySelect()， HistoryOrdersTotal()， HistoryOrderSelect()， 订单属性</p> <h2 id="_19-27-historyordergetinteger"><a href="#_19-27-historyordergetinteger" class="header-anchor">#</a> 19.27 HistoryOrderGetInteger</h2> <p>此函数请求返回一个 历史订单 的属性值，请求获取的 历史订单 的属性值必须是 整数型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span> 
   ulong                        ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_ORDER_PROPERTY_INTEGER  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span> 
   ulong                        ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_ORDER_PROPERTY_INTEGER  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">long</span><span class="token operator">&amp;</span>                        long_var           <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参数</p> <p>ticket_number</p> <p>[in] 订单编号。</p> <p>property_id</p> <p>[in] 订单属性标识符。取值范围是 ENUM_ORDER_PROPERTY_INTEGER 枚举值之一。</p> <p>string_var</p> <p>[out] 整数型变量。</p> <p>返回值</p> <p>整数型数值。</p> <p>注意</p> <p>不要将 出现在客户端&quot;工具箱&quot;的&quot;交易&quot;标签中的 当前挂单 与 历史交易(deal)单 混为一谈。可以在客户终端的“工具箱”的“历史记录”标签中查看已被取消 或 已成交的订单列表。</p> <p>例如：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 交易函数                                                          |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 从周交易历史记录接收最后订单的标签</span>
   ulong last_order<span class="token operator">=</span><span class="token function">GetLastOrderTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HistoryOrderSelect</span><span class="token punctuation">(</span>last_order<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 从1970.01.01起以毫秒为单位下单的时间</span>
      <span class="token keyword">long</span> time_setup_msc<span class="token operator">=</span><span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>last_order<span class="token punctuation">,</span>ORDER_TIME_SETUP_MSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Order #%d ORDER_TIME_SETUP_MSC=%i64 =&gt; %s&quot;</span><span class="token punctuation">,</span>
                  last_order<span class="token punctuation">,</span>time_setup_msc<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>time_setup_msc<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 从1970.01.01起以毫秒为单位执行/取消订单的时间</span>
      <span class="token keyword">long</span>  time_done_msc<span class="token operator">=</span><span class="token function">HistoryOrderGetInteger</span><span class="token punctuation">(</span>last_order<span class="token punctuation">,</span>ORDER_TIME_DONE_MSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Order #%d ORDER_TIME_DONE_MSC=%i64 =&gt; %s&quot;</span><span class="token punctuation">,</span>
                  last_order<span class="token punctuation">,</span>time_done_msc<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>time_done_msc<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span> <span class="token comment">// 通知失败</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistoryOrderSelect() failed for #%d. Eror code=%d&quot;</span><span class="token punctuation">,</span>
                  last_order<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 返回历史记录中最后订单的标签或-1                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
ulong <span class="token function">GetLastOrderTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 请求最近7天的历史记录</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetTradeHistory</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 通知不成功的调用和返回-1</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot; HistorySelect() returned false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- </span>
   ulong first_order<span class="token punctuation">,</span>last_order<span class="token punctuation">,</span>orders<span class="token operator">=</span><span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果有，从事订单工作</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>orders<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Orders = &quot;</span><span class="token punctuation">,</span>orders<span class="token punctuation">)</span><span class="token punctuation">;</span>
      first_order<span class="token operator">=</span><span class="token function">HistoryOrderGetTicket</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;first_order = %d&quot;</span><span class="token punctuation">,</span>first_order<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>orders<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         last_order<span class="token operator">=</span><span class="token function">HistoryOrderGetTicket</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>orders<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;last_order = %d&quot;</span><span class="token punctuation">,</span>last_order<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> last_order<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">return</span> first_order<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 未发现订单，返回 -1</span>
   <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+--------------------------------------------------------------------------+</span>
<span class="token comment">//| 请求最近几日的历史记录，如果失败，则返回false                                   |</span>
<span class="token comment">//+--------------------------------------------------------------------------+</span>
<span class="token keyword">bool</span> <span class="token function">GetTradeHistory</span><span class="token punctuation">(</span><span class="token keyword">int</span> days<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 设置一个星期的周期请求交易历史记录</span>
   datetime to<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   datetime from<span class="token operator">=</span>to<span class="token operator">-</span>days<span class="token operator">*</span><span class="token function">PeriodSeconds</span><span class="token punctuation">(</span>PERIOD_D1<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 发出请求检察结果</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">HistorySelect</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot; HistorySelect=false. Error code=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 成功接收历史记录</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p>相关参考<br>
HistorySelect()， HistoryOrdersTotal()， HistoryOrderSelect()， 订单属性</p> <h2 id="_19-28-historydealselect"><a href="#_19-28-historydealselect" class="header-anchor">#</a> 19.28 HistoryDealSelect</h2> <p>从历史记录中选择一个 交易(deal)单，以便进一步使用适当的函数调用它。如果该函数操作成功，将返回true。如果函数操作失败，则返回false。要想获取有关错误的更详细信息，可以调用GetLastError()函数。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryDealSelect</span><span class="token punctuation">(</span> 
   ulong  ticket      <span class="token comment">// 交易订单号 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>ticket</p> <p>[in] 交易订单号。</p> <p>返回值</p> <p>如果成功返回TRUE值，否则返回错误值。</p> <p>注释</p> <p>不要弄混 订单(orders)，交易(deals) 和 仓位(positions)。每笔 交易(deal) 的结果都是执行订单(order)，每个 仓位(positions) 都是一个或多个 交易(deals) 的汇总结果。</p> <p>如果HistoryDealSelect的执行已成功完成，则HistoryDealSelect会在MQL5程序中清除历史记录中可用于调用的 交易(deal)单 列表，并将复制其中一条交易单的记录。如果您需要遍历HistorySelect()所选择的所有交易，则最好使用HistoryDealGetTicket函数。</p> <p>相关参考</p> <p>HistorySelect()， HistoryDealGetTicket()， 交易属性</p> <h2 id="_19-29-historydealstotal"><a href="#_19-29-historydealstotal" class="header-anchor">#</a> 19.29 HistoryDealsTotal</h2> <p>返回历史 交易(deal) 总数量。在调用HistoryDealsTotal之前，首先需要使用HistorySelect()或者 HistorySelectByPosition() 函数接收 交易(deal)单 和 订单 的历史记录。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">int</span>  <span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>返回值</p> <p>整数型数值。</p> <p>注意</p> <p>不要弄混 订单(orders)，交易(deals) 和 仓位(positions)。每笔 交易(deal) 的结果都是执行订单(order)，每个 仓位(positions) 都是一个或多个 交易(deals) 的汇总结果。</p> <p>相关参考</p> <p>HistorySelect()， HistoryDealGetTicket()， 交易属性</p> <h2 id="_19-30-historydealgetticket"><a href="#_19-30-historydealgetticket" class="header-anchor">#</a> 19.30 HistoryDealGetTicket</h2> <p>根据指定的 索引编号 返回历史记录中相应的 交易(deal)单。在调用HistoryDealGetTicket()之前，首先需要使用HistorySelect()或者 HistorySelectByPosition() 函数接收 交易(deal)单 和 订单 的历史记录。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>ulong  <span class="token function">HistoryDealGetTicket</span><span class="token punctuation">(</span> 
   <span class="token keyword">int</span>  index      <span class="token comment">// 交易单的索引编号</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>参数</p> <p>index</p> <p>[in] 交易单列表中的索引编号。</p> <p>返回值</p> <p>无符号长整型数值。如果函数失败，则返回0。</p> <p>不要弄混 订单(orders)，交易(deals) 和 仓位(positions)。每笔 交易(deal) 的结果都是执行订单(order)，每个 仓位(positions) 都是一个或多个 交易(deals) 的汇总结果。</p> <p>示例:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">OnStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   ulong deal_ticket<span class="token punctuation">;</span>            <span class="token comment">// 交易订单号</span>
   ulong order_ticket<span class="token punctuation">;</span>           <span class="token comment">// 执行交易的订单的订单号</span>
   datetime transaction_time<span class="token punctuation">;</span>    <span class="token comment">// 交易执行时间 </span>
   <span class="token keyword">long</span> deal_type <span class="token punctuation">;</span>              <span class="token comment">// 交易操作类型</span>
   <span class="token keyword">long</span> position_ID<span class="token punctuation">;</span>             <span class="token comment">// 仓位ID</span>
   string deal_description<span class="token punctuation">;</span>      <span class="token comment">// 操作描述</span>
   <span class="token keyword">double</span> volume<span class="token punctuation">;</span>                <span class="token comment">// 操作交易量</span>
   string symbol<span class="token punctuation">;</span>                <span class="token comment">// 交易的交易品种</span>
<span class="token comment">//--- 设置交易历史记录请求的起止时间</span>
   datetime from_date<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>         <span class="token comment">// 从最开始</span>
   datetime to_date<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 到当前时间</span>
<span class="token comment">//--- 特定周期中请求交易历史记录</span>
   <span class="token function">HistorySelect</span><span class="token punctuation">(</span>from_date<span class="token punctuation">,</span>to_date<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 交易列表中的全部数量</span>
   <span class="token keyword">int</span> deals<span class="token operator">=</span><span class="token function">HistoryDealsTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 现在处理每一个交易</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>deals<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      deal_ticket<span class="token operator">=</span>               <span class="token function">HistoryDealGetTicket</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      volume<span class="token operator">=</span>                    <span class="token function">HistoryDealGetDouble</span><span class="token punctuation">(</span>deal_ticket<span class="token punctuation">,</span>DEAL_VOLUME<span class="token punctuation">)</span><span class="token punctuation">;</span>
      transaction_time<span class="token operator">=</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>deal_ticket<span class="token punctuation">,</span>DEAL_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
      order_ticket<span class="token operator">=</span>              <span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>deal_ticket<span class="token punctuation">,</span>DEAL_ORDER<span class="token punctuation">)</span><span class="token punctuation">;</span>
      deal_type<span class="token operator">=</span>                 <span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>deal_ticket<span class="token punctuation">,</span>DEAL_TYPE<span class="token punctuation">)</span><span class="token punctuation">;</span>
      symbol<span class="token operator">=</span>                    <span class="token function">HistoryDealGetString</span><span class="token punctuation">(</span>deal_ticket<span class="token punctuation">,</span>DEAL_SYMBOL<span class="token punctuation">)</span><span class="token punctuation">;</span>
      position_ID<span class="token operator">=</span>               <span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>deal_ticket<span class="token punctuation">,</span>DEAL_POSITION_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
      deal_description<span class="token operator">=</span>          <span class="token function">GetDealDescription</span><span class="token punctuation">(</span>deal_type<span class="token punctuation">,</span>volume<span class="token punctuation">,</span>symbol<span class="token punctuation">,</span>order_ticket<span class="token punctuation">,</span>position_ID<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 为交易号执行格式化</span>
      string print_index<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;% 3d&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//--- 显示交易信息</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>print_index<span class="token operator">+</span><span class="token string">&quot;: deal #&quot;</span><span class="token punctuation">,</span>deal_ticket<span class="token punctuation">,</span><span class="token string">&quot; at &quot;</span><span class="token punctuation">,</span>transaction_time<span class="token punctuation">,</span>deal_description<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 返回操作的字符串描述                                                |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
string <span class="token function">GetDealDescription</span><span class="token punctuation">(</span><span class="token keyword">long</span> deal_type<span class="token punctuation">,</span><span class="token keyword">double</span> volume<span class="token punctuation">,</span>string symbol<span class="token punctuation">,</span><span class="token keyword">long</span> ticket<span class="token punctuation">,</span><span class="token keyword">long</span> pos_ID<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
   string descr<span class="token punctuation">;</span>
<span class="token comment">//---</span>
   <span class="token keyword">switch</span><span class="token punctuation">(</span>deal_type<span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token keyword">case</span> DEAL_TYPE_BALANCE<span class="token operator">:</span>                  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_CREDIT<span class="token operator">:</span>                   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;credit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_CHARGE<span class="token operator">:</span>                   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;charge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_CORRECTION<span class="token operator">:</span>               <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;correction&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_BUY<span class="token operator">:</span>                      descr<span class="token operator">=</span><span class="token string">&quot;buy&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_SELL<span class="token operator">:</span>                     descr<span class="token operator">=</span><span class="token string">&quot;sell&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_BONUS<span class="token operator">:</span>                    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;bonus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_COMMISSION<span class="token operator">:</span>               <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;additional commission&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_COMMISSION_DAILY<span class="token operator">:</span>         <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;daily commission&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_COMMISSION_MONTHLY<span class="token operator">:</span>       <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;monthly commission&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_COMMISSION_AGENT_DAILY<span class="token operator">:</span>   <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;daily agent commission&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_COMMISSION_AGENT_MONTHLY<span class="token operator">:</span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;monthly agent commission&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_INTEREST<span class="token operator">:</span>                 <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">&quot;interest rate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_BUY_CANCELED<span class="token operator">:</span>             descr<span class="token operator">=</span><span class="token string">&quot;cancelled buy deal&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> DEAL_TYPE_SELL_CANCELED<span class="token operator">:</span>            descr<span class="token operator">=</span><span class="token string">&quot;cancelled sell deal&quot;</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   descr<span class="token operator">=</span><span class="token function">StringFormat</span><span class="token punctuation">(</span><span class="token string">&quot;%s %G %s (order #%d, position ID %d)&quot;</span><span class="token punctuation">,</span>
                      descr<span class="token punctuation">,</span>  <span class="token comment">// 当前描述。</span>
                      volume<span class="token punctuation">,</span> <span class="token comment">// 交易的交易量。</span>
                      symbol<span class="token punctuation">,</span> <span class="token comment">// 交易的交易品种。</span>
                      ticket<span class="token punctuation">,</span> <span class="token comment">// 引起交易的订单的订单号。</span>
                      pos_ID  <span class="token comment">// 仓位交易执行的ID号。</span>
                      <span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span><span class="token punctuation">(</span>descr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><p>相关参考<br>
HistorySelect()， HistoryDealsTotal()， HistoryDealSelect()， 交易属性</p> <h2 id="_19-31-historydealgetdouble"><a href="#_19-31-historydealgetdouble" class="header-anchor">#</a> 19.31 HistoryDealGetDouble</h2> <p>此函数请求返回一个 历史交易(deal)单 的属性值，请求获取的属性值必须是 双精度类型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">double</span>  <span class="token function">HistoryDealGetDouble</span><span class="token punctuation">(</span> 
   ulong                      ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_DEAL_PROPERTY_DOUBLE  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryDealGetDouble</span><span class="token punctuation">(</span> 
   ulong                      ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_DEAL_PROPERTY_DOUBLE  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">double</span><span class="token operator">&amp;</span>                    double_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参量</p> <p>ticket_number</p> <p>[in] 交易单编号。</p> <p>property_id</p> <p>[in] 交易属性标识符。取值范围是 ENUM_DEAL_PROPERTY_DOUBLE 枚举值之一。</p> <p>double_var</p> <p>[out] 接收属性值的双精度类型变量。</p> <p>返回值</p> <p>双精度型数值。</p> <p>注意</p> <p>不要弄混 订单(orders)，交易(deals) 和 仓位(positions)。每笔 交易(deal) 的结果都是执行订单(order)，每个 仓位(positions) 都是一个或多个 交易(deals) 的汇总结果。</p> <p>相关参考</p> <p>HistorySelect()， HistoryDealsTotal()， HistoryDealGetTicket(), 交易属性</p> <h2 id="_19-32-historydealgetinteger"><a href="#_19-32-historydealgetinteger" class="header-anchor">#</a> 19.32 HistoryDealGetInteger</h2> <p>此函数请求返回一个 历史交易(deal)单 的属性值，请求获取的属性值必须是 整数型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">long</span>  <span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span> 
   ulong                       ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_DEAL_PROPERTY_INTEGER  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span> 
   ulong                       ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_DEAL_PROPERTY_INTEGER  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   <span class="token keyword">long</span><span class="token operator">&amp;</span>                       long_var           <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参量</p> <p>ticket_number</p> <p>[in] 交易单编号。</p> <p>property_id</p> <p>[in] 交易属性标识符。取值范围是 ENUM_DEAL_PROPERTY_INTEGER 枚举值之一。</p> <p>long_var</p> <p>[out] 接收属性值的长整型变量。</p> <p>返回值</p> <p>长整型数值。</p> <p>注意</p> <p>不要弄混 订单(orders)，交易(deals) 和 仓位(positions)。每笔 交易(deal) 的结果都是执行订单(order)，每个 仓位(positions) 都是一个或多个 交易(deals) 的汇总结果。</p> <p>示例：</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 交易函数                                                          |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token keyword">void</span> <span class="token function">OnTrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 从周交易历史记录接收最后订单的标签</span>
   ulong last_deal<span class="token operator">=</span><span class="token function">GetLastDealTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HistoryDealSelect</span><span class="token punctuation">(</span>last_deal<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 从1970.01.01起以毫秒为单位的交易执行的时间</span>
      <span class="token keyword">long</span> deal_time_msc<span class="token operator">=</span><span class="token function">HistoryDealGetInteger</span><span class="token punctuation">(</span>last_deal<span class="token punctuation">,</span>DEAL_TIME_MSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;Deal #%d DEAL_TIME_MSC=%i64 =&gt; %s&quot;</span><span class="token punctuation">,</span>
                  last_deal<span class="token punctuation">,</span>deal_time_msc<span class="token punctuation">,</span><span class="token function">TimeToString</span><span class="token punctuation">(</span>deal_time_msc<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token keyword">else</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;HistoryDealSelect() failed for #%d. Eror code=%d&quot;</span><span class="token punctuation">,</span>
                  last_deal<span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//---</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
<span class="token comment">//| 返回历史记录中最后交易的标签或-1                                     |</span>
<span class="token comment">//+------------------------------------------------------------------+</span>
ulong <span class="token function">GetLastDealTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 请求最近7天的历史记录</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetTradeHistory</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token comment">//--- 通知不成功的调用和返回-1</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot; HistorySelect() returned false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- </span>
   ulong first_deal<span class="token punctuation">,</span>last_deal<span class="token punctuation">,</span>deals<span class="token operator">=</span><span class="token function">HistoryOrdersTotal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 如果有，从事订单工作</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>deals<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span><span class="token string">&quot;Deals = &quot;</span><span class="token punctuation">,</span>deals<span class="token punctuation">)</span><span class="token punctuation">;</span>
      first_deal<span class="token operator">=</span><span class="token function">HistoryDealGetTicket</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;first_deal = %d&quot;</span><span class="token punctuation">,</span>first_deal<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>deals<span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
         last_deal<span class="token operator">=</span><span class="token function">HistoryDealGetTicket</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>deals<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">PrintFormat</span><span class="token punctuation">(</span><span class="token string">&quot;last_deal = %d&quot;</span><span class="token punctuation">,</span>last_deal<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">return</span> last_deal<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">return</span> first_deal<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 未发现成交，返回 -1</span>
   <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token comment">//+--------------------------------------------------------------------------+</span>
<span class="token comment">//| 请求最近几日的历史记录，如果失败，则返回false                                   |</span>
<span class="token comment">//+--------------------------------------------------------------------------+</span>
<span class="token keyword">bool</span> <span class="token function">GetTradeHistory</span><span class="token punctuation">(</span><span class="token keyword">int</span> days<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
<span class="token comment">//--- 设置一个星期的周期请求交易历史记录</span>
   datetime to<span class="token operator">=</span><span class="token function">TimeCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   datetime from<span class="token operator">=</span>to<span class="token operator">-</span>days<span class="token operator">*</span><span class="token function">PeriodSeconds</span><span class="token punctuation">(</span>PERIOD_D1<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">ResetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//--- 发出请求检察结果</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">HistorySelect</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span>to<span class="token punctuation">)</span><span class="token punctuation">)</span>
     <span class="token punctuation">{</span>
      <span class="token function">Print</span><span class="token punctuation">(</span>__FUNCTION__<span class="token punctuation">,</span><span class="token string">&quot; HistorySelect=false. Error code=&quot;</span><span class="token punctuation">,</span><span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token comment">//--- 成功接收历史记录</span>
   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>相关参考<br>
HistorySelect()， HistoryDealsTotal()， HistoryDealGetTicket(), 交易属性</p> <h2 id="_19-33-historydealgetstring"><a href="#_19-33-historydealgetstring" class="header-anchor">#</a> 19.33 HistoryDealGetString</h2> <p>此函数请求返回一个 历史交易(deal)单 的属性值，请求获取的属性值必须是 字符串型，此函数有两种变体。</p> <ol><li>直接返回属性值。</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>string  <span class="token function">HistoryDealGetString</span><span class="token punctuation">(</span> 
   ulong                      ticket_number<span class="token punctuation">,</span>     <span class="token comment">// 订单号 </span>
   ENUM_DEAL_PROPERTY_STRING  property_id        <span class="token comment">// 属性标识符 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>依据函数是否成功调用返回TRUE 或 FALSE。如果成功，属性值被保存在形式参数中</li></ol> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">bool</span>  <span class="token function">HistoryDealGetString</span><span class="token punctuation">(</span> 
   ulong                      ticket_number<span class="token punctuation">,</span>     <span class="token comment">//订单号 </span>
   ENUM_DEAL_PROPERTY_STRING  property_id<span class="token punctuation">,</span>       <span class="token comment">// 属性标识符 </span>
   string<span class="token operator">&amp;</span>                    string_var         <span class="token comment">// 这里接受属性值 </span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>参量</p> <p>ticket_number</p> <p>[in] 交易单编号。</p> <p>property_id</p> <p>[in] 交易属性标识符。取值范围是 ENUM_DEAL_PROPERTY_STRING 枚举值之一。</p> <p>string_var [out] 接收属性值的长整型变量。</p> <p>返回值</p> <p>字符串型数值。</p> <p>注意</p> <p>不要弄混 订单(orders)，交易(deals) 和 仓位(positions)。每笔 交易(deal) 的结果都是执行订单(order)，每个 仓位(positions) 都是一个或多个 交易(deals) 的汇总结果。</p> <p>相关参考</p> <p>HistorySelect()， HistoryDealsTotal()， HistoryDealGetTicket(), 交易属性</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/mql5yao/Chapter/eighteen.html" class="prev">
        19 第十九章 图表操作
      </a></span> <span class="next"><a href="/mql5yao/Chapter/twenty.html">
        21 第廿一章 交易信号
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/mql5yao/assets/js/app.8a48e4d1.js" defer></script><script src="/mql5yao/assets/js/2.8ccfeae3.js" defer></script><script src="/mql5yao/assets/js/1.abd3212e.js" defer></script><script src="/mql5yao/assets/js/49.0b669611.js" defer></script>
  </body>
</html>
